(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){(function(global){(function(factory){var root=typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global;if(typeof define==="function"&&define.amd){define(["underscore","jquery","exports"],function(_,$,exports){root.Backbone=factory(root,exports,_,$)})}else if(typeof exports!=="undefined"){var _=require("underscore"),$;try{$=require("jquery")}catch(e){}factory(root,exports,_,$)}else{root.Backbone=factory(root,{},root._,root.jQuery||root.Zepto||root.ender||root.$)}})(function(root,Backbone,_,$){var previousBackbone=root.Backbone;var slice=Array.prototype.slice;Backbone.VERSION="1.3.3";Backbone.$=$;Backbone.noConflict=function(){root.Backbone=previousBackbone;return this};Backbone.emulateHTTP=false;Backbone.emulateJSON=false;var addMethod=function(length,method,attribute){switch(length){case 1:return function(){return _[method](this[attribute])};case 2:return function(value){return _[method](this[attribute],value)};case 3:return function(iteratee,context){return _[method](this[attribute],cb(iteratee,this),context)};case 4:return function(iteratee,defaultVal,context){return _[method](this[attribute],cb(iteratee,this),defaultVal,context)};default:return function(){var args=slice.call(arguments);args.unshift(this[attribute]);return _[method].apply(_,args)}}};var addUnderscoreMethods=function(Class,methods,attribute){_.each(methods,function(length,method){if(_[method])Class.prototype[method]=addMethod(length,method,attribute)})};var cb=function(iteratee,instance){if(_.isFunction(iteratee))return iteratee;if(_.isObject(iteratee)&&!instance._isModel(iteratee))return modelMatcher(iteratee);if(_.isString(iteratee))return function(model){return model.get(iteratee)};return iteratee};var modelMatcher=function(attrs){var matcher=_.matches(attrs);return function(model){return matcher(model.attributes)}};var Events=Backbone.Events={};var eventSplitter=/\s+/;var eventsApi=function(iteratee,events,name,callback,opts){var i=0,names;if(name&&typeof name==="object"){if(callback!==void 0&&"context"in opts&&opts.context===void 0)opts.context=callback;for(names=_.keys(name);i<names.length;i++){events=eventsApi(iteratee,events,names[i],name[names[i]],opts)}}else if(name&&eventSplitter.test(name)){for(names=name.split(eventSplitter);i<names.length;i++){events=iteratee(events,names[i],callback,opts)}}else{events=iteratee(events,name,callback,opts)}return events};Events.on=function(name,callback,context){return internalOn(this,name,callback,context)};var internalOn=function(obj,name,callback,context,listening){obj._events=eventsApi(onApi,obj._events||{},name,callback,{context:context,ctx:obj,listening:listening});if(listening){var listeners=obj._listeners||(obj._listeners={});listeners[listening.id]=listening}return obj};Events.listenTo=function(obj,name,callback){if(!obj)return this;var id=obj._listenId||(obj._listenId=_.uniqueId("l"));var listeningTo=this._listeningTo||(this._listeningTo={});var listening=listeningTo[id];if(!listening){var thisId=this._listenId||(this._listenId=_.uniqueId("l"));listening=listeningTo[id]={obj:obj,objId:id,id:thisId,listeningTo:listeningTo,count:0}}internalOn(obj,name,callback,this,listening);return this};var onApi=function(events,name,callback,options){if(callback){var handlers=events[name]||(events[name]=[]);var context=options.context,ctx=options.ctx,listening=options.listening;if(listening)listening.count++;handlers.push({callback:callback,context:context,ctx:context||ctx,listening:listening})}return events};Events.off=function(name,callback,context){if(!this._events)return this;this._events=eventsApi(offApi,this._events,name,callback,{context:context,listeners:this._listeners});return this};Events.stopListening=function(obj,name,callback){var listeningTo=this._listeningTo;if(!listeningTo)return this;var ids=obj?[obj._listenId]:_.keys(listeningTo);for(var i=0;i<ids.length;i++){var listening=listeningTo[ids[i]];if(!listening)break;listening.obj.off(name,callback,this)}return this};var offApi=function(events,name,callback,options){if(!events)return;var i=0,listening;var context=options.context,listeners=options.listeners;if(!name&&!callback&&!context){var ids=_.keys(listeners);for(;i<ids.length;i++){listening=listeners[ids[i]];delete listeners[listening.id];delete listening.listeningTo[listening.objId]}return}var names=name?[name]:_.keys(events);for(;i<names.length;i++){name=names[i];var handlers=events[name];if(!handlers)break;var remaining=[];for(var j=0;j<handlers.length;j++){var handler=handlers[j];if(callback&&callback!==handler.callback&&callback!==handler.callback._callback||context&&context!==handler.context){remaining.push(handler)}else{listening=handler.listening;if(listening&&--listening.count===0){delete listeners[listening.id];delete listening.listeningTo[listening.objId]}}}if(remaining.length){events[name]=remaining}else{delete events[name]}}return events};Events.once=function(name,callback,context){var events=eventsApi(onceMap,{},name,callback,_.bind(this.off,this));if(typeof name==="string"&&context==null)callback=void 0;return this.on(events,callback,context)};Events.listenToOnce=function(obj,name,callback){var events=eventsApi(onceMap,{},name,callback,_.bind(this.stopListening,this,obj));return this.listenTo(obj,events)};var onceMap=function(map,name,callback,offer){if(callback){var once=map[name]=_.once(function(){offer(name,once);callback.apply(this,arguments)});once._callback=callback}return map};Events.trigger=function(name){if(!this._events)return this;var length=Math.max(0,arguments.length-1);var args=Array(length);for(var i=0;i<length;i++)args[i]=arguments[i+1];eventsApi(triggerApi,this._events,name,void 0,args);return this};var triggerApi=function(objEvents,name,callback,args){if(objEvents){var events=objEvents[name];var allEvents=objEvents.all;if(events&&allEvents)allEvents=allEvents.slice();if(events)triggerEvents(events,args);if(allEvents)triggerEvents(allEvents,[name].concat(args))}return objEvents};var triggerEvents=function(events,args){var ev,i=-1,l=events.length,a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:while(++i<l)(ev=events[i]).callback.call(ev.ctx);return;case 1:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1);return;case 2:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2);return;case 3:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2,a3);return;default:while(++i<l)(ev=events[i]).callback.apply(ev.ctx,args);return}};Events.bind=Events.on;Events.unbind=Events.off;_.extend(Backbone,Events);var Model=Backbone.Model=function(attributes,options){var attrs=attributes||{};options||(options={});this.cid=_.uniqueId(this.cidPrefix);this.attributes={};if(options.collection)this.collection=options.collection;if(options.parse)attrs=this.parse(attrs,options)||{};var defaults=_.result(this,"defaults");attrs=_.defaults(_.extend({},defaults,attrs),defaults);this.set(attrs,options);this.changed={};this.initialize.apply(this,arguments)};_.extend(Model.prototype,Events,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(options){return _.clone(this.attributes)},sync:function(){return Backbone.sync.apply(this,arguments)},get:function(attr){return this.attributes[attr]},escape:function(attr){return _.escape(this.get(attr))},has:function(attr){return this.get(attr)!=null},matches:function(attrs){return!!_.iteratee(attrs,this)(this.attributes)},set:function(key,val,options){if(key==null)return this;var attrs;if(typeof key==="object"){attrs=key;options=val}else{(attrs={})[key]=val}options||(options={});if(!this._validate(attrs,options))return false;var unset=options.unset;var silent=options.silent;var changes=[];var changing=this._changing;this._changing=true;if(!changing){this._previousAttributes=_.clone(this.attributes);this.changed={}}var current=this.attributes;var changed=this.changed;var prev=this._previousAttributes;for(var attr in attrs){val=attrs[attr];if(!_.isEqual(current[attr],val))changes.push(attr);if(!_.isEqual(prev[attr],val)){changed[attr]=val}else{delete changed[attr]}unset?delete current[attr]:current[attr]=val}if(this.idAttribute in attrs)this.id=this.get(this.idAttribute);if(!silent){if(changes.length)this._pending=options;for(var i=0;i<changes.length;i++){this.trigger("change:"+changes[i],this,current[changes[i]],options)}}if(changing)return this;if(!silent){while(this._pending){options=this._pending;this._pending=false;this.trigger("change",this,options)}}this._pending=false;this._changing=false;return this},unset:function(attr,options){return this.set(attr,void 0,_.extend({},options,{unset:true}))},clear:function(options){var attrs={};for(var key in this.attributes)attrs[key]=void 0;return this.set(attrs,_.extend({},options,{unset:true}))},hasChanged:function(attr){if(attr==null)return!_.isEmpty(this.changed);return _.has(this.changed,attr)},changedAttributes:function(diff){if(!diff)return this.hasChanged()?_.clone(this.changed):false;var old=this._changing?this._previousAttributes:this.attributes;var changed={};for(var attr in diff){var val=diff[attr];if(_.isEqual(old[attr],val))continue;changed[attr]=val}return _.size(changed)?changed:false},previous:function(attr){if(attr==null||!this._previousAttributes)return null;return this._previousAttributes[attr]},previousAttributes:function(){return _.clone(this._previousAttributes)},fetch:function(options){options=_.extend({parse:true},options);var model=this;var success=options.success;options.success=function(resp){var serverAttrs=options.parse?model.parse(resp,options):resp;if(!model.set(serverAttrs,options))return false;if(success)success.call(options.context,model,resp,options);model.trigger("sync",model,resp,options)};wrapError(this,options);return this.sync("read",this,options)},save:function(key,val,options){var attrs;if(key==null||typeof key==="object"){attrs=key;options=val}else{(attrs={})[key]=val}options=_.extend({validate:true,parse:true},options);var wait=options.wait;if(attrs&&!wait){if(!this.set(attrs,options))return false}else if(!this._validate(attrs,options)){return false}var model=this;var success=options.success;var attributes=this.attributes;options.success=function(resp){model.attributes=attributes;var serverAttrs=options.parse?model.parse(resp,options):resp;if(wait)serverAttrs=_.extend({},attrs,serverAttrs);if(serverAttrs&&!model.set(serverAttrs,options))return false;if(success)success.call(options.context,model,resp,options);model.trigger("sync",model,resp,options)};wrapError(this,options);if(attrs&&wait)this.attributes=_.extend({},attributes,attrs);var method=this.isNew()?"create":options.patch?"patch":"update";if(method==="patch"&&!options.attrs)options.attrs=attrs;var xhr=this.sync(method,this,options);this.attributes=attributes;return xhr},destroy:function(options){options=options?_.clone(options):{};var model=this;var success=options.success;var wait=options.wait;var destroy=function(){model.stopListening();model.trigger("destroy",model,model.collection,options)};options.success=function(resp){if(wait)destroy();if(success)success.call(options.context,model,resp,options);if(!model.isNew())model.trigger("sync",model,resp,options)};var xhr=false;if(this.isNew()){_.defer(options.success)}else{wrapError(this,options);xhr=this.sync("delete",this,options)}if(!wait)destroy();return xhr},url:function(){var base=_.result(this,"urlRoot")||_.result(this.collection,"url")||urlError();if(this.isNew())return base;var id=this.get(this.idAttribute);return base.replace(/[^\/]$/,"$&/")+encodeURIComponent(id)},parse:function(resp,options){return resp},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(options){return this._validate({},_.extend({},options,{validate:true}))},_validate:function(attrs,options){if(!options.validate||!this.validate)return true;attrs=_.extend({},this.attributes,attrs);var error=this.validationError=this.validate(attrs,options)||null;if(!error)return true;this.trigger("invalid",this,error,_.extend(options,{validationError:error}));return false}});var modelMethods={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};addUnderscoreMethods(Model,modelMethods,"attributes");var Collection=Backbone.Collection=function(models,options){options||(options={});if(options.model)this.model=options.model;if(options.comparator!==void 0)this.comparator=options.comparator;this._reset();this.initialize.apply(this,arguments);if(models)this.reset(models,_.extend({silent:true},options))};var setOptions={add:true,remove:true,merge:true};var addOptions={add:true,remove:false};var splice=function(array,insert,at){at=Math.min(Math.max(at,0),array.length);var tail=Array(array.length-at);var length=insert.length;var i;for(i=0;i<tail.length;i++)tail[i]=array[i+at];for(i=0;i<length;i++)array[i+at]=insert[i];for(i=0;i<tail.length;i++)array[i+length+at]=tail[i]};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options)})},sync:function(){return Backbone.sync.apply(this,arguments)},add:function(models,options){return this.set(models,_.extend({merge:false},options,addOptions))},remove:function(models,options){options=_.extend({},options);var singular=!_.isArray(models);models=singular?[models]:models.slice();var removed=this._removeModels(models,options);if(!options.silent&&removed.length){options.changes={added:[],merged:[],removed:removed};this.trigger("update",this,options)}return singular?removed[0]:removed},set:function(models,options){if(models==null)return;options=_.extend({},setOptions,options);if(options.parse&&!this._isModel(models)){models=this.parse(models,options)||[]}var singular=!_.isArray(models);models=singular?[models]:models.slice();var at=options.at;if(at!=null)at=+at;if(at>this.length)at=this.length;if(at<0)at+=this.length+1;var set=[];var toAdd=[];var toMerge=[];var toRemove=[];var modelMap={};var add=options.add;var merge=options.merge;var remove=options.remove;var sort=false;var sortable=this.comparator&&at==null&&options.sort!==false;var sortAttr=_.isString(this.comparator)?this.comparator:null;var model,i;for(i=0;i<models.length;i++){model=models[i];var existing=this.get(model);if(existing){if(merge&&model!==existing){var attrs=this._isModel(model)?model.attributes:model;if(options.parse)attrs=existing.parse(attrs,options);existing.set(attrs,options);toMerge.push(existing);if(sortable&&!sort)sort=existing.hasChanged(sortAttr)}if(!modelMap[existing.cid]){modelMap[existing.cid]=true;set.push(existing)}models[i]=existing}else if(add){model=models[i]=this._prepareModel(model,options);if(model){toAdd.push(model);this._addReference(model,options);modelMap[model.cid]=true;set.push(model)}}}if(remove){for(i=0;i<this.length;i++){model=this.models[i];if(!modelMap[model.cid])toRemove.push(model)}if(toRemove.length)this._removeModels(toRemove,options)}var orderChanged=false;var replace=!sortable&&add&&remove;if(set.length&&replace){orderChanged=this.length!==set.length||_.some(this.models,function(m,index){return m!==set[index]});this.models.length=0;splice(this.models,set,0);this.length=this.models.length}else if(toAdd.length){if(sortable)sort=true;splice(this.models,toAdd,at==null?this.length:at);this.length=this.models.length}if(sort)this.sort({silent:true});if(!options.silent){for(i=0;i<toAdd.length;i++){if(at!=null)options.index=at+i;model=toAdd[i];model.trigger("add",model,this,options)}if(sort||orderChanged)this.trigger("sort",this,options);if(toAdd.length||toRemove.length||toMerge.length){options.changes={added:toAdd,removed:toRemove,merged:toMerge};this.trigger("update",this,options)}}return singular?models[0]:models},reset:function(models,options){options=options?_.clone(options):{};for(var i=0;i<this.models.length;i++){this._removeReference(this.models[i],options)}options.previousModels=this.models;this._reset();models=this.add(models,_.extend({silent:true},options));if(!options.silent)this.trigger("reset",this,options);return models},push:function(model,options){return this.add(model,_.extend({at:this.length},options))},pop:function(options){var model=this.at(this.length-1);return this.remove(model,options)},unshift:function(model,options){return this.add(model,_.extend({at:0},options))},shift:function(options){var model=this.at(0);return this.remove(model,options)},slice:function(){return slice.apply(this.models,arguments)},get:function(obj){if(obj==null)return void 0;return this._byId[obj]||this._byId[this.modelId(obj.attributes||obj)]||obj.cid&&this._byId[obj.cid]},has:function(obj){return this.get(obj)!=null},at:function(index){if(index<0)index+=this.length;return this.models[index]},where:function(attrs,first){return this[first?"find":"filter"](attrs)},findWhere:function(attrs){return this.where(attrs,true)},sort:function(options){var comparator=this.comparator;if(!comparator)throw new Error("Cannot sort a set without a comparator");options||(options={});var length=comparator.length;if(_.isFunction(comparator))comparator=_.bind(comparator,this);if(length===1||_.isString(comparator)){this.models=this.sortBy(comparator)}else{this.models.sort(comparator)}if(!options.silent)this.trigger("sort",this,options);return this},pluck:function(attr){return this.map(attr+"")},fetch:function(options){options=_.extend({parse:true},options);var success=options.success;var collection=this;options.success=function(resp){var method=options.reset?"reset":"set";collection[method](resp,options);if(success)success.call(options.context,collection,resp,options);collection.trigger("sync",collection,resp,options)};wrapError(this,options);return this.sync("read",this,options)},create:function(model,options){options=options?_.clone(options):{};var wait=options.wait;model=this._prepareModel(model,options);if(!model)return false;if(!wait)this.add(model,options);var collection=this;var success=options.success;options.success=function(m,resp,callbackOpts){if(wait)collection.add(m,callbackOpts);if(success)success.call(callbackOpts.context,m,resp,callbackOpts)};model.save(null,options);return model},parse:function(resp,options){return resp},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(attrs){return attrs[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(attrs,options){if(this._isModel(attrs)){if(!attrs.collection)attrs.collection=this;return attrs}options=options?_.clone(options):{};options.collection=this;var model=new this.model(attrs,options);if(!model.validationError)return model;this.trigger("invalid",this,model.validationError,options);return false},_removeModels:function(models,options){var removed=[];for(var i=0;i<models.length;i++){var model=this.get(models[i]);if(!model)continue;var index=this.indexOf(model);this.models.splice(index,1);this.length--;delete this._byId[model.cid];var id=this.modelId(model.attributes);if(id!=null)delete this._byId[id];if(!options.silent){options.index=index;model.trigger("remove",model,this,options)}removed.push(model);this._removeReference(model,options)}return removed},_isModel:function(model){return model instanceof Model},_addReference:function(model,options){this._byId[model.cid]=model;var id=this.modelId(model.attributes);if(id!=null)this._byId[id]=model;model.on("all",this._onModelEvent,this)},_removeReference:function(model,options){delete this._byId[model.cid];var id=this.modelId(model.attributes);if(id!=null)delete this._byId[id];if(this===model.collection)delete model.collection;model.off("all",this._onModelEvent,this)},_onModelEvent:function(event,model,collection,options){if(model){if((event==="add"||event==="remove")&&collection!==this)return;if(event==="destroy")this.remove(model,options);if(event==="change"){var prevId=this.modelId(model.previousAttributes());var id=this.modelId(model.attributes);if(prevId!==id){if(prevId!=null)delete this._byId[prevId];if(id!=null)this._byId[id]=model}}}this.trigger.apply(this,arguments)}});var collectionMethods={forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3};addUnderscoreMethods(Collection,collectionMethods,"models");var View=Backbone.View=function(options){this.cid=_.uniqueId("view");_.extend(this,_.pick(options,viewOptions));this._ensureElement();this.initialize.apply(this,arguments)};var delegateEventSplitter=/^(\S+)\s*(.*)$/;var viewOptions=["model","collection","el","id","attributes","className","tagName","events"];_.extend(View.prototype,Events,{tagName:"div",$:function(selector){return this.$el.find(selector)},initialize:function(){},render:function(){return this},remove:function(){this._removeElement();this.stopListening();return this},_removeElement:function(){this.$el.remove()},setElement:function(element){this.undelegateEvents();this._setElement(element);this.delegateEvents();return this},_setElement:function(el){this.$el=el instanceof Backbone.$?el:Backbone.$(el);this.el=this.$el[0]},delegateEvents:function(events){events||(events=_.result(this,"events"));if(!events)return this;this.undelegateEvents();for(var key in events){var method=events[key];if(!_.isFunction(method))method=this[method];if(!method)continue;var match=key.match(delegateEventSplitter);this.delegate(match[1],match[2],_.bind(method,this))}return this},delegate:function(eventName,selector,listener){this.$el.on(eventName+".delegateEvents"+this.cid,selector,listener);return this},undelegateEvents:function(){if(this.$el)this.$el.off(".delegateEvents"+this.cid);return this},undelegate:function(eventName,selector,listener){this.$el.off(eventName+".delegateEvents"+this.cid,selector,listener);return this},_createElement:function(tagName){return document.createElement(tagName)},_ensureElement:function(){if(!this.el){var attrs=_.extend({},_.result(this,"attributes"));if(this.id)attrs.id=_.result(this,"id");if(this.className)attrs["class"]=_.result(this,"className");this.setElement(this._createElement(_.result(this,"tagName")));this._setAttributes(attrs)}else{this.setElement(_.result(this,"el"))}},_setAttributes:function(attributes){this.$el.attr(attributes)}});Backbone.sync=function(method,model,options){var type=methodMap[method];_.defaults(options||(options={}),{emulateHTTP:Backbone.emulateHTTP,emulateJSON:Backbone.emulateJSON});var params={type:type,dataType:"json"};if(!options.url){params.url=_.result(model,"url")||urlError()}if(options.data==null&&model&&(method==="create"||method==="update"||method==="patch")){params.contentType="application/json";params.data=JSON.stringify(options.attrs||model.toJSON(options))}if(options.emulateJSON){params.contentType="application/x-www-form-urlencoded";params.data=params.data?{model:params.data}:{}}if(options.emulateHTTP&&(type==="PUT"||type==="DELETE"||type==="PATCH")){params.type="POST";if(options.emulateJSON)params.data._method=type;var beforeSend=options.beforeSend;options.beforeSend=function(xhr){xhr.setRequestHeader("X-HTTP-Method-Override",type);if(beforeSend)return beforeSend.apply(this,arguments)}}if(params.type!=="GET"&&!options.emulateJSON){params.processData=false}var error=options.error;options.error=function(xhr,textStatus,errorThrown){options.textStatus=textStatus;options.errorThrown=errorThrown;if(error)error.call(options.context,xhr,textStatus,errorThrown)};var xhr=options.xhr=Backbone.ajax(_.extend(params,options));model.trigger("request",model,xhr,options);return xhr};var methodMap={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};Backbone.ajax=function(){return Backbone.$.ajax.apply(Backbone.$,arguments)};var Router=Backbone.Router=function(options){options||(options={});if(options.routes)this.routes=options.routes;this._bindRoutes();this.initialize.apply(this,arguments)};var optionalParam=/\((.*?)\)/g;var namedParam=/(\(\?)?:\w+/g;var splatParam=/\*\w+/g;var escapeRegExp=/[\-{}\[\]+?.,\\\^$|#\s]/g;_.extend(Router.prototype,Events,{initialize:function(){},route:function(route,name,callback){if(!_.isRegExp(route))route=this._routeToRegExp(route);if(_.isFunction(name)){callback=name;name=""}if(!callback)callback=this[name];var router=this;Backbone.history.route(route,function(fragment){var args=router._extractParameters(route,fragment);if(router.execute(callback,args,name)!==false){router.trigger.apply(router,["route:"+name].concat(args));router.trigger("route",name,args);Backbone.history.trigger("route",router,name,args)}});return this},execute:function(callback,args,name){if(callback)callback.apply(this,args)},navigate:function(fragment,options){Backbone.history.navigate(fragment,options);return this},_bindRoutes:function(){if(!this.routes)return;this.routes=_.result(this,"routes");var route,routes=_.keys(this.routes);while((route=routes.pop())!=null){this.route(route,this.routes[route])}},_routeToRegExp:function(route){route=route.replace(escapeRegExp,"\\$&").replace(optionalParam,"(?:$1)?").replace(namedParam,function(match,optional){return optional?match:"([^/?]+)"}).replace(splatParam,"([^?]*?)");return new RegExp("^"+route+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(route,fragment){var params=route.exec(fragment).slice(1);return _.map(params,function(param,i){if(i===params.length-1)return param||null;return param?decodeURIComponent(param):null})}});var History=Backbone.History=function(){this.handlers=[];this.checkUrl=_.bind(this.checkUrl,this);if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var routeStripper=/^[#\/]|\s+$/g;var rootStripper=/^\/+|\/+$/g;var pathStripper=/#.*$/;History.started=false;_.extend(History.prototype,Events,{interval:50,atRoot:function(){var path=this.location.pathname.replace(/[^\/]$/,"$&/");return path===this.root&&!this.getSearch()},matchRoot:function(){var path=this.decodeFragment(this.location.pathname);var rootPath=path.slice(0,this.root.length-1)+"/";return rootPath===this.root},decodeFragment:function(fragment){return decodeURI(fragment.replace(/%25/g,"%2525"))},getSearch:function(){var match=this.location.href.replace(/#.*/,"").match(/\?.+/);return match?match[0]:""},getHash:function(window){var match=(window||this).location.href.match(/#(.*)$/);return match?match[1]:""},getPath:function(){var path=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return path.charAt(0)==="/"?path.slice(1):path},getFragment:function(fragment){if(fragment==null){if(this._usePushState||!this._wantsHashChange){fragment=this.getPath()}else{fragment=this.getHash()}}return fragment.replace(routeStripper,"")},start:function(options){if(History.started)throw new Error("Backbone.history has already been started");History.started=true;this.options=_.extend({root:"/"},this.options,options);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._hasHashChange="onhashchange"in window&&(document.documentMode===void 0||document.documentMode>7);this._useHashChange=this._wantsHashChange&&this._hasHashChange;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.history&&this.history.pushState);this._usePushState=this._wantsPushState&&this._hasPushState;this.fragment=this.getFragment();this.root=("/"+this.root+"/").replace(rootStripper,"/");if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var rootPath=this.root.slice(0,-1)||"/";this.location.replace(rootPath+"#"+this.getPath());return true}else if(this._hasPushState&&this.atRoot()){this.navigate(this.getHash(),{replace:true})}}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe");this.iframe.src="javascript:0";this.iframe.style.display="none";this.iframe.tabIndex=-1;var body=document.body;var iWindow=body.insertBefore(this.iframe,body.firstChild).contentWindow;iWindow.document.open();iWindow.document.close();iWindow.location.hash="#"+this.fragment}var addEventListener=window.addEventListener||function(eventName,listener){return attachEvent("on"+eventName,listener)};if(this._usePushState){addEventListener("popstate",this.checkUrl,false)}else if(this._useHashChange&&!this.iframe){addEventListener("hashchange",this.checkUrl,false)}else if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}if(!this.options.silent)return this.loadUrl()},stop:function(){var removeEventListener=window.removeEventListener||function(eventName,listener){return detachEvent("on"+eventName,listener)};if(this._usePushState){removeEventListener("popstate",this.checkUrl,false)}else if(this._useHashChange&&!this.iframe){removeEventListener("hashchange",this.checkUrl,false)}if(this.iframe){document.body.removeChild(this.iframe);this.iframe=null}if(this._checkUrlInterval)clearInterval(this._checkUrlInterval);History.started=false},route:function(route,callback){this.handlers.unshift({route:route,callback:callback})},checkUrl:function(e){var current=this.getFragment();if(current===this.fragment&&this.iframe){current=this.getHash(this.iframe.contentWindow)}if(current===this.fragment)return false;if(this.iframe)this.navigate(current);this.loadUrl()},loadUrl:function(fragment){if(!this.matchRoot())return false;fragment=this.fragment=this.getFragment(fragment);return _.some(this.handlers,function(handler){if(handler.route.test(fragment)){handler.callback(fragment);return true}})},navigate:function(fragment,options){if(!History.started)return false;if(!options||options===true)options={trigger:!!options};fragment=this.getFragment(fragment||"");var rootPath=this.root;if(fragment===""||fragment.charAt(0)==="?"){rootPath=rootPath.slice(0,-1)||"/"}var url=rootPath+fragment;fragment=this.decodeFragment(fragment.replace(pathStripper,""));if(this.fragment===fragment)return;this.fragment=fragment;if(this._usePushState){this.history[options.replace?"replaceState":"pushState"]({},document.title,url)}else if(this._wantsHashChange){this._updateHash(this.location,fragment,options.replace);if(this.iframe&&fragment!==this.getHash(this.iframe.contentWindow)){var iWindow=this.iframe.contentWindow;if(!options.replace){iWindow.document.open();iWindow.document.close()}this._updateHash(iWindow.location,fragment,options.replace)}}else{return this.location.assign(url)}if(options.trigger)return this.loadUrl(fragment)},_updateHash:function(location,fragment,replace){if(replace){var href=location.href.replace(/(javascript:|#).*$/,"");location.replace(href+"#"+fragment)}else{location.hash="#"+fragment}}});Backbone.history=new History;var extend=function(protoProps,staticProps){var parent=this;var child;if(protoProps&&_.has(protoProps,"constructor")){child=protoProps.constructor}else{child=function(){return parent.apply(this,arguments)}}_.extend(child,parent,staticProps);child.prototype=_.create(parent.prototype,protoProps);child.prototype.constructor=child;child.__super__=parent.prototype;return child};Model.extend=Collection.extend=Router.extend=View.extend=History.extend=extend;var urlError=function(){throw new Error('A "url" property or function must be specified')};var wrapError=function(model,options){var error=options.error;options.error=function(resp){if(error)error.call(options.context,model,resp,options);model.trigger("error",model,resp,options)}};return Backbone})}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{jquery:142,underscore:144}],2:[function(require,module,exports){(function(factory){if(typeof define==="function"&&define.amd){define(["jquery"],factory)}else if(typeof exports==="object"){factory(require("jquery"))}else{factory(jQuery)}})(function($){var defaults={element:"body",position:null,type:"info",allow_dismiss:true,newest_on_top:false,showProgressbar:false,placement:{from:"top",align:"right"},offset:20,spacing:10,z_index:1031,delay:5e3,timer:1e3,url_target:"_blank",mouse_over:null,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"},onShow:null,onShown:null,onClose:null,onClosed:null,icon_type:"class",template:'<div data-notify="container" class="col-xs-11 col-sm-4 alert alert-{0}" role="alert"><button type="button" aria-hidden="true" class="close" data-notify="dismiss">&times;</button><span data-notify="icon"></span> <span data-notify="title">{1}</span> <span data-notify="message">{2}</span><div class="progress" data-notify="progressbar"><div class="progress-bar progress-bar-{0}" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div></div><a href="{3}" target="{4}" data-notify="url"></a></div>'};String.format=function(){var str=arguments[0];for(var i=1;i<arguments.length;i++){str=str.replace(RegExp("\\{"+(i-1)+"\\}","gm"),arguments[i])}return str};function Notify(element,content,options){var content={content:{message:typeof content=="object"?content.message:content,title:content.title?content.title:"",icon:content.icon?content.icon:"",url:content.url?content.url:"#",target:content.target?content.target:"-"}};options=$.extend(true,{},content,options);this.settings=$.extend(true,{},defaults,options);this._defaults=defaults;if(this.settings.content.target=="-"){this.settings.content.target=this.settings.url_target}this.animations={start:"webkitAnimationStart oanimationstart MSAnimationStart animationstart",end:"webkitAnimationEnd oanimationend MSAnimationEnd animationend"};if(typeof this.settings.offset=="number"){this.settings.offset={x:this.settings.offset,y:this.settings.offset}}this.init()}$.extend(Notify.prototype,{init:function(){var self=this;this.buildNotify();if(this.settings.content.icon){this.setIcon()}if(this.settings.content.url!="#"){this.styleURL()}this.styleDismiss();this.placement();this.bind();this.notify={$ele:this.$ele,update:function(command,update){var commands={};if(typeof command=="string"){commands[command]=update}else{commands=command}for(var command in commands){switch(command){case"type":this.$ele.removeClass("alert-"+self.settings.type);this.$ele.find('[data-notify="progressbar"] > .progress-bar').removeClass("progress-bar-"+self.settings.type);self.settings.type=commands[command];this.$ele.addClass("alert-"+commands[command]).find('[data-notify="progressbar"] > .progress-bar').addClass("progress-bar-"+commands[command]);break;case"icon":var $icon=this.$ele.find('[data-notify="icon"]');if(self.settings.icon_type.toLowerCase()=="class"){$icon.removeClass(self.settings.content.icon).addClass(commands[command])}else{if(!$icon.is("img")){$icon.find("img")}$icon.attr("src",commands[command])}break;case"progress":var newDelay=self.settings.delay-self.settings.delay*(commands[command]/100);this.$ele.data("notify-delay",newDelay);this.$ele.find('[data-notify="progressbar"] > div').attr("aria-valuenow",commands[command]).css("width",commands[command]+"%");break;case"url":this.$ele.find('[data-notify="url"]').attr("href",commands[command]);break;case"target":this.$ele.find('[data-notify="url"]').attr("target",commands[command]);break;default:this.$ele.find('[data-notify="'+command+'"]').html(commands[command])}}var posX=this.$ele.outerHeight()+parseInt(self.settings.spacing)+parseInt(self.settings.offset.y);self.reposition(posX)},close:function(){self.close()}}},buildNotify:function(){var content=this.settings.content;this.$ele=$(String.format(this.settings.template,this.settings.type,content.title,content.message,content.url,content.target));this.$ele.attr("data-notify-position",this.settings.placement.from+"-"+this.settings.placement.align);if(!this.settings.allow_dismiss){this.$ele.find('[data-notify="dismiss"]').css("display","none")}if(this.settings.delay<=0&&!this.settings.showProgressbar||!this.settings.showProgressbar){this.$ele.find('[data-notify="progressbar"]').remove()}},setIcon:function(){if(this.settings.icon_type.toLowerCase()=="class"){this.$ele.find('[data-notify="icon"]').addClass(this.settings.content.icon)}else{if(this.$ele.find('[data-notify="icon"]').is("img")){this.$ele.find('[data-notify="icon"]').attr("src",this.settings.content.icon)}else{this.$ele.find('[data-notify="icon"]').append('<img src="'+this.settings.content.icon+'" alt="Notify Icon" />')}}},styleDismiss:function(){this.$ele.find('[data-notify="dismiss"]').css({position:"absolute",right:"10px",top:"5px",zIndex:this.settings.z_index+2})},styleURL:function(){this.$ele.find('[data-notify="url"]').css({backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)",height:"100%",left:"0px",position:"absolute",top:"0px",width:"100%",zIndex:this.settings.z_index+1})},placement:function(){var self=this,offsetAmt=this.settings.offset.y,css={display:"inline-block",margin:"0px auto",position:this.settings.position?this.settings.position:this.settings.element==="body"?"fixed":"absolute",transition:"all .5s ease-in-out",zIndex:this.settings.z_index},hasAnimation=false,settings=this.settings;$('[data-notify-position="'+this.settings.placement.from+"-"+this.settings.placement.align+'"]:not([data-closing="true"])').each(function(){return offsetAmt=Math.max(offsetAmt,parseInt($(this).css(settings.placement.from))+parseInt($(this).outerHeight())+parseInt(settings.spacing))});if(this.settings.newest_on_top==true){offsetAmt=this.settings.offset.y}css[this.settings.placement.from]=offsetAmt+"px";switch(this.settings.placement.align){case"left":case"right":css[this.settings.placement.align]=this.settings.offset.x+"px";break;case"center":css.left=0;css.right=0;break}this.$ele.css(css).addClass(this.settings.animate.enter);$.each(Array("webkit-","moz-","o-","ms-",""),function(index,prefix){self.$ele[0].style[prefix+"AnimationIterationCount"]=1});$(this.settings.element).append(this.$ele);if(this.settings.newest_on_top==true){offsetAmt=parseInt(offsetAmt)+parseInt(this.settings.spacing)+this.$ele.outerHeight();this.reposition(offsetAmt)}if($.isFunction(self.settings.onShow)){self.settings.onShow.call(this.$ele)}this.$ele.one(this.animations.start,function(event){hasAnimation=true}).one(this.animations.end,function(event){if($.isFunction(self.settings.onShown)){self.settings.onShown.call(this)}});setTimeout(function(){if(!hasAnimation){if($.isFunction(self.settings.onShown)){self.settings.onShown.call(this)}}},600)},bind:function(){var self=this;this.$ele.find('[data-notify="dismiss"]').on("click",function(){self.close()});this.$ele.mouseover(function(e){$(this).data("data-hover","true")}).mouseout(function(e){$(this).data("data-hover","false")});this.$ele.data("data-hover","false");if(this.settings.delay>0){self.$ele.data("notify-delay",self.settings.delay);var timer=setInterval(function(){var delay=parseInt(self.$ele.data("notify-delay"))-self.settings.timer;if(self.$ele.data("data-hover")==="false"&&self.settings.mouse_over=="pause"||self.settings.mouse_over!="pause"){var percent=(self.settings.delay-delay)/self.settings.delay*100;self.$ele.data("notify-delay",delay);self.$ele.find('[data-notify="progressbar"] > div').attr("aria-valuenow",percent).css("width",percent+"%")}if(delay<=-self.settings.timer){clearInterval(timer);self.close()}},self.settings.timer)}},close:function(){var self=this,$successors=null,posX=parseInt(this.$ele.css(this.settings.placement.from)),hasAnimation=false;this.$ele.data("closing","true").addClass(this.settings.animate.exit);self.reposition(posX);if($.isFunction(self.settings.onClose)){self.settings.onClose.call(this.$ele)}this.$ele.one(this.animations.start,function(event){hasAnimation=true}).one(this.animations.end,function(event){$(this).remove();if($.isFunction(self.settings.onClosed)){self.settings.onClosed.call(this)}});setTimeout(function(){if(!hasAnimation){self.$ele.remove();if(self.settings.onClosed){self.settings.onClosed(self.$ele)}}},600)},reposition:function(posX){var self=this,notifies='[data-notify-position="'+this.settings.placement.from+"-"+this.settings.placement.align+'"]:not([data-closing="true"])',$elements=this.$ele.nextAll(notifies);if(this.settings.newest_on_top==true){$elements=this.$ele.prevAll(notifies)}$elements.each(function(){$(this).css(self.settings.placement.from,posX);posX=parseInt(posX)+parseInt(self.settings.spacing)+$(this).outerHeight()})}});$.notify=function(content,options){var plugin=new Notify(this,content,options);return plugin.notify};$.notifyDefaults=function(options){defaults=$.extend(true,{},defaults,options);return defaults};$.notifyClose=function(command){if(typeof command==="undefined"||command=="all"){$("[data-notify]").find('[data-notify="dismiss"]').trigger("click")}else{$('[data-notify-position="'+command+'"]').find('[data-notify="dismiss"]').trigger("click")}}})},{jquery:142}],3:[function(require,module,exports){(function(root,factory){if(typeof define==="function"&&define.amd){define(["jquery"],function(a0){return factory(a0)})}else if(typeof module==="object"&&module.exports){module.exports=factory(require("jquery"))}else{factory(root["jQuery"])}})(this,function(jQuery){(function($){"use strict";if(!String.prototype.includes){(function(){"use strict";var toString={}.toString;var defineProperty=function(){try{var object={};var $defineProperty=Object.defineProperty;var result=$defineProperty(object,object,object)&&$defineProperty}catch(error){}return result}();var indexOf="".indexOf;var includes=function(search){if(this==null){throw new TypeError}var string=String(this);if(search&&toString.call(search)=="[object RegExp]"){throw new TypeError}var stringLength=string.length;var searchString=String(search);var searchLength=searchString.length;var position=arguments.length>1?arguments[1]:undefined;var pos=position?Number(position):0;if(pos!=pos){pos=0}var start=Math.min(Math.max(pos,0),stringLength);if(searchLength+start>stringLength){return false}return indexOf.call(string,searchString,pos)!=-1};if(defineProperty){defineProperty(String.prototype,"includes",{value:includes,configurable:true,writable:true})}else{String.prototype.includes=includes}})()}if(!String.prototype.startsWith){(function(){"use strict";var defineProperty=function(){try{var object={};var $defineProperty=Object.defineProperty;var result=$defineProperty(object,object,object)&&$defineProperty}catch(error){}return result}();var toString={}.toString;var startsWith=function(search){if(this==null){throw new TypeError}var string=String(this);if(search&&toString.call(search)=="[object RegExp]"){throw new TypeError}var stringLength=string.length;var searchString=String(search);var searchLength=searchString.length;var position=arguments.length>1?arguments[1]:undefined;var pos=position?Number(position):0;if(pos!=pos){pos=0}var start=Math.min(Math.max(pos,0),stringLength);if(searchLength+start>stringLength){return false}var index=-1;while(++index<searchLength){if(string.charCodeAt(start+index)!=searchString.charCodeAt(index)){return false}}return true};if(defineProperty){defineProperty(String.prototype,"startsWith",{value:startsWith,configurable:true,writable:true})}else{String.prototype.startsWith=startsWith}})()}if(!Object.keys){Object.keys=function(o,k,r){r=[];for(k in o)r.hasOwnProperty.call(o,k)&&r.push(k);return r}}var valHooks={useDefault:false,_set:$.valHooks.select.set};$.valHooks.select.set=function(elem,value){if(value&&!valHooks.useDefault)$(elem).data("selected",true);return valHooks._set.apply(this,arguments)};var changed_arguments=null;var EventIsSupported=function(){try{new Event("change");return true}catch(e){return false}}();$.fn.triggerNative=function(eventName){var el=this[0],event;if(el.dispatchEvent){if(EventIsSupported){event=new Event(eventName,{bubbles:true})}else{event=document.createEvent("Event");event.initEvent(eventName,true,false)}el.dispatchEvent(event)}else if(el.fireEvent){event=document.createEventObject();event.eventType=eventName;el.fireEvent("on"+eventName,event)}else{this.trigger(eventName)}};$.expr.pseudos.icontains=function(obj,index,meta){var $obj=$(obj).find("a");var haystack=($obj.data("tokens")||$obj.text()).toString().toUpperCase();return haystack.includes(meta[3].toUpperCase())};$.expr.pseudos.ibegins=function(obj,index,meta){var $obj=$(obj).find("a");var haystack=($obj.data("tokens")||$obj.text()).toString().toUpperCase();return haystack.startsWith(meta[3].toUpperCase())};$.expr.pseudos.aicontains=function(obj,index,meta){var $obj=$(obj).find("a");var haystack=($obj.data("tokens")||$obj.data("normalizedText")||$obj.text()).toString().toUpperCase();return haystack.includes(meta[3].toUpperCase())};$.expr.pseudos.aibegins=function(obj,index,meta){var $obj=$(obj).find("a");var haystack=($obj.data("tokens")||$obj.data("normalizedText")||$obj.text()).toString().toUpperCase();return haystack.startsWith(meta[3].toUpperCase())};function normalizeToBase(text){var rExps=[{re:/[\xC0-\xC6]/g,ch:"A"},{re:/[\xE0-\xE6]/g,ch:"a"},{re:/[\xC8-\xCB]/g,ch:"E"},{re:/[\xE8-\xEB]/g,ch:"e"},{re:/[\xCC-\xCF]/g,ch:"I"},{re:/[\xEC-\xEF]/g,ch:"i"},{re:/[\xD2-\xD6]/g,ch:"O"},{re:/[\xF2-\xF6]/g,ch:"o"},{re:/[\xD9-\xDC]/g,ch:"U"},{re:/[\xF9-\xFC]/g,ch:"u"},{re:/[\xC7-\xE7]/g,ch:"c"},{re:/[\xD1]/g,ch:"N"},{re:/[\xF1]/g,ch:"n"}];$.each(rExps,function(){text=text?text.replace(this.re,this.ch):""});return text}var escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var unescapeMap={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#x27;":"'","&#x60;":"`"};var createEscaper=function(map){var escaper=function(match){return map[match]};var source="(?:"+Object.keys(map).join("|")+")";var testRegexp=RegExp(source);var replaceRegexp=RegExp(source,"g");return function(string){string=string==null?"":""+string;return testRegexp.test(string)?string.replace(replaceRegexp,escaper):string}};var htmlEscape=createEscaper(escapeMap);var htmlUnescape=createEscaper(unescapeMap);var Selectpicker=function(element,options){if(!valHooks.useDefault){$.valHooks.select.set=valHooks._set;valHooks.useDefault=true}this.$element=$(element);this.$newElement=null;this.$button=null;this.$menu=null;this.$lis=null;this.options=options;if(this.options.title===null){this.options.title=this.$element.attr("title")}var winPad=this.options.windowPadding;if(typeof winPad==="number"){this.options.windowPadding=[winPad,winPad,winPad,winPad]}this.val=Selectpicker.prototype.val;this.render=Selectpicker.prototype.render;this.refresh=Selectpicker.prototype.refresh;this.setStyle=Selectpicker.prototype.setStyle;this.selectAll=Selectpicker.prototype.selectAll;this.deselectAll=Selectpicker.prototype.deselectAll;this.destroy=Selectpicker.prototype.destroy;this.remove=Selectpicker.prototype.remove;this.show=Selectpicker.prototype.show;this.hide=Selectpicker.prototype.hide;this.init()};Selectpicker.VERSION="1.12.4";Selectpicker.DEFAULTS={noneSelectedText:"Nothing selected",noneResultsText:"No results matched {0}",countSelectedText:function(numSelected,numTotal){return numSelected==1?"{0} item selected":"{0} items selected"},maxOptionsText:function(numAll,numGroup){return[numAll==1?"Limit reached ({n} item max)":"Limit reached ({n} items max)",numGroup==1?"Group limit reached ({n} item max)":"Group limit reached ({n} items max)"]},selectAllText:"Select All",deselectAllText:"Deselect All",doneButton:false,doneButtonText:"Close",multipleSeparator:", ",styleBase:"btn",style:"btn-default",size:"auto",title:null,selectedTextFormat:"values",width:false,container:false,hideDisabled:false,showSubtext:false,showIcon:true,showContent:true,dropupAuto:true,header:false,liveSearch:false,liveSearchPlaceholder:null,liveSearchNormalize:false,liveSearchStyle:"contains",actionsBox:false,iconBase:"glyphicon",tickIcon:"glyphicon-ok",showTick:false,template:{caret:'<span class="caret"></span>'},maxOptions:false,mobile:false,selectOnTab:false,dropdownAlignRight:false,windowPadding:0};Selectpicker.prototype={constructor:Selectpicker,init:function(){var that=this,id=this.$element.attr("id");this.$element.addClass("bs-select-hidden");this.liObj={};this.multiple=this.$element.prop("multiple");this.autofocus=this.$element.prop("autofocus");this.$newElement=this.createView();this.$element.after(this.$newElement).appendTo(this.$newElement);this.$button=this.$newElement.children("button");this.$menu=this.$newElement.children(".dropdown-menu");this.$menuInner=this.$menu.children(".inner");this.$searchbox=this.$menu.find("input");this.$element.removeClass("bs-select-hidden");if(this.options.dropdownAlignRight===true)this.$menu.addClass("dropdown-menu-right");if(typeof id!=="undefined"){this.$button.attr("data-id",id);$('label[for="'+id+'"]').click(function(e){e.preventDefault();that.$button.focus()})}this.checkDisabled();this.clickListener();if(this.options.liveSearch)this.liveSearchListener();this.render();this.setStyle();this.setWidth();if(this.options.container)this.selectPosition();this.$menu.data("this",this);this.$newElement.data("this",this);if(this.options.mobile)this.mobile();this.$newElement.on({"hide.bs.dropdown":function(e){that.$menuInner.attr("aria-expanded",false);that.$element.trigger("hide.bs.select",e)},"hidden.bs.dropdown":function(e){that.$element.trigger("hidden.bs.select",e)},"show.bs.dropdown":function(e){that.$menuInner.attr("aria-expanded",true);that.$element.trigger("show.bs.select",e)},"shown.bs.dropdown":function(e){that.$element.trigger("shown.bs.select",e)}});if(that.$element[0].hasAttribute("required")){this.$element.on("invalid",function(){that.$button.addClass("bs-invalid");that.$element.on({"focus.bs.select":function(){that.$button.focus();that.$element.off("focus.bs.select")},"shown.bs.select":function(){that.$element.val(that.$element.val()).off("shown.bs.select")},"rendered.bs.select":function(){if(this.validity.valid)that.$button.removeClass("bs-invalid");that.$element.off("rendered.bs.select")}});that.$button.on("blur.bs.select",function(){that.$element.focus().blur();that.$button.off("blur.bs.select")})})}setTimeout(function(){that.$element.trigger("loaded.bs.select")})},createDropdown:function(){var showTick=this.multiple||this.options.showTick?" show-tick":"",inputGroup=this.$element.parent().hasClass("input-group")?" input-group-btn":"",autofocus=this.autofocus?" autofocus":"";var header=this.options.header?'<div class="popover-title"><button type="button" class="close" aria-hidden="true">&times;</button>'+this.options.header+"</div>":"";var searchbox=this.options.liveSearch?'<div class="bs-searchbox">'+'<input type="text" class="form-control" autocomplete="off"'+(null===this.options.liveSearchPlaceholder?"":' placeholder="'+htmlEscape(this.options.liveSearchPlaceholder)+'"')+' role="textbox" aria-label="Search">'+"</div>":"";var actionsbox=this.multiple&&this.options.actionsBox?'<div class="bs-actionsbox">'+'<div class="btn-group btn-group-sm btn-block">'+'<button type="button" class="actions-btn bs-select-all btn btn-default">'+this.options.selectAllText+"</button>"+'<button type="button" class="actions-btn bs-deselect-all btn btn-default">'+this.options.deselectAllText+"</button>"+"</div>"+"</div>":"";var donebutton=this.multiple&&this.options.doneButton?'<div class="bs-donebutton">'+'<div class="btn-group btn-block">'+'<button type="button" class="btn btn-sm btn-default">'+this.options.doneButtonText+"</button>"+"</div>"+"</div>":"";var drop='<div class="btn-group bootstrap-select'+showTick+inputGroup+'">'+'<button type="button" class="'+this.options.styleBase+' dropdown-toggle" data-toggle="dropdown"'+autofocus+' role="button">'+'<span class="filter-option pull-left"></span>&nbsp;'+'<span class="bs-caret">'+this.options.template.caret+"</span>"+"</button>"+'<div class="dropdown-menu open" role="combobox">'+header+searchbox+actionsbox+'<ul class="dropdown-menu inner" role="listbox" aria-expanded="false">'+"</ul>"+donebutton+"</div>"+"</div>";return $(drop)},createView:function(){var $drop=this.createDropdown(),li=this.createLi();$drop.find("ul")[0].innerHTML=li;return $drop},reloadLi:function(){var li=this.createLi();this.$menuInner[0].innerHTML=li},createLi:function(){var that=this,_li=[],optID=0,titleOption=document.createElement("option"),liIndex=-1;var generateLI=function(content,index,classes,optgroup){return"<li"+(typeof classes!=="undefined"&&""!==classes?' class="'+classes+'"':"")+(typeof index!=="undefined"&&null!==index?' data-original-index="'+index+'"':"")+(typeof optgroup!=="undefined"&&null!==optgroup?'data-optgroup="'+optgroup+'"':"")+">"+content+"</li>"};var generateA=function(text,classes,inline,tokens){return'<a tabindex="0"'+(typeof classes!=="undefined"?' class="'+classes+'"':"")+(inline?' style="'+inline+'"':"")+(that.options.liveSearchNormalize?' data-normalized-text="'+normalizeToBase(htmlEscape($(text).html()))+'"':"")+(typeof tokens!=="undefined"||tokens!==null?' data-tokens="'+tokens+'"':"")+' role="option">'+text+'<span class="'+that.options.iconBase+" "+that.options.tickIcon+' check-mark"></span>'+"</a>"};if(this.options.title&&!this.multiple){liIndex--;if(!this.$element.find(".bs-title-option").length){var element=this.$element[0];titleOption.className="bs-title-option";titleOption.innerHTML=this.options.title;titleOption.value="";element.insertBefore(titleOption,element.firstChild);var $opt=$(element.options[element.selectedIndex]);if($opt.attr("selected")===undefined&&this.$element.data("selected")===undefined){titleOption.selected=true}}}var $selectOptions=this.$element.find("option");$selectOptions.each(function(index){var $this=$(this);liIndex++;if($this.hasClass("bs-title-option"))return;var optionClass=this.className||"",inline=htmlEscape(this.style.cssText),text=$this.data("content")?$this.data("content"):$this.html(),tokens=$this.data("tokens")?$this.data("tokens"):null,subtext=typeof $this.data("subtext")!=="undefined"?'<small class="text-muted">'+$this.data("subtext")+"</small>":"",icon=typeof $this.data("icon")!=="undefined"?'<span class="'+that.options.iconBase+" "+$this.data("icon")+'"></span> ':"",$parent=$this.parent(),isOptgroup=$parent[0].tagName==="OPTGROUP",isOptgroupDisabled=isOptgroup&&$parent[0].disabled,isDisabled=this.disabled||isOptgroupDisabled,prevHiddenIndex;if(icon!==""&&isDisabled){icon="<span>"+icon+"</span>"}if(that.options.hideDisabled&&(isDisabled&&!isOptgroup||isOptgroupDisabled)){prevHiddenIndex=$this.data("prevHiddenIndex");$this.next().data("prevHiddenIndex",prevHiddenIndex!==undefined?prevHiddenIndex:index);liIndex--;return}if(!$this.data("content")){text=icon+'<span class="text">'+text+subtext+"</span>"}if(isOptgroup&&$this.data("divider")!==true){if(that.options.hideDisabled&&isDisabled){if($parent.data("allOptionsDisabled")===undefined){var $options=$parent.children();$parent.data("allOptionsDisabled",$options.filter(":disabled").length===$options.length)}if($parent.data("allOptionsDisabled")){liIndex--;return}}var optGroupClass=" "+$parent[0].className||"";if($this.index()===0){optID+=1;var label=$parent[0].label,labelSubtext=typeof $parent.data("subtext")!=="undefined"?'<small class="text-muted">'+$parent.data("subtext")+"</small>":"",labelIcon=$parent.data("icon")?'<span class="'+that.options.iconBase+" "+$parent.data("icon")+'"></span> ':"";label=labelIcon+'<span class="text">'+htmlEscape(label)+labelSubtext+"</span>";if(index!==0&&_li.length>0){liIndex++;_li.push(generateLI("",null,"divider",optID+"div"))}liIndex++;_li.push(generateLI(label,null,"dropdown-header"+optGroupClass,optID))}if(that.options.hideDisabled&&isDisabled){liIndex--;return}_li.push(generateLI(generateA(text,"opt "+optionClass+optGroupClass,inline,tokens),index,"",optID))}else if($this.data("divider")===true){_li.push(generateLI("",index,"divider"))}else if($this.data("hidden")===true){prevHiddenIndex=$this.data("prevHiddenIndex");$this.next().data("prevHiddenIndex",prevHiddenIndex!==undefined?prevHiddenIndex:index);_li.push(generateLI(generateA(text,optionClass,inline,tokens),index,"hidden is-hidden"))}else{var showDivider=this.previousElementSibling&&this.previousElementSibling.tagName==="OPTGROUP";if(!showDivider&&that.options.hideDisabled){prevHiddenIndex=$this.data("prevHiddenIndex");if(prevHiddenIndex!==undefined){var prevHidden=$selectOptions.eq(prevHiddenIndex)[0].previousElementSibling;if(prevHidden&&prevHidden.tagName==="OPTGROUP"&&!prevHidden.disabled){showDivider=true}}}if(showDivider){liIndex++;_li.push(generateLI("",null,"divider",optID+"div"))}_li.push(generateLI(generateA(text,optionClass,inline,tokens),index))}that.liObj[index]=liIndex});if(!this.multiple&&this.$element.find("option:selected").length===0&&!this.options.title){this.$element.find("option").eq(0).prop("selected",true).attr("selected","selected")}return _li.join("")},findLis:function(){if(this.$lis==null)this.$lis=this.$menu.find("li");return this.$lis},render:function(updateLi){var that=this,notDisabled,$selectOptions=this.$element.find("option");if(updateLi!==false){$selectOptions.each(function(index){var $lis=that.findLis().eq(that.liObj[index]);that.setDisabled(index,this.disabled||this.parentNode.tagName==="OPTGROUP"&&this.parentNode.disabled,$lis);that.setSelected(index,this.selected,$lis)})}this.togglePlaceholder();this.tabIndex();var selectedItems=$selectOptions.map(function(){if(this.selected){if(that.options.hideDisabled&&(this.disabled||this.parentNode.tagName==="OPTGROUP"&&this.parentNode.disabled))return;var $this=$(this),icon=$this.data("icon")&&that.options.showIcon?'<i class="'+that.options.iconBase+" "+$this.data("icon")+'"></i> ':"",subtext;if(that.options.showSubtext&&$this.data("subtext")&&!that.multiple){subtext=' <small class="text-muted">'+$this.data("subtext")+"</small>"}else{subtext=""}if(typeof $this.attr("title")!=="undefined"){return $this.attr("title")}else if($this.data("content")&&that.options.showContent){return $this.data("content").toString()}else{return icon+$this.html()+subtext}}}).toArray();var title=!this.multiple?selectedItems[0]:selectedItems.join(this.options.multipleSeparator);if(this.multiple&&this.options.selectedTextFormat.indexOf("count")>-1){var max=this.options.selectedTextFormat.split(">");if(max.length>1&&selectedItems.length>max[1]||max.length==1&&selectedItems.length>=2){notDisabled=this.options.hideDisabled?", [disabled]":"";var totalCount=$selectOptions.not('[data-divider="true"], [data-hidden="true"]'+notDisabled).length,tr8nText=typeof this.options.countSelectedText==="function"?this.options.countSelectedText(selectedItems.length,totalCount):this.options.countSelectedText;title=tr8nText.replace("{0}",selectedItems.length.toString()).replace("{1}",totalCount.toString())}}if(this.options.title==undefined){this.options.title=this.$element.attr("title")}if(this.options.selectedTextFormat=="static"){title=this.options.title}if(!title){title=typeof this.options.title!=="undefined"?this.options.title:this.options.noneSelectedText}this.$button.attr("title",htmlUnescape($.trim(title.replace(/<[^>]*>?/g,""))));this.$button.children(".filter-option").html(title);this.$element.trigger("rendered.bs.select")},setStyle:function(style,status){if(this.$element.attr("class")){this.$newElement.addClass(this.$element.attr("class").replace(/selectpicker|mobile-device|bs-select-hidden|validate\[.*\]/gi,""))}var buttonClass=style?style:this.options.style;if(status=="add"){this.$button.addClass(buttonClass)}else if(status=="remove"){this.$button.removeClass(buttonClass)}else{this.$button.removeClass(this.options.style);this.$button.addClass(buttonClass)}},liHeight:function(refresh){if(!refresh&&(this.options.size===false||this.sizeInfo))return;var newElement=document.createElement("div"),menu=document.createElement("div"),menuInner=document.createElement("ul"),divider=document.createElement("li"),li=document.createElement("li"),a=document.createElement("a"),text=document.createElement("span"),header=this.options.header&&this.$menu.find(".popover-title").length>0?this.$menu.find(".popover-title")[0].cloneNode(true):null,search=this.options.liveSearch?document.createElement("div"):null,actions=this.options.actionsBox&&this.multiple&&this.$menu.find(".bs-actionsbox").length>0?this.$menu.find(".bs-actionsbox")[0].cloneNode(true):null,doneButton=this.options.doneButton&&this.multiple&&this.$menu.find(".bs-donebutton").length>0?this.$menu.find(".bs-donebutton")[0].cloneNode(true):null;text.className="text";newElement.className=this.$menu[0].parentNode.className+" open";menu.className="dropdown-menu open";menuInner.className="dropdown-menu inner";divider.className="divider";text.appendChild(document.createTextNode("Inner text"));a.appendChild(text);li.appendChild(a);menuInner.appendChild(li);menuInner.appendChild(divider);if(header)menu.appendChild(header);if(search){var input=document.createElement("input");search.className="bs-searchbox";input.className="form-control";search.appendChild(input);menu.appendChild(search)}if(actions)menu.appendChild(actions);menu.appendChild(menuInner);if(doneButton)menu.appendChild(doneButton);newElement.appendChild(menu);document.body.appendChild(newElement);var liHeight=a.offsetHeight,headerHeight=header?header.offsetHeight:0,searchHeight=search?search.offsetHeight:0,actionsHeight=actions?actions.offsetHeight:0,doneButtonHeight=doneButton?doneButton.offsetHeight:0,dividerHeight=$(divider).outerHeight(true),menuStyle=typeof getComputedStyle==="function"?getComputedStyle(menu):false,$menu=menuStyle?null:$(menu),menuPadding={vert:parseInt(menuStyle?menuStyle.paddingTop:$menu.css("paddingTop"))+parseInt(menuStyle?menuStyle.paddingBottom:$menu.css("paddingBottom"))+parseInt(menuStyle?menuStyle.borderTopWidth:$menu.css("borderTopWidth"))+parseInt(menuStyle?menuStyle.borderBottomWidth:$menu.css("borderBottomWidth")),horiz:parseInt(menuStyle?menuStyle.paddingLeft:$menu.css("paddingLeft"))+parseInt(menuStyle?menuStyle.paddingRight:$menu.css("paddingRight"))+parseInt(menuStyle?menuStyle.borderLeftWidth:$menu.css("borderLeftWidth"))+parseInt(menuStyle?menuStyle.borderRightWidth:$menu.css("borderRightWidth"))},menuExtras={vert:menuPadding.vert+parseInt(menuStyle?menuStyle.marginTop:$menu.css("marginTop"))+parseInt(menuStyle?menuStyle.marginBottom:$menu.css("marginBottom"))+2,horiz:menuPadding.horiz+parseInt(menuStyle?menuStyle.marginLeft:$menu.css("marginLeft"))+parseInt(menuStyle?menuStyle.marginRight:$menu.css("marginRight"))+2};document.body.removeChild(newElement);this.sizeInfo={liHeight:liHeight,headerHeight:headerHeight,searchHeight:searchHeight,actionsHeight:actionsHeight,doneButtonHeight:doneButtonHeight,dividerHeight:dividerHeight,menuPadding:menuPadding,menuExtras:menuExtras}},setSize:function(){this.findLis();this.liHeight();if(this.options.header)this.$menu.css("padding-top",0);if(this.options.size===false)return;var that=this,$menu=this.$menu,$menuInner=this.$menuInner,$window=$(window),selectHeight=this.$newElement[0].offsetHeight,selectWidth=this.$newElement[0].offsetWidth,liHeight=this.sizeInfo["liHeight"],headerHeight=this.sizeInfo["headerHeight"],searchHeight=this.sizeInfo["searchHeight"],actionsHeight=this.sizeInfo["actionsHeight"],doneButtonHeight=this.sizeInfo["doneButtonHeight"],divHeight=this.sizeInfo["dividerHeight"],menuPadding=this.sizeInfo["menuPadding"],menuExtras=this.sizeInfo["menuExtras"],notDisabled=this.options.hideDisabled?".disabled":"",menuHeight,menuWidth,getHeight,getWidth,selectOffsetTop,selectOffsetBot,selectOffsetLeft,selectOffsetRight,getPos=function(){var pos=that.$newElement.offset(),$container=$(that.options.container),containerPos;if(that.options.container&&!$container.is("body")){containerPos=$container.offset();containerPos.top+=parseInt($container.css("borderTopWidth"));containerPos.left+=parseInt($container.css("borderLeftWidth"))}else{containerPos={top:0,left:0}}var winPad=that.options.windowPadding;selectOffsetTop=pos.top-containerPos.top-$window.scrollTop();selectOffsetBot=$window.height()-selectOffsetTop-selectHeight-containerPos.top-winPad[2];selectOffsetLeft=pos.left-containerPos.left-$window.scrollLeft();selectOffsetRight=$window.width()-selectOffsetLeft-selectWidth-containerPos.left-winPad[1];selectOffsetTop-=winPad[0];selectOffsetLeft-=winPad[3]};getPos();if(this.options.size==="auto"){var getSize=function(){var minHeight,hasClass=function(className,include){return function(element){if(include){return element.classList?element.classList.contains(className):$(element).hasClass(className)}else{return!(element.classList?element.classList.contains(className):$(element).hasClass(className))}}},lis=that.$menuInner[0].getElementsByTagName("li"),lisVisible=Array.prototype.filter?Array.prototype.filter.call(lis,hasClass("hidden",false)):that.$lis.not(".hidden"),optGroup=Array.prototype.filter?Array.prototype.filter.call(lisVisible,hasClass("dropdown-header",true)):lisVisible.filter(".dropdown-header");getPos();menuHeight=selectOffsetBot-menuExtras.vert;menuWidth=selectOffsetRight-menuExtras.horiz;if(that.options.container){if(!$menu.data("height"))$menu.data("height",$menu.height());getHeight=$menu.data("height");if(!$menu.data("width"))$menu.data("width",$menu.width());getWidth=$menu.data("width")}else{getHeight=$menu.height();getWidth=$menu.width()}if(that.options.dropupAuto){that.$newElement.toggleClass("dropup",selectOffsetTop>selectOffsetBot&&menuHeight-menuExtras.vert<getHeight)}if(that.$newElement.hasClass("dropup")){menuHeight=selectOffsetTop-menuExtras.vert}if(that.options.dropdownAlignRight==="auto"){$menu.toggleClass("dropdown-menu-right",selectOffsetLeft>selectOffsetRight&&menuWidth-menuExtras.horiz<getWidth-selectWidth)}if(lisVisible.length+optGroup.length>3){minHeight=liHeight*3+menuExtras.vert-2}else{minHeight=0}$menu.css({"max-height":menuHeight+"px",overflow:"hidden","min-height":minHeight+headerHeight+searchHeight+actionsHeight+doneButtonHeight+"px"});$menuInner.css({"max-height":menuHeight-headerHeight-searchHeight-actionsHeight-doneButtonHeight-menuPadding.vert+"px","overflow-y":"auto","min-height":Math.max(minHeight-menuPadding.vert,0)+"px"})};getSize();this.$searchbox.off("input.getSize propertychange.getSize").on("input.getSize propertychange.getSize",getSize);$window.off("resize.getSize scroll.getSize").on("resize.getSize scroll.getSize",getSize)}else if(this.options.size&&this.options.size!="auto"&&this.$lis.not(notDisabled).length>this.options.size){var optIndex=this.$lis.not(".divider").not(notDisabled).children().slice(0,this.options.size).last().parent().index(),divLength=this.$lis.slice(0,optIndex+1).filter(".divider").length;menuHeight=liHeight*this.options.size+divLength*divHeight+menuPadding.vert;if(that.options.container){if(!$menu.data("height"))$menu.data("height",$menu.height());getHeight=$menu.data("height")}else{getHeight=$menu.height()}if(that.options.dropupAuto){this.$newElement.toggleClass("dropup",selectOffsetTop>selectOffsetBot&&menuHeight-menuExtras.vert<getHeight)}$menu.css({"max-height":menuHeight+headerHeight+searchHeight+actionsHeight+doneButtonHeight+"px",overflow:"hidden","min-height":""});$menuInner.css({"max-height":menuHeight-menuPadding.vert+"px","overflow-y":"auto","min-height":""})}},setWidth:function(){if(this.options.width==="auto"){this.$menu.css("min-width","0");var $selectClone=this.$menu.parent().clone().appendTo("body"),$selectClone2=this.options.container?this.$newElement.clone().appendTo("body"):$selectClone,ulWidth=$selectClone.children(".dropdown-menu").outerWidth(),btnWidth=$selectClone2.css("width","auto").children("button").outerWidth();$selectClone.remove();$selectClone2.remove();this.$newElement.css("width",Math.max(ulWidth,btnWidth)+"px")}else if(this.options.width==="fit"){this.$menu.css("min-width","");this.$newElement.css("width","").addClass("fit-width")}else if(this.options.width){this.$menu.css("min-width","");this.$newElement.css("width",this.options.width)}else{this.$menu.css("min-width","");this.$newElement.css("width","")}if(this.$newElement.hasClass("fit-width")&&this.options.width!=="fit"){this.$newElement.removeClass("fit-width")}},selectPosition:function(){this.$bsContainer=$('<div class="bs-container" />');var that=this,$container=$(this.options.container),pos,containerPos,actualHeight,getPlacement=function($element){that.$bsContainer.addClass($element.attr("class").replace(/form-control|fit-width/gi,"")).toggleClass("dropup",$element.hasClass("dropup"));pos=$element.offset();if(!$container.is("body")){containerPos=$container.offset();containerPos.top+=parseInt($container.css("borderTopWidth"))-$container.scrollTop();containerPos.left+=parseInt($container.css("borderLeftWidth"))-$container.scrollLeft()}else{containerPos={top:0,left:0}}actualHeight=$element.hasClass("dropup")?0:$element[0].offsetHeight;that.$bsContainer.css({top:pos.top-containerPos.top+actualHeight,left:pos.left-containerPos.left,width:$element[0].offsetWidth})};this.$button.on("click",function(){var $this=$(this);if(that.isDisabled()){return}getPlacement(that.$newElement);that.$bsContainer.appendTo(that.options.container).toggleClass("open",!$this.hasClass("open")).append(that.$menu)});$(window).on("resize scroll",function(){getPlacement(that.$newElement)});this.$element.on("hide.bs.select",function(){that.$menu.data("height",that.$menu.height());that.$bsContainer.detach()})},setSelected:function(index,selected,$lis){if(!$lis){this.togglePlaceholder();$lis=this.findLis().eq(this.liObj[index])}$lis.toggleClass("selected",selected).find("a").attr("aria-selected",selected)},setDisabled:function(index,disabled,$lis){if(!$lis){$lis=this.findLis().eq(this.liObj[index])}if(disabled){$lis.addClass("disabled").children("a").attr("href","#").attr("tabindex",-1).attr("aria-disabled",true)}else{$lis.removeClass("disabled").children("a").removeAttr("href").attr("tabindex",0).attr("aria-disabled",false)}},isDisabled:function(){return this.$element[0].disabled},checkDisabled:function(){var that=this;if(this.isDisabled()){this.$newElement.addClass("disabled");this.$button.addClass("disabled").attr("tabindex",-1).attr("aria-disabled",true)}else{if(this.$button.hasClass("disabled")){this.$newElement.removeClass("disabled");this.$button.removeClass("disabled").attr("aria-disabled",false)}if(this.$button.attr("tabindex")==-1&&!this.$element.data("tabindex")){this.$button.removeAttr("tabindex")}}this.$button.click(function(){return!that.isDisabled()})},togglePlaceholder:function(){var value=this.$element.val();this.$button.toggleClass("bs-placeholder",value===null||value===""||value.constructor===Array&&value.length===0)},tabIndex:function(){if(this.$element.data("tabindex")!==this.$element.attr("tabindex")&&(this.$element.attr("tabindex")!==-98&&this.$element.attr("tabindex")!=="-98")){this.$element.data("tabindex",this.$element.attr("tabindex"));this.$button.attr("tabindex",this.$element.data("tabindex"))}this.$element.attr("tabindex",-98)},clickListener:function(){var that=this,$document=$(document);$document.data("spaceSelect",false);this.$button.on("keyup",function(e){if(/(32)/.test(e.keyCode.toString(10))&&$document.data("spaceSelect")){e.preventDefault();$document.data("spaceSelect",false)}});this.$button.on("click",function(){that.setSize()});this.$element.on("shown.bs.select",function(){if(!that.options.liveSearch&&!that.multiple){that.$menuInner.find(".selected a").focus()}else if(!that.multiple){var selectedIndex=that.liObj[that.$element[0].selectedIndex];if(typeof selectedIndex!=="number"||that.options.size===false)return;var offset=that.$lis.eq(selectedIndex)[0].offsetTop-that.$menuInner[0].offsetTop;offset=offset-that.$menuInner[0].offsetHeight/2+that.sizeInfo.liHeight/2;that.$menuInner[0].scrollTop=offset}});this.$menuInner.on("click","li a",function(e){var $this=$(this),clickedIndex=$this.parent().data("originalIndex"),prevValue=that.$element.val(),prevIndex=that.$element.prop("selectedIndex"),triggerChange=true;if(that.multiple&&that.options.maxOptions!==1){e.stopPropagation()}e.preventDefault();if(!that.isDisabled()&&!$this.parent().hasClass("disabled")){var $options=that.$element.find("option"),$option=$options.eq(clickedIndex),state=$option.prop("selected"),$optgroup=$option.parent("optgroup"),maxOptions=that.options.maxOptions,maxOptionsGrp=$optgroup.data("maxOptions")||false;if(!that.multiple){$options.prop("selected",false);$option.prop("selected",true);that.$menuInner.find(".selected").removeClass("selected").find("a").attr("aria-selected",false);that.setSelected(clickedIndex,true)}else{$option.prop("selected",!state);that.setSelected(clickedIndex,!state);$this.blur();if(maxOptions!==false||maxOptionsGrp!==false){var maxReached=maxOptions<$options.filter(":selected").length,maxReachedGrp=maxOptionsGrp<$optgroup.find("option:selected").length;if(maxOptions&&maxReached||maxOptionsGrp&&maxReachedGrp){if(maxOptions&&maxOptions==1){$options.prop("selected",false);$option.prop("selected",true);that.$menuInner.find(".selected").removeClass("selected");that.setSelected(clickedIndex,true)}else if(maxOptionsGrp&&maxOptionsGrp==1){$optgroup.find("option:selected").prop("selected",false);$option.prop("selected",true);var optgroupID=$this.parent().data("optgroup");that.$menuInner.find('[data-optgroup="'+optgroupID+'"]').removeClass("selected");that.setSelected(clickedIndex,true)}else{var maxOptionsText=typeof that.options.maxOptionsText==="string"?[that.options.maxOptionsText,that.options.maxOptionsText]:that.options.maxOptionsText,maxOptionsArr=typeof maxOptionsText==="function"?maxOptionsText(maxOptions,maxOptionsGrp):maxOptionsText,maxTxt=maxOptionsArr[0].replace("{n}",maxOptions),maxTxtGrp=maxOptionsArr[1].replace("{n}",maxOptionsGrp),$notify=$('<div class="notify"></div>');if(maxOptionsArr[2]){maxTxt=maxTxt.replace("{var}",maxOptionsArr[2][maxOptions>1?0:1]);maxTxtGrp=maxTxtGrp.replace("{var}",maxOptionsArr[2][maxOptionsGrp>1?0:1])}$option.prop("selected",false);that.$menu.append($notify);if(maxOptions&&maxReached){$notify.append($("<div>"+maxTxt+"</div>"));triggerChange=false;that.$element.trigger("maxReached.bs.select")}if(maxOptionsGrp&&maxReachedGrp){$notify.append($("<div>"+maxTxtGrp+"</div>"));triggerChange=false;that.$element.trigger("maxReachedGrp.bs.select")}setTimeout(function(){that.setSelected(clickedIndex,false)},10);$notify.delay(750).fadeOut(300,function(){$(this).remove()})}}}}if(!that.multiple||that.multiple&&that.options.maxOptions===1){that.$button.focus()}else if(that.options.liveSearch){that.$searchbox.focus()}if(triggerChange){if(prevValue!=that.$element.val()&&that.multiple||prevIndex!=that.$element.prop("selectedIndex")&&!that.multiple){changed_arguments=[clickedIndex,$option.prop("selected"),state];that.$element.triggerNative("change")}}}});this.$menu.on("click","li.disabled a, .popover-title, .popover-title :not(.close)",function(e){if(e.currentTarget==this){e.preventDefault();e.stopPropagation();if(that.options.liveSearch&&!$(e.target).hasClass("close")){that.$searchbox.focus()}else{that.$button.focus()}}});this.$menuInner.on("click",".divider, .dropdown-header",function(e){e.preventDefault();e.stopPropagation();if(that.options.liveSearch){that.$searchbox.focus()}else{that.$button.focus()}});this.$menu.on("click",".popover-title .close",function(){that.$button.click()});this.$searchbox.on("click",function(e){e.stopPropagation()});this.$menu.on("click",".actions-btn",function(e){if(that.options.liveSearch){that.$searchbox.focus()}else{that.$button.focus()}e.preventDefault();e.stopPropagation();if($(this).hasClass("bs-select-all")){that.selectAll()}else{that.deselectAll()}});this.$element.change(function(){that.render(false);that.$element.trigger("changed.bs.select",changed_arguments);changed_arguments=null})},liveSearchListener:function(){var that=this,$no_results=$('<li class="no-results"></li>');this.$button.on("click.dropdown.data-api",function(){that.$menuInner.find(".active").removeClass("active");if(!!that.$searchbox.val()){that.$searchbox.val("");that.$lis.not(".is-hidden").removeClass("hidden");if(!!$no_results.parent().length)$no_results.remove()}if(!that.multiple)that.$menuInner.find(".selected").addClass("active");setTimeout(function(){that.$searchbox.focus()},10)});this.$searchbox.on("click.dropdown.data-api focus.dropdown.data-api touchend.dropdown.data-api",function(e){e.stopPropagation()});this.$searchbox.on("input propertychange",function(){that.$lis.not(".is-hidden").removeClass("hidden");that.$lis.filter(".active").removeClass("active");$no_results.remove();if(that.$searchbox.val()){var $searchBase=that.$lis.not(".is-hidden, .divider, .dropdown-header"),$hideItems;if(that.options.liveSearchNormalize){$hideItems=$searchBase.not(":a"+that._searchStyle()+'("'+normalizeToBase(that.$searchbox.val())+'")')}else{$hideItems=$searchBase.not(":"+that._searchStyle()+'("'+that.$searchbox.val()+'")')}if($hideItems.length===$searchBase.length){$no_results.html(that.options.noneResultsText.replace("{0}",'"'+htmlEscape(that.$searchbox.val())+'"'));that.$menuInner.append($no_results);that.$lis.addClass("hidden")}else{$hideItems.addClass("hidden");var $lisVisible=that.$lis.not(".hidden"),$foundDiv;$lisVisible.each(function(index){var $this=$(this);if($this.hasClass("divider")){if($foundDiv===undefined){$this.addClass("hidden")}else{if($foundDiv)$foundDiv.addClass("hidden");$foundDiv=$this}}else if($this.hasClass("dropdown-header")&&$lisVisible.eq(index+1).data("optgroup")!==$this.data("optgroup")){$this.addClass("hidden")}else{$foundDiv=null}});if($foundDiv)$foundDiv.addClass("hidden");$searchBase.not(".hidden").first().addClass("active");that.$menuInner.scrollTop(0)}}})},_searchStyle:function(){var styles={begins:"ibegins",startsWith:"ibegins"};return styles[this.options.liveSearchStyle]||"icontains"},val:function(value){if(typeof value!=="undefined"){this.$element.val(value);this.render();return this.$element}else{return this.$element.val()}},changeAll:function(status){if(!this.multiple)return;if(typeof status==="undefined")status=true;this.findLis();var $options=this.$element.find("option"),$lisVisible=this.$lis.not(".divider, .dropdown-header, .disabled, .hidden"),lisVisLen=$lisVisible.length,selectedOptions=[];if(status){if($lisVisible.filter(".selected").length===$lisVisible.length)return}else{if($lisVisible.filter(".selected").length===0)return}$lisVisible.toggleClass("selected",status);for(var i=0;i<lisVisLen;i++){var origIndex=$lisVisible[i].getAttribute("data-original-index");selectedOptions[selectedOptions.length]=$options.eq(origIndex)[0]}$(selectedOptions).prop("selected",status);this.render(false);this.togglePlaceholder();this.$element.triggerNative("change")},selectAll:function(){return this.changeAll(true)},deselectAll:function(){return this.changeAll(false)},toggle:function(e){e=e||window.event;if(e)e.stopPropagation();this.$button.trigger("click")},keydown:function(e){var $this=$(this),$parent=$this.is("input")?$this.parent().parent():$this.parent(),$items,that=$parent.data("this"),index,prevIndex,isActive,selector=":not(.disabled, .hidden, .dropdown-header, .divider)",keyCodeMap={32:" ",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9"};isActive=that.$newElement.hasClass("open");if(!isActive&&(e.keyCode>=48&&e.keyCode<=57||e.keyCode>=96&&e.keyCode<=105||e.keyCode>=65&&e.keyCode<=90)){if(!that.options.container){that.setSize();that.$menu.parent().addClass("open");isActive=true}else{that.$button.trigger("click")}that.$searchbox.focus();return}if(that.options.liveSearch){if(/(^9$|27)/.test(e.keyCode.toString(10))&&isActive){e.preventDefault();e.stopPropagation();that.$menuInner.click();that.$button.focus()}}if(/(38|40)/.test(e.keyCode.toString(10))){$items=that.$lis.filter(selector);if(!$items.length)return;if(!that.options.liveSearch){index=$items.index($items.find("a").filter(":focus").parent())}else{index=$items.index($items.filter(".active"))}prevIndex=that.$menuInner.data("prevIndex");if(e.keyCode==38){if((that.options.liveSearch||index==prevIndex)&&index!=-1)index--;if(index<0)index+=$items.length}else if(e.keyCode==40){if(that.options.liveSearch||index==prevIndex)index++;index=index%$items.length}that.$menuInner.data("prevIndex",index);if(!that.options.liveSearch){$items.eq(index).children("a").focus()}else{e.preventDefault();if(!$this.hasClass("dropdown-toggle")){$items.removeClass("active").eq(index).addClass("active").children("a").focus();$this.focus()}}}else if(!$this.is("input")){var keyIndex=[],count,prevKey;$items=that.$lis.filter(selector);$items.each(function(i){if($.trim($(this).children("a").text().toLowerCase()).substring(0,1)==keyCodeMap[e.keyCode]){keyIndex.push(i)}});count=$(document).data("keycount");count++;$(document).data("keycount",count);prevKey=$.trim($(":focus").text().toLowerCase()).substring(0,1);if(prevKey!=keyCodeMap[e.keyCode]){count=1;$(document).data("keycount",count)}else if(count>=keyIndex.length){$(document).data("keycount",0);if(count>keyIndex.length)count=1}$items.eq(keyIndex[count-1]).children("a").focus()}if((/(13|32)/.test(e.keyCode.toString(10))||/(^9$)/.test(e.keyCode.toString(10))&&that.options.selectOnTab)&&isActive){if(!/(32)/.test(e.keyCode.toString(10)))e.preventDefault();if(!that.options.liveSearch){var elem=$(":focus");elem.click();elem.focus();e.preventDefault();$(document).data("spaceSelect",true)}else if(!/(32)/.test(e.keyCode.toString(10))){that.$menuInner.find(".active a").click();$this.focus()}$(document).data("keycount",0)}if(/(^9$|27)/.test(e.keyCode.toString(10))&&isActive&&(that.multiple||that.options.liveSearch)||/(27)/.test(e.keyCode.toString(10))&&!isActive){that.$menu.parent().removeClass("open");if(that.options.container)that.$newElement.removeClass("open");that.$button.focus()}},mobile:function(){this.$element.addClass("mobile-device")},refresh:function(){this.$lis=null;this.liObj={};this.reloadLi();this.render();this.checkDisabled();this.liHeight(true);this.setStyle();this.setWidth();if(this.$lis)this.$searchbox.trigger("propertychange");this.$element.trigger("refreshed.bs.select")},hide:function(){this.$newElement.hide()},show:function(){this.$newElement.show()},remove:function(){this.$newElement.remove();this.$element.remove()},destroy:function(){this.$newElement.before(this.$element).remove();if(this.$bsContainer){this.$bsContainer.remove()}else{this.$menu.remove()}this.$element.off(".bs.select").removeData("selectpicker").removeClass("bs-select-hidden selectpicker")}};function Plugin(option){var args=arguments;var _option=option;[].shift.apply(args);var value;var chain=this.each(function(){var $this=$(this);if($this.is("select")){var data=$this.data("selectpicker"),options=typeof _option=="object"&&_option;if(!data){var config=$.extend({},Selectpicker.DEFAULTS,$.fn.selectpicker.defaults||{},$this.data(),options);config.template=$.extend({},Selectpicker.DEFAULTS.template,$.fn.selectpicker.defaults?$.fn.selectpicker.defaults.template:{},$this.data().template,options.template);$this.data("selectpicker",data=new Selectpicker(this,config))}else if(options){for(var i in options){if(options.hasOwnProperty(i)){data.options[i]=options[i]}}}if(typeof _option=="string"){if(data[_option]instanceof Function){value=data[_option].apply(data,args)}else{value=data.options[_option]}}}});if(typeof value!=="undefined"){return value}else{return chain}}var old=$.fn.selectpicker;$.fn.selectpicker=Plugin;$.fn.selectpicker.Constructor=Selectpicker;$.fn.selectpicker.noConflict=function(){$.fn.selectpicker=old;return this};$(document).data("keycount",0).on("keydown.bs.select",'.bootstrap-select [data-toggle=dropdown], .bootstrap-select [role="listbox"], .bs-searchbox input',Selectpicker.prototype.keydown).on("focusin.modal",'.bootstrap-select [data-toggle=dropdown], .bootstrap-select [role="listbox"], .bs-searchbox input',function(e){e.stopPropagation()});$(window).on("load.bs.select.data-api",function(){$(".selectpicker").each(function(){var $selectpicker=$(this);Plugin.call($selectpicker,$selectpicker.data())})})})(jQuery)})},{jquery:142}],4:[function(require,module,exports){require("../../js/transition.js");require("../../js/alert.js");require("../../js/button.js");require("../../js/carousel.js");require("../../js/collapse.js");require("../../js/dropdown.js");require("../../js/modal.js");require("../../js/tooltip.js");require("../../js/popover.js");require("../../js/scrollspy.js");require("../../js/tab.js");require("../../js/affix.js")},{"../../js/affix.js":5,"../../js/alert.js":6,"../../js/button.js":7,"../../js/carousel.js":8,"../../js/collapse.js":9,"../../js/dropdown.js":10,"../../js/modal.js":11,"../../js/popover.js":12,"../../js/scrollspy.js":13,"../../js/tab.js":14,"../../js/tooltip.js":15,"../../js/transition.js":16}],5:[function(require,module,exports){+function($){"use strict";var Affix=function(element,options){this.options=$.extend({},Affix.DEFAULTS,options);this.$target=$(this.options.target).on("scroll.bs.affix.data-api",$.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",$.proxy(this.checkPositionWithEventLoop,this));this.$element=$(element);this.affixed=null;this.unpin=null;this.pinnedOffset=null;this.checkPosition()};Affix.VERSION="3.3.7";Affix.RESET="affix affix-top affix-bottom";Affix.DEFAULTS={offset:0,target:window};Affix.prototype.getState=function(scrollHeight,height,offsetTop,offsetBottom){var scrollTop=this.$target.scrollTop();var position=this.$element.offset();var targetHeight=this.$target.height();if(offsetTop!=null&&this.affixed=="top")return scrollTop<offsetTop?"top":false;if(this.affixed=="bottom"){if(offsetTop!=null)return scrollTop+this.unpin<=position.top?false:"bottom";return scrollTop+targetHeight<=scrollHeight-offsetBottom?false:"bottom"}var initializing=this.affixed==null;var colliderTop=initializing?scrollTop:position.top;var colliderHeight=initializing?targetHeight:height;if(offsetTop!=null&&scrollTop<=offsetTop)return"top";if(offsetBottom!=null&&colliderTop+colliderHeight>=scrollHeight-offsetBottom)return"bottom";return false};Affix.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(Affix.RESET).addClass("affix");var scrollTop=this.$target.scrollTop();var position=this.$element.offset();return this.pinnedOffset=position.top-scrollTop};Affix.prototype.checkPositionWithEventLoop=function(){setTimeout($.proxy(this.checkPosition,this),1)};Affix.prototype.checkPosition=function(){if(!this.$element.is(":visible"))return;var height=this.$element.height();var offset=this.options.offset;var offsetTop=offset.top;var offsetBottom=offset.bottom;var scrollHeight=Math.max($(document).height(),$(document.body).height());if(typeof offset!="object")offsetBottom=offsetTop=offset;if(typeof offsetTop=="function")offsetTop=offset.top(this.$element);if(typeof offsetBottom=="function")offsetBottom=offset.bottom(this.$element);var affix=this.getState(scrollHeight,height,offsetTop,offsetBottom);if(this.affixed!=affix){if(this.unpin!=null)this.$element.css("top","");var affixType="affix"+(affix?"-"+affix:"");var e=$.Event(affixType+".bs.affix");this.$element.trigger(e);if(e.isDefaultPrevented())return;this.affixed=affix;this.unpin=affix=="bottom"?this.getPinnedOffset():null;this.$element.removeClass(Affix.RESET).addClass(affixType).trigger(affixType.replace("affix","affixed")+".bs.affix")}if(affix=="bottom"){this.$element.offset({top:scrollHeight-height-offsetBottom})}};function Plugin(option){return this.each(function(){var $this=$(this);var data=$this.data("bs.affix");var options=typeof option=="object"&&option;if(!data)$this.data("bs.affix",data=new Affix(this,options));if(typeof option=="string")data[option]()})}var old=$.fn.affix;$.fn.affix=Plugin;$.fn.affix.Constructor=Affix;$.fn.affix.noConflict=function(){$.fn.affix=old;return this};$(window).on("load",function(){$('[data-spy="affix"]').each(function(){var $spy=$(this);var data=$spy.data();data.offset=data.offset||{};if(data.offsetBottom!=null)data.offset.bottom=data.offsetBottom;if(data.offsetTop!=null)data.offset.top=data.offsetTop;Plugin.call($spy,data)})})}(jQuery)},{}],6:[function(require,module,exports){+function($){"use strict";var dismiss='[data-dismiss="alert"]';var Alert=function(el){$(el).on("click",dismiss,this.close)};Alert.VERSION="3.3.7";Alert.TRANSITION_DURATION=150;Alert.prototype.close=function(e){var $this=$(this);var selector=$this.attr("data-target");if(!selector){selector=$this.attr("href");selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,"")}var $parent=$(selector==="#"?[]:selector);if(e)e.preventDefault();if(!$parent.length){$parent=$this.closest(".alert")}$parent.trigger(e=$.Event("close.bs.alert"));if(e.isDefaultPrevented())return;$parent.removeClass("in");function removeElement(){$parent.detach().trigger("closed.bs.alert").remove()}$.support.transition&&$parent.hasClass("fade")?$parent.one("bsTransitionEnd",removeElement).emulateTransitionEnd(Alert.TRANSITION_DURATION):removeElement()};function Plugin(option){return this.each(function(){var $this=$(this);var data=$this.data("bs.alert");if(!data)$this.data("bs.alert",data=new Alert(this));if(typeof option=="string")data[option].call($this)})}var old=$.fn.alert;$.fn.alert=Plugin;$.fn.alert.Constructor=Alert;$.fn.alert.noConflict=function(){$.fn.alert=old;return this};$(document).on("click.bs.alert.data-api",dismiss,Alert.prototype.close)}(jQuery)},{}],7:[function(require,module,exports){+function($){"use strict";var Button=function(element,options){this.$element=$(element);this.options=$.extend({},Button.DEFAULTS,options);this.isLoading=false};Button.VERSION="3.3.7";Button.DEFAULTS={loadingText:"loading..."};Button.prototype.setState=function(state){var d="disabled";var $el=this.$element;var val=$el.is("input")?"val":"html";var data=$el.data();state+="Text";if(data.resetText==null)$el.data("resetText",$el[val]());setTimeout($.proxy(function(){$el[val](data[state]==null?this.options[state]:data[state]);if(state=="loadingText"){this.isLoading=true;$el.addClass(d).attr(d,d).prop(d,true)}else if(this.isLoading){this.isLoading=false;$el.removeClass(d).removeAttr(d).prop(d,false)}},this),0)};Button.prototype.toggle=function(){var changed=true;var $parent=this.$element.closest('[data-toggle="buttons"]');if($parent.length){var $input=this.$element.find("input");if($input.prop("type")=="radio"){if($input.prop("checked"))changed=false;$parent.find(".active").removeClass("active");this.$element.addClass("active")}else if($input.prop("type")=="checkbox"){if($input.prop("checked")!==this.$element.hasClass("active"))changed=false;this.$element.toggleClass("active")}$input.prop("checked",this.$element.hasClass("active"));if(changed)$input.trigger("change")}else{this.$element.attr("aria-pressed",!this.$element.hasClass("active"));this.$element.toggleClass("active")}};function Plugin(option){return this.each(function(){var $this=$(this);var data=$this.data("bs.button");var options=typeof option=="object"&&option;if(!data)$this.data("bs.button",data=new Button(this,options));if(option=="toggle")data.toggle();else if(option)data.setState(option)})}var old=$.fn.button;$.fn.button=Plugin;$.fn.button.Constructor=Button;$.fn.button.noConflict=function(){$.fn.button=old;return this};$(document).on("click.bs.button.data-api",'[data-toggle^="button"]',function(e){var $btn=$(e.target).closest(".btn");Plugin.call($btn,"toggle");if(!$(e.target).is('input[type="radio"], input[type="checkbox"]')){e.preventDefault();if($btn.is("input,button"))$btn.trigger("focus");else $btn.find("input:visible,button:visible").first().trigger("focus")}}).on("focus.bs.button.data-api blur.bs.button.data-api",'[data-toggle^="button"]',function(e){$(e.target).closest(".btn").toggleClass("focus",/^focus(in)?$/.test(e.type))})}(jQuery)},{}],8:[function(require,module,exports){+function($){"use strict";var Carousel=function(element,options){this.$element=$(element);this.$indicators=this.$element.find(".carousel-indicators");this.options=options;this.paused=null;this.sliding=null;this.interval=null;this.$active=null;this.$items=null;this.options.keyboard&&this.$element.on("keydown.bs.carousel",$.proxy(this.keydown,this));this.options.pause=="hover"&&!("ontouchstart"in document.documentElement)&&this.$element.on("mouseenter.bs.carousel",$.proxy(this.pause,this)).on("mouseleave.bs.carousel",$.proxy(this.cycle,this))};Carousel.VERSION="3.3.7";Carousel.TRANSITION_DURATION=600;Carousel.DEFAULTS={interval:5e3,pause:"hover",wrap:true,keyboard:true};Carousel.prototype.keydown=function(e){if(/input|textarea/i.test(e.target.tagName))return;switch(e.which){case 37:this.prev();break;case 39:this.next();break;default:return}e.preventDefault()};Carousel.prototype.cycle=function(e){e||(this.paused=false);this.interval&&clearInterval(this.interval);this.options.interval&&!this.paused&&(this.interval=setInterval($.proxy(this.next,this),this.options.interval));return this};Carousel.prototype.getItemIndex=function(item){this.$items=item.parent().children(".item");return this.$items.index(item||this.$active)};Carousel.prototype.getItemForDirection=function(direction,active){var activeIndex=this.getItemIndex(active);var willWrap=direction=="prev"&&activeIndex===0||direction=="next"&&activeIndex==this.$items.length-1;if(willWrap&&!this.options.wrap)return active;var delta=direction=="prev"?-1:1;var itemIndex=(activeIndex+delta)%this.$items.length;return this.$items.eq(itemIndex)};Carousel.prototype.to=function(pos){var that=this;var activeIndex=this.getItemIndex(this.$active=this.$element.find(".item.active"));if(pos>this.$items.length-1||pos<0)return;if(this.sliding)return this.$element.one("slid.bs.carousel",function(){that.to(pos)});if(activeIndex==pos)return this.pause().cycle();return this.slide(pos>activeIndex?"next":"prev",this.$items.eq(pos))};Carousel.prototype.pause=function(e){e||(this.paused=true);if(this.$element.find(".next, .prev").length&&$.support.transition){this.$element.trigger($.support.transition.end);this.cycle(true)}this.interval=clearInterval(this.interval);return this};Carousel.prototype.next=function(){if(this.sliding)return;return this.slide("next")};Carousel.prototype.prev=function(){if(this.sliding)return;return this.slide("prev")};Carousel.prototype.slide=function(type,next){var $active=this.$element.find(".item.active");var $next=next||this.getItemForDirection(type,$active);var isCycling=this.interval;var direction=type=="next"?"left":"right";var that=this;if($next.hasClass("active"))return this.sliding=false;var relatedTarget=$next[0];var slideEvent=$.Event("slide.bs.carousel",{relatedTarget:relatedTarget,direction:direction});this.$element.trigger(slideEvent);if(slideEvent.isDefaultPrevented())return;this.sliding=true;isCycling&&this.pause();if(this.$indicators.length){this.$indicators.find(".active").removeClass("active");var $nextIndicator=$(this.$indicators.children()[this.getItemIndex($next)]);$nextIndicator&&$nextIndicator.addClass("active")}var slidEvent=$.Event("slid.bs.carousel",{relatedTarget:relatedTarget,direction:direction});if($.support.transition&&this.$element.hasClass("slide")){$next.addClass(type);$next[0].offsetWidth;$active.addClass(direction);$next.addClass(direction);$active.one("bsTransitionEnd",function(){$next.removeClass([type,direction].join(" ")).addClass("active");$active.removeClass(["active",direction].join(" "));that.sliding=false;setTimeout(function(){that.$element.trigger(slidEvent)},0)}).emulateTransitionEnd(Carousel.TRANSITION_DURATION)}else{$active.removeClass("active");$next.addClass("active");this.sliding=false;this.$element.trigger(slidEvent)}isCycling&&this.cycle();return this};function Plugin(option){return this.each(function(){var $this=$(this);var data=$this.data("bs.carousel");var options=$.extend({},Carousel.DEFAULTS,$this.data(),typeof option=="object"&&option);var action=typeof option=="string"?option:options.slide;if(!data)$this.data("bs.carousel",data=new Carousel(this,options));if(typeof option=="number")data.to(option);else if(action)data[action]();else if(options.interval)data.pause().cycle()})}var old=$.fn.carousel;$.fn.carousel=Plugin;$.fn.carousel.Constructor=Carousel;$.fn.carousel.noConflict=function(){$.fn.carousel=old;return this};var clickHandler=function(e){var href;var $this=$(this);var $target=$($this.attr("data-target")||(href=$this.attr("href"))&&href.replace(/.*(?=#[^\s]+$)/,""));if(!$target.hasClass("carousel"))return;var options=$.extend({},$target.data(),$this.data());var slideIndex=$this.attr("data-slide-to");if(slideIndex)options.interval=false;Plugin.call($target,options);if(slideIndex){$target.data("bs.carousel").to(slideIndex)}e.preventDefault()};$(document).on("click.bs.carousel.data-api","[data-slide]",clickHandler).on("click.bs.carousel.data-api","[data-slide-to]",clickHandler);$(window).on("load",function(){$('[data-ride="carousel"]').each(function(){var $carousel=$(this);Plugin.call($carousel,$carousel.data())})})}(jQuery)},{}],9:[function(require,module,exports){+function($){"use strict";var Collapse=function(element,options){this.$element=$(element);this.options=$.extend({},Collapse.DEFAULTS,options);this.$trigger=$('[data-toggle="collapse"][href="#'+element.id+'"],'+'[data-toggle="collapse"][data-target="#'+element.id+'"]');this.transitioning=null;if(this.options.parent){this.$parent=this.getParent()}else{this.addAriaAndCollapsedClass(this.$element,this.$trigger)}if(this.options.toggle)this.toggle()};Collapse.VERSION="3.3.7";Collapse.TRANSITION_DURATION=350;Collapse.DEFAULTS={toggle:true};Collapse.prototype.dimension=function(){var hasWidth=this.$element.hasClass("width");return hasWidth?"width":"height"};Collapse.prototype.show=function(){if(this.transitioning||this.$element.hasClass("in"))return;var activesData;var actives=this.$parent&&this.$parent.children(".panel").children(".in, .collapsing");if(actives&&actives.length){activesData=actives.data("bs.collapse");if(activesData&&activesData.transitioning)return}var startEvent=$.Event("show.bs.collapse");this.$element.trigger(startEvent);if(startEvent.isDefaultPrevented())return;if(actives&&actives.length){Plugin.call(actives,"hide");activesData||actives.data("bs.collapse",null)}var dimension=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[dimension](0).attr("aria-expanded",true);this.$trigger.removeClass("collapsed").attr("aria-expanded",true);this.transitioning=1;var complete=function(){this.$element.removeClass("collapsing").addClass("collapse in")[dimension]("");this.transitioning=0;this.$element.trigger("shown.bs.collapse")};if(!$.support.transition)return complete.call(this);var scrollSize=$.camelCase(["scroll",dimension].join("-"));this.$element.one("bsTransitionEnd",$.proxy(complete,this)).emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])};Collapse.prototype.hide=function(){if(this.transitioning||!this.$element.hasClass("in"))return;var startEvent=$.Event("hide.bs.collapse");this.$element.trigger(startEvent);if(startEvent.isDefaultPrevented())return;var dimension=this.dimension();this.$element[dimension](this.$element[dimension]())[0].offsetHeight;this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",false);this.$trigger.addClass("collapsed").attr("aria-expanded",false);this.transitioning=1;var complete=function(){this.transitioning=0;this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};if(!$.support.transition)return complete.call(this);this.$element[dimension](0).one("bsTransitionEnd",$.proxy(complete,this)).emulateTransitionEnd(Collapse.TRANSITION_DURATION)};Collapse.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()};Collapse.prototype.getParent=function(){return $(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each($.proxy(function(i,element){var $element=$(element);this.addAriaAndCollapsedClass(getTargetFromTrigger($element),$element)},this)).end()};Collapse.prototype.addAriaAndCollapsedClass=function($element,$trigger){var isOpen=$element.hasClass("in");$element.attr("aria-expanded",isOpen);$trigger.toggleClass("collapsed",!isOpen).attr("aria-expanded",isOpen)};function getTargetFromTrigger($trigger){var href;var target=$trigger.attr("data-target")||(href=$trigger.attr("href"))&&href.replace(/.*(?=#[^\s]+$)/,"");return $(target)}function Plugin(option){return this.each(function(){var $this=$(this);var data=$this.data("bs.collapse");var options=$.extend({},Collapse.DEFAULTS,$this.data(),typeof option=="object"&&option);if(!data&&options.toggle&&/show|hide/.test(option))options.toggle=false;if(!data)$this.data("bs.collapse",data=new Collapse(this,options));if(typeof option=="string")data[option]()})}var old=$.fn.collapse;$.fn.collapse=Plugin;$.fn.collapse.Constructor=Collapse;$.fn.collapse.noConflict=function(){$.fn.collapse=old;return this};$(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(e){var $this=$(this);if(!$this.attr("data-target"))e.preventDefault();var $target=getTargetFromTrigger($this);var data=$target.data("bs.collapse");var option=data?"toggle":$this.data();Plugin.call($target,option)})}(jQuery)},{}],10:[function(require,module,exports){+function($){"use strict";var backdrop=".dropdown-backdrop";var toggle='[data-toggle="dropdown"]';var Dropdown=function(element){$(element).on("click.bs.dropdown",this.toggle)};Dropdown.VERSION="3.3.7";function getParent($this){var selector=$this.attr("data-target");if(!selector){selector=$this.attr("href");selector=selector&&/#[A-Za-z]/.test(selector)&&selector.replace(/.*(?=#[^\s]*$)/,"")}var $parent=selector&&$(selector);return $parent&&$parent.length?$parent:$this.parent()}function clearMenus(e){if(e&&e.which===3)return;$(backdrop).remove();$(toggle).each(function(){var $this=$(this);var $parent=getParent($this);var relatedTarget={relatedTarget:this};if(!$parent.hasClass("open"))return;if(e&&e.type=="click"&&/input|textarea/i.test(e.target.tagName)&&$.contains($parent[0],e.target))return;$parent.trigger(e=$.Event("hide.bs.dropdown",relatedTarget));if(e.isDefaultPrevented())return;$this.attr("aria-expanded","false");$parent.removeClass("open").trigger($.Event("hidden.bs.dropdown",relatedTarget))})}Dropdown.prototype.toggle=function(e){var $this=$(this);if($this.is(".disabled, :disabled"))return;var $parent=getParent($this);var isActive=$parent.hasClass("open");clearMenus();if(!isActive){if("ontouchstart"in document.documentElement&&!$parent.closest(".navbar-nav").length){$(document.createElement("div")).addClass("dropdown-backdrop").insertAfter($(this)).on("click",clearMenus)}var relatedTarget={relatedTarget:this};$parent.trigger(e=$.Event("show.bs.dropdown",relatedTarget));if(e.isDefaultPrevented())return;$this.trigger("focus").attr("aria-expanded","true");$parent.toggleClass("open").trigger($.Event("shown.bs.dropdown",relatedTarget))}return false};Dropdown.prototype.keydown=function(e){if(!/(38|40|27|32)/.test(e.which)||/input|textarea/i.test(e.target.tagName))return;var $this=$(this);e.preventDefault();e.stopPropagation();if($this.is(".disabled, :disabled"))return;var $parent=getParent($this);var isActive=$parent.hasClass("open");if(!isActive&&e.which!=27||isActive&&e.which==27){if(e.which==27)$parent.find(toggle).trigger("focus");return $this.trigger("click")}var desc=" li:not(.disabled):visible a";var $items=$parent.find(".dropdown-menu"+desc);if(!$items.length)return;var index=$items.index(e.target);if(e.which==38&&index>0)index--;if(e.which==40&&index<$items.length-1)index++;if(!~index)index=0;$items.eq(index).trigger("focus")};function Plugin(option){return this.each(function(){var $this=$(this);var data=$this.data("bs.dropdown");if(!data)$this.data("bs.dropdown",data=new Dropdown(this));if(typeof option=="string")data[option].call($this)})}var old=$.fn.dropdown;$.fn.dropdown=Plugin;$.fn.dropdown.Constructor=Dropdown;$.fn.dropdown.noConflict=function(){$.fn.dropdown=old;return this};$(document).on("click.bs.dropdown.data-api",clearMenus).on("click.bs.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.bs.dropdown.data-api",toggle,Dropdown.prototype.toggle).on("keydown.bs.dropdown.data-api",toggle,Dropdown.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",Dropdown.prototype.keydown)}(jQuery)},{}],11:[function(require,module,exports){+function($){"use strict";var Modal=function(element,options){this.options=options;this.$body=$(document.body);this.$element=$(element);this.$dialog=this.$element.find(".modal-dialog");this.$backdrop=null;this.isShown=null;this.originalBodyPad=null;this.scrollbarWidth=0;this.ignoreBackdropClick=false;if(this.options.remote){this.$element.find(".modal-content").load(this.options.remote,$.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))}};Modal.VERSION="3.3.7";Modal.TRANSITION_DURATION=300;Modal.BACKDROP_TRANSITION_DURATION=150;Modal.DEFAULTS={backdrop:true,keyboard:true,show:true};Modal.prototype.toggle=function(_relatedTarget){return this.isShown?this.hide():this.show(_relatedTarget)};Modal.prototype.show=function(_relatedTarget){var that=this;var e=$.Event("show.bs.modal",{relatedTarget:_relatedTarget});this.$element.trigger(e);if(this.isShown||e.isDefaultPrevented())return;this.isShown=true;this.checkScrollbar();this.setScrollbar();this.$body.addClass("modal-open");this.escape();this.resize();this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',$.proxy(this.hide,this));this.$dialog.on("mousedown.dismiss.bs.modal",function(){that.$element.one("mouseup.dismiss.bs.modal",function(e){if($(e.target).is(that.$element))that.ignoreBackdropClick=true})});this.backdrop(function(){var transition=$.support.transition&&that.$element.hasClass("fade");if(!that.$element.parent().length){that.$element.appendTo(that.$body)}that.$element.show().scrollTop(0);that.adjustDialog();if(transition){that.$element[0].offsetWidth}that.$element.addClass("in");that.enforceFocus();var e=$.Event("shown.bs.modal",{relatedTarget:_relatedTarget});transition?that.$dialog.one("bsTransitionEnd",function(){that.$element.trigger("focus").trigger(e)}).emulateTransitionEnd(Modal.TRANSITION_DURATION):that.$element.trigger("focus").trigger(e)})};Modal.prototype.hide=function(e){if(e)e.preventDefault();e=$.Event("hide.bs.modal");this.$element.trigger(e);if(!this.isShown||e.isDefaultPrevented())return;this.isShown=false;this.escape();this.resize();$(document).off("focusin.bs.modal");this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal");this.$dialog.off("mousedown.dismiss.bs.modal");$.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",$.proxy(this.hideModal,this)).emulateTransitionEnd(Modal.TRANSITION_DURATION):this.hideModal()};Modal.prototype.enforceFocus=function(){$(document).off("focusin.bs.modal").on("focusin.bs.modal",$.proxy(function(e){if(document!==e.target&&this.$element[0]!==e.target&&!this.$element.has(e.target).length){this.$element.trigger("focus")}},this))};Modal.prototype.escape=function(){if(this.isShown&&this.options.keyboard){this.$element.on("keydown.dismiss.bs.modal",$.proxy(function(e){e.which==27&&this.hide()},this))}else if(!this.isShown){this.$element.off("keydown.dismiss.bs.modal")}};Modal.prototype.resize=function(){if(this.isShown){$(window).on("resize.bs.modal",$.proxy(this.handleUpdate,this))}else{$(window).off("resize.bs.modal")}};Modal.prototype.hideModal=function(){var that=this;this.$element.hide();this.backdrop(function(){that.$body.removeClass("modal-open");that.resetAdjustments();that.resetScrollbar();that.$element.trigger("hidden.bs.modal")})};Modal.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove();this.$backdrop=null};Modal.prototype.backdrop=function(callback){var that=this;var animate=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var doAnimate=$.support.transition&&animate;this.$backdrop=$(document.createElement("div")).addClass("modal-backdrop "+animate).appendTo(this.$body);this.$element.on("click.dismiss.bs.modal",$.proxy(function(e){if(this.ignoreBackdropClick){this.ignoreBackdropClick=false;return}if(e.target!==e.currentTarget)return;this.options.backdrop=="static"?this.$element[0].focus():this.hide()},this));if(doAnimate)this.$backdrop[0].offsetWidth;this.$backdrop.addClass("in");if(!callback)return;doAnimate?this.$backdrop.one("bsTransitionEnd",callback).emulateTransitionEnd(Modal.BACKDROP_TRANSITION_DURATION):callback()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var callbackRemove=function(){that.removeBackdrop();callback&&callback()};$.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",callbackRemove).emulateTransitionEnd(Modal.BACKDROP_TRANSITION_DURATION):callbackRemove()}else if(callback){callback()}};Modal.prototype.handleUpdate=function(){this.adjustDialog()};Modal.prototype.adjustDialog=function(){var modalIsOverflowing=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&modalIsOverflowing?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!modalIsOverflowing?this.scrollbarWidth:""})};Modal.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})};Modal.prototype.checkScrollbar=function(){var fullWindowWidth=window.innerWidth;if(!fullWindowWidth){var documentElementRect=document.documentElement.getBoundingClientRect();fullWindowWidth=documentElementRect.right-Math.abs(documentElementRect.left)}this.bodyIsOverflowing=document.body.clientWidth<fullWindowWidth;this.scrollbarWidth=this.measureScrollbar()};Modal.prototype.setScrollbar=function(){var bodyPad=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"";if(this.bodyIsOverflowing)this.$body.css("padding-right",bodyPad+this.scrollbarWidth)};Modal.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad)};Modal.prototype.measureScrollbar=function(){var scrollDiv=document.createElement("div");scrollDiv.className="modal-scrollbar-measure";this.$body.append(scrollDiv);var scrollbarWidth=scrollDiv.offsetWidth-scrollDiv.clientWidth;this.$body[0].removeChild(scrollDiv);return scrollbarWidth};function Plugin(option,_relatedTarget){return this.each(function(){var $this=$(this);var data=$this.data("bs.modal");var options=$.extend({},Modal.DEFAULTS,$this.data(),typeof option=="object"&&option);if(!data)$this.data("bs.modal",data=new Modal(this,options));if(typeof option=="string")data[option](_relatedTarget);else if(options.show)data.show(_relatedTarget)})}var old=$.fn.modal;$.fn.modal=Plugin;$.fn.modal.Constructor=Modal;$.fn.modal.noConflict=function(){$.fn.modal=old;return this};$(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(e){var $this=$(this);var href=$this.attr("href");var $target=$($this.attr("data-target")||href&&href.replace(/.*(?=#[^\s]+$)/,""));var option=$target.data("bs.modal")?"toggle":$.extend({remote:!/#/.test(href)&&href},$target.data(),$this.data());if($this.is("a"))e.preventDefault();$target.one("show.bs.modal",function(showEvent){if(showEvent.isDefaultPrevented())return;$target.one("hidden.bs.modal",function(){$this.is(":visible")&&$this.trigger("focus")})});Plugin.call($target,option,this)})}(jQuery)},{}],12:[function(require,module,exports){+function($){"use strict";var Popover=function(element,options){this.init("popover",element,options)};if(!$.fn.tooltip)throw new Error("Popover requires tooltip.js");Popover.VERSION="3.3.7";Popover.DEFAULTS=$.extend({},$.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'});Popover.prototype=$.extend({},$.fn.tooltip.Constructor.prototype);Popover.prototype.constructor=Popover;Popover.prototype.getDefaults=function(){return Popover.DEFAULTS};Popover.prototype.setContent=function(){var $tip=this.tip();var title=this.getTitle();var content=this.getContent();$tip.find(".popover-title")[this.options.html?"html":"text"](title);$tip.find(".popover-content").children().detach().end()[this.options.html?typeof content=="string"?"html":"append":"text"](content);$tip.removeClass("fade top bottom left right in");if(!$tip.find(".popover-title").html())$tip.find(".popover-title").hide()};Popover.prototype.hasContent=function(){return this.getTitle()||this.getContent()};Popover.prototype.getContent=function(){var $e=this.$element;var o=this.options;return $e.attr("data-content")||(typeof o.content=="function"?o.content.call($e[0]):o.content)};Popover.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")};function Plugin(option){return this.each(function(){var $this=$(this);var data=$this.data("bs.popover");var options=typeof option=="object"&&option;if(!data&&/destroy|hide/.test(option))return;if(!data)$this.data("bs.popover",data=new Popover(this,options));if(typeof option=="string")data[option]()})}var old=$.fn.popover;$.fn.popover=Plugin;$.fn.popover.Constructor=Popover;$.fn.popover.noConflict=function(){$.fn.popover=old;return this}}(jQuery)},{}],13:[function(require,module,exports){+function($){"use strict";function ScrollSpy(element,options){this.$body=$(document.body);this.$scrollElement=$(element).is(document.body)?$(window):$(element);this.options=$.extend({},ScrollSpy.DEFAULTS,options);this.selector=(this.options.target||"")+" .nav li > a";this.offsets=[];this.targets=[];this.activeTarget=null;this.scrollHeight=0;this.$scrollElement.on("scroll.bs.scrollspy",$.proxy(this.process,this));this.refresh();this.process()}ScrollSpy.VERSION="3.3.7";ScrollSpy.DEFAULTS={offset:10};ScrollSpy.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)};ScrollSpy.prototype.refresh=function(){var that=this;var offsetMethod="offset";var offsetBase=0;this.offsets=[];this.targets=[];this.scrollHeight=this.getScrollHeight();if(!$.isWindow(this.$scrollElement[0])){offsetMethod="position";offsetBase=this.$scrollElement.scrollTop()}this.$body.find(this.selector).map(function(){var $el=$(this);var href=$el.data("target")||$el.attr("href");var $href=/^#./.test(href)&&$(href);return $href&&$href.length&&$href.is(":visible")&&[[$href[offsetMethod]().top+offsetBase,href]]||null}).sort(function(a,b){return a[0]-b[0]}).each(function(){that.offsets.push(this[0]);that.targets.push(this[1])})};ScrollSpy.prototype.process=function(){var scrollTop=this.$scrollElement.scrollTop()+this.options.offset;var scrollHeight=this.getScrollHeight();var maxScroll=this.options.offset+scrollHeight-this.$scrollElement.height();var offsets=this.offsets;var targets=this.targets;var activeTarget=this.activeTarget;var i;if(this.scrollHeight!=scrollHeight){this.refresh()}if(scrollTop>=maxScroll){return activeTarget!=(i=targets[targets.length-1])&&this.activate(i)}if(activeTarget&&scrollTop<offsets[0]){this.activeTarget=null;return this.clear()}for(i=offsets.length;i--;){activeTarget!=targets[i]&&scrollTop>=offsets[i]&&(offsets[i+1]===undefined||scrollTop<offsets[i+1])&&this.activate(targets[i])}};ScrollSpy.prototype.activate=function(target){this.activeTarget=target;this.clear();var selector=this.selector+'[data-target="'+target+'"],'+this.selector+'[href="'+target+'"]';var active=$(selector).parents("li").addClass("active");if(active.parent(".dropdown-menu").length){active=active.closest("li.dropdown").addClass("active")}active.trigger("activate.bs.scrollspy")};ScrollSpy.prototype.clear=function(){$(this.selector).parentsUntil(this.options.target,".active").removeClass("active")};function Plugin(option){return this.each(function(){var $this=$(this);var data=$this.data("bs.scrollspy");var options=typeof option=="object"&&option;if(!data)$this.data("bs.scrollspy",data=new ScrollSpy(this,options));if(typeof option=="string")data[option]()})}var old=$.fn.scrollspy;$.fn.scrollspy=Plugin;$.fn.scrollspy.Constructor=ScrollSpy;$.fn.scrollspy.noConflict=function(){$.fn.scrollspy=old;return this};$(window).on("load.bs.scrollspy.data-api",function(){$('[data-spy="scroll"]').each(function(){var $spy=$(this);Plugin.call($spy,$spy.data())})})}(jQuery)},{}],14:[function(require,module,exports){+function($){"use strict";var Tab=function(element){this.element=$(element)};Tab.VERSION="3.3.7";Tab.TRANSITION_DURATION=150;Tab.prototype.show=function(){var $this=this.element;var $ul=$this.closest("ul:not(.dropdown-menu)");var selector=$this.data("target");if(!selector){selector=$this.attr("href");selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,"")}if($this.parent("li").hasClass("active"))return;var $previous=$ul.find(".active:last a");var hideEvent=$.Event("hide.bs.tab",{relatedTarget:$this[0]});var showEvent=$.Event("show.bs.tab",{relatedTarget:$previous[0]});$previous.trigger(hideEvent);$this.trigger(showEvent);if(showEvent.isDefaultPrevented()||hideEvent.isDefaultPrevented())return;var $target=$(selector);this.activate($this.closest("li"),$ul);this.activate($target,$target.parent(),function(){$previous.trigger({type:"hidden.bs.tab",relatedTarget:$this[0]});$this.trigger({type:"shown.bs.tab",relatedTarget:$previous[0]})})};Tab.prototype.activate=function(element,container,callback){var $active=container.find("> .active");var transition=callback&&$.support.transition&&($active.length&&$active.hasClass("fade")||!!container.find("> .fade").length);function next(){$active.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",false);element.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",true);if(transition){element[0].offsetWidth;element.addClass("in")}else{element.removeClass("fade")}if(element.parent(".dropdown-menu").length){element.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",true)}callback&&callback()}$active.length&&transition?$active.one("bsTransitionEnd",next).emulateTransitionEnd(Tab.TRANSITION_DURATION):next();$active.removeClass("in")};function Plugin(option){return this.each(function(){var $this=$(this);var data=$this.data("bs.tab");if(!data)$this.data("bs.tab",data=new Tab(this));if(typeof option=="string")data[option]()})}var old=$.fn.tab;$.fn.tab=Plugin;$.fn.tab.Constructor=Tab;$.fn.tab.noConflict=function(){$.fn.tab=old;return this};var clickHandler=function(e){e.preventDefault();Plugin.call($(this),"show")};$(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',clickHandler).on("click.bs.tab.data-api",'[data-toggle="pill"]',clickHandler)}(jQuery)},{}],15:[function(require,module,exports){+function($){"use strict";var Tooltip=function(element,options){this.type=null;this.options=null;this.enabled=null;this.timeout=null;this.hoverState=null;this.$element=null;this.inState=null;this.init("tooltip",element,options)};Tooltip.VERSION="3.3.7";Tooltip.TRANSITION_DURATION=150;Tooltip.DEFAULTS={animation:true,placement:"top",selector:false,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:false,container:false,viewport:{selector:"body",padding:0}};Tooltip.prototype.init=function(type,element,options){this.enabled=true;this.type=type;this.$element=$(element);this.options=this.getOptions(options);this.$viewport=this.options.viewport&&$($.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport);this.inState={click:false,hover:false,focus:false};if(this.$element[0]instanceof document.constructor&&!this.options.selector){throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!")}var triggers=this.options.trigger.split(" ");for(var i=triggers.length;i--;){var trigger=triggers[i];if(trigger=="click"){this.$element.on("click."+this.type,this.options.selector,$.proxy(this.toggle,this))}else if(trigger!="manual"){var eventIn=trigger=="hover"?"mouseenter":"focusin";var eventOut=trigger=="hover"?"mouseleave":"focusout";this.$element.on(eventIn+"."+this.type,this.options.selector,$.proxy(this.enter,this));this.$element.on(eventOut+"."+this.type,this.options.selector,$.proxy(this.leave,this))}}this.options.selector?this._options=$.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()};Tooltip.prototype.getDefaults=function(){return Tooltip.DEFAULTS};Tooltip.prototype.getOptions=function(options){options=$.extend({},this.getDefaults(),this.$element.data(),options);if(options.delay&&typeof options.delay=="number"){options.delay={show:options.delay,hide:options.delay}}return options};Tooltip.prototype.getDelegateOptions=function(){var options={};var defaults=this.getDefaults();this._options&&$.each(this._options,function(key,value){if(defaults[key]!=value)options[key]=value});return options};Tooltip.prototype.enter=function(obj){var self=obj instanceof this.constructor?obj:$(obj.currentTarget).data("bs."+this.type);if(!self){self=new this.constructor(obj.currentTarget,this.getDelegateOptions());$(obj.currentTarget).data("bs."+this.type,self)}if(obj instanceof $.Event){self.inState[obj.type=="focusin"?"focus":"hover"]=true}if(self.tip().hasClass("in")||self.hoverState=="in"){self.hoverState="in";return}clearTimeout(self.timeout);self.hoverState="in";if(!self.options.delay||!self.options.delay.show)return self.show();self.timeout=setTimeout(function(){if(self.hoverState=="in")self.show()},self.options.delay.show)};Tooltip.prototype.isInStateTrue=function(){for(var key in this.inState){if(this.inState[key])return true}return false};Tooltip.prototype.leave=function(obj){var self=obj instanceof this.constructor?obj:$(obj.currentTarget).data("bs."+this.type);if(!self){self=new this.constructor(obj.currentTarget,this.getDelegateOptions());$(obj.currentTarget).data("bs."+this.type,self)}if(obj instanceof $.Event){self.inState[obj.type=="focusout"?"focus":"hover"]=false}if(self.isInStateTrue())return;clearTimeout(self.timeout);self.hoverState="out";if(!self.options.delay||!self.options.delay.hide)return self.hide();self.timeout=setTimeout(function(){if(self.hoverState=="out")self.hide()},self.options.delay.hide)};Tooltip.prototype.show=function(){var e=$.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(e);var inDom=$.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(e.isDefaultPrevented()||!inDom)return;var that=this;var $tip=this.tip();var tipId=this.getUID(this.type);this.setContent();$tip.attr("id",tipId);this.$element.attr("aria-describedby",tipId);if(this.options.animation)$tip.addClass("fade");var placement=typeof this.options.placement=="function"?this.options.placement.call(this,$tip[0],this.$element[0]):this.options.placement;var autoToken=/\s?auto?\s?/i;var autoPlace=autoToken.test(placement);if(autoPlace)placement=placement.replace(autoToken,"")||"top";$tip.detach().css({top:0,left:0,display:"block"}).addClass(placement).data("bs."+this.type,this);this.options.container?$tip.appendTo(this.options.container):$tip.insertAfter(this.$element);this.$element.trigger("inserted.bs."+this.type);var pos=this.getPosition();var actualWidth=$tip[0].offsetWidth;var actualHeight=$tip[0].offsetHeight;if(autoPlace){var orgPlacement=placement;var viewportDim=this.getPosition(this.$viewport);placement=placement=="bottom"&&pos.bottom+actualHeight>viewportDim.bottom?"top":placement=="top"&&pos.top-actualHeight<viewportDim.top?"bottom":placement=="right"&&pos.right+actualWidth>viewportDim.width?"left":placement=="left"&&pos.left-actualWidth<viewportDim.left?"right":placement;$tip.removeClass(orgPlacement).addClass(placement)}var calculatedOffset=this.getCalculatedOffset(placement,pos,actualWidth,actualHeight);this.applyPlacement(calculatedOffset,placement);var complete=function(){var prevHoverState=that.hoverState;that.$element.trigger("shown.bs."+that.type);that.hoverState=null;if(prevHoverState=="out")that.leave(that)};$.support.transition&&this.$tip.hasClass("fade")?$tip.one("bsTransitionEnd",complete).emulateTransitionEnd(Tooltip.TRANSITION_DURATION):complete()}};Tooltip.prototype.applyPlacement=function(offset,placement){var $tip=this.tip();var width=$tip[0].offsetWidth;var height=$tip[0].offsetHeight;var marginTop=parseInt($tip.css("margin-top"),10);var marginLeft=parseInt($tip.css("margin-left"),10);if(isNaN(marginTop))marginTop=0;if(isNaN(marginLeft))marginLeft=0;offset.top+=marginTop;offset.left+=marginLeft;$.offset.setOffset($tip[0],$.extend({using:function(props){$tip.css({top:Math.round(props.top),left:Math.round(props.left)})}},offset),0);$tip.addClass("in");var actualWidth=$tip[0].offsetWidth;var actualHeight=$tip[0].offsetHeight;if(placement=="top"&&actualHeight!=height){offset.top=offset.top+height-actualHeight}var delta=this.getViewportAdjustedDelta(placement,offset,actualWidth,actualHeight);if(delta.left)offset.left+=delta.left;else offset.top+=delta.top;var isVertical=/top|bottom/.test(placement);var arrowDelta=isVertical?delta.left*2-width+actualWidth:delta.top*2-height+actualHeight;var arrowOffsetPosition=isVertical?"offsetWidth":"offsetHeight";$tip.offset(offset);this.replaceArrow(arrowDelta,$tip[0][arrowOffsetPosition],isVertical)};Tooltip.prototype.replaceArrow=function(delta,dimension,isVertical){this.arrow().css(isVertical?"left":"top",50*(1-delta/dimension)+"%").css(isVertical?"top":"left","")};Tooltip.prototype.setContent=function(){var $tip=this.tip();var title=this.getTitle();$tip.find(".tooltip-inner")[this.options.html?"html":"text"](title);$tip.removeClass("fade in top bottom left right")};Tooltip.prototype.hide=function(callback){var that=this;var $tip=$(this.$tip);var e=$.Event("hide.bs."+this.type);function complete(){if(that.hoverState!="in")$tip.detach();if(that.$element){that.$element.removeAttr("aria-describedby").trigger("hidden.bs."+that.type)}callback&&callback()}this.$element.trigger(e);if(e.isDefaultPrevented())return;$tip.removeClass("in");$.support.transition&&$tip.hasClass("fade")?$tip.one("bsTransitionEnd",complete).emulateTransitionEnd(Tooltip.TRANSITION_DURATION):complete();this.hoverState=null;return this};Tooltip.prototype.fixTitle=function(){var $e=this.$element;if($e.attr("title")||typeof $e.attr("data-original-title")!="string"){$e.attr("data-original-title",$e.attr("title")||"").attr("title","")}};Tooltip.prototype.hasContent=function(){return this.getTitle()};Tooltip.prototype.getPosition=function($element){$element=$element||this.$element;var el=$element[0];var isBody=el.tagName=="BODY";var elRect=el.getBoundingClientRect();if(elRect.width==null){elRect=$.extend({},elRect,{width:elRect.right-elRect.left,height:elRect.bottom-elRect.top})}var isSvg=window.SVGElement&&el instanceof window.SVGElement;var elOffset=isBody?{top:0,left:0}:isSvg?null:$element.offset();var scroll={scroll:isBody?document.documentElement.scrollTop||document.body.scrollTop:$element.scrollTop()};var outerDims=isBody?{width:$(window).width(),height:$(window).height()}:null;return $.extend({},elRect,scroll,outerDims,elOffset)};Tooltip.prototype.getCalculatedOffset=function(placement,pos,actualWidth,actualHeight){return placement=="bottom"?{top:pos.top+pos.height,left:pos.left+pos.width/2-actualWidth/2}:placement=="top"?{top:pos.top-actualHeight,left:pos.left+pos.width/2-actualWidth/2}:placement=="left"?{top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth}:{top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width}};Tooltip.prototype.getViewportAdjustedDelta=function(placement,pos,actualWidth,actualHeight){var delta={top:0,left:0};if(!this.$viewport)return delta;var viewportPadding=this.options.viewport&&this.options.viewport.padding||0;var viewportDimensions=this.getPosition(this.$viewport);if(/right|left/.test(placement)){var topEdgeOffset=pos.top-viewportPadding-viewportDimensions.scroll;var bottomEdgeOffset=pos.top+viewportPadding-viewportDimensions.scroll+actualHeight;if(topEdgeOffset<viewportDimensions.top){delta.top=viewportDimensions.top-topEdgeOffset}else if(bottomEdgeOffset>viewportDimensions.top+viewportDimensions.height){delta.top=viewportDimensions.top+viewportDimensions.height-bottomEdgeOffset}}else{var leftEdgeOffset=pos.left-viewportPadding;var rightEdgeOffset=pos.left+viewportPadding+actualWidth;if(leftEdgeOffset<viewportDimensions.left){delta.left=viewportDimensions.left-leftEdgeOffset}else if(rightEdgeOffset>viewportDimensions.right){delta.left=viewportDimensions.left+viewportDimensions.width-rightEdgeOffset}}return delta};Tooltip.prototype.getTitle=function(){var title;var $e=this.$element;var o=this.options;title=$e.attr("data-original-title")||(typeof o.title=="function"?o.title.call($e[0]):o.title);return title};Tooltip.prototype.getUID=function(prefix){do{prefix+=~~(Math.random()*1e6)}while(document.getElementById(prefix));return prefix};Tooltip.prototype.tip=function(){if(!this.$tip){this.$tip=$(this.options.template);if(this.$tip.length!=1){throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!")}}return this.$tip};Tooltip.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")};Tooltip.prototype.enable=function(){this.enabled=true};Tooltip.prototype.disable=function(){this.enabled=false};Tooltip.prototype.toggleEnabled=function(){this.enabled=!this.enabled};Tooltip.prototype.toggle=function(e){var self=this;if(e){self=$(e.currentTarget).data("bs."+this.type);if(!self){self=new this.constructor(e.currentTarget,this.getDelegateOptions());$(e.currentTarget).data("bs."+this.type,self)}}if(e){self.inState.click=!self.inState.click;if(self.isInStateTrue())self.enter(self);else self.leave(self)}else{self.tip().hasClass("in")?self.leave(self):self.enter(self)}};Tooltip.prototype.destroy=function(){var that=this;clearTimeout(this.timeout);this.hide(function(){that.$element.off("."+that.type).removeData("bs."+that.type);if(that.$tip){that.$tip.detach()}that.$tip=null;that.$arrow=null;that.$viewport=null;that.$element=null})};function Plugin(option){return this.each(function(){var $this=$(this);var data=$this.data("bs.tooltip");var options=typeof option=="object"&&option;if(!data&&/destroy|hide/.test(option))return;if(!data)$this.data("bs.tooltip",data=new Tooltip(this,options));if(typeof option=="string")data[option]()})}var old=$.fn.tooltip;$.fn.tooltip=Plugin;$.fn.tooltip.Constructor=Tooltip;$.fn.tooltip.noConflict=function(){$.fn.tooltip=old;return this}}(jQuery)},{}],16:[function(require,module,exports){+function($){"use strict";function transitionEnd(){var el=document.createElement("bootstrap");var transEndEventNames={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var name in transEndEventNames){if(el.style[name]!==undefined){return{end:transEndEventNames[name]}}}return false}$.fn.emulateTransitionEnd=function(duration){var called=false;var $el=this;$(this).one("bsTransitionEnd",function(){called=true});var callback=function(){if(!called)$($el).trigger($.support.transition.end)};setTimeout(callback,duration);return this};$(function(){$.support.transition=transitionEnd();if(!$.support.transition)return;$.event.special.bsTransitionEnd={bindType:$.support.transition.end,delegateType:$.support.transition.end,handle:function(e){if($(e.target).is(this))return e.handleObj.handler.apply(this,arguments)}}})}(jQuery)},{}],17:[function(require,module,exports){(function(){"use strict";var $=typeof jQuery===typeof undefined?null:jQuery;var register=function(cytoscape,$){if(!cytoscape){return}var cy;var defaults={menuItems:[],menuItemClasses:[],contextMenuClasses:[]};var options;var $cxtMenu;var menuItemCSSClass="cy-context-menus-cxt-menuitem";var dividerCSSClass="cy-context-menus-divider";var eventCyTapStart;var active=false;var anyVisibleChild=false;function extend(defaults,options){var obj={};for(var i in defaults){obj[i]=defaults[i]}for(var i in options){obj[i]=options[i]}return obj}function preventDefaultContextTap(){$("#cy-context-menus-cxt-menu").contextmenu(function(){return false})}function getMenuItemClassStr(classes,hasTrailingDivider){var str=getClassStr(classes);str+=" "+menuItemCSSClass;if(hasTrailingDivider){str+=" "+dividerCSSClass}return str}function getClassStr(classes){var str="";for(var i=0;i<classes.length;i++){var className=classes[i];str+=className;if(i!==classes.length-1){str+=" "}}return str}function displayComponent($component){$component.css("display","block")}function hideComponent($component){$component.css("display","none")}function hideMenuItemComponents(){$cxtMenu.children().css("display","none")}function bindOnClickFunction($component,onClickFcn){var callOnClickFcn;$component.on("click",callOnClickFcn=function(){onClickFcn(cy.scratch("currentCyEvent"))});$component.data("call-on-click-function",callOnClickFcn)}function bindCyCxttap($component,selector,coreAsWell){function _cxtfcn(event){cy.scratch("currentCyEvent",event);adjustCxtMenu(event);if($component.data("show")){if(!$cxtMenu.is(":visible")){displayComponent($cxtMenu)}anyVisibleChild=true;displayComponent($component)}if(!anyVisibleChild&&$cxtMenu.is(":visible")){hideComponent($cxtMenu)}}var cxtfcn;var cxtCoreFcn;if(coreAsWell){cy.on("cxttap",cxtCoreFcn=function(event){if(event.cyTarget!=cy){return}_cxtfcn(event)})}if(selector){cy.on("cxttap",selector,cxtfcn=function(event){_cxtfcn(event)})}$component.data("cy-context-menus-cxtfcn",cxtfcn);$component.data("cy-context-menus-cxtcorefcn",cxtCoreFcn)}function bindCyEvents(){cy.on("tapstart",eventCyTapStart=function(){hideComponent($cxtMenu);cy.removeScratch("cxtMenuPosition");cy.removeScratch("currentCyEvent")})}function performBindings($component,onClickFcn,selector,coreAsWell){bindOnClickFunction($component,onClickFcn);bindCyCxttap($component,selector,coreAsWell)}function adjustCxtMenu(event){var currentCxtMenuPosition=cy.scratch("cxtMenuPosition");if(currentCxtMenuPosition!=event.cyPosition){hideMenuItemComponents();anyVisibleChild=false;cy.scratch("cxtMenuPosition",event.cyPosition);var containerPos=$(cy.container()).offset();var left=containerPos.left+event.cyRenderedPosition.x;var top=containerPos.top+event.cyRenderedPosition.y;$cxtMenu.css("left",left);$cxtMenu.css("top",top)}}function createAndAppendMenuItemComponents(menuItems){for(var i=0;i<menuItems.length;i++){createAndAppendMenuItemComponent(menuItems[i])}}function createAndAppendMenuItemComponent(menuItem){var $menuItemComponent=createMenuItemComponent(menuItem);appendComponentToCxtMenu($menuItemComponent);performBindings($menuItemComponent,menuItem.onClickFunction,menuItem.selector,menuItem.coreAsWell)}function createAndInsertMenuItemComponentBeforeExistingComponent(menuItem,existingComponentID){var $menuItemComponent=createMenuItemComponent(menuItem);insertComponentBeforeExistingItem($menuItemComponent,existingComponentID);performBindings($menuItemComponent,menuItem.onClickFunction,menuItem.selector,menuItem.coreAsWell)}function createAndAppendCxtMenuComponent(){var classes=getClassStr(options.contextMenuClasses);$cxtMenu=$('<div id="cy-context-menus-cxt-menu" class='+classes+"></div>");$("body").append($cxtMenu);return $cxtMenu}function createMenuItemComponent(item){var classStr=getMenuItemClassStr(options.menuItemClasses,item.hasTrailingDivider);var itemStr='<button id="'+item.id+'" title="'+item.title+'" class="'+classStr+'"';if(item.disabled){itemStr+=" disabled"}itemStr+="></button>";var $menuItemComponent=$(itemStr);$menuItemComponent.data("selector",item.selector);$menuItemComponent.data("on-click-function",item.onClickFunction);$menuItemComponent.data("show",typeof item.show==="undefined"||item.show);return $menuItemComponent}function appendComponentToCxtMenu(component){$cxtMenu.append(component);bindMenuItemClickFunction(component)}function insertComponentBeforeExistingItem(component,existingItemID){var $existingItem=$("#"+existingItemID);component.insertBefore($existingItem)}function destroyCxtMenu(){if(!active){return}removeAndUnbindMenuItems();cy.off("tapstart",eventCyTapStart);$cxtMenu.remove();$cxtMenu=undefined;active=false;anyVisibleChild=false}function removeAndUnbindMenuItems(){var children=$cxtMenu.children();$(children).each(function(){removeAndUnbindMenuItem($(this))})}function removeAndUnbindMenuItem(itemID){var $component=typeof itemID==="string"?$("#"+itemID):itemID;var cxtfcn=$component.data("cy-context-menus-cxtfcn");var selector=$component.data("selector");var callOnClickFcn=$component.data("call-on-click-function");var cxtCoreFcn=$component.data("cy-context-menus-cxtcorefcn");if(cxtfcn){cy.off("cxttap",selector,cxtfcn)}if(cxtCoreFcn){cy.off("cxttap",cxtCoreFcn)}if(callOnClickFcn){$component.off("click",callOnClickFcn)}$component.remove()}function moveBeforeOtherMenuItemComponent(componentID,existingComponentID){if(componentID===existingComponentID){return}var $component=$("#"+componentID).detach();var $existingComponent=$("#"+existingComponentID);$component.insertBefore($existingComponent)}function bindMenuItemClickFunction(component){component.click(function(){hideComponent($cxtMenu);cy.removeScratch("cxtMenuPosition")})}function disableComponent(componentID){$("#"+componentID).attr("disabled",true)}function enableComponent(componentID){$("#"+componentID).attr("disabled",false)}function setTrailingDivider(componentID,status){var $component=$("#"+componentID);if(status){$component.addClass(dividerCSSClass)}else{$component.removeClass(dividerCSSClass)}}function getInstance(cy){var instance={isActive:function(){return active},appendMenuItem:function(item){createAndAppendMenuItemComponent(item);return cy},appendMenuItems:function(items){createAndAppendMenuItemComponents(items);return cy},removeMenuItem:function(itemID){removeAndUnbindMenuItem(itemID);return cy},setTrailingDivider:function(itemID,status){setTrailingDivider(itemID,status);return cy},insertBeforeMenuItem:function(item,existingItemID){createAndInsertMenuItemComponentBeforeExistingComponent(item,existingItemID);return cy},moveBeforeOtherMenuItem:function(itemID,existingItemID){moveBeforeOtherMenuItemComponent(itemID,existingItemID);return cy},disableMenuItem:function(itemID){disableComponent(itemID);return cy},enableMenuItem:function(itemID){enableComponent(itemID);return cy},hideMenuItem:function(itemID){$("#"+itemID).data("show",false);hideComponent($("#"+itemID));return cy},showMenuItem:function(itemID){$("#"+itemID).data("show",true);displayComponent($("#"+itemID));return cy},destroy:function(){destroyCxtMenu();return cy}};return instance}cytoscape("core","contextMenus",function(opts){cy=this;if(opts!=="get"){options=extend(defaults,opts);if(active){destroyCxtMenu()}active=true;$cxtMenu=createAndAppendCxtMenuComponent();var menuItems=options.menuItems;createAndAppendMenuItemComponents(menuItems);bindCyEvents();preventDefaultContextTap()}return getInstance(this)})};if(typeof module!=="undefined"&&module.exports){module.exports=register}if(typeof define!=="undefined"&&define.amd){define("cytoscape-context-menus",function(){return register})}if(typeof cytoscape!=="undefined"&&$){register(cytoscape,$)}})()},{}],18:[function(require,module,exports){module.exports=function(cytoscape,cy,$){function moveTopDown(node,dx,dy){var nodes=node.union(node.descendants());nodes.positions(function(i,node){var pos=node.position();return{x:pos.x+dx,y:pos.y+dy}})}function getTopMostNodes(nodes){var nodesMap={};for(var i=0;i<nodes.length;i++){nodesMap[nodes[i].id()]=true}var roots=nodes.filter(function(i,ele){var parent=ele.parent()[0];while(parent!=null){if(nodesMap[parent.id()]){return false}parent=parent.parent()[0]}return true});return roots}cytoscape("collection","align",function(horizontal,vertical,alignTo){var eles=getTopMostNodes(this.nodes(":visible"));var modelNode=alignTo?alignTo:eles[0];eles=eles.not(modelNode);horizontal=horizontal?horizontal:"none";vertical=vertical?vertical:"none";var xFactor=0;var yFactor=0;if(vertical=="left")xFactor=-1;else if(vertical=="right")xFactor=1;if(horizontal=="top")yFactor=-1;else if(horizontal=="bottom")yFactor=1;for(var i=0;i<eles.length;i++){var node=eles[i];var oldPos=$.extend({},node.position());var newPos=$.extend({},node.position());if(vertical!="none")newPos.x=modelNode.position("x")+xFactor*(modelNode.width()-node.width())/2;if(horizontal!="none")newPos.y=modelNode.position("y")+yFactor*(modelNode.height()-node.height())/2;moveTopDown(node,newPos.x-oldPos.x,newPos.y-oldPos.y)}return this});if(cy.undoRedo){function getNodePositions(){var positionsAndSizes={};var nodes=cy.nodes();for(var i=0;i<nodes.length;i++){var ele=nodes[i];positionsAndSizes[ele.id()]={x:ele.position("x"),y:ele.position("y")}}return positionsAndSizes}function returnToPositions(nodesData){var currentPositions={};cy.nodes().positions(function(i,ele){currentPositions[ele.id()]={x:ele.position("x"),y:ele.position("y")};var data=nodesData[ele.id()];return{x:data.x,y:data.y}});return currentPositions}var ur=cy.undoRedo();ur.action("align",function(args){var nodesData;if(args.firstTime){nodesData=getNodePositions();args.nodes.align(args.horizontal,args.vertical,args.alignTo)}else nodesData=returnToPositions(args);return nodesData},function(nodesData){return returnToPositions(nodesData)})}}},{}],19:[function(require,module,exports){var debounce=function(){var FUNC_ERROR_TEXT="Expected a function";var nativeMax=Math.max,nativeNow=Date.now;var now=nativeNow||function(){return(new Date).getTime()};function debounce(func,wait,options){var args,maxTimeoutId,result,stamp,thisArg,timeoutId,trailingCall,lastCalled=0,maxWait=false,trailing=true;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}wait=wait<0?0:+wait||0;if(options===true){var leading=true;trailing=false}else if(isObject(options)){leading=!!options.leading;maxWait="maxWait"in options&&nativeMax(+options.maxWait||0,wait);trailing="trailing"in options?!!options.trailing:trailing}function cancel(){if(timeoutId){clearTimeout(timeoutId)}if(maxTimeoutId){clearTimeout(maxTimeoutId)}lastCalled=0;maxTimeoutId=timeoutId=trailingCall=undefined}function complete(isCalled,id){if(id){clearTimeout(id)}maxTimeoutId=timeoutId=trailingCall=undefined;if(isCalled){lastCalled=now();result=func.apply(thisArg,args);if(!timeoutId&&!maxTimeoutId){args=thisArg=undefined}}}function delayed(){var remaining=wait-(now()-stamp);if(remaining<=0||remaining>wait){complete(trailingCall,maxTimeoutId)}else{timeoutId=setTimeout(delayed,remaining)}}function maxDelayed(){complete(trailing,timeoutId)}function debounced(){args=arguments;stamp=now();thisArg=this;trailingCall=trailing&&(timeoutId||!leading);if(maxWait===false){var leadingCall=leading&&!timeoutId}else{if(!maxTimeoutId&&!leading){lastCalled=stamp}var remaining=maxWait-(stamp-lastCalled),isCalled=remaining<=0||remaining>maxWait;if(isCalled){if(maxTimeoutId){maxTimeoutId=clearTimeout(maxTimeoutId)}lastCalled=stamp;result=func.apply(thisArg,args)}else if(!maxTimeoutId){maxTimeoutId=setTimeout(maxDelayed,remaining)}}if(isCalled&&timeoutId){timeoutId=clearTimeout(timeoutId)}else if(!timeoutId&&wait!==maxWait){timeoutId=setTimeout(delayed,wait)}if(leadingCall){isCalled=true;result=func.apply(thisArg,args)}if(isCalled&&!timeoutId&&!maxTimeoutId){args=thisArg=undefined}return result}debounced.cancel=cancel;return debounced}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}return debounce}();module.exports=debounce},{}],20:[function(require,module,exports){module.exports=function(cy,snap){var discreteDrag={};var attachedNode;var draggedNodes;var startPos;var endPos;discreteDrag.onTapStartNode=function(e){if(e.cyTarget.selected())draggedNodes=e.cy.$(":selected");else draggedNodes=e.cyTarget;startPos=e.cyPosition;attachedNode=e.cyTarget;attachedNode.lock();attachedNode.trigger("grab");cy.on("tapdrag",onTapDrag);cy.on("tapend",onTapEndNode)};var onTapEndNode=function(e){cy.off("tapdrag",onTapDrag);cy.off("tapend",onTapEndNode);attachedNode.unlock();e.preventDefault()};var getDist=function(){return{x:endPos.x-startPos.x,y:endPos.y-startPos.y}};function getTopMostNodes(nodes){var nodesMap={};for(var i=0;i<nodes.length;i++){nodesMap[nodes[i].id()]=true}var roots=nodes.filter(function(i,ele){var parent=ele.parent()[0];while(parent!=null){if(nodesMap[parent.id()]){return false}parent=parent.parent()[0]}return true});return roots}var moveNodesTopDown=function(nodes,dx,dy){};var onTapDrag=function(e){var nodePos=attachedNode.position();endPos=e.cyPosition;endPos=snap.snapPos(endPos);var dist=getDist();if(dist.x!=0||dist.y!=0){attachedNode.unlock();var nodes=draggedNodes.union(draggedNodes.descendants());nodes.positions(function(i,node){var pos=node.position();return snap.snapPos({x:pos.x+dist.x,y:pos.y+dist.y})});startPos=endPos;attachedNode.lock();attachedNode.trigger("drag")}};return discreteDrag}},{}],21:[function(require,module,exports){module.exports=function(opts,cy,$,debounce){var options=opts;var changeOptions=function(opts){options=opts};var $canvas=$("<canvas></canvas>");var $container=$(cy.container());var ctx=$canvas[0].getContext("2d");$container.append($canvas);var drawGrid=function(){clearDrawing();var zoom=cy.zoom();var canvasWidth=$container.width();var canvasHeight=$container.height();var increment=options.gridSpacing*zoom;var pan=cy.pan();var initialValueX=pan.x%increment;var initialValueY=pan.y%increment;ctx.strokeStyle=options.strokeStyle;ctx.lineWidth=options.lineWidth;if(options.zoomDash){var zoomedDash=options.lineDash.slice();for(var i=0;i<zoomedDash.length;i++){zoomedDash[i]=options.lineDash[i]*zoom}ctx.setLineDash(zoomedDash)}else{ctx.setLineDash(options.lineDash)}if(options.panGrid){ctx.lineDashOffset=-pan.y}else{ctx.lineDashOffset=0}for(var i=initialValueX;i<canvasWidth;i+=increment){ctx.beginPath();ctx.moveTo(i,0);ctx.lineTo(i,canvasHeight);ctx.stroke()}if(options.panGrid){ctx.lineDashOffset=-pan.x}else{ctx.lineDashOffset=0}for(var i=initialValueY;i<canvasHeight;i+=increment){ctx.beginPath();ctx.moveTo(0,i);ctx.lineTo(canvasWidth,i);ctx.stroke()}};var clearDrawing=function(){var width=$container.width();var height=$container.height();ctx.clearRect(0,0,width,height)};var resizeCanvas=debounce(function(){$canvas.attr("height",$container.height()).attr("width",$container.width()).css({position:"absolute",top:0,left:0,"z-index":options.gridStackOrder});setTimeout(function(){var canvasBb=$canvas.offset();var containerBb=$container.offset();console.log(canvasBb,containerBb);$canvas.attr("height",$container.height()).attr("width",$container.width()).css({top:-(canvasBb.top-containerBb.top),left:-(canvasBb.left-containerBb.left)});drawGrid()},0)},250);return{initCanvas:resizeCanvas,resizeCanvas:resizeCanvas,clearCanvas:clearDrawing,drawGrid:drawGrid,changeOptions:changeOptions,sizeCanvas:drawGrid}}},{}],22:[function(require,module,exports){module.exports=function(cy,snap,resize,discreteDrag,drawGrid,guidelines,parentPadding,$){var feature=function(func){return function(enable){func(enable)}};var controller={discreteDrag:new feature(setDiscreteDrag),resize:new feature(setResize),snapToGrid:new feature(setSnapToGrid),drawGrid:new feature(setDrawGrid),guidelines:new feature(setGuidelines),parentPadding:new feature(setParentPadding)};function applyToCyTarget(func,allowParent){return function(e){if(!e.cyTarget.is(":parent")||allowParent)func(e.cyTarget)}}function applyToActiveNodes(func,allowParent){return function(e){if(!e.cyTarget.is(":parent")||allowParent)if(e.cyTarget.selected())func(e.cyTarget,e.cy.$(":selected"));else func(e.cyTarget,e.cyTarget)}}function applyToAllNodesButNoParent(func){return function(){cy.nodes().not(":parent").each(function(i,ele){func(ele)})}}function applyToAllNodes(func){return function(){cy.nodes().each(function(i,ele){func(ele)})}}function eventStatus(enable){return enable?"on":"off"}function setDiscreteDrag(enable){cy[eventStatus(enable)]("tapstart","node",discreteDrag.onTapStartNode)}var resizeAllNodes=applyToAllNodesButNoParent(resize.resizeNode);var resizeNode=applyToCyTarget(resize.resizeNode);var recoverAllNodeDimensions=applyToAllNodesButNoParent(resize.recoverNodeDimensions);function setResize(enable){cy[eventStatus(enable)]("ready",resizeAllNodes);enable?resizeAllNodes():recoverAllNodeDimensions()}var snapAllNodes=applyToAllNodes(snap.snapNodesTopDown);var recoverSnapAllNodes=applyToAllNodes(snap.recoverSnapNode);var snapCyTarget=applyToCyTarget(snap.snapNode,true);function setSnapToGrid(enable){cy[eventStatus(enable)]("add","node",snapCyTarget);cy[eventStatus(enable)]("ready",snapAllNodes);cy[eventStatus(enable)]("free","node",snap.onFreeNode);if(enable){snapAllNodes()}else{recoverSnapAllNodes()}}var drawGridOnZoom=function(){if(currentOptions.zoomDash)drawGrid.drawGrid()};var drawGridOnPan=function(){if(currentOptions.panGrid)drawGrid.drawGrid()};function setDrawGrid(enable){cy[eventStatus(enable)]("zoom",drawGridOnZoom);cy[eventStatus(enable)]("pan",drawGridOnPan);cy[eventStatus(enable)]("ready",drawGrid.resizeCanvas);if(enable){drawGrid.initCanvas();$(window).on("resize",drawGrid.resizeCanvas)}else{drawGrid.clearCanvas();$(window).off("resize",drawGrid.resizeCanvas)}}function setGuidelines(enable){cy[eventStatus(enable)]("zoom",guidelines.onZoom);cy[eventStatus(enable)]("drag","node",guidelines.onDragNode);cy[eventStatus(enable)]("grab","node",guidelines.onGrabNode);cy[eventStatus(enable)]("free","node",guidelines.onFreeNode);if(enable){$(window).on("resize",guidelines.resizeCanvas)}else{$(window).off("resize",guidelines.resizeCanvas)}}var setAllParentPaddings=function(enable){parentPadding.setPaddingOfParent(cy.nodes(":parent"),enable)};var enableParentPadding=function(node){parentPadding.setPaddingOfParent(node,true)};function setParentPadding(enable){setAllParentPaddings(enable);cy[eventStatus(enable)]("ready",setAllParentPaddings);cy[eventStatus(enable)]("add","node:parent",applyToCyTarget(enableParentPadding,true))}var latestOptions={};var currentOptions;var specialOpts={drawGrid:["gridSpacing","zoomDash","panGrid","gridStackOrder","strokeStyle","lineWidth","lineDash"],guidelines:["gridSpacing","guidelinesStackOrder","guidelinesTolerance","guidelinesStyle"],resize:["gridSpacing"],parentPadding:["gridSpacing","parentSpacing"],snapToGrid:["gridSpacing"]};function syncWithOptions(options){currentOptions=$.extend(true,{},options);for(var key in options)if(latestOptions[key]!=options[key])if(controller.hasOwnProperty(key)){controller[key](options[key])}else{for(var optsKey in specialOpts){var opts=specialOpts[optsKey];if(opts.indexOf(key)>=0){if(optsKey=="drawGrid"){drawGrid.changeOptions(options);if(options.drawGrid)drawGrid.resizeCanvas()}if(optsKey=="snapToGrid"){snap.changeOptions(options);if(options.snapToGrid)snapAllNodes()}if(optsKey=="guidelines")guidelines.changeOptions(options);if(optsKey=="resize"){resize.changeOptions(options);if(options.resize)resizeAllNodes()}if(optsKey=="parentPadding")parentPadding.changeOptions(options)}}}latestOptions=$.extend(true,latestOptions,options)}return{init:syncWithOptions,syncWithOptions:syncWithOptions}}},{}],23:[function(require,module,exports){module.exports=function(opts,cy,$,debounce){var options=opts;var changeOptions=function(opts){options=opts};function calcDistance(p1,p2){return Math.sqrt(Math.pow(p1.x-p2.x,2)+Math.pow(p1.y-p2.y,2))}function getExtraDim(node,paddingDim){}var dims=function(node){var pos=node.renderedPosition();var width=node.renderedWidth();var height=node.renderedHeight();var padding={left:Number(node.renderedStyle("padding-left").replace("px","")),right:Number(node.renderedStyle("padding-right").replace("px","")),top:Number(node.renderedStyle("padding-top").replace("px","")),bottom:Number(node.renderedStyle("padding-bottom").replace("px",""))};this.horizontal={center:pos.x,left:pos.x-(padding.left+width/2),right:pos.x+(padding.right+width/2)};this.vertical={center:pos.y,top:pos.y-(padding.top+height/2),bottom:pos.y+(padding.bottom+height/2)};return this};var $canvas=$("<canvas></canvas>");var $container=$(cy.container());var ctx=$canvas[0].getContext("2d");$container.append($canvas);$canvas.attr("height",$container.height()).attr("width",$container.width()).css({position:"absolute",top:0,left:0,"z-index":options.guidelinesStackOrder});var canvasBb=$canvas.offset();var containerBb=$container.offset();$canvas.attr("height",$container.height()).attr("width",$container.width()).css({top:-(canvasBb.top-containerBb.top),left:-(canvasBb.left-containerBb.left)});var clearDrawing=function(){var width=$container.width();var height=$container.height();ctx.clearRect(0,0,width,height)};var pickedNode;function onGrabNode(e){pickedNode=e.cyTarget;onDragNode(e)}var onDragNode=debounce(function(e){if(pickedNode){var node=pickedNode;var mainDims=new dims(node);var cy=e.cy;var nearests={horizontal:{distance:Number.MAX_VALUE},vertical:{distance:Number.MAX_VALUE}};cy.nodes(":visible").not(node.ancestors()).not(node.descendants()).not(node).each(function(i,ele){var nodeDims=new dims(ele);for(var dim in mainDims){var mainDim=mainDims[dim];var nodeDim=nodeDims[dim];var otherDim=dim=="horizontal"?"y":"x";var eitherDim=otherDim=="x"?"y":"x";for(var key in mainDim){for(var key2 in nodeDim){if(Math.abs(mainDim[key]-nodeDim[key2])<options.guidelinesTolerance){var distance=calcDistance(node.renderedPosition(),ele.renderedPosition());if(nearests[dim].distance>distance){nearests[dim]={to:ele.id(),toPos:{},from:node.id(),fromPos:{},distance:distance};nearests[dim].fromPos[eitherDim]=mainDim[key];nearests[dim].fromPos[otherDim]=node.renderedPosition(otherDim);nearests[dim].toPos[eitherDim]=nodeDim[key2];nearests[dim].toPos[otherDim]=ele.renderedPosition(otherDim)}}}}}});clearDrawing();for(var key in nearests){var item=nearests[key];if(item.from){ctx.beginPath();ctx.moveTo(item.fromPos.x,item.fromPos.y);ctx.lineTo(item.toPos.x,item.toPos.y);ctx.setLineDash(options.guidelinesStyle.lineDash);for(var styleKey in options.guidelinesStyle)ctx[styleKey]=options.guidelinesStyle[styleKey];ctx.stroke()}}}},0,true);function onFreeNode(){pickedNode=undefined;clearDrawing()}var resizeCanvas=debounce(function(){$canvas.attr("height",$container.height()).attr("width",$container.width()).css({position:"absolute",top:0,left:0,"z-index":options.guidelinesStackOrder});setTimeout(function(){var canvasBb=$canvas.offset();var containerBb=$container.offset();$canvas.attr("height",$container.height()).attr("width",$container.width()).css({top:-(canvasBb.top-containerBb.top),left:-(canvasBb.left-containerBb.left)})},0)},250);resizeCanvas();return{onDragNode:onDragNode,onZoom:onDragNode,onGrabNode:onGrabNode,onFreeNode:onFreeNode,changeOptions:changeOptions,resizeCanvas:resizeCanvas}}},{}],24:[function(require,module,exports){(function(){"use strict";var register=function(cytoscape){if(!cytoscape){return}var options={snapToGrid:true,discreteDrag:true,guidelines:true,resize:true,parentPadding:true,drawGrid:true,gridSpacing:20,zoomDash:true,panGrid:true,gridStackOrder:-1,strokeStyle:"#dedede",lineWidth:1,lineDash:[2.5,4],guidelinesStackOrder:4,guidelinesTolerance:2,guidelinesStyle:{strokeStyle:"#8b7d6b",lineDash:[3,5]},parentSpacing:-1};var _snap=require("./snap");var _discreteDrag=require("./discrete_drag");var _drawGrid=require("./draw_grid");var _resize=require("./resize");var _eventsController=require("./events_controller");var _guidelines=require("./guidelines");var _parentPadding=require("./parentPadding");var _alignment=require("./alignment");var debounce=require("./debounce");var snap,resize,discreteDrag,drawGrid,eventsController,guidelines,parentPadding,alignment;function getScratch(cy){if(!cy.scratch("_gridGuide")){cy.scratch("_gridGuide",{})}return cy.scratch("_gridGuide")}cytoscape("core","gridGuide",function(opts){var cy=this;$.extend(true,options,opts);if(!getScratch(cy).initialized){snap=_snap(cy,options.gridSpacing);resize=_resize(options.gridSpacing);discreteDrag=_discreteDrag(cy,snap);drawGrid=_drawGrid(options,cy,$,debounce);guidelines=_guidelines(options,cy,$,debounce);parentPadding=_parentPadding(options,cy);eventsController=_eventsController(cy,snap,resize,discreteDrag,drawGrid,guidelines,parentPadding,$);alignment=_alignment(cytoscape,cy,$);eventsController.init(options);getScratch(cy).initialized=true}else eventsController.syncWithOptions(options);return this})};if(typeof module!=="undefined"&&module.exports){module.exports=register}if(typeof define!=="undefined"&&define.amd){define("cytoscape-grid-guide",function(){return register})}if(typeof cytoscape!=="undefined"){register(cytoscape)}})()},{"./alignment":18,"./debounce":19,"./discrete_drag":20,"./draw_grid":21,"./events_controller":22,"./guidelines":23,"./parentPadding":25,"./resize":26,"./snap":27}],25:[function(require,module,exports){module.exports=function(opts,cy){var options=opts;var ppClass="_gridParentPadding";function initPadding(){var padding=options.parentSpacing<0?options.gridSpacing:options.parentSpacing;cy.style().selector("."+ppClass).style("compound-sizing-wrt-labels","exclude").style("padding-left",padding).style("padding-right",padding).style("padding-top",padding).style("padding-bottom",padding).update()}function changeOptions(opts){options=opts;padding=options.parentSpacing<0?options.gridSpacing:options.parentSpacing;initPadding()}function setPaddingOfParent(node,enable){if(enable)node.addClass(ppClass);else node.removeClass(ppClass)}return{changeOptions:changeOptions,setPaddingOfParent:setPaddingOfParent}}},{}],26:[function(require,module,exports){module.exports=function(gridSpacing){var changeOptions=function(opts){gridSpacing=Number(opts.gridSpacing)};var getScratch=function(node){if(!node.scratch("_gridGuide"))node.scratch("_gridGuide",{});return node.scratch("_gridGuide")};function resizeNode(node){var width=node.width();var height=node.height();var newWidth=Math.round((width-gridSpacing)/(gridSpacing*2))*(gridSpacing*2);var newHeight=Math.round((height-gridSpacing)/(gridSpacing*2))*(gridSpacing*2);newWidth=newWidth>0?newWidth+gridSpacing:gridSpacing;newHeight=newHeight>0?newHeight+gridSpacing:gridSpacing;if(width!=newWidth||height!=newHeight){node.style({width:newWidth,height:newHeight});getScratch(node).resize={oldWidth:width,oldHeight:height}}}function recoverNodeDimensions(node){var oldSizes=getScratch(node).resize;if(oldSizes)node.style({width:oldSizes.oldWidth,height:oldSizes.oldHeight})}return{resizeNode:resizeNode,recoverNodeDimensions:recoverNodeDimensions,changeOptions:changeOptions}}},{}],27:[function(require,module,exports){module.exports=function(cy,gridSpacing){var snap={};snap.changeOptions=function(opts){gridSpacing=opts.gridSpacing};var getScratch=function(node){if(!node.scratch("_gridGuide"))node.scratch("_gridGuide",{});return node.scratch("_gridGuide")};function getTopMostNodes(nodes){var nodesMap={};for(var i=0;i<nodes.length;i++){nodesMap[nodes[i].id()]=true}var roots=nodes.filter(function(i,ele){var parent=ele.parent()[0];while(parent!=null){if(nodesMap[parent.id()]){return false}parent=parent.parent()[0]}return true});return roots}snap.snapPos=function(pos){var newPos={x:(Math.floor(pos.x/gridSpacing)+.5)*gridSpacing,y:(Math.floor(pos.y/gridSpacing)+.5)*gridSpacing};return newPos};snap.snapNode=function(node){var pos=node.position();var newPos=snap.snapPos(pos);node.position(newPos)};function snapTopDown(nodes){nodes.union(nodes.descendants()).positions(function(i,node){var pos=node.position();return snap.snapPos(pos)})}snap.snapNodesTopDown=function(nodes){cy.startBatch();nodes.union(nodes.descendants()).positions(function(i,node){var pos=node.position();return snap.snapPos(pos)});cy.endBatch()};snap.onFreeNode=function(e){var nodes;if(e.cyTarget.selected())nodes=e.cy.$(":selected");else nodes=e.cyTarget;snap.snapNodesTopDown(nodes)};snap.recoverSnapNode=function(node){var snapScratch=getScratch(node).snap;if(snapScratch){node.position(snapScratch.oldPos)}};return snap}},{}],28:[function(require,module,exports){(function(){"use strict";var $;var defaults={container:false,viewLiveFramerate:0,dblClickDelay:200,removeCustomContainer:true,rerenderDelay:500};var debounce=function(){var FUNC_ERROR_TEXT="Expected a function";var nativeMax=Math.max,nativeNow=Date.now;var now=nativeNow||function(){return(new Date).getTime()};function debounce(func,wait,options){var args,maxTimeoutId,result,stamp,thisArg,timeoutId,trailingCall,lastCalled=0,maxWait=false,trailing=true;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}wait=wait<0?0:+wait||0;if(options===true){var leading=true;trailing=false}else if(isObject(options)){leading=!!options.leading;maxWait="maxWait"in options&&nativeMax(+options.maxWait||0,wait);trailing="trailing"in options?!!options.trailing:trailing}function cancel(){if(timeoutId){clearTimeout(timeoutId)}if(maxTimeoutId){clearTimeout(maxTimeoutId)}lastCalled=0;maxTimeoutId=timeoutId=trailingCall=undefined}function complete(isCalled,id){if(id){clearTimeout(id)}maxTimeoutId=timeoutId=trailingCall=undefined;if(isCalled){lastCalled=now();result=func.apply(thisArg,args);if(!timeoutId&&!maxTimeoutId){args=thisArg=undefined}}}function delayed(){var remaining=wait-(now()-stamp);if(remaining<=0||remaining>wait){complete(trailingCall,maxTimeoutId)}else{timeoutId=setTimeout(delayed,remaining)}}function maxDelayed(){complete(trailing,timeoutId)}function debounced(){args=arguments;stamp=now();thisArg=this;trailingCall=trailing&&(timeoutId||!leading);if(maxWait===false){var leadingCall=leading&&!timeoutId}else{if(!maxTimeoutId&&!leading){lastCalled=stamp}var remaining=maxWait-(stamp-lastCalled),isCalled=remaining<=0||remaining>maxWait;if(isCalled){if(maxTimeoutId){maxTimeoutId=clearTimeout(maxTimeoutId)}lastCalled=stamp;result=func.apply(thisArg,args)}else if(!maxTimeoutId){maxTimeoutId=setTimeout(maxDelayed,remaining)}}if(isCalled&&timeoutId){timeoutId=clearTimeout(timeoutId)}else if(!timeoutId&&wait!==maxWait){timeoutId=setTimeout(delayed,wait)}if(leadingCall){isCalled=true;result=func.apply(thisArg,args)}if(isCalled&&!timeoutId&&!maxTimeoutId){args=thisArg=undefined}return result}debounced.cancel=cancel;return debounced}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}return debounce}();var throttle=function(func,wait,options){var leading=true,trailing=true;if(options===false){leading=false}else if(typeof options===typeof{}){leading="leading"in options?options.leading:leading;trailing="trailing"in options?options.trailing:trailing}options=options||{};options.leading=leading;options.maxWait=wait;options.trailing=trailing;return debounce(func,wait,options)};var Navigator=function(element,options){this._init(element,options)};Navigator.prototype={constructor:Navigator,bb:function(){var bb=this.cy.elements().boundingBox();if(bb.w===0||bb.h===0){return{x1:0,x2:Infinity,y1:0,y2:Infinity,w:Infinity,h:Infinity}}return bb},_init:function(cy,options){this.$element=$(cy.container());this.options=$.extend({},defaults,options);this.cy=cy;this.boundingBox=this.bb();this.width=this.$element.width();this.height=this.$element.height();this._initPanel();this._initThumbnail();this._initView();this._initOverlay()},destroy:function(){this._removeEventsHandling();if(this.options.container&&!this.options.removeCustomContainer){this.$panel.empty()}else{this.$panel.remove()}this.$element.removeData("navigator")},_initPanel:function(){var options=this.options;if(options.container){if(options.container instanceof jQuery){if(options.container.length>0){this.$panel=options.container.first()}else{$.error("Container for jquery.cyNavigator is empty");return}}else if($(options.container).length>0){this.$panel=$(options.container).first()}else{$.error("There is no any element matching your selector for jquery.cyNavigator");return}}else{this.$panel=$('<div class="cytoscape-navigator"/>');$("body").append(this.$panel)}this._setupPanel();this.cy.on("resize",$.proxy(this.resize,this))},_setupPanel:function(){var options=this.options;this.panelWidth=this.$panel.width();this.panelHeight=this.$panel.height()},_initThumbnail:function(){this.$thumbnail=$("<img/>");this.$panel.append(this.$thumbnail);this._setupThumbnailSizes();this._setupThumbnail()},_setupThumbnail:function(){this._updateThumbnailImage()},_setupThumbnailSizes:function(){this.boundingBox=this.bb();this.thumbnailZoom=Math.min(this.panelHeight/this.boundingBox.h,this.panelWidth/this.boundingBox.w);this.thumbnailPan={x:(this.panelWidth-this.thumbnailZoom*(this.boundingBox.x1+this.boundingBox.x2))/2,y:(this.panelHeight-this.thumbnailZoom*(this.boundingBox.y1+this.boundingBox.y2))/2}},_checkThumbnailSizesAndUpdate:function(){var _zoom=this.thumbnailZoom,_pan_x=this.thumbnailPan.x,_pan_y=this.thumbnailPan.y;this._setupThumbnailSizes();if(_zoom!=this.thumbnailZoom||_pan_x!=this.thumbnailPan.x||_pan_y!=this.thumbnailPan.y){this._setupThumbnail();this._setupView()}else{this._updateThumbnailImage()}},_initView:function(){var that=this;this.$view=$('<div class="cytoscape-navigatorView"/>');this.$panel.append(this.$view);this.viewBorderTop=parseInt(this.$view.css("border-top-width"),10);this.viewBorderRight=parseInt(this.$view.css("border-right-width"),10);this.viewBorderBottom=parseInt(this.$view.css("border-bottom-width"),10);this.viewBorderLeft=parseInt(this.$view.css("border-left-width"),10);this.viewBorderHorizontal=this.viewBorderLeft+this.viewBorderRight;this.viewBorderVertical=this.viewBorderTop+this.viewBorderBottom;this._setupView();this.cy.on("zoom pan",$.proxy(this._setupView,this))},_setupView:function(){if(this.viewLocked)return;var cyZoom=this.cy.zoom(),cyPan=this.cy.pan();this.viewW=this.width/cyZoom*this.thumbnailZoom;this.viewX=-cyPan.x*this.viewW/this.width+this.thumbnailPan.x-this.viewBorderLeft;this.viewH=this.height/cyZoom*this.thumbnailZoom;this.viewY=-cyPan.y*this.viewH/this.height+this.thumbnailPan.y-this.viewBorderTop;this.$view.width(this.viewW).height(this.viewH).css({position:"absolute",left:this.viewX,top:this.viewY})},_initOverlay:function(){this.$overlay=$('<div class="cytoscape-navigatorOverlay"/>');this.$panel.append(this.$overlay);this.overlayHookPointX=0;this.overlayHookPointY=0;this._initEventsHandling()},resize:function(){this.width=this.$element.width();this.height=this.$element.height();this._thumbnailSetup=false;this._setupPanel();this._checkThumbnailSizesAndUpdate();this._setupView()},_initEventsHandling:function(){var that=this,eventsLocal=["mousedown","mousewheel","DOMMouseScroll","touchstart"],eventsGlobal=["mouseup","mouseout","mousemove","touchmove","touchend"];var overlayListener;this.$overlay.on(eventsLocal.join(" "),overlayListener=function(ev){if(ev.type=="touchstart"){ev.offsetX=that.viewX+that.viewW/2;ev.offsetY=that.viewY+that.viewH/2}if(ev.offsetX===undefined||ev.offsetY===undefined){var targetOffset=$(ev.target).offset();ev.offsetX=ev.pageX-targetOffset.left;ev.offsetY=ev.pageY-targetOffset.top}if(ev.type=="mousedown"||ev.type=="touchstart"){that._eventMoveStart(ev)}else if(ev.type=="mousewheel"||ev.type=="DOMMouseScroll"){that._eventZoom(ev)}return false});var globalListener;$(window).on(eventsGlobal.join(" "),globalListener=function(ev){if(!that.overlayInMovement)return;if(ev.type=="touchend"){ev.offsetX=that.viewX+that.viewW/2;ev.offsetY=that.viewY+that.viewH/2}else if(ev.type=="touchmove"){ev.pageX=ev.originalEvent.touches[0].pageX;ev.pageY=ev.originalEvent.touches[0].pageY}if(ev.offsetX===undefined||ev.offsetY===undefined){var targetOffset=$(ev.target).offset();ev.offsetX=ev.pageX-targetOffset.left;ev.offsetY=ev.pageY-targetOffset.top}if(ev.target!==that.$overlay[0]){var targetOffset=$(ev.target).offset(),overlayOffset=that.$overlay.offset();if(targetOffset&&overlayOffset){ev.offsetX=ev.offsetX-overlayOffset.left+targetOffset.left;ev.offsetY=ev.offsetY-overlayOffset.top+targetOffset.top}else{return false}}if(ev.type=="mousemove"||ev.type=="touchmove"){that._eventMove(ev)}else if(ev.type=="mouseup"||ev.type=="touchend"){that._eventMoveEnd(ev)}return false});this._removeEventsHandling=function(){this.$overlay.off(eventsLocal.join(" "),overlayListener);$(window).off(eventsGlobal.join(" "),globalListener)}},_eventMoveStart:function(ev){var now=(new Date).getTime();if(this.overlayLastMoveStartTime&&this.overlayLastMoveStartTime+this.options.dblClickDelay>now){this.overlayLastMoveStartTime=0;this.overlayInMovement=true;this.overlayHookPointX=this.viewW/2;this.overlayHookPointY=this.viewH/2;if(this.options.viewLiveFramerate!==false){this._eventMove({offsetX:this.panelWidth/2,offsetY:this.panelHeight/2})}else{this._eventMoveEnd({offsetX:this.panelWidth/2,offsetY:this.panelHeight/2})}this.overlayInMovement=false}else{this.overlayLastMoveStartTime=now;this.overlayInMovement=true;this.viewLocked=true;if(ev.offsetX>=this.viewX&&ev.offsetX<=this.viewX+this.viewW&&ev.offsetY>=this.viewY&&ev.offsetY<=this.viewY+this.viewH){this.overlayHookPointX=ev.offsetX-this.viewX;this.overlayHookPointY=ev.offsetY-this.viewY}else{this.overlayHookPointX=this.viewW/2;this.overlayHookPointY=this.viewH/2;this._eventMove(ev)}}},_eventMove:function(ev){var that=this;this._checkMousePosition(ev);if(!this.overlayInMovement){return}this.viewX=ev.offsetX-this.overlayHookPointX;this.viewY=ev.offsetY-this.overlayHookPointY;this.$view.css("left",this.viewX);this.$view.css("top",this.viewY);if(this.options.viewLiveFramerate!==false){if(this.options.viewLiveFramerate==0){this._moveCy()}else if(!this.overlayTimeout){this.overlayTimeout=setTimeout(function(){that._moveCy();that.overlayTimeout=false},1e3/this.options.viewLiveFramerate)}}},_checkMousePosition:function(ev){if(ev.offsetX>this.viewX&&ev.offsetX<this.viewX+this.viewBorderHorizontal+this.viewW&&ev.offsetY>this.viewY&&ev.offsetY<this.viewY+this.viewBorderVertical+this.viewH){this.$panel.addClass("mouseover-view")}else{this.$panel.removeClass("mouseover-view")}},_eventMoveEnd:function(ev){this.viewLocked=false;this.$panel.removeClass("mouseover-view");if(!this.overlayInMovement){return}this._eventMove(ev);if(this.options.viewLiveFramerate===false){this._moveCy()}this.overlayInMovement=false},_eventZoom:function(ev){var zoomRate=Math.pow(10,ev.originalEvent.wheelDeltaY/1e3||ev.originalEvent.wheelDelta/1e3||ev.originalEvent.detail/-32),mousePosition={left:ev.offsetX,top:ev.offsetY};if(this.cy.zoomingEnabled()){this._zoomCy(zoomRate,mousePosition)}},_updateThumbnailImage:function(){var that=this;if(this._thumbnailUpdating){return}this._thumbnailUpdating=true;var render=function(){that._checkThumbnailSizesAndUpdate();that._setupView();var $img=that.$thumbnail;var img=$img[0];var w=that.panelWidth;var h=that.panelHeight;var bb=that.boundingBox;var zoom=Math.min(w/bb.w,h/bb.h);var pxRatio=1;var translate={x:(w-zoom*bb.w)/2,y:(h-zoom*bb.h)/2};var png=that.cy.png({full:true,scale:zoom});if(png.indexOf("image/png")<0){img.removeAttribute("src")}else{img.setAttribute("src",png)}$img.css({position:"absolute",left:translate.x+"px",top:translate.y+"px"})};this.cy.onRender(throttle(render,that.options.rerenderDelay))},_moveCy:function(){this.cy.pan({x:-(this.viewX+this.viewBorderLeft-this.thumbnailPan.x)*this.width/this.viewW,y:-(this.viewY+this.viewBorderLeft-this.thumbnailPan.y)*this.height/this.viewH})},_zoomCy:function(zoomRate,zoomCenterRaw){var zoomCenter,isZoomCenterInView=false;zoomCenter={x:this.width/2,y:this.height/2};this.cy.zoom({level:this.cy.zoom()*zoomRate,renderedPosition:zoomCenter})}};var register=function(cytoscape,jq){if(!cytoscape||!jq){return}$=jq;cytoscape("core","navigator",function(options){var cy=this;return new Navigator(cy,options)})};if(typeof module!=="undefined"&&module.exports){module.exports=function(cytoscape,jq){register(cytoscape,jq||require("jquery"))}}else if(typeof define!=="undefined"&&define.amd){define("cytoscape-navigator",function(){return register})}if(typeof cytoscape!=="undefined"&&typeof jQuery!=="undefined"){register(cytoscape,jQuery)}})()},{jquery:142}],29:[function(require,module,exports){(function(){"use strict";var register=function(cytoscape,$){if(!cytoscape){return}$.fn.cyPanzoom=$.fn.cytoscapePanzoom=function(options){panzoom.apply(this,[options,$]);return this};cytoscape("core","panzoom",function(options){var cy=this;panzoom.apply(cy.container(),[options,$]);return this})};var defaults={zoomFactor:.05,zoomDelay:45,minZoom:.1,maxZoom:10,fitPadding:50,panSpeed:10,panDistance:10,panDragAreaSize:75,panMinPercentSpeed:.25,panInactiveArea:8,panIndicatorMinOpacity:.5,zoomOnly:false,sliderHandleIcon:"fa fa-minus",zoomInIcon:"fa fa-plus",zoomOutIcon:"fa fa-minus",resetIcon:"fa fa-expand"};var panzoom=function(params,$){var options=$.extend(true,{},defaults,params);var fn=params;var functions={destroy:function(){var $this=$(this);var $pz=$this.find(".cy-panzoom");$pz.data("winbdgs").forEach(function(l){$(window).unbind(l.evt,l.fn)});$pz.data("cybdgs").forEach(function(l){$(this).cytoscape("get").off(l.evt,l.fn)});$pz.remove()},init:function(){var browserIsMobile="ontouchstart"in window;return $(this).each(function(){var $container=$(this);var winbdgs=[];var $win=$(window);var windowBind=function(evt,fn){winbdgs.push({evt:evt,fn:fn});$win.bind(evt,fn)};var windowUnbind=function(evt,fn){for(var i=0;i<winbdgs.length;i++){var l=winbdgs[i];if(l.evt===evt&&l.fn===fn){winbdgs.splice(i,1);break}}$win.unbind(evt,fn)};var cybdgs=[];var cy=$container.cytoscape("get");var cyOn=function(evt,fn){cybdgs.push({evt:evt,fn:fn});cy.on(evt,fn)};var cyOff=function(evt,fn){for(var i=0;i<cybdgs.length;i++){var l=cybdgs[i];if(l.evt===evt&&l.fn===fn){cybdgs.splice(i,1);break}}cy.off(evt,fn)};var $panzoom=$('<div class="cy-panzoom"></div>');$container.prepend($panzoom);$panzoom.css("position","absolute");$panzoom.data("winbdgs",winbdgs);$panzoom.data("cybdgs",cybdgs);if(options.zoomOnly){$panzoom.addClass("cy-panzoom-zoom-only")}var $zoomIn=$('<div class="cy-panzoom-zoom-in cy-panzoom-zoom-button"><span class="icon '+options.zoomInIcon+'"></span></div>');$panzoom.append($zoomIn);var $zoomOut=$('<div class="cy-panzoom-zoom-out cy-panzoom-zoom-button"><span class="icon '+options.zoomOutIcon+'"></span></div>');$panzoom.append($zoomOut);var $reset=$('<div class="cy-panzoom-reset cy-panzoom-zoom-button"><span class="icon '+options.resetIcon+'"></span></div>');$panzoom.append($reset);var $slider=$('<div class="cy-panzoom-slider"></div>');$panzoom.append($slider);$slider.append('<div class="cy-panzoom-slider-background"></div>');var $sliderHandle=$('<div class="cy-panzoom-slider-handle"><span class="icon '+options.sliderHandleIcon+'"></span></div>');$slider.append($sliderHandle);var $noZoomTick=$('<div class="cy-panzoom-no-zoom-tick"></div>');$slider.append($noZoomTick);var $panner=$('<div class="cy-panzoom-panner"></div>');$panzoom.append($panner);var $pHandle=$('<div class="cy-panzoom-panner-handle"></div>');$panner.append($pHandle);var $pUp=$('<div class="cy-panzoom-pan-up cy-panzoom-pan-button"></div>');var $pDown=$('<div class="cy-panzoom-pan-down cy-panzoom-pan-button"></div>');var $pLeft=$('<div class="cy-panzoom-pan-left cy-panzoom-pan-button"></div>');var $pRight=$('<div class="cy-panzoom-pan-right cy-panzoom-pan-button"></div>');$panner.append($pUp).append($pDown).append($pLeft).append($pRight);var $pIndicator=$('<div class="cy-panzoom-pan-indicator"></div>');$panner.append($pIndicator);function handle2pan(e){var v={x:e.originalEvent.pageX-$panner.offset().left-$panner.width()/2,y:e.originalEvent.pageY-$panner.offset().top-$panner.height()/2};var r=options.panDragAreaSize;var d=Math.sqrt(v.x*v.x+v.y*v.y);var percent=Math.min(d/r,1);if(d<options.panInactiveArea){return{x:NaN,y:NaN}}v={x:v.x/d,y:v.y/d};percent=Math.max(options.panMinPercentSpeed,percent);var vnorm={x:-1*v.x*(percent*options.panDistance),y:-1*v.y*(percent*options.panDistance)};return vnorm}function donePanning(){clearInterval(panInterval);windowUnbind("mousemove",handler);$pIndicator.hide()}function positionIndicator(pan){var v=pan;var d=Math.sqrt(v.x*v.x+v.y*v.y);var vnorm={x:-1*v.x/d,y:-1*v.y/d};var w=$panner.width();var h=$panner.height();var percent=d/options.panDistance;var opacity=Math.max(options.panIndicatorMinOpacity,percent);var color=255-Math.round(opacity*255);$pIndicator.show().css({left:w/2*vnorm.x+w/2,top:h/2*vnorm.y+h/2,background:"rgb("+color+", "+color+", "+color+")"})}function calculateZoomCenterPoint(){var cy=$container.cytoscape("get");var pan=cy.pan();var zoom=cy.zoom();zx=$container.width()/2;zy=$container.height()/2}var zooming=false;function startZooming(){zooming=true;calculateZoomCenterPoint()}function endZooming(){zooming=false}var zx,zy;function zoomTo(level){var cy=$container.cytoscape("get");if(!zooming){calculateZoomCenterPoint()}cy.zoom({level:level,renderedPosition:{x:zx,y:zy}})}var panInterval;var handler=function(e){e.stopPropagation();e.preventDefault();clearInterval(panInterval);var pan=handle2pan(e);if(isNaN(pan.x)||isNaN(pan.y)){$pIndicator.hide();return}positionIndicator(pan);panInterval=setInterval(function(){$container.cytoscape("get").panBy(pan)},options.panSpeed)};$pHandle.bind("mousedown",function(e){handler(e);windowBind("mousemove",handler)});$pHandle.bind("mouseup",function(){donePanning()});windowBind("mouseup blur",function(){donePanning()});$slider.bind("mousedown",function(){return false});var sliderVal;var sliding=false;var sliderPadding=2;function setSliderFromMouse(evt,handleOffset){if(handleOffset===undefined){handleOffset=0}var padding=sliderPadding;var min=0+padding;var max=$slider.height()-$sliderHandle.height()-2*padding;var top=evt.pageY-$slider.offset().top-handleOffset;if(top<min){top=min}if(top>max){top=max}var percent=1-(top-min)/(max-min);$sliderHandle.css("top",top);var zmin=options.minZoom;var zmax=options.maxZoom;var x=Math.log(zmin)/Math.log(zmax);var p=(1-x)*percent+x;var z=Math.pow(zmax,p);if(z<zmin){z=zmin}else if(z>zmax){z=zmax}zoomTo(z)}var sliderMdownHandler,sliderMmoveHandler;$sliderHandle.bind("mousedown",sliderMdownHandler=function(mdEvt){var handleOffset=mdEvt.target===$sliderHandle[0]?mdEvt.offsetY:0;sliding=true;startZooming();$sliderHandle.addClass("active");var lastMove=0;windowBind("mousemove",sliderMmoveHandler=function(mmEvt){var now=+new Date;if(now>lastMove+10){lastMove=now}else{return false}setSliderFromMouse(mmEvt,handleOffset);return false});windowBind("mouseup",function(){windowUnbind("mousemove",sliderMmoveHandler);sliding=false;$sliderHandle.removeClass("active");endZooming()});return false});$slider.bind("mousedown",function(e){if(e.target!==$sliderHandle[0]){sliderMdownHandler(e);setSliderFromMouse(e)}});function positionSliderFromZoom(){var cy=$container.cytoscape("get");var z=cy.zoom();var zmin=options.minZoom;var zmax=options.maxZoom;var x=Math.log(zmin)/Math.log(zmax);var p=Math.log(z)/Math.log(zmax);var percent=1-(p-x)/(1-x);var min=sliderPadding;var max=$slider.height()-$sliderHandle.height()-2*sliderPadding;var top=percent*(max-min);if(top<min){top=min}if(top>max){top=max}$sliderHandle.css("top",top)}positionSliderFromZoom();cyOn("zoom",function(){if(!sliding){positionSliderFromZoom()}});(function(){var z=1;var zmin=options.minZoom;var zmax=options.maxZoom;var x=Math.log(zmin)/Math.log(zmax);var p=Math.log(z)/Math.log(zmax);var percent=1-(p-x)/(1-x);if(percent>1||percent<0){$noZoomTick.hide();return}var min=sliderPadding;var max=$slider.height()-$sliderHandle.height()-2*sliderPadding;var top=percent*(max-min);if(top<min){top=min}if(top>max){top=max}$noZoomTick.css("top",top)})();function bindButton($button,factor){var zoomInterval;$button.bind("mousedown",function(e){e.preventDefault();e.stopPropagation();if(e.button!=0){return}var cy=$container.cytoscape("get");var doZoom=function(){var zoom=cy.zoom();var lvl=cy.zoom()*factor;if(lvl<options.minZoom){lvl=options.minZoom}if(lvl>options.maxZoom){lvl=options.maxZoom}if(lvl==options.maxZoom&&zoom==options.maxZoom||lvl==options.minZoom&&zoom==options.minZoom){return}zoomTo(lvl)};startZooming();doZoom();zoomInterval=setInterval(doZoom,options.zoomDelay);return false});windowBind("mouseup blur",function(){clearInterval(zoomInterval);endZooming()})}bindButton($zoomIn,1+options.zoomFactor);bindButton($zoomOut,1-options.zoomFactor);$reset.bind("mousedown",function(e){if(e.button!=0){return}var cy=$container.cytoscape("get");if(cy.elements().size()===0){cy.reset()}else{cy.fit(options.fitPadding)}return false})})}};if(functions[fn]){return functions[fn].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof fn=="object"||!fn){return functions.init.apply(this,arguments)}else{$.error("No such function `"+fn+"` for jquery.cytoscapePanzoom")}return $(this)};if(typeof module!=="undefined"&&module.exports){module.exports=register}if(typeof define!=="undefined"&&define.amd){define("cytoscape-panzoom",function(){return register})}if(typeof cytoscape!=="undefined"&&typeof jQuery!=="undefined"){register(cytoscape,jQuery)}})()},{}],30:[function(require,module,exports){(function($,$$){"use strict";var isObject=function(o){return o!=null&&typeof o==="object"};var isFunction=function(o){return o!=null&&typeof o==="function"};var isNumber=function(o){return o!=null&&typeof o==="number"};var isString=function(o){return o!=null&&typeof o==="string"};var isUndef=function(o){return o===undefined};var wrap=function(obj,target){if(isFunction(obj)){return function(event,api){return obj.apply(target,[event,api])}}else{return obj}};var throttle=function(func,wait,options){var leading=true,trailing=true;if(options===false){leading=false}else if(isObject(options)){leading="leading"in options?options.leading:leading;trailing="trailing"in options?options.trailing:trailing}options=options||{};options.leading=leading;options.maxWait=wait;options.trailing=trailing;return debounce(func,wait,options)};var debounce=function(func,wait,options){var args,maxTimeoutId,result,stamp,thisArg,timeoutId,trailingCall,lastCalled=0,maxWait=false,trailing=true;if(!isFunction(func)){return}wait=Math.max(0,wait)||0;if(options===true){var leading=true;trailing=false}else if(isObject(options)){leading=options.leading;maxWait="maxWait"in options&&(Math.max(wait,options.maxWait)||0);trailing="trailing"in options?options.trailing:trailing}var delayed=function(){var remaining=wait-(Date.now()-stamp);if(remaining<=0){if(maxTimeoutId){clearTimeout(maxTimeoutId)}var isCalled=trailingCall;maxTimeoutId=timeoutId=trailingCall=undefined;if(isCalled){lastCalled=Date.now();result=func.apply(thisArg,args);if(!timeoutId&&!maxTimeoutId){args=thisArg=null}}}else{timeoutId=setTimeout(delayed,remaining)}};var maxDelayed=function(){if(timeoutId){clearTimeout(timeoutId)}maxTimeoutId=timeoutId=trailingCall=undefined;if(trailing||maxWait!==wait){lastCalled=Date.now();result=func.apply(thisArg,args);if(!timeoutId&&!maxTimeoutId){args=thisArg=null}}};return function(){args=arguments;stamp=Date.now();thisArg=this;trailingCall=trailing&&(timeoutId||!leading);if(maxWait===false){var leadingCall=leading&&!timeoutId}else{if(!maxTimeoutId&&!leading){lastCalled=stamp}var remaining=maxWait-(stamp-lastCalled),isCalled=remaining<=0;if(isCalled){if(maxTimeoutId){maxTimeoutId=clearTimeout(maxTimeoutId)}lastCalled=stamp;result=func.apply(thisArg,args)}else if(!maxTimeoutId){maxTimeoutId=setTimeout(maxDelayed,remaining)}}if(isCalled&&timeoutId){timeoutId=clearTimeout(timeoutId)}else if(!timeoutId&&wait!==maxWait){timeoutId=setTimeout(delayed,wait)}if(leadingCall){isCalled=true;result=func.apply(thisArg,args)}if(isCalled&&!timeoutId&&!maxTimeoutId){args=thisArg=null}return result}};function register($$,$){var $qtipContainer=$("<div></div>");var viewportDebounceRate=250;function generateOpts(target,passedOpts){var qtip=target.scratch().qtip;var opts=$.extend({},passedOpts);if(!opts.id){opts.id="cy-qtip-target-"+(Date.now()+Math.round(Math.random()*1e4))}if(!qtip.$domEle){qtip.$domEle=$qtipContainer}opts.position=opts.position||{};opts.position.container=opts.position.container||$(document.body);opts.position.viewport=opts.position.viewport||$(document.body);opts.position.target=[0,0];opts.position.my=opts.position.my||"top center";opts.position.at=opts.position.at||"bottom center";var adjust=opts.position.adjust=opts.position.adjust||{};adjust.method=adjust.method||"flip";adjust.mouse=false;if(isUndef(adjust.cyAdjustToEleBB)){adjust.cyAdjustToEleBB=true}opts.show=opts.show||{};if(isUndef(opts.show.event)){opts.show.event="tap"}opts.hide=opts.hide||{};opts.hide.cyViewport=opts.hide.cyViewport===undefined?true:opts.hide.cyViewport;if(isUndef(opts.hide.event)){opts.hide.event="unfocus"}opts.overwrite=false;if(opts.content){if(isFunction(opts.content)||isString(opts.content)){opts.content=wrap(opts.content,target)}else{opts.content={text:wrap(opts.content.text,target),title:wrap(opts.content.title,target)}}}return opts}$$("collection","qtip",function(passedOpts){var eles=this;var cy=this.cy();var container=cy.container();if(passedOpts==="api"){return this.scratch().qtip.api}eles.each(function(i,ele){var scratch=ele.scratch();var qtip=scratch.qtip=scratch.qtip||{};var opts=generateOpts(ele,passedOpts);var adjNums=opts.position.adjust;qtip.$domEle.qtip(opts);var qtipApi=qtip.api=qtip.$domEle.qtip("api");qtip.$domEle.removeData("qtip");var updatePosition=function(e){var cOff=container.getBoundingClientRect();var pos=ele.renderedPosition()||(e?e.cyRenderedPosition:undefined);if(!pos||pos.x==null||isNaN(pos.x)){return}if(opts.position.adjust.cyAdjustToEleBB&&ele.isNode()){var my=opts.position.my.toLowerCase();var at=opts.position.at.toLowerCase();var z=cy.zoom();var w=ele.outerWidth()*z;var h=ele.outerHeight()*z;if(at.match("top")){pos.y-=h/2}else if(at.match("bottom")){pos.y+=h/2}if(at.match("left")){pos.x-=w/2}else if(at.match("right")){pos.x+=w/2}if(isNumber(adjNums.x)){pos.x+=adjNums.x}if(isNumber(adjNums.y)){pos.y+=adjNums.y}}qtipApi.set("position.adjust.x",cOff.left+pos.x+window.pageXOffset);qtipApi.set("position.adjust.y",cOff.top+pos.y+window.pageYOffset)};updatePosition();ele.on(opts.show.event,function(e){updatePosition(e);qtipApi.show()});ele.on(opts.hide.event,function(e){qtipApi.hide()});if(opts.hide.cyViewport){cy.on("viewport",debounce(function(){qtipApi.hide()},viewportDebounceRate,{leading:true}))}if(opts.position.adjust.cyViewport){cy.on("pan zoom",debounce(function(e){updatePosition(e);qtipApi.reposition()},viewportDebounceRate,{trailing:true}))}});return this});$$("core","qtip",function(passedOpts){var cy=this;var container=cy.container();if(passedOpts==="api"){return this.scratch().qtip.api}var scratch=cy.scratch();var qtip=scratch.qtip=scratch.qtip||{};var opts=generateOpts(cy,passedOpts);qtip.$domEle.qtip(opts);var qtipApi=qtip.api=qtip.$domEle.qtip("api");qtip.$domEle.removeData("qtip");var updatePosition=function(e){var cOff=container.getBoundingClientRect();var pos=e.cyRenderedPosition;if(!pos||pos.x==null||isNaN(pos.x)){return}qtipApi.set("position.adjust.x",cOff.left+pos.x+window.pageXOffset);qtipApi.set("position.adjust.y",cOff.top+pos.y+window.pageYOffset)};cy.on(opts.show.event,function(e){if(!opts.show.cyBgOnly||opts.show.cyBgOnly&&e.cyTarget===cy){updatePosition(e);qtipApi.show()}});cy.on(opts.hide.event,function(e){if(!opts.hide.cyBgOnly||opts.hide.cyBgOnly&&e.cyTarget===cy){qtipApi.hide()}});if(opts.hide.cyViewport){cy.on("viewport",debounce(function(){qtipApi.hide()},viewportDebounceRate,{leading:true}))}return this})}if(typeof module!=="undefined"&&module.exports){module.exports=register}if(typeof define!=="undefined"&&define.amd){define("cytoscape-qtip",function(){return register})}if($&&$$){register($$,$)}})(typeof jQuery!=="undefined"?jQuery:null,typeof cytoscape!=="undefined"?cytoscape:null)},{}],31:[function(require,module,exports){(function(){"use strict";var register=function(cytoscape){if(!cytoscape){return}function getScratch(eleOrCy,name){if(eleOrCy.scratch("_undoRedo")===undefined){eleOrCy.scratch("_undoRedo",{})}var scratchPad=eleOrCy.scratch("_undoRedo");return name===undefined?scratchPad:scratchPad[name]}function setScratch(eleOrCy,name,val){var scratchPad=getScratch(eleOrCy);scratchPad[name]=val;eleOrCy.scratch("_undoRedo",scratchPad)}function generateInstance(cy){var instance={};instance.options={isDebug:false,actions:{},undoableDrag:true,stackSizeLimit:undefined,beforeUndo:function(){},afterUndo:function(){},beforeRedo:function(){},afterRedo:function(){},ready:function(){}};instance.actions={};instance.undoStack=[];instance.redoStack=[];instance.reset=function(undos,redos){this.undoStack=undos||[];this.redoStack=undos||[]};instance.undo=function(){if(!this.isUndoStackEmpty()){var action=this.undoStack.pop();cy.trigger("beforeUndo",[action.name,action.args]);var res=this.actions[action.name]._undo(action.args);this.redoStack.push({name:action.name,args:res});cy.trigger("afterUndo",[action.name,action.args,res]);return res}else if(this.options.isDebug){console.log("Undoing cannot be done because undo stack is empty!")}};instance.redo=function(){if(!this.isRedoStackEmpty()){var action=this.redoStack.pop();cy.trigger(action.firstTime?"beforeDo":"beforeRedo",[action.name,action.args]);if(!action.args)action.args={};action.args.firstTime=action.firstTime?true:false;var res=this.actions[action.name]._do(action.args);this.undoStack.push({name:action.name,args:res});if(this.options.stackSizeLimit!=undefined&&this.undoStack.length>this.options.stackSizeLimit){this.undoStack.shift()}cy.trigger(action.firstTime?"afterDo":"afterRedo",[action.name,action.args,res]);return res}else if(this.options.isDebug){console.log("Redoing cannot be done because redo stack is empty!")}};instance.do=function(actionName,args){this.redoStack.length=0;this.redoStack.push({name:actionName,args:args,firstTime:true});return this.redo()};instance.undoAll=function(){while(!this.isUndoStackEmpty()){this.undo()}};instance.redoAll=function(){while(!this.isRedoStackEmpty()){this.redo()}};instance.action=function(actionName,_do,_undo){this.actions[actionName]={_do:_do,_undo:_undo};return this};instance.removeAction=function(actionName){delete this.actions[actionName]};instance.isUndoStackEmpty=function(){return this.undoStack.length===0};instance.isRedoStackEmpty=function(){return this.redoStack.length===0};instance.getUndoStack=function(){return this.undoStack};instance.getRedoStack=function(){return this.redoStack};return instance}cytoscape("core","undoRedo",function(options,dontInit){var cy=this;var instance=getScratch(cy,"instance")||generateInstance(cy);setScratch(cy,"instance",instance);if(options){for(var key in options)if(instance.options.hasOwnProperty(key))instance.options[key]=options[key];if(options.actions)for(var key in options.actions)instance.actions[key]=options.actions[key]}if(!getScratch(cy,"isInitialized")&&!dontInit){var defActions=defaultActions(cy);for(var key in defActions)instance.actions[key]=defActions[key];setDragUndo(cy,instance.options.undoableDrag);setScratch(cy,"isInitialized",true)}instance.options.ready();return instance});function setDragUndo(cy,undoable){var lastMouseDownNodeInfo=null;cy.on("grab","node",function(){if(typeof undoable==="function"?undoable.call(this):undoable){lastMouseDownNodeInfo={};lastMouseDownNodeInfo.lastMouseDownPosition={x:this.position("x"),y:this.position("y")};lastMouseDownNodeInfo.node=this}});cy.on("free","node",function(){var instance=getScratch(cy,"instance");if(typeof undoable==="function"?undoable.call(this):undoable){if(lastMouseDownNodeInfo==null){return}var node=lastMouseDownNodeInfo.node;var lastMouseDownPosition=lastMouseDownNodeInfo.lastMouseDownPosition;var mouseUpPosition={x:node.position("x"),y:node.position("y")};if(mouseUpPosition.x!=lastMouseDownPosition.x||mouseUpPosition.y!=lastMouseDownPosition.y){var positionDiff={x:mouseUpPosition.x-lastMouseDownPosition.x,y:mouseUpPosition.y-lastMouseDownPosition.y};var nodes;if(node.selected()){nodes=cy.nodes(":visible").filter(":selected")}else{nodes=cy.collection([node])}var param={positionDiff:positionDiff,nodes:nodes,move:false};instance.do("drag",param);lastMouseDownNodeInfo=null}}})}function defaultActions(cy){function getTopMostNodes(nodes){var nodesMap={};for(var i=0;i<nodes.length;i++){nodesMap[nodes[i].id()]=true}var roots=nodes.filter(function(ele,i){if(typeof ele==="number"){ele=i}var parent=ele.parent()[0];while(parent!=null){if(nodesMap[parent.id()]){return false}parent=parent.parent()[0]}return true});return roots}function moveNodes(positionDiff,nodes,notCalcTopMostNodes){var topMostNodes=notCalcTopMostNodes?nodes:getTopMostNodes(nodes);for(var i=0;i<topMostNodes.length;i++){var node=topMostNodes[i];var oldX=node.position("x");var oldY=node.position("y");node.position({x:oldX+positionDiff.x,y:oldY+positionDiff.y});var children=node.children();moveNodes(positionDiff,children,true)}}function getEles(_eles){return typeof _eles==="string"?cy.$(_eles):_eles}function restoreEles(_eles){return getEles(_eles).restore()}function returnToPositions(positions){var currentPositions={};cy.nodes().positions(function(ele,i){if(typeof ele==="number"){ele=i}currentPositions[ele.id()]={x:ele.position("x"),y:ele.position("y")};var pos=positions[ele.id()];return{x:pos.x,y:pos.y}});return currentPositions}function getNodePositions(){var positions={};var nodes=cy.nodes();for(var i=0;i<nodes.length;i++){var node=nodes[i];positions[node.id()]={x:node.position("x"),y:node.position("y")}}return positions}function changeParent(param){var result={};if(param.firstTime){var newParentId=param.parentData==undefined?null:param.parentData;var withDescendant=param.nodes.union(param.nodes.descendants());result.elesToRestore=withDescendant.union(withDescendant.connectedEdges());result.movedEles=param.nodes.move({parent:newParentId});var posDiff={x:param.posDiffX,y:param.posDiffY};moveNodes(posDiff,result.movedEles)}else{result.elesToRestore=param.movedEles.remove();result.movedEles=param.elesToRestore.restore()}if(param.callback){result.callback=param.callback;param.callback(result.movedEles)}return result}function batch(actionList,doOrUndo){var tempStack=[];var instance=getScratch(cy,"instance");var actions=instance.actions;for(var i=0;i<actionList.length;i++){var action=actionList[i];if(!actions.hasOwnProperty(action.name)){throw"Action "+action.name+" does not exist as an undoable function"}}for(var i=0;i<actionList.length;i++){var action=actionList[i];action.param.firstTime=actionList.firstTime;var actionResult;if(doOrUndo=="undo"){actionResult=actions[action.name]._undo(action.param)}else{actionResult=actions[action.name]._do(action.param)}tempStack.unshift({name:action.name,param:actionResult})}return tempStack}return{add:{_do:function(eles){return eles.firstTime?cy.add(eles):restoreEles(eles)},_undo:cy.remove},remove:{_do:cy.remove,_undo:restoreEles},restore:{_do:restoreEles,_undo:cy.remove},select:{_do:function(_eles){return getEles(_eles).select()},_undo:function(_eles){return getEles(_eles).unselect()}},unselect:{_do:function(_eles){return getEles(_eles).unselect()},_undo:function(_eles){return getEles(_eles).select()}},move:{_do:function(args){var eles=getEles(args.eles);var nodes=eles.nodes();var edges=eles.edges();return{oldNodes:nodes,newNodes:nodes.move(args.location),oldEdges:edges,newEdges:edges.move(args.location)}},_undo:function(eles){var newEles=cy.collection();var location={};if(eles.newNodes.length>0){location.parent=eles.newNodes[0].parent();for(var i=0;i<eles.newNodes.length;i++){var newNode=eles.newNodes[i].move({parent:eles.oldNodes[i].parent()});newEles.union(newNode)}}else{location.source=location.newEdges[0].source();location.target=location.newEdges[0].target();for(var i=0;i<eles.newEdges.length;i++){var newEdge=eles.newEdges[i].move({source:eles.oldEdges[i].source(),target:eles.oldEdges[i].target()});newEles.union(newEdge)}}return{eles:newEles,location:location}}},drag:{_do:function(args){if(args.move)moveNodes(args.positionDiff,args.nodes);return args},_undo:function(args){var diff={x:-1*args.positionDiff.x,y:-1*args.positionDiff.y};var result={positionDiff:args.positionDiff,nodes:args.nodes,move:true};moveNodes(diff,args.nodes);return result}},layout:{_do:function(args){if(args.firstTime){var positions=getNodePositions();var layout;if(args.eles){layout=getEles(args.eles).layout(args.options)}else{layout=cy.layout(args.options)}if(layout&&layout.run){layout.run()}return positions}else return returnToPositions(args)},_undo:function(nodesData){return returnToPositions(nodesData)}},changeParent:{_do:function(args){return changeParent(args)},_undo:function(args){return changeParent(args)}},batch:{_do:function(args){return batch(args,"do")},_undo:function(args){return batch(args,"undo")}}}}};if(typeof module!=="undefined"&&module.exports){module.exports=register}if(typeof define!=="undefined"&&define.amd){define("cytoscape.js-undo-redo",function(){return register})}if(typeof cytoscape!=="undefined"){register(cytoscape)}})()},{}],32:[function(require,module,exports){(function(){"use strict";var register=function(cytoscape,$){if(!cytoscape||!$){return}var options={node:{highlighted:{},unhighlighted:{opacity:.3}},edge:{highlighted:{},unhighlighted:{opacity:.3}},setVisibilityOnHide:false,setDisplayOnHide:true,neighbor:function(node){return false},neighborSelectTime:500};var undoRedo=require("./undo-redo");var viewUtilities=require("./view-utilities");var Mousetrap=require("mousetrap");cytoscape("core","viewUtilities",function(opts){var cy=this;if(opts==="get"){return getScratch(cy).instance}$.extend(true,options,opts);function getScratch(eleOrCy){if(!eleOrCy.scratch("_viewUtilities")){eleOrCy.scratch("_viewUtilities",{})}return eleOrCy.scratch("_viewUtilities")}if(!getScratch(cy).initialized){getScratch(cy).initialized=true;var instance=viewUtilities(cy,options);if(cy.undoRedo){var ur=cy.undoRedo(null,true);undoRedo(cy,ur,instance)}getScratch(cy).instance=instance;var mt=new Mousetrap;var shiftKeyDown=false;mt.bind(["shift"],function(){shiftKeyDown=true},"keydown");mt.bind(["shift"],function(){shiftKeyDown=false},"keyup");cy.on("taphold","node",function(event){var target=event.target||event.cyTarget;var tapheld=false;var neighborhood;var timeout=setTimeout(function(){if(shiftKeyDown==true){cy.elements().unselect();neighborhood=options.neighbor(target);neighborhood.select();target.lock();tapheld=true}},options.neighborSelectTime-500);cy.on("free","node",function(){var targetTapheld=event.target||event.cyTarget;if(target==targetTapheld&&tapheld===true){tapheld=false;neighborhood.select();target.unlock()}else{clearTimeout(timeout)}});cy.on("drag","node",function(){var targetDragged=event.target||event.cyTarget;if(target==targetDragged&&tapheld===false){clearTimeout(timeout)}})})}return getScratch(cy).instance})};if(typeof module!=="undefined"&&module.exports){module.exports=register}if(typeof define!=="undefined"&&define.amd){define("cytoscape-view-utilities",function(){return register})}if(typeof cytoscape!=="undefined"&&typeof $!=="undefined"){register(cytoscape,$)}})()},{"./undo-redo":33,"./view-utilities":34,mousetrap:143}],33:[function(require,module,exports){function highlightUR(cy,ur,viewUtilities){function getStatus(eles){eles=eles?eles:cy.elements();return{highlighteds:eles.filter(".highlighted:visible"),unhighlighteds:eles.filter(".unhighlighted:visible"),notHighlighteds:eles.filter(":visible").not(".highlighted, .unhighlighted")}}function generalUndo(args){var current=args.current;var highlighteds=viewUtilities.highlight(args.highlighteds);var unhighlighteds=viewUtilities.unhighlight(args.unhighlighteds);var notHighlighteds=viewUtilities.removeHighlights(args.notHighlighteds);return{highlighteds:highlighteds,unhighlighteds:unhighlighteds,notHighlighteds:notHighlighteds,current:current}}function generalRedo(args){var current=args.current;var highlighteds=viewUtilities.highlight(args.current.highlighteds);var unhighlighteds=viewUtilities.unhighlight(args.current.unhighlighteds);var notHighlighteds=viewUtilities.removeHighlights(args.current.notHighlighteds);return{highlighteds:highlighteds,unhighlighteds:unhighlighteds,notHighlighteds:notHighlighteds,current:current}}function generateDoFunc(func){return function(eles){var res=getStatus();if(eles.firstTime)viewUtilities[func](eles);else generalRedo(eles);res.current=getStatus();return res}}function urRemoveHighlights(args){var res=getStatus();if(args.firstTime)viewUtilities.removeHighlights();else generalRedo(args);res.current=getStatus();return res}ur.action("highlightNeighbors",generateDoFunc("highlightNeighbors"),generalUndo);ur.action("highlightNeighbours",generateDoFunc("highlightNeighbours"),generalUndo);ur.action("highlight",generateDoFunc("highlight"),generalUndo);ur.action("unhighlight",generateDoFunc("unhighlight"),generalUndo);ur.action("unhighlightNeighbors",generateDoFunc("unhighlightNeighbors"),generalUndo);ur.action("unhighlightNeighbours",generateDoFunc("unhighlightNeighbours"),generalUndo);ur.action("removeHighlights",urRemoveHighlights,generalUndo)}function hideShowUR(cy,ur,viewUtilities){function urShow(eles){return viewUtilities.show(eles)}function urHide(eles){return viewUtilities.hide(eles)}ur.action("show",urShow,urHide);ur.action("hide",urHide,urShow)}module.exports=function(cy,ur,viewUtilities){highlightUR(cy,ur,viewUtilities);hideShowUR(cy,ur,viewUtilities)}},{}],34:[function(require,module,exports){var viewUtilities=function(cy,options){cy.style().selector("node.highlighted").css(options.node.highlighted).selector("node.unhighlighted").css(options.node.unhighlighted).selector("edge.highlighted").css(options.edge.highlighted).selector("edge.unhighlighted").css(options.edge.unhighlighted).update();function highlight(eles){eles.removeClass("unhighlighted").addClass("highlighted")}function getWithNeighbors(eles){return eles.add(eles.descendants()).closedNeighborhood()}var instance={};instance.hide=function(eles){eles=eles.filter(":visible");eles=eles.union(eles.connectedEdges());eles.unselect();if(options.setVisibilityOnHide){eles.css("visibility","hidden")}if(options.setDisplayOnHide){eles.css("display","none")}return eles};instance.show=function(eles){eles=eles.not(":visible");eles=eles.union(eles.connectedEdges());eles.unselect();if(options.setVisibilityOnHide){eles.css("visibility","visible")}if(options.setDisplayOnHide){eles.css("display","element")}return eles};instance.highlight=function(eles){var others=cy.elements().difference(eles.union(eles.ancestors()));if(cy.$(".highlighted:visible").length==0)this.unhighlight(others);highlight(eles);return eles};instance.unhighlight=function(eles){eles.removeClass("highlighted").addClass("unhighlighted")};instance.highlightNeighbors=function(eles){var allEles=getWithNeighbors(eles);return this.highlight(allEles)};instance.highlightNeighbours=function(eles){return this.highlightNeighbors(eles)};instance.unhighlightNeighbors=function(eles){var allEles=getWithNeighbors(eles);return this.unhighlight(allEles)};instance.unhighlightNeighbours=function(eles){this.unhighlightNeighbors(eles)};instance.removeHighlights=function(eles){if(!eles){eles=cy.elements()}return eles.removeClass("highlighted").removeClass("unhighlighted").removeData("highlighted")};instance.isHighlighted=function(ele){return ele.is(".highlighted:visible")?true:false};return instance};module.exports=viewUtilities},{}],35:[function(require,module,exports){"use strict"},{}],36:[function(require,module,exports){"use strict";var util=require("./util");var is=require("./is");var Promise=require("./promise");var Animation=function(target,opts,opts2){if(!(this instanceof Animation)){return new Animation(target,opts,opts2)}var _p=this._private=util.extend({duration:1e3},opts,opts2);_p.target=target;_p.style=_p.style||_p.css;_p.started=false;_p.playing=false;_p.hooked=false;_p.applying=false;_p.progress=0;_p.completes=[];_p.frames=[];if(_p.complete&&is.fn(_p.complete)){_p.completes.push(_p.complete)}this.length=1;this[0]=this};var anifn=Animation.prototype;util.extend(anifn,{instanceString:function(){return"animation"},hook:function(){var _p=this._private;if(!_p.hooked){var q;var tAni=_p.target._private.animation;if(_p.queue){q=tAni.queue}else{q=tAni.current}q.push(this);if(is.elementOrCollection(_p.target)){_p.target.cy().addToAnimationPool(_p.target)}_p.hooked=true}return this},play:function(){var _p=this._private;if(_p.progress===1){_p.progress=0}_p.playing=true;_p.started=false;_p.stopped=false;this.hook();return this},playing:function(){return this._private.playing},apply:function(){var _p=this._private;_p.applying=true;_p.started=false;_p.stopped=false;this.hook();return this},applying:function(){return this._private.applying},pause:function(){var _p=this._private;_p.playing=false;_p.started=false;return this},stop:function(){var _p=this._private;_p.playing=false;_p.started=false;_p.stopped=true;return this},rewind:function(){return this.progress(0)},fastforward:function(){return this.progress(1)},time:function(t){var _p=this._private;if(t===undefined){return _p.progress*_p.duration}else{return this.progress(t/_p.duration)}},progress:function(p){var _p=this._private;var wasPlaying=_p.playing;if(p===undefined){return _p.progress}else{if(wasPlaying){this.pause()}_p.progress=p;_p.started=false;if(wasPlaying){this.play()}}return this},completed:function(){return this._private.progress===1},reverse:function(){var _p=this._private;var wasPlaying=_p.playing;if(wasPlaying){this.pause()}_p.progress=1-_p.progress;_p.started=false;var swap=function(a,b){var _pa=_p[a];_p[a]=_p[b];_p[b]=_pa};swap("zoom","startZoom");swap("pan","startPan");swap("position","startPosition");for(var i=0;i<_p.style.length;i++){var prop=_p.style[i];var name=prop.name;var startStyleProp=_p.startStyle[name];_p.startStyle[name]=prop;_p.style[i]=startStyleProp}if(wasPlaying){this.play()}return this},promise:function(type){var _p=this._private;var arr;switch(type){case"frame":arr=_p.frames;break;default:case"complete":case"completed":arr=_p.completes}return new Promise(function(resolve,reject){arr.push(function(){resolve()})})}});anifn.complete=anifn.completed;module.exports=Animation},{"./is":117,"./promise":120,"./util":134}],37:[function(require,module,exports){"use strict";var is=require("../../is");var elesfn={aStar:function(options){var eles=this;options=options||{};var reconstructPath=function(start,end,cameFromMap,pathAcum){if(start==end){pathAcum.push(cy.getElementById(end));return pathAcum}if(end in cameFromMap){var previous=cameFromMap[end];var previousEdge=cameFromEdge[end];pathAcum.push(cy.getElementById(end));pathAcum.push(cy.getElementById(previousEdge));return reconstructPath(start,previous,cameFromMap,pathAcum)}return undefined};var findMin=function(openSet,fScore){if(openSet.length===0){return undefined}var minPos=0;var tempScore=fScore[openSet[0]];for(var i=1;i<openSet.length;i++){var s=fScore[openSet[i]];if(s<tempScore){tempScore=s;minPos=i}}return minPos};var cy=this._private.cy;if(options!=null&&options.root!=null){var source=is.string(options.root)?this.filter(options.root)[0]:options.root[0]}else{return undefined}if(options.goal!=null){var target=is.string(options.goal)?this.filter(options.goal)[0]:options.goal[0]}else{return undefined}if(options.heuristic!=null&&is.fn(options.heuristic)){var heuristic=options.heuristic}else{var heuristic=function(){return 0}}if(options.weight!=null&&is.fn(options.weight)){var weightFn=options.weight}else{var weightFn=function(e){return 1}}if(options.directed!=null){var directed=options.directed}else{var directed=false}var closedSet=[];var openSet=[source.id()];var cameFrom={};var cameFromEdge={};var gScore={};var fScore={};gScore[source.id()]=0;fScore[source.id()]=heuristic(source);var edges=this.edges().stdFilter(function(e){return!e.isLoop()});var nodes=this.nodes();var steps=0;while(openSet.length>0){var minPos=findMin(openSet,fScore);var cMin=cy.getElementById(openSet[minPos]);steps++;if(cMin.id()==target.id()){var rPath=reconstructPath(source.id(),target.id(),cameFrom,[]);rPath.reverse();return{found:true,distance:gScore[cMin.id()],path:eles.spawn(rPath),steps:steps}}closedSet.push(cMin.id());openSet.splice(minPos,1);var vwEdges=cMin.connectedEdges();if(directed){vwEdges=vwEdges.stdFilter(function(ele){return ele.data("source")===cMin.id()})}vwEdges=vwEdges.intersect(edges);for(var i=0;i<vwEdges.length;i++){var e=vwEdges[i];var w=e.connectedNodes().stdFilter(function(n){return n.id()!==cMin.id()}).intersect(nodes);if(closedSet.indexOf(w.id())!=-1){continue}var tempScore=gScore[cMin.id()]+weightFn.apply(e,[e]);if(openSet.indexOf(w.id())==-1){gScore[w.id()]=tempScore;fScore[w.id()]=tempScore+heuristic(w);openSet.push(w.id());cameFrom[w.id()]=cMin.id();cameFromEdge[w.id()]=e.id();continue}if(tempScore<gScore[w.id()]){gScore[w.id()]=tempScore;fScore[w.id()]=tempScore+heuristic(w);cameFrom[w.id()]=cMin.id()}}}return{found:false,distance:undefined,path:undefined,steps:steps}}};module.exports=elesfn},{"../../is":117}],38:[function(require,module,exports){"use strict";var is=require("../../is");var util=require("../../util");var elesfn={bellmanFord:function(options){var eles=this;options=options||{};if(options.weight!=null&&is.fn(options.weight)){var weightFn=options.weight}else{var weightFn=function(e){return 1}}if(options.directed!=null){var directed=options.directed}else{var directed=false}if(options.root!=null){if(is.string(options.root)){var source=this.filter(options.root)[0]}else{var source=options.root[0]}}else{return undefined}var cy=this._private.cy;var edges=this.edges().stdFilter(function(e){return!e.isLoop()});var nodes=this.nodes();var numNodes=nodes.length;var id2position={};for(var i=0;i<numNodes;i++){id2position[nodes[i].id()]=i}var cost=[];var predecessor=[];var predEdge=[];for(var i=0;i<numNodes;i++){if(nodes[i].id()===source.id()){cost[i]=0}else{cost[i]=Infinity}predecessor[i]=undefined}var flag=false;for(var i=1;i<numNodes;i++){flag=false;for(var e=0;e<edges.length;e++){var sourceIndex=id2position[edges[e].source().id()];var targetIndex=id2position[edges[e].target().id()];var weight=weightFn.apply(edges[e],[edges[e]]);var temp=cost[sourceIndex]+weight;if(temp<cost[targetIndex]){cost[targetIndex]=temp;predecessor[targetIndex]=sourceIndex;predEdge[targetIndex]=edges[e];flag=true}if(!directed){var temp=cost[targetIndex]+weight;if(temp<cost[sourceIndex]){cost[sourceIndex]=temp;predecessor[sourceIndex]=targetIndex;predEdge[sourceIndex]=edges[e];flag=true}}}if(!flag){break}}if(flag){for(var e=0;e<edges.length;e++){var sourceIndex=id2position[edges[e].source().id()];var targetIndex=id2position[edges[e].target().id()];var weight=weightFn.apply(edges[e],[edges[e]]);if(cost[sourceIndex]+weight<cost[targetIndex]){util.error("Graph contains a negative weight cycle for Bellman-Ford");return{pathTo:undefined,distanceTo:undefined,hasNegativeWeightCycle:true}}}}var position2id=[];for(var i=0;i<numNodes;i++){position2id.push(nodes[i].id())}var res={distanceTo:function(to){if(is.string(to)){var toId=cy.filter(to)[0].id()}else{var toId=to.id()}return cost[id2position[toId]]},pathTo:function(to){var reconstructPathAux=function(predecessor,fromPos,toPos,position2id,acumPath,predEdge){for(;;){acumPath.push(cy.getElementById(position2id[toPos]));acumPath.push(predEdge[toPos]);if(fromPos===toPos){return acumPath}var predPos=predecessor[toPos];if(typeof predPos==="undefined"){return undefined}toPos=predPos}};if(is.string(to)){var toId=cy.filter(to)[0].id()}else{var toId=to.id()}var path=[];var res=reconstructPathAux(predecessor,id2position[source.id()],id2position[toId],position2id,path,predEdge);if(res!=null){res.reverse()}return eles.spawn(res)},hasNegativeWeightCycle:false};return res}};module.exports=elesfn},{"../../is":117,"../../util":134}],39:[function(require,module,exports){"use strict";var is=require("../../is");var Heap=require("../../heap");var elesfn={betweennessCentrality:function(options){options=options||{};var weighted,weightFn;if(is.fn(options.weight)){weightFn=options.weight;weighted=true}else{weighted=false}var directed=options.directed!=null?options.directed:false;var cy=this._private.cy;var V=this.nodes();var A={};var _C={};var max=0;var C={set:function(key,val){_C[key]=val;if(val>max){max=val}},get:function(key){return _C[key]}};for(var i=0;i<V.length;i++){var v=V[i];var vid=v.id();if(directed){A[vid]=v.outgoers().nodes()}else{A[vid]=v.openNeighborhood().nodes()}C.set(vid,0)}for(var s=0;s<V.length;s++){var sid=V[s].id();var S=[];var P={};var g={};var d={};var Q=new Heap(function(a,b){return d[a]-d[b]});for(var i=0;i<V.length;i++){var vid=V[i].id();P[vid]=[];g[vid]=0;d[vid]=Infinity}g[sid]=1;d[sid]=0;Q.push(sid);while(!Q.empty()){var v=Q.pop();S.push(v);if(weighted){for(var j=0;j<A[v].length;j++){var w=A[v][j];var vEle=cy.getElementById(v);var edge;if(vEle.edgesTo(w).length>0){edge=vEle.edgesTo(w)[0]}else{edge=w.edgesTo(vEle)[0]}var edgeWeight=weightFn.apply(edge,[edge]);w=w.id();if(d[w]>d[v]+edgeWeight){d[w]=d[v]+edgeWeight;if(Q.nodes.indexOf(w)<0){Q.push(w)}else{Q.updateItem(w)}g[w]=0;P[w]=[]}if(d[w]==d[v]+edgeWeight){g[w]=g[w]+g[v];P[w].push(v)}}}else{for(var j=0;j<A[v].length;j++){var w=A[v][j].id();if(d[w]==Infinity){Q.push(w);d[w]=d[v]+1}if(d[w]==d[v]+1){g[w]=g[w]+g[v];P[w].push(v)}}}}var e={};for(var i=0;i<V.length;i++){e[V[i].id()]=0}while(S.length>0){var w=S.pop();for(var j=0;j<P[w].length;j++){var v=P[w][j];e[v]=e[v]+g[v]/g[w]*(1+e[w]);if(w!=V[s].id()){C.set(w,C.get(w)+e[w])}}}}var ret={betweenness:function(node){if(is.string(node)){var node=cy.filter(node).id()}else{var node=node.id()}return C.get(node)},betweennessNormalized:function(node){if(max==0)return 0;if(is.string(node)){var node=cy.filter(node).id()}else{var node=node.id()}return C.get(node)/max}};ret.betweennessNormalised=ret.betweennessNormalized;return ret}};elesfn.bc=elesfn.betweennessCentrality;module.exports=elesfn},{"../../heap":115,"../../is":117}],40:[function(require,module,exports){"use strict";var is=require("../../is");var defineSearch=function(params){params={bfs:params.bfs||!params.dfs,dfs:params.dfs||!params.bfs};return function searchFn(roots,fn,directed){var options;var std;var thisArg;if(is.plainObject(roots)&&!is.elementOrCollection(roots)){options=roots;roots=options.roots||options.root;fn=options.visit;directed=options.directed;std=options.std;thisArg=options.thisArg}directed=arguments.length===2&&!is.fn(fn)?fn:directed;fn=is.fn(fn)?fn:function(){};var cy=this._private.cy;var v=roots=is.string(roots)?this.filter(roots):roots;var Q=[];var connectedNodes=[];var connectedBy={};var id2depth={};var V={};var j=0;var found;var nodes=this.nodes();var edges=this.edges();for(var i=0;i<v.length;i++){if(v[i].isNode()){Q.unshift(v[i]);if(params.bfs){V[v[i].id()]=true;connectedNodes.push(v[i])}id2depth[v[i].id()]=0}}while(Q.length!==0){var v=params.bfs?Q.shift():Q.pop();if(params.dfs){if(V[v.id()]){continue}V[v.id()]=true;connectedNodes.push(v)}var depth=id2depth[v.id()];var prevEdge=connectedBy[v.id()];var prevNode=prevEdge==null?undefined:prevEdge.connectedNodes().not(v)[0];var ret;if(std){ret=fn.call(thisArg,v,prevEdge,prevNode,j++,depth)}else{ret=fn.call(v,j++,depth,v,prevEdge,prevNode)}if(ret===true){found=v;break}if(ret===false){break}var vwEdges=v.connectedEdges(directed?function(){return this.data("source")===v.id()}:undefined).intersect(edges);for(var i=0;i<vwEdges.length;i++){var e=vwEdges[i];var w=e.connectedNodes(function(){return this.id()!==v.id()}).intersect(nodes);if(w.length!==0&&!V[w.id()]){w=w[0];Q.push(w);if(params.bfs){V[w.id()]=true;connectedNodes.push(w)}connectedBy[w.id()]=e;id2depth[w.id()]=id2depth[v.id()]+1}}}var connectedEles=[];for(var i=0;i<connectedNodes.length;i++){var node=connectedNodes[i];var edge=connectedBy[node.id()];if(edge){connectedEles.push(edge)}connectedEles.push(node)}return{path:cy.collection(connectedEles,{unique:true}),found:cy.collection(found)}}};var elesfn={breadthFirstSearch:defineSearch({bfs:true}),depthFirstSearch:defineSearch({dfs:true})};elesfn.bfs=elesfn.breadthFirstSearch;elesfn.dfs=elesfn.depthFirstSearch;module.exports=elesfn},{"../../is":117}],41:[function(require,module,exports){"use strict";var is=require("../../is");var elesfn={closenessCentralityNormalized:function(options){options=options||{};var cy=this.cy();var harmonic=options.harmonic;if(harmonic===undefined){harmonic=true}var closenesses={};var maxCloseness=0;var nodes=this.nodes();var fw=this.floydWarshall({weight:options.weight,directed:options.directed});for(var i=0;i<nodes.length;i++){var currCloseness=0;for(var j=0;j<nodes.length;j++){if(i!=j){var d=fw.distance(nodes[i],nodes[j]);if(harmonic){currCloseness+=1/d}else{currCloseness+=d}}}if(!harmonic){currCloseness=1/currCloseness}if(maxCloseness<currCloseness){maxCloseness=currCloseness}closenesses[nodes[i].id()]=currCloseness}return{closeness:function(node){if(maxCloseness==0){return 0}if(is.string(node)){var node=cy.filter(node)[0].id()}else{var node=node.id()}return closenesses[node]/maxCloseness}}},closenessCentrality:function(options){options=options||{};if(options.root!=null){if(is.string(options.root)){var root=this.filter(options.root)[0]}else{var root=options.root[0]}}else{return undefined}if(options.weight!=null&&is.fn(options.weight)){var weight=options.weight}else{var weight=function(){return 1}}if(options.directed!=null&&is.bool(options.directed)){var directed=options.directed}else{var directed=false}var harmonic=options.harmonic;if(harmonic===undefined){harmonic=true}var dijkstra=this.dijkstra({root:root,weight:weight,directed:directed});var totalDistance=0;var nodes=this.nodes();for(var i=0;i<nodes.length;i++){if(nodes[i].id()!=root.id()){var d=dijkstra.distanceTo(nodes[i]);if(harmonic){totalDistance+=1/d}else{totalDistance+=d}}}return harmonic?totalDistance:1/totalDistance}};elesfn.cc=elesfn.closenessCentrality;elesfn.ccn=elesfn.closenessCentralityNormalised=elesfn.closenessCentralityNormalized;module.exports=elesfn},{"../../is":117}],42:[function(require,module,exports){"use strict";var is=require("../../is");var util=require("../../util");var elesfn={degreeCentralityNormalized:function(options){options=options||{};var cy=this.cy();if(options.directed!=null){var directed=options.directed}else{var directed=false}var nodes=this.nodes();var numNodes=nodes.length;if(!directed){var degrees={};var maxDegree=0;for(var i=0;i<numNodes;i++){var node=nodes[i];var currDegree=this.degreeCentrality(util.extend({},options,{root:node}));if(maxDegree<currDegree.degree)maxDegree=currDegree.degree;degrees[node.id()]=currDegree.degree}return{degree:function(node){if(maxDegree==0)return 0;if(is.string(node)){var node=cy.filter(node)[0].id()}else{var node=node.id()}return degrees[node]/maxDegree}}}else{var indegrees={};var outdegrees={};var maxIndegree=0;var maxOutdegree=0;for(var i=0;i<numNodes;i++){var node=nodes[i];var currDegree=this.degreeCentrality(util.extend({},options,{root:node}));if(maxIndegree<currDegree.indegree)maxIndegree=currDegree.indegree;if(maxOutdegree<currDegree.outdegree)maxOutdegree=currDegree.outdegree;indegrees[node.id()]=currDegree.indegree;outdegrees[node.id()]=currDegree.outdegree}return{indegree:function(node){if(maxIndegree==0)return 0;if(is.string(node)){var node=cy.filter(node)[0].id()}else{var node=node.id()}return indegrees[node]/maxIndegree},outdegree:function(node){if(maxOutdegree==0)return 0;if(is.string(node)){var node=cy.filter(node)[0].id()}else{var node=node.id()}return outdegrees[node]/maxOutdegree}}}},degreeCentrality:function(options){options=options||{};var callingEles=this;if(options!=null&&options.root!=null){var root=is.string(options.root)?this.filter(options.root)[0]:options.root[0]}else{return undefined}if(options.weight!=null&&is.fn(options.weight)){var weightFn=options.weight}else{var weightFn=function(e){return 1}}if(options.directed!=null){var directed=options.directed}else{var directed=false}if(options.alpha!=null&&is.number(options.alpha)){var alpha=options.alpha}else{alpha=0}if(!directed){var connEdges=root.connectedEdges().intersection(callingEles);var k=connEdges.length;var s=0;for(var i=0;i<connEdges.length;i++){var edge=connEdges[i];s+=weightFn.apply(edge,[edge])}return{degree:Math.pow(k,1-alpha)*Math.pow(s,alpha)}}else{var incoming=root.connectedEdges('edge[target = "'+root.id()+'"]').intersection(callingEles);var outgoing=root.connectedEdges('edge[source = "'+root.id()+'"]').intersection(callingEles);var k_in=incoming.length;var k_out=outgoing.length;var s_in=0;var s_out=0;for(var i=0;i<incoming.length;i++){var edge=incoming[i];s_in+=weightFn.apply(edge,[edge])}for(var i=0;i<outgoing.length;i++){var edge=outgoing[i];s_out+=weightFn.apply(edge,[edge])}return{indegree:Math.pow(k_in,1-alpha)*Math.pow(s_in,alpha),outdegree:Math.pow(k_out,1-alpha)*Math.pow(s_out,alpha)}}}};elesfn.dc=elesfn.degreeCentrality;elesfn.dcn=elesfn.degreeCentralityNormalised=elesfn.degreeCentralityNormalized;module.exports=elesfn},{"../../is":117,"../../util":134}],43:[function(require,module,exports){"use strict";var is=require("../../is");var Heap=require("../../heap");var elesfn={dijkstra:function(root,weightFn,directed){var options;if(is.plainObject(root)&&!is.elementOrCollection(root)){options=root;root=options.root;weightFn=options.weight;directed=options.directed}var cy=this._private.cy;weightFn=is.fn(weightFn)?weightFn:function(){return 1};var source=is.string(root)?this.filter(root)[0]:root[0];var dist={};var prev={};var knownDist={};var edges=this.edges().filter(function(){return!this.isLoop()});var nodes=this.nodes();var getDist=function(node){return dist[node.id()]};var setDist=function(node,d){dist[node.id()]=d;Q.updateItem(node)};var Q=new Heap(function(a,b){return getDist(a)-getDist(b)});for(var i=0;i<nodes.length;i++){var node=nodes[i];dist[node.id()]=node.same(source)?0:Infinity;Q.push(node)}var distBetween=function(u,v){var uvs=(directed?u.edgesTo(v):u.edgesWith(v)).intersect(edges);var smallestDistance=Infinity;var smallestEdge;for(var i=0;i<uvs.length;i++){var edge=uvs[i];var weight=weightFn.apply(edge,[edge]);if(weight<smallestDistance||!smallestEdge){smallestDistance=weight;smallestEdge=edge}}return{edge:smallestEdge,dist:smallestDistance}};while(Q.size()>0){var u=Q.pop();var smalletsDist=getDist(u);var uid=u.id();knownDist[uid]=smalletsDist;if(smalletsDist===Math.Infinite){break}var neighbors=u.neighborhood().intersect(nodes);for(var i=0;i<neighbors.length;i++){var v=neighbors[i];var vid=v.id();var vDist=distBetween(u,v);var alt=smalletsDist+vDist.dist;if(alt<getDist(v)){setDist(v,alt);prev[vid]={node:u,edge:vDist.edge}}}}return{distanceTo:function(node){var target=is.string(node)?nodes.filter(node)[0]:node[0];return knownDist[target.id()]},pathTo:function(node){var target=is.string(node)?nodes.filter(node)[0]:node[0];var S=[];var u=target;if(target.length>0){S.unshift(target);while(prev[u.id()]){var p=prev[u.id()];S.unshift(p.edge);S.unshift(p.node);u=p.node}}return cy.collection(S)}}}};module.exports=elesfn},{"../../heap":115,"../../is":117}],44:[function(require,module,exports){"use strict";var is=require("../../is");var elesfn={floydWarshall:function(options){options=options||{};var cy=this.cy();if(options.weight!=null&&is.fn(options.weight)){var weightFn=options.weight}else{var weightFn=function(e){return 1}}if(options.directed!=null){var directed=options.directed}else{var directed=false}var edges=this.edges().stdFilter(function(e){return!e.isLoop()});var nodes=this.nodes();var numNodes=nodes.length;var id2position={};for(var i=0;i<numNodes;i++){id2position[nodes[i].id()]=i}var dist=[];for(var i=0;i<numNodes;i++){var newRow=new Array(numNodes);for(var j=0;j<numNodes;j++){if(i==j){newRow[j]=0}else{newRow[j]=Infinity}}dist.push(newRow)}var next=[];var edgeNext=[];var initMatrix=function(next){for(var i=0;i<numNodes;i++){var newRow=new Array(numNodes);for(var j=0;j<numNodes;j++){newRow[j]=undefined}next.push(newRow)}};initMatrix(next);initMatrix(edgeNext);for(var i=0;i<edges.length;i++){var sourceIndex=id2position[edges[i].source().id()];var targetIndex=id2position[edges[i].target().id()];var weight=weightFn.apply(edges[i],[edges[i]]);if(dist[sourceIndex][targetIndex]>weight){dist[sourceIndex][targetIndex]=weight;next[sourceIndex][targetIndex]=targetIndex;edgeNext[sourceIndex][targetIndex]=edges[i]}}if(!directed){for(var i=0;i<edges.length;i++){var sourceIndex=id2position[edges[i].target().id()];var targetIndex=id2position[edges[i].source().id()];var weight=weightFn.apply(edges[i],[edges[i]]);if(dist[sourceIndex][targetIndex]>weight){dist[sourceIndex][targetIndex]=weight;next[sourceIndex][targetIndex]=targetIndex;edgeNext[sourceIndex][targetIndex]=edges[i]}}}for(var k=0;k<numNodes;k++){for(var i=0;i<numNodes;i++){for(var j=0;j<numNodes;j++){if(dist[i][k]+dist[k][j]<dist[i][j]){dist[i][j]=dist[i][k]+dist[k][j];next[i][j]=next[i][k]}}}}var position2id=[];for(var i=0;i<numNodes;i++){position2id.push(nodes[i].id())}var res={distance:function(from,to){if(is.string(from)){var fromId=cy.filter(from)[0].id()}else{var fromId=from.id()}if(is.string(to)){var toId=cy.filter(to)[0].id()}else{var toId=to.id()}return dist[id2position[fromId]][id2position[toId]]},path:function(from,to){var reconstructPathAux=function(from,to,next,position2id,edgeNext){if(from===to){return cy.getElementById(position2id[from])}if(next[from][to]===undefined){return undefined}var path=[cy.getElementById(position2id[from])];var prev=from;while(from!==to){prev=from;from=next[from][to];var edge=edgeNext[prev][from];path.push(edge);path.push(cy.getElementById(position2id[from]))}return path};if(is.string(from)){var fromId=cy.filter(from)[0].id()}else{var fromId=from.id()}if(is.string(to)){var toId=cy.filter(to)[0].id()}else{var toId=to.id()}var pathArr=reconstructPathAux(id2position[fromId],id2position[toId],next,position2id,edgeNext);return cy.collection(pathArr)}};return res}};module.exports=elesfn},{"../../is":117}],45:[function(require,module,exports){"use strict";var util=require("../../util");var elesfn={};[require("./bfs-dfs"),require("./dijkstra"),require("./kruskal"),require("./a-star"),require("./floyd-warshall"),require("./bellman-ford"),require("./kerger-stein"),require("./page-rank"),require("./degree-centrality"),require("./closeness-centrality"),require("./betweenness-centrality")].forEach(function(props){util.extend(elesfn,props)});module.exports=elesfn},{"../../util":134,"./a-star":37,"./bellman-ford":38,"./betweenness-centrality":39,"./bfs-dfs":40,"./closeness-centrality":41,"./degree-centrality":42,"./dijkstra":43,"./floyd-warshall":44,"./kerger-stein":46,"./kruskal":47,"./page-rank":48}],46:[function(require,module,exports){"use strict";var util=require("../../util");var elesfn={kargerStein:function(options){var eles=this;options=options||{};var colapse=function(edgeIndex,nodeMap,remainingEdges){var edgeInfo=remainingEdges[edgeIndex];var sourceIn=edgeInfo[1];var targetIn=edgeInfo[2];var partition1=nodeMap[sourceIn];var partition2=nodeMap[targetIn];var newEdges=remainingEdges.filter(function(edge){if(nodeMap[edge[1]]===partition1&&nodeMap[edge[2]]===partition2){return false}if(nodeMap[edge[1]]===partition2&&nodeMap[edge[2]]===partition1){return false}return true});for(var i=0;i<newEdges.length;i++){var edge=newEdges[i];if(edge[1]===partition2){newEdges[i]=edge.slice(0);newEdges[i][1]=partition1}else if(edge[2]===partition2){newEdges[i]=edge.slice(0);newEdges[i][2]=partition1}}for(var i=0;i<nodeMap.length;i++){if(nodeMap[i]===partition2){nodeMap[i]=partition1}}return newEdges};var contractUntil=function(metaNodeMap,remainingEdges,size,sizeLimit){if(size<=sizeLimit){return remainingEdges}var edgeIndex=Math.floor(Math.random()*remainingEdges.length);var newEdges=colapse(edgeIndex,metaNodeMap,remainingEdges);return contractUntil(metaNodeMap,newEdges,size-1,sizeLimit)};var cy=this._private.cy;var edges=this.edges().stdFilter(function(e){return!e.isLoop()});var nodes=this.nodes();var numNodes=nodes.length;var numEdges=edges.length;var numIter=Math.ceil(Math.pow(Math.log(numNodes)/Math.LN2,2));var stopSize=Math.floor(numNodes/Math.sqrt(2));if(numNodes<2){util.error("At least 2 nodes are required for Karger-Stein algorithm");return undefined}var id2position={};for(var i=0;i<numNodes;i++){id2position[nodes[i].id()]=i}var edgeIndexes=[];for(var i=0;i<numEdges;i++){var e=edges[i];edgeIndexes.push([i,id2position[e.source().id()],id2position[e.target().id()]])}var minCutSize=Infinity;var minCut;var originalMetaNode=[];for(var i=0;i<numNodes;i++){originalMetaNode.push(i)}for(var iter=0;iter<=numIter;iter++){var metaNodeMap=originalMetaNode.slice(0);var edgesState=contractUntil(metaNodeMap,edgeIndexes,numNodes,stopSize);var metaNodeMap2=metaNodeMap.slice(0);var res1=contractUntil(metaNodeMap,edgesState,stopSize,2);var res2=contractUntil(metaNodeMap2,edgesState,stopSize,2);if(res1.length<=res2.length&&res1.length<minCutSize){minCutSize=res1.length;minCut=[res1,metaNodeMap]}else if(res2.length<=res1.length&&res2.length<minCutSize){minCutSize=res2.length;minCut=[res2,metaNodeMap2]}}var resEdges=minCut[0].map(function(e){return edges[e[0]]});var partition1=[];var partition2=[];var witnessNodePartition=minCut[1][0];for(var i=0;i<minCut[1].length;i++){var partitionId=minCut[1][i];if(partitionId===witnessNodePartition){partition1.push(nodes[i])}else{partition2.push(nodes[i])}}var ret={cut:eles.spawn(cy,resEdges),partition1:eles.spawn(partition1),partition2:eles.spawn(partition2)};return ret}};module.exports=elesfn},{"../../util":134}],47:[function(require,module,exports){"use strict";var is=require("../../is");var elesfn={kruskal:function(weightFn){var cy=this.cy();weightFn=is.fn(weightFn)?weightFn:function(){return 1};function findSet(ele){for(var i=0;i<forest.length;i++){var eles=forest[i];if(eles.anySame(ele)){return{eles:eles,index:i}}}}var A=cy.collection(cy,[]);var forest=[];var nodes=this.nodes();for(var i=0;i<nodes.length;i++){forest.push(nodes[i].collection())}var edges=this.edges();var S=edges.toArray().sort(function(a,b){var weightA=weightFn.call(a,a);var weightB=weightFn.call(b,b);return weightA-weightB});for(var i=0;i<S.length;i++){var edge=S[i];var u=edge.source()[0];var v=edge.target()[0];var setU=findSet(u);var setV=findSet(v);if(setU.index!==setV.index){A=A.add(edge);forest[setU.index]=setU.eles.add(setV.eles);forest.splice(setV.index,1)}}return nodes.add(A)}};module.exports=elesfn},{"../../is":117}],48:[function(require,module,exports){"use strict";var is=require("../../is");var elesfn={pageRank:function(options){options=options||{};var normalizeVector=function(vector){var length=vector.length;var total=0;for(var i=0;i<length;i++){total+=vector[i]}for(var i=0;i<length;i++){vector[i]=vector[i]/total}};if(options!=null&&options.dampingFactor!=null){var dampingFactor=options.dampingFactor}else{var dampingFactor=.8}if(options!=null&&options.precision!=null){var epsilon=options.precision}else{var epsilon=1e-6}if(options!=null&&options.iterations!=null){var numIter=options.iterations}else{var numIter=200}if(options!=null&&options.weight!=null&&is.fn(options.weight)){var weightFn=options.weight}else{var weightFn=function(e){return 1}}var cy=this._private.cy;var edges=this.edges().stdFilter(function(e){return!e.isLoop()});var nodes=this.nodes();var numNodes=nodes.length;var numEdges=edges.length;var id2position={};for(var i=0;i<numNodes;i++){id2position[nodes[i].id()]=i}var matrix=[];var columnSum=[];var additionalProb=(1-dampingFactor)/numNodes;for(var i=0;i<numNodes;i++){var newRow=[];for(var j=0;j<numNodes;j++){newRow.push(0)}matrix.push(newRow);columnSum.push(0)}for(var i=0;i<numEdges;i++){var edge=edges[i];var s=id2position[edge.source().id()];var t=id2position[edge.target().id()];var w=weightFn.apply(edge,[edge]);matrix[t][s]+=w;columnSum[s]+=w}var p=1/numNodes+additionalProb;for(var j=0;j<numNodes;j++){if(columnSum[j]===0){for(var i=0;i<numNodes;i++){matrix[i][j]=p}}else{for(var i=0;i<numNodes;i++){matrix[i][j]=matrix[i][j]/columnSum[j]+additionalProb}}}var eigenvector=[];var nullVector=[];var previous;for(var i=0;i<numNodes;i++){eigenvector.push(1);nullVector.push(0)}for(var iter=0;iter<numIter;iter++){var temp=nullVector.slice(0);for(var i=0;i<numNodes;i++){for(var j=0;j<numNodes;j++){temp[i]+=matrix[i][j]*eigenvector[j]}}normalizeVector(temp);previous=eigenvector;eigenvector=temp;var diff=0;for(var i=0;i<numNodes;i++){diff+=Math.pow(previous[i]-eigenvector[i],2)}if(diff<epsilon){break}}var res={rank:function(node){if(is.string(node)){var nodeId=cy.filter(node)[0].id()}else{var nodeId=node.id()}return eigenvector[id2position[nodeId]]}};return res}};module.exports=elesfn},{"../../is":117}],49:[function(require,module,exports){"use strict";var define=require("../define");var elesfn={animate:define.animate(),animation:define.animation(),animated:define.animated(),clearQueue:define.clearQueue(),delay:define.delay(),delayAnimation:define.delayAnimation(),stop:define.stop()};module.exports=elesfn},{"../define":78}],50:[function(require,module,exports){"use strict";var util=require("../util");var elesfn={classes:function(classes){classes=classes.match(/\S+/g)||[];var self=this;var changed=[];var classesMap={};for(var i=0;i<classes.length;i++){var cls=classes[i];classesMap[cls]=true}for(var j=0;j<self.length;j++){var ele=self[j];var _p=ele._private;var eleClasses=_p.classes;var changedEle=false;for(var i=0;i<classes.length;i++){var cls=classes[i];var eleHasClass=eleClasses[cls];if(!eleHasClass){changedEle=true;break}}if(!changedEle){var classes=Object.keys(eleClasses);for(var i=0;i<classes.length;i++){var eleCls=classes[i];var eleHasClass=eleClasses[eleCls];var specdClass=classesMap[eleCls];if(eleHasClass&&!specdClass){changedEle=true;break}}}if(changedEle){_p.classes=util.copy(classesMap);changed.push(ele)}}if(changed.length>0){this.spawn(changed).updateStyle().trigger("class")}return self},addClass:function(classes){return this.toggleClass(classes,true)},hasClass:function(className){var ele=this[0];return ele!=null&&ele._private.classes[className]?true:false},toggleClass:function(classesStr,toggle){var classes=classesStr.match(/\S+/g)||[];var self=this;var changed=[];for(var i=0,il=self.length;i<il;i++){var ele=self[i];var changedEle=false;for(var j=0;j<classes.length;j++){var cls=classes[j];var eleClasses=ele._private.classes;var hasClass=eleClasses[cls];var shouldAdd=toggle||toggle===undefined&&!hasClass;if(shouldAdd){eleClasses[cls]=true;if(!hasClass&&!changedEle){changed.push(ele);changedEle=true}}else{eleClasses[cls]=false;if(hasClass&&!changedEle){changed.push(ele);changedEle=true}}}}if(changed.length>0){this.spawn(changed).updateStyle().trigger("class")}return self},removeClass:function(classes){return this.toggleClass(classes,false)},flashClass:function(classes,duration){var self=this;if(duration==null){duration=250}else if(duration===0){return self}self.addClass(classes);setTimeout(function(){self.removeClass(classes)},duration);return self}};module.exports=elesfn},{"../util":134}],51:[function(require,module,exports){"use strict";var elesfn={allAre:function(selector){return this.filter(selector).length===this.length},is:function(selector){return this.filter(selector).length>0},some:function(fn,thisArg){for(var i=0;i<this.length;i++){var ret=!thisArg?fn(this[i],i,this):fn.apply(thisArg,[this[i],i,this]);if(ret){return true}}return false},every:function(fn,thisArg){for(var i=0;i<this.length;i++){var ret=!thisArg?fn(this[i],i,this):fn.apply(thisArg,[this[i],i,this]);if(!ret){return false}}return true},same:function(collection){collection=this.cy().collection(collection);if(this.length!==collection.length){return false}return this.intersect(collection).length===this.length},anySame:function(collection){collection=this.cy().collection(collection);return this.intersect(collection).length>0},allAreNeighbors:function(collection){collection=this.cy().collection(collection);return this.neighborhood().intersect(collection).length===collection.length}};elesfn.allAreNeighbours=elesfn.allAreNeighbors;module.exports=elesfn},{}],52:[function(require,module,exports){"use strict";var elesfn={parent:function(selector){var parents=[];var cy=this._private.cy;for(var i=0;i<this.length;i++){var ele=this[i];var parent=cy.getElementById(ele._private.data.parent);if(parent.size()>0){parents.push(parent)}}return this.spawn(parents,{unique:true}).filter(selector)},parents:function(selector){var parents=[];var eles=this.parent();while(eles.nonempty()){for(var i=0;i<eles.length;i++){var ele=eles[i];parents.push(ele)}eles=eles.parent()}return this.spawn(parents,{unique:true}).filter(selector)},commonAncestors:function(selector){var ancestors;for(var i=0;i<this.length;i++){var ele=this[i];var parents=ele.parents();ancestors=ancestors||parents;ancestors=ancestors.intersect(parents)}return ancestors.filter(selector)},orphans:function(selector){return this.stdFilter(function(ele){return ele.isNode()&&ele.parent().empty()}).filter(selector)},nonorphans:function(selector){return this.stdFilter(function(ele){return ele.isNode()&&ele.parent().nonempty()}).filter(selector)},children:function(selector){var children=[];for(var i=0;i<this.length;i++){var ele=this[i];children=children.concat(ele._private.children)}return this.spawn(children,{unique:true}).filter(selector)},siblings:function(selector){return this.parent().children().not(this).filter(selector)},isParent:function(){var ele=this[0];if(ele){return ele._private.children.length!==0}},isChild:function(){var ele=this[0];if(ele){return ele._private.data.parent!==undefined&&ele.parent().length!==0}},descendants:function(selector){var elements=[];function add(eles){for(var i=0;i<eles.length;i++){var ele=eles[i];elements.push(ele);if(ele.children().nonempty()){add(ele.children())}}}add(this.children());return this.spawn(elements,{unique:true}).filter(selector)}};elesfn.ancestors=elesfn.parents;module.exports=elesfn},{}],53:[function(require,module,exports){"use strict";var define=require("../define");var fn,elesfn;fn=elesfn={data:define.data({field:"data",bindingEvent:"data",allowBinding:true,allowSetting:true,settingEvent:"data",settingTriggersEvent:true,triggerFnName:"trigger",allowGetting:true,immutableKeys:{id:true,source:true,target:true,parent:true},updateStyle:true}),removeData:define.removeData({field:"data",event:"data",triggerFnName:"trigger",triggerEvent:true,immutableKeys:{id:true,source:true,target:true,parent:true},updateStyle:true}),scratch:define.data({field:"scratch",bindingEvent:"scratch",allowBinding:true,allowSetting:true,settingEvent:"scratch",settingTriggersEvent:true,triggerFnName:"trigger",allowGetting:true,updateStyle:true}),removeScratch:define.removeData({field:"scratch",event:"scratch",triggerFnName:"trigger",triggerEvent:true,updateStyle:true}),rscratch:define.data({field:"rscratch",allowBinding:false,allowSetting:true,settingTriggersEvent:false,allowGetting:true}),removeRscratch:define.removeData({field:"rscratch",triggerEvent:false}),id:function(){var ele=this[0];if(ele){return ele._private.data.id}}};fn.attr=fn.data;fn.removeAttr=fn.removeData;module.exports=elesfn},{"../define":78}],54:[function(require,module,exports){"use strict";var util=require("../util");var elesfn={};function defineDegreeFunction(callback){return function(includeLoops){var self=this;if(includeLoops===undefined){includeLoops=true}if(self.length===0){return}if(self.isNode()&&!self.removed()){var degree=0;var node=self[0];var connectedEdges=node._private.edges;for(var i=0;i<connectedEdges.length;i++){var edge=connectedEdges[i];if(!includeLoops&&edge.isLoop()){continue}degree+=callback(node,edge)}return degree}else{return}}}util.extend(elesfn,{degree:defineDegreeFunction(function(node,edge){if(edge.source().same(edge.target())){return 2}else{return 1}}),indegree:defineDegreeFunction(function(node,edge){if(edge.target().same(node)){return 1}else{return 0}}),outdegree:defineDegreeFunction(function(node,edge){if(edge.source().same(node)){return 1}else{return 0}})});function defineDegreeBoundsFunction(degreeFn,callback){return function(includeLoops){var ret;var nodes=this.nodes();for(var i=0;i<nodes.length;i++){var ele=nodes[i];var degree=ele[degreeFn](includeLoops);if(degree!==undefined&&(ret===undefined||callback(degree,ret))){ret=degree}}return ret}}util.extend(elesfn,{minDegree:defineDegreeBoundsFunction("degree",function(degree,min){return degree<min}),maxDegree:defineDegreeBoundsFunction("degree",function(degree,max){return degree>max}),minIndegree:defineDegreeBoundsFunction("indegree",function(degree,min){return degree<min}),maxIndegree:defineDegreeBoundsFunction("indegree",function(degree,max){return degree>max}),minOutdegree:defineDegreeBoundsFunction("outdegree",function(degree,min){return degree<min}),maxOutdegree:defineDegreeBoundsFunction("outdegree",function(degree,max){return degree>max})});util.extend(elesfn,{totalDegree:function(includeLoops){var total=0;var nodes=this.nodes();for(var i=0;i<nodes.length;i++){total+=nodes[i].degree(includeLoops)}return total}});module.exports=elesfn},{"../util":134}],55:[function(require,module,exports){"use strict";var define=require("../define");var is=require("../is");var util=require("../util");var math=require("../math");var fn,elesfn;fn=elesfn={position:define.data({field:"position",bindingEvent:"position",allowBinding:true,allowSetting:true,settingEvent:"position",settingTriggersEvent:true,triggerFnName:"rtrigger",allowGetting:true,validKeys:["x","y"],onSet:function(eles){var updatedEles=eles.updateCompoundBounds();updatedEles.rtrigger("position")},canSet:function(ele){return!ele.locked()&&!ele.isParent()}}),silentPosition:define.data({field:"position",bindingEvent:"position",allowBinding:false,allowSetting:true,settingEvent:"position",settingTriggersEvent:false,triggerFnName:"trigger",allowGetting:true,validKeys:["x","y"],onSet:function(eles){eles.updateCompoundBounds()},canSet:function(ele){return!ele.locked()&&!ele.isParent()}}),positions:function(pos,silent){if(is.plainObject(pos)){this.position(pos)}else if(is.fn(pos)){var fn=pos;for(var i=0;i<this.length;i++){var ele=this[i];var pos=fn.apply(ele,[i,ele]);if(pos&&!ele.locked()&&!ele.isParent()){var elePos=ele._private.position;elePos.x=pos.x;elePos.y=pos.y}}var updatedEles=this.updateCompoundBounds();var toTrigger=updatedEles.length>0?this.add(updatedEles):this;if(silent){toTrigger.trigger("position")}else{toTrigger.rtrigger("position")}}return this},silentPositions:function(pos){return this.positions(pos,true)},renderedPosition:function(dim,val){var ele=this[0];var cy=this.cy();var zoom=cy.zoom();var pan=cy.pan();var rpos=is.plainObject(dim)?dim:undefined;var setting=rpos!==undefined||val!==undefined&&is.string(dim);if(ele&&ele.isNode()){if(setting){for(var i=0;i<this.length;i++){var ele=this[i];if(val!==undefined){ele._private.position[dim]=(val-pan[dim])/zoom}else if(rpos!==undefined){ele._private.position={x:(rpos.x-pan.x)/zoom,y:(rpos.y-pan.y)/zoom}}}this.rtrigger("position")}else{var pos=ele._private.position;rpos={x:pos.x*zoom+pan.x,y:pos.y*zoom+pan.y};if(dim===undefined){return rpos}else{return rpos[dim]}}}else if(!setting){return undefined}return this},relativePosition:function(dim,val){var ele=this[0];var cy=this.cy();var ppos=is.plainObject(dim)?dim:undefined;var setting=ppos!==undefined||val!==undefined&&is.string(dim);var hasCompoundNodes=cy.hasCompoundNodes();if(ele&&ele.isNode()){if(setting){for(var i=0;i<this.length;i++){var ele=this[i];var parent=hasCompoundNodes?ele.parent():null;var hasParent=parent&&parent.length>0;var relativeToParent=hasParent;if(hasParent){parent=parent[0]}var origin=relativeToParent?parent._private.position:{x:0,y:0};if(val!==undefined){ele._private.position[dim]=val+origin[dim]}else if(ppos!==undefined){ele._private.position={x:ppos.x+origin.x,y:ppos.y+origin.y}}}this.rtrigger("position")}else{var pos=ele._private.position;var parent=hasCompoundNodes?ele.parent():null;var hasParent=parent&&parent.length>0;var relativeToParent=hasParent;if(hasParent){parent=parent[0]}var origin=relativeToParent?parent._private.position:{x:0,y:0};ppos={x:pos.x-origin.x,y:pos.y-origin.y};if(dim===undefined){return ppos}else{return ppos[dim]}}}else if(!setting){return undefined}return this},renderedBoundingBox:function(options){var bb=this.boundingBox(options);var cy=this.cy();var zoom=cy.zoom();var pan=cy.pan();var x1=bb.x1*zoom+pan.x;var x2=bb.x2*zoom+pan.x;var y1=bb.y1*zoom+pan.y;var y2=bb.y2*zoom+pan.y;return{x1:x1,x2:x2,y1:y1,y2:y2,w:x2-x1,h:y2-y1}},updateCompoundBounds:function(){var cy=this.cy();if(!cy.styleEnabled()||!cy.hasCompoundNodes()){return cy.collection()}var updated=[];function update(parent){if(!parent.isParent()){return}var _p=parent._private;var children=parent.children();var includeLabels=parent.pstyle("compound-sizing-wrt-labels").value==="include";var bb=children.boundingBox({includeLabels:includeLabels,includeShadows:false,includeOverlays:false,useCache:false});var padding={top:parent.pstyle("padding-top").pfValue,bottom:parent.pstyle("padding-bottom").pfValue,left:parent.pstyle("padding-left").pfValue,right:parent.pstyle("padding-right").pfValue};var pos=_p.position;_p.autoWidth=bb.w;pos.x=(bb.x1+bb.x2-padding.left+padding.right)/2;_p.autoHeight=bb.h;pos.y=(bb.y1+bb.y2-padding.top+padding.bottom)/2;updated.push(parent)}var eles=this;while(eles.nonempty()){for(var i=0;i<eles.length;i++){var ele=eles[i];update(ele)}eles=eles.parent()}return this.spawn(updated)}};var noninf=function(x){if(x===Infinity||x===-Infinity){return 0}return x};var updateBounds=function(b,x1,y1,x2,y2){if(x2-x1===0||y2-y1===0){return}b.x1=x1<b.x1?x1:b.x1;b.x2=x2>b.x2?x2:b.x2;b.y1=y1<b.y1?y1:b.y1;b.y2=y2>b.y2?y2:b.y2};var updateBoundsFromBox=function(b,b2){return updateBounds(b,b2.x1,b2.y1,b2.x2,b2.y2)};var prefixedProperty=function(obj,field,prefix){return util.getPrefixedProperty(obj,field,prefix)};var updateBoundsFromArrow=function(bounds,ele,prefix,options){var _p=ele._private;var rstyle=_p.rstyle;var halfArW=rstyle.arrowWidth/2;var arrowType=ele.pstyle(prefix+"-arrow-shape").value;var x;var y;if(arrowType!=="none"){if(prefix==="source"){x=rstyle.srcX;y=rstyle.srcY}else if(prefix==="target"){x=rstyle.tgtX;y=rstyle.tgtY}else{x=rstyle.midX;y=rstyle.midY}updateBounds(bounds,x-halfArW,y-halfArW,x+halfArW,y+halfArW)}};var updateBoundsFromLabel=function(bounds,ele,prefix,options){var prefixDash;if(prefix){prefixDash=prefix+"-"}else{prefixDash=""}var _p=ele._private;var rstyle=_p.rstyle;var label=ele.pstyle(prefixDash+"label").strValue;if(label){var halign=ele.pstyle("text-halign");var valign=ele.pstyle("text-valign");var labelWidth=prefixedProperty(rstyle,"labelWidth",prefix);var labelHeight=prefixedProperty(rstyle,"labelHeight",prefix);var labelX=prefixedProperty(rstyle,"labelX",prefix);var labelY=prefixedProperty(rstyle,"labelY",prefix);var marginX=ele.pstyle(prefixDash+"text-margin-x").pfValue;var marginY=ele.pstyle(prefixDash+"text-margin-y").pfValue;var isEdge=ele.isEdge();var rotation=ele.pstyle(prefixDash+"text-rotation");var shadowR=ele.pstyle("text-shadow-blur").pfValue/2;var shadowX=ele.pstyle("text-shadow-offset-x").pfValue;var shadowY=ele.pstyle("text-shadow-offset-y").pfValue;var shadowOpacity=ele.pstyle("text-shadow-opacity").value;var outlineWidth=ele.pstyle("text-outline-width").pfValue;var borderWidth=ele.pstyle("text-border-width").pfValue;var halfBorderWidth=borderWidth/2;var lh=labelHeight;var lw=labelWidth;var lw_2=lw/2;var lh_2=lh/2;var lx1,lx2,ly1,ly2;if(isEdge){lx1=labelX-lw_2;lx2=labelX+lw_2;ly1=labelY-lh_2;ly2=labelY+lh_2}else{switch(halign.value){case"left":lx1=labelX-lw;lx2=labelX;break;case"center":lx1=labelX-lw_2;lx2=labelX+lw_2;break;case"right":lx1=labelX;lx2=labelX+lw;break}switch(valign.value){case"top":ly1=labelY-lh;ly2=labelY;break;case"center":ly1=labelY-lh_2;ly2=labelY+lh_2;break;case"bottom":ly1=labelY;ly2=labelY+lh;break}}var isAutorotate=isEdge&&rotation.strValue==="autorotate";var isPfValue=rotation.pfValue!=null&&rotation.pfValue!==0;if(isAutorotate||isPfValue){var theta=isAutorotate?prefixedProperty(_p.rstyle,"labelAngle",prefix):rotation.pfValue;var cos=Math.cos(theta);var sin=Math.sin(theta);var rotate=function(x,y){x=x-labelX;y=y-labelY;return{x:x*cos-y*sin+labelX,y:x*sin+y*cos+labelY}};var px1y1=rotate(lx1,ly1);var px1y2=rotate(lx1,ly2);var px2y1=rotate(lx2,ly1);var px2y2=rotate(lx2,ly2);lx1=Math.min(px1y1.x,px1y2.x,px2y1.x,px2y2.x);lx2=Math.max(px1y1.x,px1y2.x,px2y1.x,px2y2.x);ly1=Math.min(px1y1.y,px1y2.y,px2y1.y,px2y2.y);ly2=Math.max(px1y1.y,px1y2.y,px2y1.y,px2y2.y)}lx1+=marginX-Math.max(outlineWidth,halfBorderWidth);lx2+=marginX+Math.max(outlineWidth,halfBorderWidth);ly1+=marginY-Math.max(outlineWidth,halfBorderWidth);ly2+=marginY+Math.max(outlineWidth,halfBorderWidth);updateBounds(bounds,lx1,ly1,lx2,ly2);if(options.includeShadows&&shadowOpacity>0){lx1+=-shadowR+shadowX;lx2+=+shadowR+shadowX;ly1+=-shadowR+shadowY;ly2+=+shadowR+shadowY;updateBounds(bounds,lx1,ly1,lx2,ly2)}}return bounds};var boundingBoxImpl=function(ele,options){var cy=ele._private.cy;var cy_p=cy._private;var styleEnabled=cy_p.styleEnabled;var bounds={x1:Infinity,y1:Infinity,x2:-Infinity,y2:-Infinity};var _p=ele._private;var display=styleEnabled?ele.pstyle("display").value:"element";var isNode=ele.isNode();var isEdge=ele.isEdge();var ex1,ex2,ey1,ey2,x,y;var displayed=display!=="none";if(displayed){var overlayOpacity=0;var overlayPadding=0;if(styleEnabled&&options.includeOverlays){overlayOpacity=ele.pstyle("overlay-opacity").value;if(overlayOpacity!==0){overlayPadding=ele.pstyle("overlay-padding").value}}var w=0;var wHalf=0;if(styleEnabled){w=ele.pstyle("width").pfValue;wHalf=w/2}if(isNode&&options.includeNodes){var pos=_p.position;x=pos.x;y=pos.y;var w=ele.outerWidth();var halfW=w/2;var h=ele.outerHeight();var halfH=h/2;ex1=x-halfW-overlayPadding;ex2=x+halfW+overlayPadding;ey1=y-halfH-overlayPadding;ey2=y+halfH+overlayPadding;updateBounds(bounds,ex1,ey1,ex2,ey2)}else if(isEdge&&options.includeEdges){var rstyle=_p.rstyle||{};if(styleEnabled){ex1=Math.min(rstyle.srcX,rstyle.midX,rstyle.tgtX);ex2=Math.max(rstyle.srcX,rstyle.midX,rstyle.tgtX);ey1=Math.min(rstyle.srcY,rstyle.midY,rstyle.tgtY);ey2=Math.max(rstyle.srcY,rstyle.midY,rstyle.tgtY);ex1-=wHalf;ex2+=wHalf;ey1-=wHalf;ey2+=wHalf;updateBounds(bounds,ex1,ey1,ex2,ey2)}if(styleEnabled&&ele.pstyle("curve-style").strValue==="haystack"){var hpts=rstyle.haystackPts;ex1=hpts[0].x;ey1=hpts[0].y;ex2=hpts[1].x;ey2=hpts[1].y;if(ex1>ex2){var temp=ex1;ex1=ex2;ex2=temp}if(ey1>ey2){var temp=ey1;ey1=ey2;ey2=temp}updateBounds(bounds,ex1-wHalf,ey1-wHalf,ex2+wHalf,ey2+wHalf)}else{var pts=rstyle.bezierPts||rstyle.linePts||[];for(var j=0;j<pts.length;j++){var pt=pts[j];ex1=pt.x-wHalf;ex2=pt.x+wHalf;ey1=pt.y-wHalf;ey2=pt.y+wHalf;updateBounds(bounds,ex1,ey1,ex2,ey2)}if(pts.length===0){var n1=_p.source;var n1_p=n1._private;var n1pos=n1_p.position;var n2=_p.target;var n2_p=n2._private;var n2pos=n2_p.position;ex1=n1pos.x;ex2=n2pos.x;ey1=n1pos.y;ey2=n2pos.y;if(ex1>ex2){var temp=ex1;ex1=ex2;ex2=temp}if(ey1>ey2){var temp=ey1;ey1=ey2;ey2=temp}ex1-=wHalf;ex2+=wHalf;ey1-=wHalf;ey2+=wHalf;updateBounds(bounds,ex1,ey1,ex2,ey2)}}}if(styleEnabled){ex1=bounds.x1;ex2=bounds.x2;ey1=bounds.y1;ey2=bounds.y2;if(options.includeShadows&&ele.pstyle("shadow-opacity").value>0){var r=ele.pstyle("shadow-blur").pfValue/2;var ox=ele.pstyle("shadow-offset-x").pfValue;var oy=ele.pstyle("shadow-offset-y").pfValue;updateBounds(bounds,ex1-r+ox,ey1-r+oy,ex2+r+ox,ey2+r+oy)}updateBounds(bounds,ex1-overlayPadding,ey1-overlayPadding,ex2+overlayPadding,ey2+overlayPadding)}if(styleEnabled&&options.includeEdges&&isEdge){updateBoundsFromArrow(bounds,ele,"mid-source",options);updateBoundsFromArrow(bounds,ele,"mid-target",options);updateBoundsFromArrow(bounds,ele,"source",options);updateBoundsFromArrow(bounds,ele,"target",options)}if(styleEnabled&&options.includeLabels){updateBoundsFromLabel(bounds,ele,null,options);if(isEdge){updateBoundsFromLabel(bounds,ele,"source",options);updateBoundsFromLabel(bounds,ele,"target",options)}}}bounds.x1=noninf(bounds.x1);bounds.y1=noninf(bounds.y1);bounds.x2=noninf(bounds.x2);bounds.y2=noninf(bounds.y2);bounds.w=noninf(bounds.x2-bounds.x1);bounds.h=noninf(bounds.y2-bounds.y1);if(bounds.w>0&&bounds.h>0&&displayed){math.expandBoundingBox(bounds,1)}return bounds};var tf=function(val){if(val){return"t"}else{return"f"}};var getKey=function(opts){var key="";key+=tf(opts.incudeNodes);key+=tf(opts.includeEdges);key+=tf(opts.includeLabels);key+=tf(opts.includeShadows);key+=tf(opts.includeOverlays);return key};var cachedBoundingBoxImpl=function(ele,opts){var _p=ele._private;var bb;var headless=ele.cy().headless();var key=opts===defBbOpts?defBbOptsKey:getKey(opts);if(!opts.useCache||headless||!_p.bbCache||!_p.bbCache[key]){bb=boundingBoxImpl(ele,opts);if(!headless){_p.bbCache=_p.bbCache||{};_p.bbCache[key]=bb}}else{bb=_p.bbCache[key]}return bb};var defBbOpts={includeNodes:true,includeEdges:true,includeLabels:true,includeShadows:true,includeOverlays:true,useCache:true};var defBbOptsKey=getKey(defBbOpts);elesfn.recalculateRenderedStyle=function(useCache){var cy=this.cy();var renderer=cy.renderer();var styleEnabled=cy.styleEnabled();if(renderer&&styleEnabled){renderer.recalculateRenderedStyle(this,useCache)}return this};elesfn.boundingBox=function(options){if(this.length===1&&this[0]._private.bbCache&&(options===undefined||options.useCache===undefined||options.useCache===true)){if(options===undefined){options=defBbOpts}return cachedBoundingBoxImpl(this[0],options)}var bounds={x1:Infinity,y1:Infinity,x2:-Infinity,y2:-Infinity};options=options||util.staticEmptyObject();var opts={includeNodes:util.default(options.includeNodes,defBbOpts.includeNodes),includeEdges:util.default(options.includeEdges,defBbOpts.includeEdges),includeLabels:util.default(options.includeLabels,defBbOpts.includeLabels),includeShadows:util.default(options.includeShadows,defBbOpts.includeShadows),includeOverlays:util.default(options.includeOverlays,defBbOpts.includeOverlays),useCache:util.default(options.useCache,defBbOpts.useCache)};var eles=this;var cy=eles.cy();var styleEnabled=cy.styleEnabled();if(styleEnabled){this.recalculateRenderedStyle(opts.useCache)}for(var i=0;i<eles.length;i++){var ele=eles[i];if(styleEnabled&&ele.isEdge()&&ele.pstyle("curve-style").strValue==="bezier"){ele.parallelEdges().recalculateRenderedStyle(opts.useCache)}updateBoundsFromBox(bounds,cachedBoundingBoxImpl(ele,opts))}bounds.x1=noninf(bounds.x1);bounds.y1=noninf(bounds.y1);bounds.x2=noninf(bounds.x2);bounds.y2=noninf(bounds.y2);bounds.w=noninf(bounds.x2-bounds.x1);bounds.h=noninf(bounds.y2-bounds.y1);return bounds};var defineDimFns=function(opts){opts.uppercaseName=util.capitalize(opts.name);opts.autoName="auto"+opts.uppercaseName;opts.labelName="label"+opts.uppercaseName;opts.outerName="outer"+opts.uppercaseName;opts.uppercaseOuterName=util.capitalize(opts.outerName);fn[opts.name]=function dimImpl(){var ele=this[0];var _p=ele._private;var cy=_p.cy;var styleEnabled=cy._private.styleEnabled;if(ele){if(styleEnabled){if(ele.isParent()){return _p[opts.autoName]||0}var d=ele.pstyle(opts.name);switch(d.strValue){case"label":return _p.rstyle[opts.labelName]||0;default:return d.pfValue}}else{return 1}}};fn["outer"+opts.uppercaseName]=function outerDimImpl(){var ele=this[0];var _p=ele._private;var cy=_p.cy;var styleEnabled=cy._private.styleEnabled;if(ele){if(styleEnabled){var dim=ele[opts.name]();var border=ele.pstyle("border-width").pfValue;var padding=ele.pstyle(opts.paddings[0]).pfValue+ele.pstyle(opts.paddings[1]).pfValue;return dim+border+padding}else{return 1}}};fn["rendered"+opts.uppercaseName]=function renderedDimImpl(){var ele=this[0];if(ele){var d=ele[opts.name]();return d*this.cy().zoom()}};fn["rendered"+opts.uppercaseOuterName]=function renderedOuterDimImpl(){var ele=this[0];if(ele){var od=ele[opts.outerName]();return od*this.cy().zoom()}}};defineDimFns({name:"width",paddings:["padding-left","padding-right"]});defineDimFns({name:"height",paddings:["padding-top","padding-bottom"]});fn.modelPosition=fn.point=fn.position;fn.modelPositions=fn.points=fn.positions;fn.renderedPoint=fn.renderedPosition;fn.relativePoint=fn.relativePosition;fn.boundingbox=fn.boundingBox;fn.renderedBoundingbox=fn.renderedBoundingBox;module.exports=elesfn},{"../define":78,"../is":117,"../math":119,"../util":134}],56:[function(require,module,exports){"use strict";var util=require("../util");var is=require("../is");var Element=function(cy,params,restore){var self=this;restore=restore===undefined||restore?true:false;if(cy===undefined||params===undefined||!is.core(cy)){util.error("An element must have a core reference and parameters set");return}var group=params.group;if(group==null){if(params.data&&params.data.source!=null&&params.data.target!=null){group="edges"}else{group="nodes"}}if(group!=="nodes"&&group!=="edges"){util.error("An element must be of type `nodes` or `edges`; you specified `"+group+"`");return}this.length=1;this[0]=this;this._private={cy:cy,single:true,data:params.data||{},position:params.position||{},autoWidth:undefined,autoHeight:undefined,listeners:[],group:group,style:{},rstyle:{},styleCxts:[],removed:true,selected:params.selected?true:false,selectable:params.selectable===undefined?true:params.selectable?true:false,locked:params.locked?true:false,grabbed:false,grabbable:params.grabbable===undefined?true:params.grabbable?true:false,active:false,classes:{},animation:{current:[],queue:[]},rscratch:{},scratch:params.scratch||{},edges:[],children:[],traversalCache:{}};if(params.renderedPosition){var rpos=params.renderedPosition;var pan=cy.pan();var zoom=cy.zoom();this._private.position={x:(rpos.x-pan.x)/zoom,y:(rpos.y-pan.y)/zoom}}if(is.string(params.classes)){var classes=params.classes.split(/\s+/);for(var i=0,l=classes.length;i<l;i++){var cls=classes[i];if(!cls||cls===""){continue}self._private.classes[cls]=true}}if(params.style||params.css){cy.style().applyBypass(this,params.style||params.css)}if(restore===undefined||restore){this.restore()}};module.exports=Element},{"../is":117,"../util":134}],57:[function(require,module,exports){"use strict";var define=require("../define");var elesfn={on:define.on(),one:define.on({unbindSelfOnTrigger:true}),once:define.on({unbindAllBindersOnTrigger:true}),off:define.off(),trigger:define.trigger(),rtrigger:function(event,extraParams){if(this.length===0){return}this.cy().notify({type:event,eles:this});this.trigger(event,extraParams);return this}};define.eventAliasesOn(elesfn);module.exports=elesfn},{"../define":78}],58:[function(require,module,exports){"use strict";var is=require("../is");var Selector=require("../selector");var elesfn={nodes:function(selector){return this.filter(function(i,element){return element.isNode()}).filter(selector)},edges:function(selector){return this.filter(function(i,element){return element.isEdge()}).filter(selector)},filter:function(filter){if(filter===undefined){return this}else if(is.string(filter)||is.elementOrCollection(filter)){return Selector(filter).filter(this)}else if(is.fn(filter)){var elements=[];for(var i=0;i<this.length;i++){var ele=this[i];if(filter.apply(ele,[i,ele])){elements.push(ele)}}return this.spawn(elements)}return this.spawn()},not:function(toRemove){if(!toRemove){return this}else{if(is.string(toRemove)){toRemove=this.filter(toRemove)}var elements=[];for(var i=0;i<this.length;i++){var element=this[i];var remove=toRemove._private.ids[element.id()];if(!remove){elements.push(element)}}return this.spawn(elements)}},absoluteComplement:function(){var cy=this._private.cy;return cy.mutableElements().not(this)},intersect:function(other){if(is.string(other)){var selector=other;return this.filter(selector)}var elements=[];var col1=this;var col2=other;var col1Smaller=this.length<other.length;var ids2=col1Smaller?col2._private.ids:col1._private.ids;var col=col1Smaller?col1:col2;for(var i=0;i<col.length;i++){var id=col[i]._private.data.id;var ele=ids2[id];if(ele){elements.push(ele)}}return this.spawn(elements)},xor:function(other){var cy=this._private.cy;if(is.string(other)){other=cy.$(other)}var elements=[];var col1=this;var col2=other;var add=function(col,other){for(var i=0;i<col.length;i++){var ele=col[i];var id=ele._private.data.id;var inOther=other._private.ids[id];if(!inOther){elements.push(ele)}}};add(col1,col2);add(col2,col1);return this.spawn(elements)},diff:function(other){var cy=this._private.cy;if(is.string(other)){other=cy.$(other)}var left=[];var right=[];var both=[];var col1=this;var col2=other;var add=function(col,other,retEles){for(var i=0;i<col.length;i++){var ele=col[i];var id=ele._private.data.id;var inOther=other._private.ids[id];if(inOther){both.push(ele)}else{retEles.push(ele)}}};add(col1,col2,left);add(col2,col1,right);return{left:this.spawn(left,{unique:true}),right:this.spawn(right,{unique:true}),both:this.spawn(both,{unique:true})}},add:function(toAdd){var cy=this._private.cy;if(!toAdd){return this}if(is.string(toAdd)){var selector=toAdd;toAdd=cy.mutableElements().filter(selector)}var elements=[];for(var i=0;i<this.length;i++){elements.push(this[i])}for(var i=0;i<toAdd.length;i++){var add=!this._private.ids[toAdd[i].id()];if(add){elements.push(toAdd[i])}}return this.spawn(elements)},merge:function(toAdd){var _p=this._private;var cy=_p.cy;if(!toAdd){return this}if(toAdd&&is.string(toAdd)){var selector=toAdd;toAdd=cy.mutableElements().filter(selector)}for(var i=0;i<toAdd.length;i++){var toAddEle=toAdd[i];var id=toAddEle._private.data.id;var add=!_p.ids[id];if(add){var index=this.length++;this[index]=toAddEle;_p.ids[id]=toAddEle;_p.indexes[id]=index}else{var index=_p.indexes[id];this[index]=toAddEle;_p.ids[id]=toAddEle}}return this},unmergeOne:function(ele){ele=ele[0];var _p=this._private;var id=ele._private.data.id;var i=_p.indexes[id];if(i==null){return this}this[i]=undefined;_p.ids[id]=undefined;_p.indexes[id]=undefined;var unmergedLastEle=i===this.length-1;if(this.length>1&&!unmergedLastEle){var lastEleI=this.length-1;var lastEle=this[lastEleI];var lastEleId=lastEle._private.data.id;this[lastEleI]=undefined;this[i]=lastEle;_p.indexes[lastEleId]=i}this.length--;return this},unmerge:function(toRemove){var cy=this._private.cy;if(!toRemove){return this}if(toRemove&&is.string(toRemove)){var selector=toRemove;toRemove=cy.mutableElements().filter(selector)}for(var i=0;i<toRemove.length;i++){this.unmergeOne(toRemove[i])}return this},map:function(mapFn,thisArg){var arr=[];var eles=this;for(var i=0;i<eles.length;i++){var ele=eles[i];var ret=thisArg?mapFn.apply(thisArg,[ele,i,eles]):mapFn(ele,i,eles);arr.push(ret)}return arr},stdFilter:function(fn,thisArg){var filterEles=[];var eles=this;for(var i=0;i<eles.length;i++){var ele=eles[i];var include=thisArg?fn.apply(thisArg,[ele,i,eles]):fn(ele,i,eles);if(include){filterEles.push(ele)}}return this.spawn(filterEles)},max:function(valFn,thisArg){var max=-Infinity;var maxEle;var eles=this;for(var i=0;i<eles.length;i++){var ele=eles[i];var val=thisArg?valFn.apply(thisArg,[ele,i,eles]):valFn(ele,i,eles);if(val>max){max=val;maxEle=ele}}return{value:max,ele:maxEle}},min:function(valFn,thisArg){var min=Infinity;var minEle;var eles=this;for(var i=0;i<eles.length;i++){var ele=eles[i];var val=thisArg?valFn.apply(thisArg,[ele,i,eles]):valFn(ele,i,eles);if(val<min){min=val;minEle=ele}}return{value:min,ele:minEle}}};var fn=elesfn;fn["u"]=fn["|"]=fn["+"]=fn.union=fn.or=fn.add;fn["\\"]=fn["!"]=fn["-"]=fn.difference=fn.relativeComplement=fn.subtract=fn.not;fn["n"]=fn["&"]=fn["."]=fn.and=fn.intersection=fn.intersect;fn["^"]=fn["(+)"]=fn["(-)"]=fn.symmetricDifference=fn.symdiff=fn.xor;fn.fnFilter=fn.filterFn=fn.stdFilter;fn.complement=fn.abscomp=fn.absoluteComplement;module.exports=elesfn},{"../is":117,"../selector":121}],59:[function(require,module,exports){"use strict";var elesfn={isNode:function(){return this.group()==="nodes"},isEdge:function(){return this.group()==="edges"},isLoop:function(){return this.isEdge()&&this.source().id()===this.target().id()},isSimple:function(){return this.isEdge()&&this.source().id()!==this.target().id()},group:function(){var ele=this[0];if(ele){return ele._private.group}}};module.exports=elesfn},{}],60:[function(require,module,exports){"use strict";var util=require("../util");var is=require("../is");var Element=require("./element");var idFactory={generate:function(cy,element,tryThisId){var id=tryThisId!=null?tryThisId:util.uuid();while(cy.hasElementWithId(id)){id=util.uuid()}return id}};var Collection=function(cy,elements,options){if(cy===undefined||!is.core(cy)){util.error("A collection must have a reference to the core");return}var ids={};var indexes={};var createdElements=false;if(!elements){elements=[]}else if(elements.length>0&&is.plainObject(elements[0])&&!is.element(elements[0])){createdElements=true;var eles=[];var elesIds={};for(var i=0,l=elements.length;i<l;i++){var json=elements[i];if(json.data==null){json.data={}}var data=json.data;if(data.id==null){data.id=idFactory.generate(cy,json)}else if(cy.hasElementWithId(data.id)||elesIds[data.id]){continue}var ele=new Element(cy,json,false);eles.push(ele);elesIds[data.id]=true}elements=eles}this.length=0;for(var i=0,l=elements.length;i<l;i++){var element=elements[i];if(!element){continue}var id=element._private.data.id;if(!options||options.unique&&!ids[id]){ids[id]=element;indexes[id]=this.length;this[this.length]=element;this.length++}}this._private={cy:cy,ids:ids,indexes:indexes};if(createdElements){this.restore()}};var elesfn=Element.prototype=Collection.prototype;elesfn.instanceString=function(){return"collection"};elesfn.spawn=function(cy,eles,opts){if(!is.core(cy)){opts=eles;eles=cy;cy=this.cy()}return new Collection(cy,eles,opts)};elesfn.spawnSelf=function(){return this.spawn(this)};elesfn.cy=function(){return this._private.cy};elesfn.element=function(){return this[0]};elesfn.collection=function(){if(is.collection(this)){return this}else{return new Collection(this._private.cy,[this])}};elesfn.unique=function(){return new Collection(this._private.cy,this,{unique:true})};elesfn.hasElementWithId=function(id){return!!this._private.ids[id]};elesfn.getElementById=function(id){var cy=this._private.cy;var ele=this._private.ids[id];return ele?ele:new Collection(cy)};elesfn.poolIndex=function(){var cy=this._private.cy;var eles=cy._private.elements;var id=this._private.data.id;return eles._private.indexes[id]};elesfn.json=function(obj){var ele=this.element();var cy=this.cy();if(ele==null&&obj){return this}if(ele==null){return undefined}var p=ele._private;if(is.plainObject(obj)){cy.startBatch();if(obj.data){ele.data(obj.data)}if(obj.position){ele.position(obj.position)}var checkSwitch=function(k,trueFnName,falseFnName){var obj_k=obj[k];if(obj_k!=null&&obj_k!==p[k]){if(obj_k){ele[trueFnName]()}else{ele[falseFnName]()}}};checkSwitch("removed","remove","restore");checkSwitch("selected","select","unselect");checkSwitch("selectable","selectify","unselectify");checkSwitch("locked","lock","unlock");checkSwitch("grabbable","grabify","ungrabify");if(obj.classes!=null){ele.classes(obj.classes)}cy.endBatch();return this}else if(obj===undefined){var json={data:util.copy(p.data),position:util.copy(p.position),group:p.group,removed:p.removed,selected:p.selected,selectable:p.selectable,locked:p.locked,grabbable:p.grabbable,classes:null};json.classes=Object.keys(p.classes).filter(function(cls){return p.classes[cls]}).join(" ");return json}};elesfn.jsons=function(){var jsons=[];for(var i=0;i<this.length;i++){var ele=this[i];var json=ele.json();jsons.push(json)}return jsons};elesfn.clone=function(){var cy=this.cy();var elesArr=[];for(var i=0;i<this.length;i++){var ele=this[i];var json=ele.json();var clone=new Element(cy,json,false);elesArr.push(clone)}return new Collection(cy,elesArr)};elesfn.copy=elesfn.clone;elesfn.restore=function(notifyRenderer){var self=this;var cy=self.cy();var cy_p=cy._private;if(notifyRenderer===undefined){notifyRenderer=true}var nodes=[];var edges=[];var elements;for(var i=0,l=self.length;i<l;i++){var ele=self[i];if(!ele.removed()){continue}if(ele.isNode()){nodes.push(ele)}else{edges.push(ele)}}elements=nodes.concat(edges);var i;var removeFromElements=function(){elements.splice(i,1);i--};for(i=0;i<elements.length;i++){var ele=elements[i];var _private=ele._private;var data=_private.data;_private.traversalCache=null;if(data.id===undefined){data.id=idFactory.generate(cy,ele)}else if(is.number(data.id)){data.id=""+data.id}else if(is.emptyString(data.id)||!is.string(data.id)){util.error("Can not create element with invalid string ID `"+data.id+"`");removeFromElements();continue}else if(cy.hasElementWithId(data.id)){util.error("Can not create second element with ID `"+data.id+"`");removeFromElements();continue}var id=data.id;if(ele.isNode()){var node=ele;var pos=_private.position;if(pos.x==null){pos.x=0}if(pos.y==null){pos.y=0}}if(ele.isEdge()){var edge=ele;var fields=["source","target"];var fieldsLength=fields.length;var badSourceOrTarget=false;for(var j=0;j<fieldsLength;j++){var field=fields[j];var val=data[field];if(is.number(val)){val=data[field]=""+data[field]}if(val==null||val===""){util.error("Can not create edge `"+id+"` with unspecified "+field);badSourceOrTarget=true}else if(!cy.hasElementWithId(val)){util.error("Can not create edge `"+id+"` with nonexistant "+field+" `"+val+"`");badSourceOrTarget=true}}if(badSourceOrTarget){removeFromElements();continue}var src=cy.getElementById(data.source);var tgt=cy.getElementById(data.target);src._private.edges.push(edge);tgt._private.edges.push(edge);edge._private.source=src;edge._private.target=tgt}_private.ids={};_private.ids[id]=ele;_private.indexes={};_private.indexes[id]=ele;_private.removed=false;cy.addToPool(ele)}for(var i=0;i<nodes.length;i++){var node=nodes[i];var data=node._private.data;if(is.number(data.parent)){data.parent=""+data.parent}var parentId=data.parent;var specifiedParent=parentId!=null;if(specifiedParent){var parent=cy.getElementById(parentId);if(parent.empty()){data.parent=undefined}else{var selfAsParent=false;var ancestor=parent;while(!ancestor.empty()){if(node.same(ancestor)){selfAsParent=true;data.parent=undefined;break}ancestor=ancestor.parent()}if(!selfAsParent){parent[0]._private.children.push(node);node._private.parent=parent[0];cy_p.hasCompoundNodes=true}}}}if(elements.length>0){var restored=new Collection(cy,elements);for(var i=0;i<restored.length;i++){var ele=restored[i];if(ele.isNode()){continue}var pedges=ele.parallelEdges();for(var j=0;j<pedges.length;j++){pedges[j]._private.traversalCache=null}ele.source()[0]._private.traversalCache=null;ele.target()[0]._private.traversalCache=null}var toUpdateStyle;if(cy_p.hasCompoundNodes){toUpdateStyle=restored.add(restored.connectedNodes()).add(restored.parent())}else{toUpdateStyle=restored}toUpdateStyle.updateStyle(notifyRenderer);if(notifyRenderer){restored.rtrigger("add")}else{restored.trigger("add")}}return self};elesfn.removed=function(){var ele=this[0];return ele&&ele._private.removed};elesfn.inside=function(){var ele=this[0];return ele&&!ele._private.removed};elesfn.remove=function(notifyRenderer){var self=this;var removed=[];var elesToRemove=[];var elesToRemoveIds={};var cy=self._private.cy;if(notifyRenderer===undefined){notifyRenderer=true}function addConnectedEdges(node){var edges=node._private.edges;for(var i=0;i<edges.length;i++){add(edges[i])}}function addChildren(node){var children=node._private.children;for(var i=0;i<children.length;i++){add(children[i])}}function add(ele){var alreadyAdded=elesToRemoveIds[ele.id()];if(alreadyAdded){return}else{elesToRemoveIds[ele.id()]=true}if(ele.isNode()){elesToRemove.push(ele);addConnectedEdges(ele);addChildren(ele)}else{elesToRemove.unshift(ele)}}for(var i=0,l=self.length;i<l;i++){var ele=self[i];add(ele)}function removeEdgeRef(node,edge){var connectedEdges=node._private.edges;util.removeFromArray(connectedEdges,edge);node._private.traversalCache=null}function removeParallelRefs(edge){var pedges=edge.parallelEdges();for(var j=0;j<pedges.length;j++){pedges[j]._private.traversalCache=null}}var alteredParents=[];alteredParents.ids={};function removeChildRef(parent,ele){ele=ele[0];parent=parent[0];var children=parent._private.children;var pid=parent.id();util.removeFromArray(children,ele);if(!alteredParents.ids[pid]){alteredParents.ids[pid]=true;alteredParents.push(parent)}}cy.removeFromPool(elesToRemove);for(var i=0;i<elesToRemove.length;i++){var ele=elesToRemove[i];ele._private.removed=true;removed.push(ele);if(ele.isEdge()){var src=ele.source()[0];var tgt=ele.target()[0];removeEdgeRef(src,ele);removeEdgeRef(tgt,ele);removeParallelRefs(ele)}else{var parent=ele.parent();if(parent.length!==0){removeChildRef(parent,ele)}}}var elesStillInside=cy._private.elements;cy._private.hasCompoundNodes=false;for(var i=0;i<elesStillInside.length;i++){var ele=elesStillInside[i];if(ele.isParent()){cy._private.hasCompoundNodes=true;break}}var removedElements=new Collection(this.cy(),removed);if(removedElements.size()>0){if(notifyRenderer){this.cy().notify({type:"remove",eles:removedElements})}removedElements.trigger("remove")}for(var i=0;i<alteredParents.length;i++){var ele=alteredParents[i];if(!ele.removed()){ele.updateStyle()}}return new Collection(cy,removed)};elesfn.move=function(struct){var cy=this._private.cy;if(struct.source!==undefined||struct.target!==undefined){var srcId=struct.source;var tgtId=struct.target;var srcExists=cy.hasElementWithId(srcId);var tgtExists=cy.hasElementWithId(tgtId);if(srcExists||tgtExists){var jsons=this.jsons();this.remove();for(var i=0;i<jsons.length;i++){var json=jsons[i];var ele=this[i];if(json.group==="edges"){if(srcExists){json.data.source=srcId}if(tgtExists){json.data.target=tgtId}json.scratch=ele._private.scratch}}return cy.add(jsons)}}else if(struct.parent!==undefined){var parentId=struct.parent;var parentExists=parentId===null||cy.hasElementWithId(parentId);if(parentExists){var jsons=this.jsons();var descs=this.descendants();var descsEtcJsons=descs.union(descs.union(this).connectedEdges()).jsons();this.remove();for(var i=0;i<jsons.length;i++){var json=jsons[i];var ele=this[i];if(json.group==="nodes"){json.data.parent=parentId===null?undefined:parentId;json.scratch=ele._private.scratch}}return cy.add(jsons.concat(descsEtcJsons))}}return this};[require("./algorithms"),require("./animation"),require("./class"),require("./comparators"),require("./compounds"),require("./data"),require("./degree"),require("./dimensions"),require("./events"),require("./filter"),require("./group"),require("./index"),require("./iteration"),require("./layout"),require("./style"),require("./switch-functions"),require("./traversing")].forEach(function(props){util.extend(elesfn,props)});module.exports=Collection},{"../is":117,"../util":134,"./algorithms":45,"./animation":49,"./class":50,"./comparators":51,"./compounds":52,"./data":53,"./degree":54,"./dimensions":55,"./element":56,"./events":57,"./filter":58,"./group":59,"./index":60,"./iteration":61,"./layout":62,"./style":63,"./switch-functions":64,"./traversing":65}],61:[function(require,module,exports){"use strict";var is=require("../is");var zIndexSort=require("./zsort");var elesfn={each:function(fn){if(is.fn(fn)){for(var i=0;i<this.length;i++){var ele=this[i];var ret=fn.apply(ele,[i,ele]);if(ret===false){break}}}return this},forEach:function(fn,thisArg){if(is.fn(fn)){for(var i=0;i<this.length;i++){var ele=this[i];var ret=thisArg?fn.apply(thisArg,[ele,i,this]):fn(ele,i,this);if(ret===false){break}}}return this},toArray:function(){var array=[];for(var i=0;i<this.length;i++){array.push(this[i])}return array},slice:function(start,end){var array=[];var thisSize=this.length;if(end==null){end=thisSize}if(start==null){start=0}if(start<0){start=thisSize+start}if(end<0){end=thisSize+end}for(var i=start;i>=0&&i<end&&i<thisSize;i++){array.push(this[i])}return this.spawn(array)},size:function(){return this.length},eq:function(i){return this[i]||this.spawn()},first:function(){return this[0]||this.spawn()},last:function(){return this[this.length-1]||this.spawn()},empty:function(){return this.length===0},nonempty:function(){return!this.empty()},sort:function(sortFn){if(!is.fn(sortFn)){return this}var sorted=this.toArray().sort(sortFn);return this.spawn(sorted)},sortByZIndex:function(){return this.sort(zIndexSort)},zDepth:function(){var ele=this[0];if(!ele){return undefined}var _p=ele._private;var group=_p.group;if(group==="nodes"){var depth=_p.data.parent?ele.parents().size():0;if(!ele.isParent()){return Number.MAX_VALUE}return depth}else{var src=_p.source;var tgt=_p.target;var srcDepth=src.zDepth();var tgtDepth=tgt.zDepth();return Math.max(srcDepth,tgtDepth,0)}}};module.exports=elesfn},{"../is":117,"./zsort":66}],62:[function(require,module,exports){"use strict";var is=require("../is");var util=require("../util");var Promise=require("../promise");var elesfn={layoutPositions:function(layout,options,fn){var nodes=this.nodes();var cy=this.cy();layout.trigger({type:"layoutstart",layout:layout});layout.animations=[];if(options.animate){for(var i=0;i<nodes.length;i++){var node=nodes[i];var newPos=fn.call(node,i,node);var pos=node.position();if(!is.number(pos.x)||!is.number(pos.y)){node.silentPosition({x:0,y:0})}var ani=node.animation({position:newPos,duration:options.animationDuration,easing:options.animationEasing});layout.animations.push(ani);ani.play()}var onStep;cy.on("step.*",onStep=function(){if(options.fit){cy.fit(options.eles,options.padding)}});layout.one("layoutstop",function(){cy.off("step.*",onStep)});layout.one("layoutready",options.ready);layout.trigger({type:"layoutready",layout:layout});Promise.all(layout.animations.map(function(ani){return ani.promise()})).then(function(){cy.off("step.*",onStep);if(options.zoom!=null){cy.zoom(options.zoom)}if(options.pan){cy.pan(options.pan)}if(options.fit){cy.fit(options.eles,options.padding)}layout.one("layoutstop",options.stop);layout.trigger({type:"layoutstop",layout:layout})})}else{nodes.positions(fn);if(options.fit){cy.fit(options.eles,options.padding)}if(options.zoom!=null){cy.zoom(options.zoom)}if(options.pan){cy.pan(options.pan)}layout.one("layoutready",options.ready);layout.trigger({type:"layoutready",layout:layout});layout.one("layoutstop",options.stop);layout.trigger({type:"layoutstop",layout:layout})}return this},layout:function(options){var cy=this.cy();cy.layout(util.extend({},options,{eles:this}));return this},makeLayout:function(options){var cy=this.cy();return cy.makeLayout(util.extend({},options,{eles:this}))}};elesfn.createLayout=elesfn.makeLayout;module.exports=elesfn},{"../is":117,"../promise":120,"../util":134}],63:[function(require,module,exports){"use strict";var is=require("../is");var elesfn={updateStyle:function(notifyRenderer){var cy=this._private.cy;if(!cy.styleEnabled()){return this}if(cy._private.batchingStyle){var bEles=cy._private.batchStyleEles;bEles.merge(this);return this}var style=cy.style();notifyRenderer=notifyRenderer||notifyRenderer===undefined?true:false;style.apply(this);var updatedCompounds=this.updateCompoundBounds();var toNotify=updatedCompounds.length>0?this.add(updatedCompounds):this;if(notifyRenderer){toNotify.rtrigger("style")}else{toNotify.trigger("style")}return this},updateMappers:function(notifyRenderer){var cy=this._private.cy;var style=cy.style();notifyRenderer=notifyRenderer||notifyRenderer===undefined?true:false;if(!cy.styleEnabled()){return this}style.updateMappers(this);var updatedCompounds=this.updateCompoundBounds();var toNotify=updatedCompounds.length>0?this.add(updatedCompounds):this;if(notifyRenderer){toNotify.rtrigger("style")}else{toNotify.trigger("style")}return this},parsedStyle:function(property){var ele=this[0];if(!ele.cy().styleEnabled()){return}if(ele){return ele._private.style[property]||ele.cy().style().getDefaultProperty(property)}},renderedStyle:function(property){var cy=this.cy();if(!cy.styleEnabled()){return this}var ele=this[0];if(ele){var renstyle=ele.cy().style().getRenderedStyle(ele);if(property===undefined){return renstyle}else{return renstyle[property]}}},style:function(name,value){var cy=this.cy();if(!cy.styleEnabled()){return this}var updateTransitions=false;var style=cy.style();if(is.plainObject(name)){var props=name;style.applyBypass(this,props,updateTransitions);var updatedCompounds=this.updateCompoundBounds();var toNotify=updatedCompounds.length>0?this.add(updatedCompounds):this;toNotify.rtrigger("style")}else if(is.string(name)){if(value===undefined){var ele=this[0];if(ele){return style.getStylePropertyValue(ele,name)}else{return}}else{style.applyBypass(this,name,value,updateTransitions);var updatedCompounds=this.updateCompoundBounds();var toNotify=updatedCompounds.length>0?this.add(updatedCompounds):this;toNotify.rtrigger("style")}}else if(name===undefined){var ele=this[0];if(ele){return style.getRawStyle(ele)}else{return}}return this},removeStyle:function(names){var cy=this.cy();if(!cy.styleEnabled()){return this}var updateTransitions=false;var style=cy.style();var eles=this;if(names===undefined){for(var i=0;i<eles.length;i++){var ele=eles[i];style.removeAllBypasses(ele,updateTransitions)}}else{names=names.split(/\s+/);for(var i=0;i<eles.length;i++){var ele=eles[i];style.removeBypasses(ele,names,updateTransitions)}}var updatedCompounds=this.updateCompoundBounds();var toNotify=updatedCompounds.length>0?this.add(updatedCompounds):this;toNotify.rtrigger("style");return this},show:function(){this.css("display","element");return this},hide:function(){this.css("display","none");return this},visible:function(){var cy=this.cy();if(!cy.styleEnabled()){return true}var ele=this[0];var hasCompoundNodes=cy.hasCompoundNodes();if(ele){if(ele.pstyle("visibility").value!=="visible"||ele.pstyle("display").value!=="element"||ele.pstyle("width").pfValue===0){return false}if(ele._private.group==="nodes"){if(ele.pstyle("height").pfValue===0){return false}if(!hasCompoundNodes){return true}var parents=ele._private.data.parent?ele.parents():null;if(parents){for(var i=0;i<parents.length;i++){var parent=parents[i];var pVis=parent.pstyle("visibility").value;var pDis=parent.pstyle("display").value;if(pVis!=="visible"||pDis!=="element"){return false}}}return true}else{var src=ele._private.source;var tgt=ele._private.target;return src.visible()&&tgt.visible()}}},hidden:function(){var ele=this[0];if(ele){return!ele.visible()}},effectiveOpacity:function(){var cy=this.cy();if(!cy.styleEnabled()){return 1}var hasCompoundNodes=cy.hasCompoundNodes();var ele=this[0];if(ele){var _p=ele._private;var parentOpacity=ele.pstyle("opacity").value;if(!hasCompoundNodes){return parentOpacity}var parents=!_p.data.parent?null:ele.parents();if(parents){for(var i=0;i<parents.length;i++){var parent=parents[i];var opacity=parent.pstyle("opacity").value;parentOpacity=opacity*parentOpacity}}return parentOpacity}},transparent:function(){var cy=this.cy();if(!cy.styleEnabled()){return false}var ele=this[0];var hasCompoundNodes=ele.cy().hasCompoundNodes();if(ele){if(!hasCompoundNodes){return ele.pstyle("opacity").value===0}else{return ele.effectiveOpacity()===0}}},backgrounding:function(){var cy=this.cy();if(!cy.styleEnabled()){return false}var ele=this[0];return ele._private.backgrounding?true:false}};elesfn.bypass=elesfn.css=elesfn.style;elesfn.renderedCss=elesfn.renderedStyle;elesfn.removeBypass=elesfn.removeCss=elesfn.removeStyle;elesfn.pstyle=elesfn.parsedStyle;module.exports=elesfn},{"../is":117}],64:[function(require,module,exports){"use strict";var elesfn={};function defineSwitchFunction(params){return function(){var args=arguments;var changedEles=[];if(args.length===2){var data=args[0];var handler=args[1];this.on(params.event,data,handler)}else if(args.length===1){var handler=args[0];this.on(params.event,handler)}else if(args.length===0){for(var i=0;i<this.length;i++){var ele=this[i];var able=!params.ableField||ele._private[params.ableField];var changed=ele._private[params.field]!=params.value;if(params.overrideAble){var overrideAble=params.overrideAble(ele);if(overrideAble!==undefined){able=overrideAble;if(!overrideAble){return this}}}if(able){ele._private[params.field]=params.value;if(changed){changedEles.push(ele)}}}var changedColl=this.spawn(changedEles);changedColl.updateStyle();changedColl.trigger(params.event)}return this}}function defineSwitchSet(params){elesfn[params.field]=function(){var ele=this[0];if(ele){if(params.overrideField){var val=params.overrideField(ele);if(val!==undefined){return val}}return ele._private[params.field]}};elesfn[params.on]=defineSwitchFunction({event:params.on,field:params.field,ableField:params.ableField,overrideAble:params.overrideAble,value:true});elesfn[params.off]=defineSwitchFunction({event:params.off,field:params.field,ableField:params.ableField,overrideAble:params.overrideAble,value:false})}defineSwitchSet({field:"locked",overrideField:function(ele){return ele.cy().autolock()?true:undefined},on:"lock",off:"unlock"});defineSwitchSet({field:"grabbable",overrideField:function(ele){return ele.cy().autoungrabify()?false:undefined},on:"grabify",off:"ungrabify"});defineSwitchSet({field:"selected",ableField:"selectable",overrideAble:function(ele){return ele.cy().autounselectify()?false:undefined},on:"select",off:"unselect"});defineSwitchSet({field:"selectable",overrideField:function(ele){return ele.cy().autounselectify()?false:undefined},on:"selectify",off:"unselectify"});elesfn.deselect=elesfn.unselect;elesfn.grabbed=function(){var ele=this[0];if(ele){return ele._private.grabbed}};defineSwitchSet({field:"active",on:"activate",off:"unactivate"});elesfn.inactive=function(){var ele=this[0];if(ele){return!ele._private.active}};module.exports=elesfn},{}],65:[function(require,module,exports){"use strict";var util=require("../util");var is=require("../is");var elesfn={};var cache=function(fn,name){return function traversalCache(arg1,arg2,arg3,arg4){var selectorOrEles=arg1;var eles=this;var key;if(selectorOrEles==null){key="null"}else if(is.elementOrCollection(selectorOrEles)&&selectorOrEles.length===1){key="#"+selectorOrEles.id()}if(eles.length===1&&key){var _p=eles[0]._private;var tch=_p.traversalCache=_p.traversalCache||{};var ch=tch[name]=tch[name]||{};var cacheHit=ch[key];if(cacheHit){return cacheHit}else{return ch[key]=fn.call(eles,arg1,arg2,arg3,arg4)}}else{return fn.call(eles,arg1,arg2,arg3,arg4)}}};var defineDagExtremity=function(params){return function dagExtremityImpl(selector){var eles=this;var ret=[];for(var i=0;i<eles.length;i++){var ele=eles[i];if(!ele.isNode()){continue}var disqualified=false;var edges=ele.connectedEdges();for(var j=0;j<edges.length;j++){var edge=edges[j];var src=edge.source();var tgt=edge.target();if(params.noIncomingEdges&&tgt===ele&&src!==ele||params.noOutgoingEdges&&src===ele&&tgt!==ele){disqualified=true;break}}if(!disqualified){ret.push(ele)}}return this.spawn(ret,{unique:true}).filter(selector)}};var defineDagOneHop=function(params){return function(selector){var eles=this;var oEles=[];for(var i=0;i<eles.length;i++){var ele=eles[i];if(!ele.isNode()){continue}var edges=ele.connectedEdges();for(var j=0;j<edges.length;j++){var edge=edges[j];var src=edge.source();var tgt=edge.target();if(params.outgoing&&src===ele){oEles.push(edge);oEles.push(tgt)}else if(params.incoming&&tgt===ele){oEles.push(edge);oEles.push(src)}}}return this.spawn(oEles,{unique:true}).filter(selector)}};var defineDagAllHops=function(params){return function(selector){var eles=this;var sEles=[];var sElesIds={};for(;;){var next=params.outgoing?eles.outgoers():eles.incomers();if(next.length===0){break}var newNext=false;for(var i=0;i<next.length;i++){var n=next[i];var nid=n.id();if(!sElesIds[nid]){sElesIds[nid]=true;sEles.push(n);newNext=true}}if(!newNext){break}eles=next}return this.spawn(sEles,{unique:true}).filter(selector)}};util.extend(elesfn,{roots:defineDagExtremity({noIncomingEdges:true}),leaves:defineDagExtremity({noOutgoingEdges:true}),outgoers:cache(defineDagOneHop({outgoing:true}),"outgoers"),successors:defineDagAllHops({outgoing:true}),incomers:cache(defineDagOneHop({incoming:true}),"incomers"),predecessors:defineDagAllHops({incoming:true})});util.extend(elesfn,{neighborhood:cache(function(selector){var elements=[];var nodes=this.nodes();for(var i=0;i<nodes.length;i++){var node=nodes[i];var connectedEdges=node.connectedEdges();for(var j=0;j<connectedEdges.length;j++){var edge=connectedEdges[j];var src=edge.source();var tgt=edge.target();var otherNode=node===src?tgt:src;if(otherNode.length>0){elements.push(otherNode[0])}elements.push(edge[0])}}return this.spawn(elements,{unique:true}).filter(selector)},"neighborhood"),closedNeighborhood:function(selector){return this.neighborhood().add(this).filter(selector)},openNeighborhood:function(selector){return this.neighborhood(selector)}});elesfn.neighbourhood=elesfn.neighborhood;elesfn.closedNeighbourhood=elesfn.closedNeighborhood;elesfn.openNeighbourhood=elesfn.openNeighborhood;util.extend(elesfn,{source:cache(function sourceImpl(selector){var ele=this[0];var src;if(ele){src=ele._private.source||ele.cy().collection()}return src&&selector?src.filter(selector):src},"source"),target:cache(function targetImpl(selector){var ele=this[0];var tgt;if(ele){tgt=ele._private.target||ele.cy().collection()}return tgt&&selector?tgt.filter(selector):tgt},"target"),sources:defineSourceFunction({attr:"source"}),targets:defineSourceFunction({attr:"target"})});function defineSourceFunction(params){return function sourceImpl(selector){var sources=[];for(var i=0;i<this.length;i++){var ele=this[i];var src=ele._private[params.attr];if(src){sources.push(src)}}return this.spawn(sources,{unique:true}).filter(selector)}}util.extend(elesfn,{edgesWith:cache(defineEdgesWithFunction(),"edgesWith",true),edgesTo:cache(defineEdgesWithFunction({thisIsSrc:true}),"edgesTo",true)});function defineEdgesWithFunction(params){return function edgesWithImpl(otherNodes){var elements=[];var cy=this._private.cy;var p=params||{};if(is.string(otherNodes)){otherNodes=cy.$(otherNodes)}var thisIds=this._private.ids;var otherIds=otherNodes._private.ids;for(var h=0;h<otherNodes.length;h++){var edges=otherNodes[h]._private.edges;for(var i=0;i<edges.length;i++){var edge=edges[i];var edgeData=edge._private.data;var thisToOther=thisIds[edgeData.source]&&otherIds[edgeData.target];var otherToThis=otherIds[edgeData.source]&&thisIds[edgeData.target];var edgeConnectsThisAndOther=thisToOther||otherToThis;if(!edgeConnectsThisAndOther){continue}if(p.thisIsSrc||p.thisIsTgt){if(p.thisIsSrc&&!thisToOther){continue}if(p.thisIsTgt&&!otherToThis){continue}}elements.push(edge)}}return this.spawn(elements,{unique:true})}}util.extend(elesfn,{connectedEdges:cache(function(selector){var retEles=[];var eles=this;for(var i=0;i<eles.length;i++){var node=eles[i];if(!node.isNode()){continue}var edges=node._private.edges;for(var j=0;j<edges.length;j++){var edge=edges[j];retEles.push(edge)}}return this.spawn(retEles,{unique:true}).filter(selector)},"connectedEdges"),connectedNodes:cache(function(selector){var retEles=[];var eles=this;for(var i=0;i<eles.length;i++){var edge=eles[i];if(!edge.isEdge()){continue}retEles.push(edge.source()[0]);retEles.push(edge.target()[0])}return this.spawn(retEles,{unique:true}).filter(selector)},"connectedNodes"),parallelEdges:cache(defineParallelEdgesFunction(),"parallelEdges"),codirectedEdges:cache(defineParallelEdgesFunction({codirected:true}),"codirectedEdges")});function defineParallelEdgesFunction(params){var defaults={codirected:false};params=util.extend({},defaults,params);return function parallelEdgesImpl(selector){var elements=[];var edges=this.edges();var p=params;for(var i=0;i<edges.length;i++){var edge1=edges[i];var edge1_p=edge1._private;var src1=edge1_p.source;var srcid1=src1._private.data.id;var tgtid1=edge1_p.data.target;var srcEdges1=src1._private.edges;for(var j=0;j<srcEdges1.length;j++){var edge2=srcEdges1[j];var edge2data=edge2._private.data;var tgtid2=edge2data.target;var srcid2=edge2data.source;var codirected=tgtid2===tgtid1&&srcid2===srcid1;var oppdirected=srcid1===tgtid2&&tgtid1===srcid2;if(p.codirected&&codirected||!p.codirected&&(codirected||oppdirected)){elements.push(edge2)}}}return this.spawn(elements,{unique:true}).filter(selector)}}util.extend(elesfn,{components:function(){var self=this;var cy=self.cy();var visited=self.spawn();var unvisited=self.nodes().spawnSelf();var components=[];var visitInComponent=function(node,component){visited.merge(node);unvisited.unmerge(node);component.merge(node)};if(unvisited.empty()){return self.spawn()}do{var component=cy.collection();components.push(component);var root=unvisited[0];visitInComponent(root,component);self.bfs({directed:false,roots:root,visit:function(i,depth,v,e,u){visitInComponent(v,component)}})}while(unvisited.length>0);return components.map(function(component){var connectedEdges=component.connectedEdges().stdFilter(function(edge){return component.anySame(edge.source())&&component.anySame(edge.target())});return component.union(connectedEdges)})}});module.exports=elesfn},{"../is":117,"../util":134}],66:[function(require,module,exports){"use strict";var zIndexSort=function(a,b){var cy=a.cy();var zDiff=a.pstyle("z-index").value-b.pstyle("z-index").value;var depthA=0;var depthB=0;var hasCompoundNodes=cy.hasCompoundNodes();var aIsNode=a.isNode();var aIsEdge=!aIsNode;var bIsNode=b.isNode();var bIsEdge=!bIsNode;if(hasCompoundNodes){depthA=a.zDepth();depthB=b.zDepth()}var depthDiff=depthA-depthB;var sameDepth=depthDiff===0;if(sameDepth){if(aIsNode&&bIsEdge){return 1}else if(aIsEdge&&bIsNode){return-1}else{if(zDiff===0){return a.poolIndex()-b.poolIndex()}else{return zDiff}}}else{return depthDiff}};module.exports=zIndexSort},{}],67:[function(require,module,exports){"use strict";var is=require("../is");var util=require("../util");var Collection=require("../collection");var Element=require("../collection/element");var corefn={add:function(opts){var elements;var cy=this;if(is.elementOrCollection(opts)){var eles=opts;if(eles._private.cy===cy){elements=eles.restore()}else{var jsons=[];for(var i=0;i<eles.length;i++){var ele=eles[i];jsons.push(ele.json())}elements=new Collection(cy,jsons)}}else if(is.array(opts)){var jsons=opts;elements=new Collection(cy,jsons)}else if(is.plainObject(opts)&&(is.array(opts.nodes)||is.array(opts.edges))){var elesByGroup=opts;var jsons=[];var grs=["nodes","edges"];for(var i=0,il=grs.length;i<il;i++){var group=grs[i];var elesArray=elesByGroup[group];if(is.array(elesArray)){for(var j=0,jl=elesArray.length;j<jl;j++){var json=util.extend({group:group},elesArray[j]);jsons.push(json)}}}elements=new Collection(cy,jsons)}else{var json=opts;elements=new Element(cy,json).collection()}return elements},remove:function(collection){if(is.elementOrCollection(collection)){}else if(is.string(collection)){var selector=collection;collection=this.$(selector)}return collection.remove()},load:function(elements,onload,ondone){var cy=this;cy.notifications(false);var oldEles=cy.mutableElements();if(oldEles.length>0){oldEles.remove()}if(elements!=null){if(is.plainObject(elements)||is.array(elements)){cy.add(elements)}}cy.one("layoutready",function(e){cy.notifications(true);cy.trigger(e);cy.notify({type:"load",eles:cy.mutableElements()});cy.one("load",onload);cy.trigger("load")}).one("layoutstop",function(){cy.one("done",ondone);cy.trigger("done")});var layoutOpts=util.extend({},cy._private.options.layout);layoutOpts.eles=cy.elements();cy.layout(layoutOpts);return this}};module.exports=corefn},{"../collection":60,"../collection/element":56,"../is":117,"../util":134}],68:[function(require,module,exports){"use strict";var define=require("../define");var util=require("../util");var is=require("../is");var corefn={animate:define.animate(),animation:define.animation(),animated:define.animated(),clearQueue:define.clearQueue(),delay:define.delay(),delayAnimation:define.delayAnimation(),stop:define.stop(),addToAnimationPool:function(eles){var cy=this;if(!cy.styleEnabled()){return}cy._private.aniEles.merge(eles)},stopAnimationLoop:function(){this._private.animationsRunning=false},startAnimationLoop:function(){var cy=this;cy._private.animationsRunning=true;if(!cy.styleEnabled()){return}function globalAnimationStep(){if(!cy._private.animationsRunning){return}util.requestAnimationFrame(function animationStep(now){handleElements(now);globalAnimationStep()})}var renderer=cy.renderer();if(renderer&&renderer.beforeRender){renderer.beforeRender(function rendererAnimationStep(willDraw,now){handleElements(now)},renderer.beforeRenderPriorities.animations)}else{globalAnimationStep()}function handleElements(now){var eles=cy._private.aniEles;var doneEles=[];function handleElement(ele,isCore){var _p=ele._private;var current=_p.animation.current;var queue=_p.animation.queue;var ranAnis=false;if(current.length===0){var next=queue.shift();if(next){current.push(next)}}var callbacks=function(callbacks){for(var j=callbacks.length-1;j>=0;j--){var cb=callbacks[j];cb()}callbacks.splice(0,callbacks.length)};for(var i=current.length-1;i>=0;i--){var ani=current[i];var ani_p=ani._private;if(ani_p.stopped){current.splice(i,1);ani_p.hooked=false;ani_p.playing=false;ani_p.started=false;callbacks(ani_p.frames);continue}if(!ani_p.playing&&!ani_p.applying){continue}if(ani_p.playing&&ani_p.applying){ani_p.applying=false}if(!ani_p.started){startAnimation(ele,ani,now)}step(ele,ani,now,isCore);if(is.fn(ani_p.step)){ani_p.step.call(ele,now)}if(ani_p.applying){ani_p.applying=false}callbacks(ani_p.frames);if(ani.completed()){current.splice(i,1);ani_p.hooked=false;ani_p.playing=false;ani_p.started=false;callbacks(ani_p.completes)}ranAnis=true}if(!isCore&&current.length===0&&queue.length===0){doneEles.push(ele)}return ranAnis}var ranEleAni=false;for(var e=0;e<eles.length;e++){var ele=eles[e];var handledThisEle=handleElement(ele);ranEleAni=ranEleAni||handledThisEle}var ranCoreAni=handleElement(cy,true);if(ranEleAni||ranCoreAni){if(eles.length>0){var updatedEles=eles.updateCompoundBounds().spawnSelf().merge(eles);cy.notify({type:"draw",eles:updatedEles})}else{cy.notify({type:"draw"})}}eles.unmerge(doneEles);cy.trigger("step")}function startAnimation(self,ani,now){var isCore=is.core(self);var isEles=!isCore;var ele=self;var style=cy._private.style;var ani_p=ani._private;if(isEles){var pos=ele._private.position;ani_p.startPosition=ani_p.startPosition||{x:pos.x,y:pos.y};ani_p.startStyle=ani_p.startStyle||style.getAnimationStartStyle(ele,ani_p.style)}if(isCore){var pan=cy._private.pan;ani_p.startPan=ani_p.startPan||{x:pan.x,y:pan.y};ani_p.startZoom=ani_p.startZoom!=null?ani_p.startZoom:cy._private.zoom}ani_p.started=true;ani_p.startTime=now-ani_p.progress*ani_p.duration}function step(self,ani,now,isCore){var style=cy._private.style;var isEles=!isCore;var _p=self._private;var ani_p=ani._private;var pEasing=ani_p.easing;var startTime=ani_p.startTime;if(!ani_p.easingImpl){if(pEasing==null){ani_p.easingImpl=easings["linear"]}else{var easingVals;if(is.string(pEasing)){var easingProp=style.parse("transition-timing-function",pEasing);easingVals=easingProp.value}else{easingVals=pEasing}var name,args;if(is.string(easingVals)){name=easingVals;args=[]}else{name=easingVals[1];args=easingVals.slice(2).map(function(n){return+n})}if(args.length>0){if(name==="spring"){args.push(ani_p.duration)}ani_p.easingImpl=easings[name].apply(null,args)}else{ani_p.easingImpl=easings[name]}}}var easing=ani_p.easingImpl;var percent;if(ani_p.duration===0){percent=1}else{percent=(now-startTime)/ani_p.duration}if(ani_p.applying){percent=ani_p.progress}if(percent<0){percent=0}else if(percent>1){percent=1}if(ani_p.delay==null){var startPos=ani_p.startPosition;var endPos=ani_p.position;var pos=_p.position;if(endPos&&isEles){if(valid(startPos.x,endPos.x)){pos.x=ease(startPos.x,endPos.x,percent,easing)}if(valid(startPos.y,endPos.y)){pos.y=ease(startPos.y,endPos.y,percent,easing)}self.trigger("position")}var startPan=ani_p.startPan;var endPan=ani_p.pan;var pan=_p.pan;var animatingPan=endPan!=null&&isCore;if(animatingPan){if(valid(startPan.x,endPan.x)){pan.x=ease(startPan.x,endPan.x,percent,easing)}if(valid(startPan.y,endPan.y)){pan.y=ease(startPan.y,endPan.y,percent,easing)}self.trigger("pan")}var startZoom=ani_p.startZoom;var endZoom=ani_p.zoom;var animatingZoom=endZoom!=null&&isCore;if(animatingZoom){if(valid(startZoom,endZoom)){_p.zoom=ease(startZoom,endZoom,percent,easing)}self.trigger("zoom")}if(animatingPan||animatingZoom){self.trigger("viewport")}var props=ani_p.style;if(props&&props.length>0&&isEles){for(var i=0;i<props.length;i++){var prop=props[i];var name=prop.name;var end=prop;var start=ani_p.startStyle[name];var easedVal=ease(start,end,percent,easing);style.overrideBypass(self,name,easedVal)}self.trigger("style")}}ani_p.progress=percent;return percent}function valid(start,end){if(start==null||end==null){return false}if(is.number(start)&&is.number(end)){return true}else if(start&&end){return true}return false}function evalCubicBezier(p1,p2,t){var one_t=1-t;var tsq=t*t;return 3*one_t*one_t*t*p1+3*one_t*tsq*p2+tsq*t}function cubicBezier(p1,p2){return function(start,end,percent){return start+(end-start)*evalCubicBezier(p1,p2,percent)}}var generateSpringRK4=function(){function springAccelerationForState(state){return-state.tension*state.x-state.friction*state.v}function springEvaluateStateWithDerivative(initialState,dt,derivative){var state={x:initialState.x+derivative.dx*dt,v:initialState.v+derivative.dv*dt,tension:initialState.tension,friction:initialState.friction};return{dx:state.v,dv:springAccelerationForState(state)}}function springIntegrateState(state,dt){var a={dx:state.v,dv:springAccelerationForState(state)},b=springEvaluateStateWithDerivative(state,dt*.5,a),c=springEvaluateStateWithDerivative(state,dt*.5,b),d=springEvaluateStateWithDerivative(state,dt,c),dxdt=1/6*(a.dx+2*(b.dx+c.dx)+d.dx),dvdt=1/6*(a.dv+2*(b.dv+c.dv)+d.dv);state.x=state.x+dxdt*dt;state.v=state.v+dvdt*dt;return state}return function springRK4Factory(tension,friction,duration){var initState={x:-1,v:0,tension:null,friction:null},path=[0],time_lapsed=0,tolerance=1/1e4,DT=16/1e3,have_duration,dt,last_state;tension=parseFloat(tension)||500;friction=parseFloat(friction)||20;duration=duration||null;initState.tension=tension;initState.friction=friction;have_duration=duration!==null;if(have_duration){time_lapsed=springRK4Factory(tension,friction);dt=time_lapsed/duration*DT}else{dt=DT}while(true){last_state=springIntegrateState(last_state||initState,dt);path.push(1+last_state.x);time_lapsed+=16;if(!(Math.abs(last_state.x)>tolerance&&Math.abs(last_state.v)>tolerance)){break}}return!have_duration?time_lapsed:function(percentComplete){return path[percentComplete*(path.length-1)|0]}}}();var easings={linear:function(start,end,percent){return start+(end-start)*percent},ease:cubicBezier(.25,.1,.25,1),"ease-in":cubicBezier(.42,0,1,1),"ease-out":cubicBezier(0,0,.58,1),"ease-in-out":cubicBezier(.42,0,.58,1),"ease-in-sine":cubicBezier(.47,0,.745,.715),"ease-out-sine":cubicBezier(.39,.575,.565,1),"ease-in-out-sine":cubicBezier(.445,.05,.55,.95),"ease-in-quad":cubicBezier(.55,.085,.68,.53),"ease-out-quad":cubicBezier(.25,.46,.45,.94),"ease-in-out-quad":cubicBezier(.455,.03,.515,.955),"ease-in-cubic":cubicBezier(.55,.055,.675,.19),"ease-out-cubic":cubicBezier(.215,.61,.355,1),"ease-in-out-cubic":cubicBezier(.645,.045,.355,1),"ease-in-quart":cubicBezier(.895,.03,.685,.22),"ease-out-quart":cubicBezier(.165,.84,.44,1),"ease-in-out-quart":cubicBezier(.77,0,.175,1),"ease-in-quint":cubicBezier(.755,.05,.855,.06),"ease-out-quint":cubicBezier(.23,1,.32,1),"ease-in-out-quint":cubicBezier(.86,0,.07,1),"ease-in-expo":cubicBezier(.95,.05,.795,.035),"ease-out-expo":cubicBezier(.19,1,.22,1),"ease-in-out-expo":cubicBezier(1,0,0,1),"ease-in-circ":cubicBezier(.6,.04,.98,.335),"ease-out-circ":cubicBezier(.075,.82,.165,1),"ease-in-out-circ":cubicBezier(.785,.135,.15,.86),spring:function(tension,friction,duration){if(duration===0){return easings.linear}var spring=generateSpringRK4(tension,friction,duration);return function(start,end,percent){return start+(end-start)*spring(percent)}},"cubic-bezier":function(x1,y1,x2,y2){return cubicBezier(x1,y1,x2,y2)}};function ease(startProp,endProp,percent,easingFn){if(percent<0){percent=0}else if(percent>1){percent=1}var start,end;if(startProp.pfValue!=null||startProp.value!=null){start=startProp.pfValue!=null?startProp.pfValue:startProp.value}else{start=startProp}if(endProp.pfValue!=null||endProp.value!=null){end=endProp.pfValue!=null?endProp.pfValue:endProp.value}else{end=endProp}if(is.number(start)&&is.number(end)){return easingFn(start,end,percent)}else if(is.array(start)&&is.array(end)){var easedArr=[];for(var i=0;i<end.length;i++){var si=start[i];var ei=end[i];if(si!=null&&ei!=null){var val=easingFn(si,ei,percent);if(startProp.roundValue){val=Math.round(val)}easedArr.push(val)}else{easedArr.push(ei)}}return easedArr}return undefined}}};module.exports=corefn},{"../define":78,"../is":117,"../util":134}],69:[function(require,module,exports){"use strict";var define=require("../define");var corefn={on:define.on(),one:define.on({unbindSelfOnTrigger:true}),once:define.on({unbindAllBindersOnTrigger:true}),off:define.off(),trigger:define.trigger()};define.eventAliasesOn(corefn);module.exports=corefn},{"../define":78}],70:[function(require,module,exports){"use strict";var corefn={png:function(options){var renderer=this._private.renderer;options=options||{};return renderer.png(options)},jpg:function(options){var renderer=this._private.renderer;options=options||{};options.bg=options.bg||"#fff";return renderer.jpg(options)}};corefn.jpeg=corefn.jpg;module.exports=corefn},{}],71:[function(require,module,exports){"use strict";var window=require("../window");var util=require("../util");var Collection=require("../collection");var is=require("../is");var Promise=require("../promise");var define=require("../define");var Core=function(opts){var cy=this;opts=util.extend({},opts);var container=opts.container;if(container&&!is.htmlElement(container)&&is.htmlElement(container[0])){container=container[0]}var reg=container?container._cyreg:null;reg=reg||{};if(reg&&reg.cy){reg.cy.destroy();reg={}}var readies=reg.readies=reg.readies||[];if(container){container._cyreg=reg}reg.cy=cy;var head=window!==undefined&&container!==undefined&&!opts.headless;var options=opts;options.layout=util.extend({name:head?"grid":"null"},options.layout);options.renderer=util.extend({name:head?"canvas":"null"},options.renderer);var defVal=function(def,val,altVal){if(val!==undefined){return val}else if(altVal!==undefined){return altVal}else{return def}};var _p=this._private={container:container,ready:false,initrender:false,options:options,elements:new Collection(this),listeners:[],aniEles:new Collection(this),scratch:{},layout:null,renderer:null,notificationsEnabled:true,minZoom:1e-50,maxZoom:1e50,zoomingEnabled:defVal(true,options.zoomingEnabled),userZoomingEnabled:defVal(true,options.userZoomingEnabled),panningEnabled:defVal(true,options.panningEnabled),userPanningEnabled:defVal(true,options.userPanningEnabled),boxSelectionEnabled:defVal(true,options.boxSelectionEnabled),autolock:defVal(false,options.autolock,options.autolockNodes),autoungrabify:defVal(false,options.autoungrabify,options.autoungrabifyNodes),autounselectify:defVal(false,options.autounselectify),styleEnabled:options.styleEnabled===undefined?head:options.styleEnabled,zoom:is.number(options.zoom)?options.zoom:1,pan:{x:is.plainObject(options.pan)&&is.number(options.pan.x)?options.pan.x:0,y:is.plainObject(options.pan)&&is.number(options.pan.y)?options.pan.y:0},animation:{current:[],queue:[]},hasCompoundNodes:false};var selType=options.selectionType;if(selType===undefined||selType!=="additive"&&selType!=="single"){_p.selectionType="single"}else{_p.selectionType=selType}if(is.number(options.minZoom)&&is.number(options.maxZoom)&&options.minZoom<options.maxZoom){_p.minZoom=options.minZoom;_p.maxZoom=options.maxZoom}else if(is.number(options.minZoom)&&options.maxZoom===undefined){_p.minZoom=options.minZoom}else if(is.number(options.maxZoom)&&options.minZoom===undefined){_p.maxZoom=options.maxZoom}var loadExtData=function(extData,next){var anyIsPromise=extData.some(is.promise);if(anyIsPromise){return Promise.all(extData).then(next)}else{next(extData)}};cy.initRenderer(util.extend({hideEdgesOnViewport:options.hideEdgesOnViewport,textureOnViewport:options.textureOnViewport,wheelSensitivity:is.number(options.wheelSensitivity)&&options.wheelSensitivity>0?options.wheelSensitivity:1,motionBlur:options.motionBlur===undefined?false:options.motionBlur,motionBlurOpacity:options.motionBlurOpacity===undefined?.05:options.motionBlurOpacity,pixelRatio:is.number(options.pixelRatio)&&options.pixelRatio>0?options.pixelRatio:undefined,desktopTapThreshold:options.desktopTapThreshold===undefined?4:options.desktopTapThreshold,touchTapThreshold:options.touchTapThreshold===undefined?8:options.touchTapThreshold},options.renderer));loadExtData([options.style,options.elements],function(thens){var initStyle=thens[0];var initEles=thens[1];if(_p.styleEnabled){cy.setStyle(initStyle)}if(options.initrender){cy.on("initrender",options.initrender);cy.on("initrender",function(){_p.initrender=true})}cy.load(initEles,function(){cy.startAnimationLoop();_p.ready=true;if(is.fn(options.ready)){cy.on("ready",options.ready)}for(var i=0;i<readies.length;i++){var fn=readies[i];cy.on("ready",fn)}if(reg){reg.readies=[]}cy.trigger("ready")},options.done)})};var corefn=Core.prototype;util.extend(corefn,{instanceString:function(){return"core"},isReady:function(){return this._private.ready},ready:function(fn){if(this.isReady()){this.trigger("ready",[],fn)}else{this.on("ready",fn)}return this},initrender:function(){return this._private.initrender},destroy:function(){var cy=this;cy.stopAnimationLoop();cy.destroyRenderer();return cy},hasElementWithId:function(id){return this._private.elements.hasElementWithId(id)},getElementById:function(id){return this._private.elements.getElementById(id)},selectionType:function(){return this._private.selectionType},hasCompoundNodes:function(){return this._private.hasCompoundNodes},headless:function(){return this._private.options.renderer.name==="null"},styleEnabled:function(){return this._private.styleEnabled},addToPool:function(eles){this._private.elements.merge(eles);return this},removeFromPool:function(eles){this._private.elements.unmerge(eles);return this},container:function(){return this._private.container},options:function(){return util.copy(this._private.options)},json:function(obj){var cy=this;var _p=cy._private;var eles=cy.mutableElements();if(is.plainObject(obj)){cy.startBatch();if(obj.elements){var idInJson={};var updateEles=function(jsons,gr){for(var i=0;i<jsons.length;i++){var json=jsons[i];var id=json.data.id;var ele=cy.getElementById(id);idInJson[id]=true;if(ele.length!==0){ele.json(json)}else{if(gr){cy.add(util.extend({group:gr},json))}else{cy.add(json)}}}};if(is.array(obj.elements)){updateEles(obj.elements)}else{var grs=["nodes","edges"];for(var i=0;i<grs.length;i++){var gr=grs[i];var elements=obj.elements[gr];if(is.array(elements)){updateEles(elements,gr)}}}eles.stdFilter(function(ele){return!idInJson[ele.id()]}).remove()}if(obj.style){cy.style(obj.style)}if(obj.zoom!=null&&obj.zoom!==_p.zoom){cy.zoom(obj.zoom)}if(obj.pan){if(obj.pan.x!==_p.pan.x||obj.pan.y!==_p.pan.y){cy.pan(obj.pan)}}var fields=["minZoom","maxZoom","zoomingEnabled","userZoomingEnabled","panningEnabled","userPanningEnabled","boxSelectionEnabled","autolock","autoungrabify","autounselectify"];for(var i=0;i<fields.length;i++){var f=fields[i];if(obj[f]!=null){cy[f](obj[f])}}cy.endBatch();return this}else if(obj===undefined){var json={};json.elements={};eles.forEach(function(ele){var group=ele.group();if(!json.elements[group]){json.elements[group]=[]}json.elements[group].push(ele.json())});if(this._private.styleEnabled){json.style=cy.style().json()}json.zoomingEnabled=cy._private.zoomingEnabled;json.userZoomingEnabled=cy._private.userZoomingEnabled;json.zoom=cy._private.zoom;json.minZoom=cy._private.minZoom;json.maxZoom=cy._private.maxZoom;json.panningEnabled=cy._private.panningEnabled;json.userPanningEnabled=cy._private.userPanningEnabled;json.pan=util.copy(cy._private.pan);json.boxSelectionEnabled=cy._private.boxSelectionEnabled;json.renderer=util.copy(cy._private.options.renderer);json.hideEdgesOnViewport=cy._private.options.hideEdgesOnViewport;json.textureOnViewport=cy._private.options.textureOnViewport;json.wheelSensitivity=cy._private.options.wheelSensitivity;json.motionBlur=cy._private.options.motionBlur;return json}},scratch:define.data({field:"scratch",bindingEvent:"scratch",allowBinding:true,allowSetting:true,settingEvent:"scratch",settingTriggersEvent:true,triggerFnName:"trigger",allowGetting:true}),removeScratch:define.removeData({field:"scratch",event:"scratch",triggerFnName:"trigger",triggerEvent:true})});[require("./add-remove"),require("./animation"),require("./events"),require("./export"),require("./layout"),require("./notification"),require("./renderer"),require("./search"),require("./style"),require("./viewport")].forEach(function(props){util.extend(corefn,props)});module.exports=Core},{"../collection":60,"../define":78,"../is":117,"../promise":120,"../util":134,"../window":141,"./add-remove":67,"./animation":68,"./events":69,"./export":70,"./layout":72,"./notification":73,"./renderer":74,"./search":75,"./style":76,"./viewport":77}],72:[function(require,module,exports){"use strict";var util=require("../util");var is=require("../is");var corefn={layout:function(params){var layout=this._private.prevLayout=params==null?this._private.prevLayout:this.makeLayout(params);layout.run();return this},makeLayout:function(options){var cy=this;if(options==null){util.error("Layout options must be specified to make a layout");return}if(options.name==null){util.error("A `name` must be specified to make a layout");return}var name=options.name;var Layout=cy.extension("layout",name);if(Layout==null){util.error("Can not apply layout: No such layout `"+name+"` found; did you include its JS file?");return}var eles;if(is.string(options.eles)){eles=cy.$(options.eles)}else{eles=options.eles!=null?options.eles:cy.$()}var layout=new Layout(util.extend({},options,{cy:cy,eles:eles}));return layout}};corefn.createLayout=corefn.makeLayout;module.exports=corefn},{"../is":117,"../util":134}],73:[function(require,module,exports){"use strict";var corefn={notify:function(params){var _p=this._private;if(_p.batchingNotify){var bEles=_p.batchNotifyEles;var bTypes=_p.batchNotifyTypes;if(params.eles){bEles.merge(params.eles)}if(!bTypes.ids[params.type]){bTypes.push(params.type);bTypes.ids[params.type]=true}return}if(!_p.notificationsEnabled){return}var renderer=this.renderer();if(!renderer){return}renderer.notify(params)},notifications:function(bool){var p=this._private;if(bool===undefined){return p.notificationsEnabled}else{p.notificationsEnabled=bool?true:false}},noNotifications:function(callback){this.notifications(false);callback();this.notifications(true)},startBatch:function(){var _p=this._private;if(_p.batchCount==null){_p.batchCount=0}if(_p.batchCount===0){_p.batchingStyle=_p.batchingNotify=true;_p.batchStyleEles=this.collection();_p.batchNotifyEles=this.collection();_p.batchNotifyTypes=[];_p.batchNotifyTypes.ids={}}_p.batchCount++;return this},endBatch:function(){var _p=this._private;_p.batchCount--;if(_p.batchCount===0){_p.batchingStyle=false;_p.batchStyleEles.updateStyle();_p.batchingNotify=false;this.notify({type:_p.batchNotifyTypes,eles:_p.batchNotifyEles})}return this},batch:function(callback){this.startBatch();callback();this.endBatch();return this},batchData:function(map){var cy=this;return this.batch(function(){var ids=Object.keys(map);for(var i=0;i<ids.length;i++){var id=ids[i];var data=map[id];var ele=cy.getElementById(id);ele.data(data)}})}};module.exports=corefn},{}],74:[function(require,module,exports){"use strict";var util=require("../util");var corefn={renderTo:function(context,zoom,pan,pxRatio){var r=this._private.renderer;r.renderTo(context,zoom,pan,pxRatio);return this},renderer:function(){return this._private.renderer},forceRender:function(){this.notify({type:"draw"});return this},resize:function(){this.invalidateSize();this.notify({type:"resize"});this.trigger("resize");return this},initRenderer:function(options){var cy=this;var RendererProto=cy.extension("renderer",options.name);if(RendererProto==null){util.error("Can not initialise: No such renderer `%s` found; did you include its JS file?",options.name);return}var rOpts=util.extend({},options,{cy:cy});cy._private.renderer=new RendererProto(rOpts)},destroyRenderer:function(){var cy=this;cy.notify({type:"destroy"});var domEle=cy.container();if(domEle){domEle._cyreg=null;while(domEle.childNodes.length>0){domEle.removeChild(domEle.childNodes[0])}}cy._private.renderer=null},onRender:function(fn){return this.on("render",fn)},offRender:function(fn){return this.off("render",fn)}};corefn.invalidateDimensions=corefn.resize;module.exports=corefn},{"../util":134}],75:[function(require,module,exports){"use strict";var is=require("../is");var Collection=require("../collection");var corefn={collection:function(eles,opts){if(is.string(eles)){return this.$(eles)}else if(is.elementOrCollection(eles)){return eles.collection()}else if(is.array(eles)){return new Collection(this,eles,opts)}return new Collection(this)},nodes:function(selector){var nodes=this.$(function(){return this.isNode()});if(selector){return nodes.filter(selector)}return nodes},edges:function(selector){var edges=this.$(function(){return this.isEdge()});if(selector){return edges.filter(selector)}return edges},$:function(selector){var eles=this._private.elements;if(selector){return eles.filter(selector)}else{return eles.spawnSelf()}},mutableElements:function(){return this._private.elements}};corefn.elements=corefn.filter=corefn.$;module.exports=corefn},{"../collection":60,"../is":117}],76:[function(require,module,exports){"use strict";var is=require("../is");var Style=require("../style");var corefn={style:function(newStyle){if(newStyle){var s=this.setStyle(newStyle);s.update()}return this._private.style},setStyle:function(style){var _p=this._private;if(is.stylesheet(style)){_p.style=style.generateStyle(this)}else if(is.array(style)){_p.style=Style.fromJson(this,style)}else if(is.string(style)){_p.style=Style.fromString(this,style)}else{_p.style=Style(this)}return _p.style}};module.exports=corefn},{"../is":117,"../style":126}],77:[function(require,module,exports){"use strict";var is=require("../is");var corefn={autolock:function(bool){if(bool!==undefined){this._private.autolock=bool?true:false}else{return this._private.autolock}return this},autoungrabify:function(bool){if(bool!==undefined){this._private.autoungrabify=bool?true:false}else{return this._private.autoungrabify}return this},autounselectify:function(bool){if(bool!==undefined){this._private.autounselectify=bool?true:false}else{return this._private.autounselectify}return this},panningEnabled:function(bool){if(bool!==undefined){this._private.panningEnabled=bool?true:false}else{return this._private.panningEnabled}return this},userPanningEnabled:function(bool){if(bool!==undefined){this._private.userPanningEnabled=bool?true:false}else{return this._private.userPanningEnabled}return this},zoomingEnabled:function(bool){if(bool!==undefined){this._private.zoomingEnabled=bool?true:false}else{return this._private.zoomingEnabled}return this},userZoomingEnabled:function(bool){if(bool!==undefined){this._private.userZoomingEnabled=bool?true:false}else{return this._private.userZoomingEnabled}return this},boxSelectionEnabled:function(bool){if(bool!==undefined){this._private.boxSelectionEnabled=bool?true:false}else{return this._private.boxSelectionEnabled}return this},pan:function(){var args=arguments;var pan=this._private.pan;var dim,val,dims,x,y;switch(args.length){case 0:return pan;case 1:if(is.string(args[0])){dim=args[0];return pan[dim]}else if(is.plainObject(args[0])){if(!this._private.panningEnabled){return this}dims=args[0];x=dims.x;y=dims.y;if(is.number(x)){pan.x=x}if(is.number(y)){pan.y=y}this.trigger("pan viewport")}break;case 2:if(!this._private.panningEnabled){return this}dim=args[0];val=args[1];if((dim==="x"||dim==="y")&&is.number(val)){pan[dim]=val}this.trigger("pan viewport");break;default:break}this.notify({type:"viewport"});return this},panBy:function(params){var args=arguments;var pan=this._private.pan;var dim,val,dims,x,y;if(!this._private.panningEnabled){return this}switch(args.length){case 1:if(is.plainObject(args[0])){dims=args[0];x=dims.x;y=dims.y;if(is.number(x)){pan.x+=x}if(is.number(y)){pan.y+=y}this.trigger("pan viewport")}break;case 2:dim=args[0];val=args[1];if((dim==="x"||dim==="y")&&is.number(val)){pan[dim]+=val}this.trigger("pan viewport");break;default:break}this.notify({type:"viewport"});return this},fit:function(elements,padding){var viewportState=this.getFitViewport(elements,padding);if(viewportState){var _p=this._private;_p.zoom=viewportState.zoom;_p.pan=viewportState.pan;this.trigger("pan zoom viewport");this.notify({type:"viewport"})}return this},getFitViewport:function(elements,padding){if(is.number(elements)&&padding===undefined){padding=elements;elements=undefined}if(!this._private.panningEnabled||!this._private.zoomingEnabled){return}var bb;if(is.string(elements)){var sel=elements;elements=this.$(sel)}else if(is.boundingBox(elements)){var bbe=elements;bb={x1:bbe.x1,y1:bbe.y1,x2:bbe.x2,y2:bbe.y2};bb.w=bb.x2-bb.x1;bb.h=bb.y2-bb.y1}else if(!is.elementOrCollection(elements)){elements=this.mutableElements()}bb=bb||elements.boundingBox();var w=this.width();var h=this.height();var zoom;padding=is.number(padding)?padding:0;if(!isNaN(w)&&!isNaN(h)&&w>0&&h>0&&!isNaN(bb.w)&&!isNaN(bb.h)&&bb.w>0&&bb.h>0){zoom=Math.min((w-2*padding)/bb.w,(h-2*padding)/bb.h);zoom=zoom>this._private.maxZoom?this._private.maxZoom:zoom;zoom=zoom<this._private.minZoom?this._private.minZoom:zoom;var pan={x:(w-zoom*(bb.x1+bb.x2))/2,y:(h-zoom*(bb.y1+bb.y2))/2};return{zoom:zoom,pan:pan}}return},minZoom:function(zoom){if(zoom===undefined){return this._private.minZoom}else if(is.number(zoom)){this._private.minZoom=zoom}return this},maxZoom:function(zoom){if(zoom===undefined){return this._private.maxZoom}else if(is.number(zoom)){this._private.maxZoom=zoom}return this},zoom:function(params){var pos;var zoom;if(params===undefined){return this._private.zoom}else if(is.number(params)){zoom=params}else if(is.plainObject(params)){zoom=params.level;if(params.position){var p=params.position;var pan=this._private.pan;var z=this._private.zoom;pos={x:p.x*z+pan.x,y:p.y*z+pan.y}}else if(params.renderedPosition){pos=params.renderedPosition}if(pos&&!this._private.panningEnabled){return this}}if(!this._private.zoomingEnabled){return this}if(!is.number(zoom)||pos&&(!is.number(pos.x)||!is.number(pos.y))){return this}zoom=zoom>this._private.maxZoom?this._private.maxZoom:zoom;zoom=zoom<this._private.minZoom?this._private.minZoom:zoom;if(pos){var pan1=this._private.pan;var zoom1=this._private.zoom;var zoom2=zoom;var pan2={x:-zoom2/zoom1*(pos.x-pan1.x)+pos.x,y:-zoom2/zoom1*(pos.y-pan1.y)+pos.y};this._private.zoom=zoom;this._private.pan=pan2;var posChanged=pan1.x!==pan2.x||pan1.y!==pan2.y;this.trigger(" zoom "+(posChanged?" pan ":"")+" viewport ")}else{this._private.zoom=zoom;this.trigger("zoom viewport")}this.notify({type:"viewport"});return this},viewport:function(opts){var _p=this._private;var zoomDefd=true;var panDefd=true;var events=[];var zoomFailed=false;var panFailed=false;if(!opts){return this}if(!is.number(opts.zoom)){zoomDefd=false}if(!is.plainObject(opts.pan)){panDefd=false}if(!zoomDefd&&!panDefd){return this}if(zoomDefd){var z=opts.zoom;if(z<_p.minZoom||z>_p.maxZoom||!_p.zoomingEnabled){zoomFailed=true}else{_p.zoom=z;events.push("zoom")}}if(panDefd&&(!zoomFailed||!opts.cancelOnFailedZoom)&&_p.panningEnabled){var p=opts.pan;if(is.number(p.x)){_p.pan.x=p.x;panFailed=false}if(is.number(p.y)){_p.pan.y=p.y;panFailed=false}if(!panFailed){events.push("pan")}}if(events.length>0){events.push("viewport");this.trigger(events.join(" "));this.notify({type:"viewport"})}return this},center:function(elements){var pan=this.getCenterPan(elements);if(pan){this._private.pan=pan;this.trigger("pan viewport");this.notify({type:"viewport"})}return this},getCenterPan:function(elements,zoom){if(!this._private.panningEnabled){return}if(is.string(elements)){var selector=elements;elements=this.mutableElements().filter(selector)}else if(!is.elementOrCollection(elements)){elements=this.mutableElements()}var bb=elements.boundingBox();var w=this.width();var h=this.height();zoom=zoom===undefined?this._private.zoom:zoom;var pan={x:(w-zoom*(bb.x1+bb.x2))/2,y:(h-zoom*(bb.y1+bb.y2))/2};return pan},reset:function(){if(!this._private.panningEnabled||!this._private.zoomingEnabled){return this}this.viewport({pan:{x:0,y:0},zoom:1});return this},invalidateSize:function(){this._private.sizeCache=null},size:function(){var _p=this._private;var container=_p.container;return _p.sizeCache=_p.sizeCache||(container?{width:container.clientWidth,height:container.clientHeight}:{width:1,height:1})},width:function(){return this.size().width},height:function(){return this.size().height},extent:function(){var pan=this._private.pan;var zoom=this._private.zoom;var rb=this.renderedExtent();var b={x1:(rb.x1-pan.x)/zoom,x2:(rb.x2-pan.x)/zoom,y1:(rb.y1-pan.y)/zoom,y2:(rb.y2-pan.y)/zoom};b.w=b.x2-b.x1;b.h=b.y2-b.y1;return b},renderedExtent:function(){var width=this.width();var height=this.height();return{x1:0,y1:0,x2:width,y2:height,w:width,h:height}}};corefn.centre=corefn.center;corefn.autolockNodes=corefn.autolock;corefn.autoungrabifyNodes=corefn.autoungrabify;module.exports=corefn},{"../is":117}],78:[function(require,module,exports){"use strict";var util=require("./util");var is=require("./is");var Selector=require("./selector");var Promise=require("./promise");var Event=require("./event");var Animation=require("./animation");var define={data:function(params){var defaults={field:"data",bindingEvent:"data",allowBinding:false,allowSetting:false,allowGetting:false,settingEvent:"data",settingTriggersEvent:false,triggerFnName:"trigger",immutableKeys:{},updateStyle:false,onSet:function(self){},canSet:function(self){return true}};params=util.extend({},defaults,params);return function dataImpl(name,value){var p=params;var self=this;var selfIsArrayLike=self.length!==undefined;var all=selfIsArrayLike?self:[self];var single=selfIsArrayLike?self[0]:self;if(is.string(name)){if(p.allowGetting&&value===undefined){var ret;if(single){ret=single._private[p.field][name]}return ret}else if(p.allowSetting&&value!==undefined){var valid=!p.immutableKeys[name];if(valid){for(var i=0,l=all.length;i<l;i++){if(p.canSet(all[i])){all[i]._private[p.field][name]=value}}if(p.updateStyle){self.updateStyle()}p.onSet(self);if(p.settingTriggersEvent){self[p.triggerFnName](p.settingEvent)}}}}else if(p.allowSetting&&is.plainObject(name)){var obj=name;var k,v;var keys=Object.keys(obj);for(var i=0;i<keys.length;i++){k=keys[i];v=obj[k];var valid=!p.immutableKeys[k];if(valid){for(var j=0;j<all.length;j++){var ele=all[j];if(p.canSet(ele)){ele._private[p.field][k]=v}}}}if(p.updateStyle){self.updateStyle()}p.onSet(self);if(p.settingTriggersEvent){self[p.triggerFnName](p.settingEvent)}}else if(p.allowBinding&&is.fn(name)){var fn=name;self.on(p.bindingEvent,fn)}else if(p.allowGetting&&name===undefined){var ret;if(single){ret=single._private[p.field]}return ret}return self}},removeData:function(params){var defaults={field:"data",event:"data",triggerFnName:"trigger",triggerEvent:false,immutableKeys:{}};params=util.extend({},defaults,params);return function removeDataImpl(names){var p=params;var self=this;var selfIsArrayLike=self.length!==undefined;var all=selfIsArrayLike?self:[self];if(is.string(names)){var keys=names.split(/\s+/);var l=keys.length;for(var i=0;i<l;i++){var key=keys[i];if(is.emptyString(key)){continue}var valid=!p.immutableKeys[key];if(valid){for(var i_a=0,l_a=all.length;i_a<l_a;i_a++){all[i_a]._private[p.field][key]=undefined}}}if(p.triggerEvent){self[p.triggerFnName](p.event)}}else if(names===undefined){for(var i_a=0,l_a=all.length;i_a<l_a;i_a++){var _privateFields=all[i_a]._private[p.field];var keys=Object.keys(_privateFields);for(var i=0;i<keys.length;i++){var key=keys[i];var validKeyToDelete=!p.immutableKeys[key];if(validKeyToDelete){_privateFields[key]=undefined}}}if(p.triggerEvent){self[p.triggerFnName](p.event)}}return self}},event:{regex:/(\w+)(\.(?:\w+|\*))?/,universalNamespace:".*",optionalTypeRegex:/(\w+)?(\.(?:\w+|\*))?/,falseCallback:function(){return false}},on:function(params){var defaults={unbindSelfOnTrigger:false,unbindAllBindersOnTrigger:false};params=util.extend({},defaults,params);return function onImpl(events,selector,data,callback){var self=this;var selfIsArrayLike=self.length!==undefined;var all=selfIsArrayLike?self:[self];var eventsIsString=is.string(events);var p=params;if(is.plainObject(selector)){callback=data;data=selector;selector=undefined}else if(is.fn(selector)||selector===false){callback=selector;data=undefined;selector=undefined}if(is.fn(data)||data===false){callback=data;data=undefined}if(!(is.fn(callback)||callback===false)&&eventsIsString){return self}if(eventsIsString){var map={};map[events]=callback;events=map}var keys=Object.keys(events);for(var k=0;k<keys.length;k++){var evts=keys[k];callback=events[evts];if(callback===false){callback=define.event.falseCallback}if(!is.fn(callback)){continue}evts=evts.split(/\s+/);for(var i=0;i<evts.length;i++){var evt=evts[i];if(is.emptyString(evt)){continue}var match=evt.match(define.event.regex);if(match){var type=match[1];var namespace=match[2]?match[2]:undefined;var listener={callback:callback,data:data,delegated:selector?true:false,selector:selector,selObj:new Selector(selector),type:type,namespace:namespace,unbindSelfOnTrigger:p.unbindSelfOnTrigger,unbindAllBindersOnTrigger:p.unbindAllBindersOnTrigger,binders:all};for(var j=0;j<all.length;j++){var _p=all[j]._private=all[j]._private||{};_p.listeners=_p.listeners||[];_p.listeners.push(listener)}}}}return self}},eventAliasesOn:function(proto){var p=proto;p.addListener=p.listen=p.bind=p.on;p.removeListener=p.unlisten=p.unbind=p.off;p.emit=p.trigger;p.pon=p.promiseOn=function(events,selector){var self=this;var args=Array.prototype.slice.call(arguments,0);return new Promise(function(resolve,reject){var callback=function(e){self.off.apply(self,offArgs);resolve(e)};var onArgs=args.concat([callback]);var offArgs=onArgs.concat([]);self.on.apply(self,onArgs)})}},off:function offImpl(params){var defaults={};params=util.extend({},defaults,params);return function(events,selector,callback){var self=this;var selfIsArrayLike=self.length!==undefined;var all=selfIsArrayLike?self:[self];var eventsIsString=is.string(events);if(arguments.length===0){for(var i=0;i<all.length;i++){all[i]._private=all[i]._private||{};_p.listeners=[]}return self}if(is.fn(selector)||selector===false){callback=selector;selector=undefined}if(eventsIsString){var map={};map[events]=callback;events=map}var keys=Object.keys(events);for(var k=0;k<keys.length;k++){var evts=keys[k];callback=events[evts];if(callback===false){callback=define.event.falseCallback}evts=evts.split(/\s+/);for(var h=0;h<evts.length;h++){var evt=evts[h];if(is.emptyString(evt)){continue}var match=evt.match(define.event.optionalTypeRegex);if(match){var type=match[1]?match[1]:undefined;var namespace=match[2]?match[2]:undefined;for(var i=0;i<all.length;i++){var _p=all[i]._private=all[i]._private||{};var listeners=_p.listeners=_p.listeners||[];for(var j=0;j<listeners.length;j++){var listener=listeners[j];var nsMatches=!namespace||namespace===listener.namespace;var typeMatches=!type||listener.type===type;var cbMatches=!callback||callback===listener.callback;var listenerMatches=nsMatches&&typeMatches&&cbMatches;if(listenerMatches){listeners.splice(j,1);j--}}}}}}return self}},trigger:function(params){var defaults={};params=util.extend({},defaults,params);return function triggerImpl(events,extraParams,fnToTrigger){var self=this;var selfIsArrayLike=self.length!==undefined;var all=selfIsArrayLike?self:[self];var eventsIsString=is.string(events);var eventsIsObject=is.plainObject(events);var eventsIsEvent=is.event(events);var _p=this._private=this._private||{};var cy=_p.cy||(is.core(this)?this:null);var hasCompounds=cy?cy.hasCompoundNodes():false;if(eventsIsString){var evts=events.split(/\s+/);events=[];for(var i=0;i<evts.length;i++){var evt=evts[i];if(is.emptyString(evt)){continue}var match=evt.match(define.event.regex);var type=match[1];var namespace=match[2]?match[2]:undefined;events.push({type:type,namespace:namespace})}}else if(eventsIsObject){var eventArgObj=events;events=[eventArgObj]}if(extraParams){if(!is.array(extraParams)){extraParams=[extraParams]}}else{extraParams=[]}for(var i=0;i<events.length;i++){var evtObj=events[i];for(var j=0;j<all.length;j++){var triggerer=all[j];var _p=triggerer._private=triggerer._private||{};var listeners=_p.listeners=_p.listeners||[];var triggererIsElement=is.element(triggerer);var bubbleUp=triggererIsElement||params.layout;var evt;if(eventsIsEvent){evt=evtObj;evt.cyTarget=evt.cyTarget||triggerer;evt.cy=evt.cy||cy}else{evt=new Event(evtObj,{cyTarget:triggerer,cy:cy,namespace:evtObj.namespace})}if(evtObj.layout){evt.layout=evtObj.layout}if(params.layout){evt.layout=triggerer}if(evt.cyPosition){var pos=evt.cyPosition;var zoom=cy.zoom();var pan=cy.pan();evt.cyRenderedPosition={x:pos.x*zoom+pan.x,y:pos.y*zoom+pan.y}}if(fnToTrigger){listeners=[{namespace:evt.namespace,type:evt.type,callback:fnToTrigger}]}for(var k=0;k<listeners.length;k++){var lis=listeners[k];var nsMatches=!lis.namespace||lis.namespace===evt.namespace||lis.namespace===define.event.universalNamespace;var typeMatches=lis.type===evt.type;var targetMatches=lis.delegated?triggerer!==evt.cyTarget&&is.element(evt.cyTarget)&&lis.selObj.matches(evt.cyTarget):true;var listenerMatches=nsMatches&&typeMatches&&targetMatches;if(listenerMatches){var args=[evt];args=args.concat(extraParams);if(lis.data){evt.data=lis.data}else{evt.data=undefined}if(lis.unbindSelfOnTrigger||lis.unbindAllBindersOnTrigger){listeners.splice(k,1);k--}if(lis.unbindAllBindersOnTrigger){var binders=lis.binders;for(var l=0;l<binders.length;l++){var binder=binders[l];if(!binder||binder===triggerer){continue}var binderListeners=binder._private.listeners;for(var m=0;m<binderListeners.length;m++){var binderListener=binderListeners[m];if(binderListener===lis){binderListeners.splice(m,1);m--}}}}var context=lis.delegated?evt.cyTarget:triggerer;var ret=lis.callback.apply(context,args);if(ret===false||evt.isPropagationStopped()){bubbleUp=false;if(ret===false){evt.stopPropagation();evt.preventDefault()}}}}if(bubbleUp){var parent=hasCompounds?triggerer._private.parent:null;var hasParent=parent!=null&&parent.length!==0;if(hasParent){parent=parent[0];parent.trigger(evt)}else{cy.trigger(evt)}}}}return self}},animated:function(fnParams){var defaults={};fnParams=util.extend({},defaults,fnParams);return function animatedImpl(){var self=this;var selfIsArrayLike=self.length!==undefined;var all=selfIsArrayLike?self:[self];var cy=this._private.cy||this;if(!cy.styleEnabled()){return false}var ele=all[0];if(ele){return ele._private.animation.current.length>0}}},clearQueue:function(fnParams){var defaults={};fnParams=util.extend({},defaults,fnParams);return function clearQueueImpl(){var self=this;var selfIsArrayLike=self.length!==undefined;var all=selfIsArrayLike?self:[self];var cy=this._private.cy||this;if(!cy.styleEnabled()){return this}for(var i=0;i<all.length;i++){var ele=all[i];ele._private.animation.queue=[]}return this}},delay:function(fnParams){var defaults={};fnParams=util.extend({},defaults,fnParams);return function delayImpl(time,complete){var cy=this._private.cy||this;if(!cy.styleEnabled()){return this}return this.animate({delay:time,duration:time,complete:complete})}},delayAnimation:function(fnParams){var defaults={};fnParams=util.extend({},defaults,fnParams);return function delayAnimationImpl(time,complete){var cy=this._private.cy||this;if(!cy.styleEnabled()){return this}return this.animation({delay:time,duration:time,complete:complete})}},animation:function(fnParams){var defaults={};fnParams=util.extend({},defaults,fnParams);return function animationImpl(properties,params){var self=this;var selfIsArrayLike=self.length!==undefined;var all=selfIsArrayLike?self:[self];var cy=this._private.cy||this;var isCore=!selfIsArrayLike;var isEles=!isCore;if(!cy.styleEnabled()){return this}var style=cy.style();properties=util.extend({},properties,params);if(properties.duration===undefined){properties.duration=400}switch(properties.duration){case"slow":properties.duration=600;break;case"fast":properties.duration=200;break}var propertiesEmpty=Object.keys(properties).length===0;if(propertiesEmpty){return new Animation(all[0],properties)}if(isEles){properties.style=style.getPropsList(properties.style||properties.css);properties.css=undefined}if(properties.renderedPosition&&isEles){var rpos=properties.renderedPosition;var pan=cy.pan();var zoom=cy.zoom();properties.position={x:(rpos.x-pan.x)/zoom,y:(rpos.y-pan.y)/zoom}}if(properties.panBy&&isCore){var panBy=properties.panBy;var cyPan=cy.pan();properties.pan={x:cyPan.x+panBy.x,y:cyPan.y+panBy.y}}var center=properties.center||properties.centre;if(center&&isCore){var centerPan=cy.getCenterPan(center.eles,properties.zoom);if(centerPan){properties.pan=centerPan}}if(properties.fit&&isCore){var fit=properties.fit;var fitVp=cy.getFitViewport(fit.eles||fit.boundingBox,fit.padding);if(fitVp){properties.pan=fitVp.pan;properties.zoom=fitVp.zoom}}return new Animation(all[0],properties)}},animate:function(fnParams){var defaults={};fnParams=util.extend({},defaults,fnParams);return function animateImpl(properties,params){var self=this;var selfIsArrayLike=self.length!==undefined;var all=selfIsArrayLike?self:[self];var cy=this._private.cy||this;if(!cy.styleEnabled()){return this}if(params){properties=util.extend({},properties,params)}for(var i=0;i<all.length;i++){var ele=all[i];var queue=ele.animated()&&(properties.queue===undefined||properties.queue);var ani=ele.animation(properties,queue?{queue:true}:undefined);ani.play()}return this}},stop:function(fnParams){var defaults={};fnParams=util.extend({},defaults,fnParams);return function stopImpl(clearQueue,jumpToEnd){var self=this;var selfIsArrayLike=self.length!==undefined;var all=selfIsArrayLike?self:[self];var cy=this._private.cy||this;if(!cy.styleEnabled()){return this}for(var i=0;i<all.length;i++){var ele=all[i];var _p=ele._private;var anis=_p.animation.current;for(var j=0;j<anis.length;j++){var ani=anis[j];var ani_p=ani._private;if(jumpToEnd){ani_p.duration=0}}if(clearQueue){_p.animation.queue=[]}if(!jumpToEnd){_p.animation.current=[]}}cy.notify({eles:this,type:"draw"});return this}}};module.exports=define},{"./animation":36,"./event":79,"./is":117,"./promise":120,"./selector":121,"./util":134}],79:[function(require,module,exports){"use strict";var Event=function(src,props){if(!(this instanceof Event)){return new Event(src,props)}if(src&&src.type){this.originalEvent=src;this.type=src.type;this.isDefaultPrevented=src.defaultPrevented?returnTrue:returnFalse}else{this.type=src}if(props){this.type=props.type!==undefined?props.type:this.type;this.cy=props.cy;this.cyTarget=props.cyTarget;this.cyPosition=props.cyPosition;this.cyRenderedPosition=props.cyRenderedPosition;this.namespace=props.namespace;this.layout=props.layout;this.data=props.data;this.message=props.message}this.timeStamp=src&&src.timeStamp||Date.now()};function returnFalse(){return false}function returnTrue(){return true}Event.prototype={instanceString:function(){return"event"},preventDefault:function(){this.isDefaultPrevented=returnTrue;var e=this.originalEvent;if(!e){return}if(e.preventDefault){e.preventDefault()}},stopPropagation:function(){this.isPropagationStopped=returnTrue;var e=this.originalEvent;if(!e){return}if(e.stopPropagation){e.stopPropagation()}},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue;this.stopPropagation()},isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse};module.exports=Event},{}],80:[function(require,module,exports){"use strict";var util=require("./util");var define=require("./define");var Collection=require("./collection");var Core=require("./core");var incExts=require("./extensions");var is=require("./is");var extensions={};var modules={};function setExtension(type,name,registrant){var ext=registrant;var overrideErr=function(field){util.error("Can not register `"+name+"` for `"+type+"` since `"+field+"` already exists in the prototype and can not be overridden")};if(type==="core"){if(Core.prototype[name]){return overrideErr(name)}else{Core.prototype[name]=registrant}}else if(type==="collection"){if(Collection.prototype[name]){return overrideErr(name)}else{Collection.prototype[name]=registrant}}else if(type==="layout"){var Layout=function(options){this.options=options;registrant.call(this,options);if(!is.plainObject(this._private)){this._private={}}this._private.cy=options.cy;this._private.listeners=[]};var layoutProto=Layout.prototype=Object.create(registrant.prototype);var optLayoutFns=[];for(var i=0;i<optLayoutFns.length;i++){var fnName=optLayoutFns[i];layoutProto[fnName]=layoutProto[fnName]||function(){return this}}if(layoutProto.start&&!layoutProto.run){layoutProto.run=function(){this.start();return this}}else if(!layoutProto.start&&layoutProto.run){layoutProto.start=function(){this.run();return this}}if(!layoutProto.stop){layoutProto.stop=function(){var opts=this.options;if(opts&&opts.animate){var anis=this.animations;for(var i=0;i<anis.length;i++){anis[i].stop()}}this.trigger("layoutstop");return this}}if(!layoutProto.destroy){layoutProto.destroy=function(){return this}}layoutProto.on=define.on({layout:true});layoutProto.one=define.on({layout:true,unbindSelfOnTrigger:true});layoutProto.once=define.on({layout:true,unbindAllBindersOnTrigger:true});layoutProto.off=define.off({layout:true});layoutProto.trigger=define.trigger({layout:true});define.eventAliasesOn(layoutProto);ext=Layout}else if(type==="renderer"&&name!=="null"&&name!=="base"){var BaseRenderer=getExtension("renderer","base");var bProto=BaseRenderer.prototype;var RegistrantRenderer=registrant;var rProto=registrant.prototype;var Renderer=function(){BaseRenderer.apply(this,arguments);RegistrantRenderer.apply(this,arguments)};var proto=Renderer.prototype;for(var pName in bProto){var pVal=bProto[pName];var existsInR=rProto[pName]!=null;if(existsInR){return overrideErr(pName)}proto[pName]=pVal}for(var pName in rProto){proto[pName]=rProto[pName]}bProto.clientFunctions.forEach(function(name){proto[name]=proto[name]||function(){util.error("Renderer does not implement `renderer."+name+"()` on its prototype")}});ext=Renderer}return util.setMap({map:extensions,keys:[type,name],value:ext})}function getExtension(type,name){return util.getMap({map:extensions,keys:[type,name]})}function setModule(type,name,moduleType,moduleName,registrant){return util.setMap({map:modules,keys:[type,name,moduleType,moduleName],value:registrant})}function getModule(type,name,moduleType,moduleName){return util.getMap({map:modules,keys:[type,name,moduleType,moduleName]})}var extension=function(){if(arguments.length===2){return getExtension.apply(null,arguments)}else if(arguments.length===3){return setExtension.apply(null,arguments)}else if(arguments.length===4){return getModule.apply(null,arguments)}else if(arguments.length===5){return setModule.apply(null,arguments)}else{util.error("Invalid extension access syntax")}};Core.prototype.extension=extension;incExts.forEach(function(group){group.extensions.forEach(function(ext){setExtension(group.type,ext.name,ext.impl)})});module.exports=extension},{"./collection":60,"./core":71,"./define":78,"./extensions":81,"./is":117,"./util":134}],81:[function(require,module,exports){"use strict";module.exports=[{type:"layout",extensions:require("./layout")},{type:"renderer",extensions:require("./renderer")}]},{"./layout":87,"./renderer":112}],82:[function(require,module,exports){"use strict";var util=require("../../util");var math=require("../../math");var is=require("../../is");var defaults={fit:true,directed:false,padding:30,circle:false,spacingFactor:1.75,boundingBox:undefined,avoidOverlap:true,roots:undefined,maximalAdjustments:0,animate:false,animationDuration:500,animationEasing:undefined,ready:undefined,stop:undefined};function BreadthFirstLayout(options){this.options=util.extend({},defaults,options)}BreadthFirstLayout.prototype.run=function(){var params=this.options;var options=params;var cy=params.cy;var eles=options.eles;var nodes=eles.nodes().not(":parent");var graph=eles;var bb=math.makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()});var roots;if(is.elementOrCollection(options.roots)){roots=options.roots}else if(is.array(options.roots)){var rootsArray=[];for(var i=0;i<options.roots.length;i++){var id=options.roots[i];var ele=cy.getElementById(id);rootsArray.push(ele)}roots=cy.collection(rootsArray)}else if(is.string(options.roots)){roots=cy.$(options.roots)}else{if(options.directed){roots=nodes.roots()}else{var components=[];var unhandledNodes=nodes;while(unhandledNodes.length>0){var currComp=cy.collection();eles.bfs({roots:unhandledNodes[0],visit:function(i,depth,node,edge,pNode){currComp=currComp.add(node)},directed:false});unhandledNodes=unhandledNodes.not(currComp);components.push(currComp)}roots=cy.collection();for(var i=0;i<components.length;i++){var comp=components[i];var maxDegree=comp.maxDegree(false);var compRoots=comp.filter(function(){return this.degree(false)===maxDegree});roots=roots.add(compRoots)}}}var depths=[];var foundByBfs={};var id2depth={};var prevNode={};var prevEdge={};var successors={};graph.bfs({roots:roots,directed:options.directed,visit:function(i,depth,node,edge,pNode){var ele=this[0];var id=ele.id();if(!depths[depth]){depths[depth]=[]}depths[depth].push(ele);foundByBfs[id]=true;id2depth[id]=depth;prevNode[id]=pNode;prevEdge[id]=edge;if(pNode){var prevId=pNode.id();var succ=successors[prevId]=successors[prevId]||[];succ.push(node)}}});var orphanNodes=[];for(var i=0;i<nodes.length;i++){var ele=nodes[i];if(foundByBfs[ele.id()]){continue}else{orphanNodes.push(ele)}}var maxChecks=orphanNodes.length*3;var checks=0;while(orphanNodes.length!==0&&checks<maxChecks){var node=orphanNodes.shift();var neighbors=node.neighborhood().nodes();var assignedDepth=false;for(var i=0;i<neighbors.length;i++){var depth=id2depth[neighbors[i].id()];if(depth!==undefined){depths[depth].push(node);assignedDepth=true;break}}if(!assignedDepth){orphanNodes.push(node)}checks++}while(orphanNodes.length!==0){var node=orphanNodes.shift();var assignedDepth=false;if(!assignedDepth){if(depths.length===0){depths.push([])}depths[0].push(node)}}var assignDepthsToEles=function(){for(var i=0;i<depths.length;i++){var eles=depths[i];for(var j=0;j<eles.length;j++){var ele=eles[j];ele._private.scratch.breadthfirst={depth:i,index:j}}}};assignDepthsToEles();var intersectsDepth=function(node){var edges=node.connectedEdges(function(){return this.data("target")===node.id()});var thisInfo=node._private.scratch.breadthfirst;var highestDepthOfOther=0;var highestOther;for(var i=0;i<edges.length;i++){var edge=edges[i];var otherNode=edge.source()[0];var otherInfo=otherNode._private.scratch.breadthfirst;if(thisInfo.depth<=otherInfo.depth&&highestDepthOfOther<otherInfo.depth){highestDepthOfOther=otherInfo.depth;highestOther=otherNode}}return highestOther};for(var adj=0;adj<options.maximalAdjustments;adj++){var nDepths=depths.length;var elesToMove=[];for(var i=0;i<nDepths;i++){var depth=depths[i];var nDepth=depth.length;for(var j=0;j<nDepth;j++){var ele=depth[j];var info=ele._private.scratch.breadthfirst;var intEle=intersectsDepth(ele);if(intEle){info.intEle=intEle;elesToMove.push(ele)}}}for(var i=0;i<elesToMove.length;i++){var ele=elesToMove[i];var info=ele._private.scratch.breadthfirst;var intEle=info.intEle;var intInfo=intEle._private.scratch.breadthfirst;depths[info.depth].splice(info.index,1);var newDepth=intInfo.depth+1;while(newDepth>depths.length-1){depths.push([])}depths[newDepth].push(ele);info.depth=newDepth;info.index=depths[newDepth].length-1}assignDepthsToEles()}var minDistance=0;if(options.avoidOverlap){for(var i=0;i<nodes.length;i++){var n=nodes[i];var nbb=n.boundingBox();var w=nbb.w;var h=nbb.h;minDistance=Math.max(minDistance,w,h)}minDistance*=options.spacingFactor}var cachedWeightedPercent={};var getWeightedPercent=function(ele){if(cachedWeightedPercent[ele.id()]){return cachedWeightedPercent[ele.id()]}var eleDepth=ele._private.scratch.breadthfirst.depth;var neighbors=ele.neighborhood().nodes().not(":parent");var percent=0;var samples=0;for(var i=0;i<neighbors.length;i++){var neighbor=neighbors[i];var bf=neighbor._private.scratch.breadthfirst;var index=bf.index;var depth=bf.depth;var nDepth=depths[depth].length;if(eleDepth>depth||eleDepth===0){percent+=index/nDepth;samples++}}samples=Math.max(1,samples);percent=percent/samples;if(samples===0){percent=undefined}cachedWeightedPercent[ele.id()]=percent;return percent};var sortFn=function(a,b){var apct=getWeightedPercent(a);var bpct=getWeightedPercent(b);return apct-bpct};for(var times=0;times<3;times++){for(var i=0;i<depths.length;i++){depths[i]=depths[i].sort(sortFn)}assignDepthsToEles()}var biggestDepthSize=0;for(var i=0;i<depths.length;i++){biggestDepthSize=Math.max(depths[i].length,biggestDepthSize)}var center={x:bb.x1+bb.w/2,y:bb.x1+bb.h/2};var getPosition=function(ele,isBottomDepth){var info=ele._private.scratch.breadthfirst;var depth=info.depth;var index=info.index;var depthSize=depths[depth].length;var distanceX=Math.max(bb.w/(depthSize+1),minDistance);var distanceY=Math.max(bb.h/(depths.length+1),minDistance);var radiusStepSize=Math.min(bb.w/2/depths.length,bb.h/2/depths.length);radiusStepSize=Math.max(radiusStepSize,minDistance);if(!options.circle){var epos={x:center.x+(index+1-(depthSize+1)/2)*distanceX,y:(depth+1)*distanceY};if(isBottomDepth){return epos}return epos}else{if(options.circle){var radius=radiusStepSize*depth+radiusStepSize-(depths.length>0&&depths[0].length<=3?radiusStepSize/2:0);var theta=2*Math.PI/depths[depth].length*index;if(depth===0&&depths[0].length===1){radius=1}return{x:center.x+radius*Math.cos(theta),y:center.y+radius*Math.sin(theta)}}else{return{x:center.x+(index+1-(depthSize+1)/2)*distanceX,y:(depth+1)*distanceY}}}};var pos={};for(var i=depths.length-1;i>=0;i--){var depth=depths[i];for(var j=0;j<depth.length;j++){var node=depth[j];pos[node.id()]=getPosition(node,i===depths.length-1)}}nodes.layoutPositions(this,options,function(){return pos[this.id()]});return this};module.exports=BreadthFirstLayout},{"../../is":117,"../../math":119,"../../util":134}],83:[function(require,module,exports){"use strict";var util=require("../../util");var math=require("../../math");var is=require("../../is");var defaults={fit:true,padding:30,boundingBox:undefined,avoidOverlap:true,radius:undefined,startAngle:3/2*Math.PI,sweep:undefined,clockwise:true,sort:undefined,animate:false,animationDuration:500,animationEasing:undefined,ready:undefined,stop:undefined};function CircleLayout(options){this.options=util.extend({},defaults,options)}CircleLayout.prototype.run=function(){var params=this.options;var options=params;var cy=params.cy;var eles=options.eles;var clockwise=options.counterclockwise!==undefined?!options.counterclockwise:options.clockwise;var nodes=eles.nodes().not(":parent");if(options.sort){nodes=nodes.sort(options.sort)}var bb=math.makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()});var center={x:bb.x1+bb.w/2,y:bb.y1+bb.h/2};var sweep=options.sweep===undefined?2*Math.PI-2*Math.PI/nodes.length:options.sweep;var dTheta=sweep/Math.max(1,nodes.length-1);var r;var minDistance=0;for(var i=0;i<nodes.length;i++){var n=nodes[i];var nbb=n.boundingBox();var w=nbb.w;var h=nbb.h;minDistance=Math.max(minDistance,w,h)}if(is.number(options.radius)){r=options.radius}else if(nodes.length<=1){r=0}else{r=Math.min(bb.h,bb.w)/2-minDistance}if(nodes.length>1&&options.avoidOverlap){minDistance*=1.75;var dcos=Math.cos(dTheta)-Math.cos(0);var dsin=Math.sin(dTheta)-Math.sin(0);var rMin=Math.sqrt(minDistance*minDistance/(dcos*dcos+dsin*dsin));r=Math.max(rMin,r)}var getPos=function(i,ele){var theta=options.startAngle+i*dTheta*(clockwise?1:-1);var rx=r*Math.cos(theta);var ry=r*Math.sin(theta);var pos={x:center.x+rx,y:center.y+ry};return pos};nodes.layoutPositions(this,options,getPos);return this};module.exports=CircleLayout},{"../../is":117,"../../math":119,"../../util":134}],84:[function(require,module,exports){"use strict";var util=require("../../util");var math=require("../../math");var defaults={fit:true,padding:30,startAngle:3/2*Math.PI,sweep:undefined,clockwise:true,equidistant:false,minNodeSpacing:10,boundingBox:undefined,avoidOverlap:true,height:undefined,width:undefined,concentric:function(node){return node.degree()},levelWidth:function(nodes){return nodes.maxDegree()/4},animate:false,animationDuration:500,animationEasing:undefined,ready:undefined,stop:undefined};function ConcentricLayout(options){this.options=util.extend({},defaults,options)}ConcentricLayout.prototype.run=function(){var params=this.options;var options=params;var clockwise=options.counterclockwise!==undefined?!options.counterclockwise:options.clockwise;var cy=params.cy;var eles=options.eles;var nodes=eles.nodes().not(":parent");var bb=math.makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()});var center={x:bb.x1+bb.w/2,y:bb.y1+bb.h/2};var nodeValues=[];var theta=options.startAngle;var maxNodeSize=0;for(var i=0;i<nodes.length;i++){var node=nodes[i];var value;value=options.concentric.apply(node,[node]);nodeValues.push({value:value,node:node});node._private.scratch.concentric=value}nodes.updateStyle();for(var i=0;i<nodes.length;i++){var node=nodes[i];var nbb=node.boundingBox();maxNodeSize=Math.max(maxNodeSize,nbb.w,nbb.h)}nodeValues.sort(function(a,b){return b.value-a.value});var levelWidth=options.levelWidth(nodes);var levels=[[]];var currentLevel=levels[0];for(var i=0;i<nodeValues.length;i++){var val=nodeValues[i];if(currentLevel.length>0){var diff=Math.abs(currentLevel[0].value-val.value);if(diff>=levelWidth){currentLevel=[];levels.push(currentLevel)}}currentLevel.push(val)}var minDist=maxNodeSize+options.minNodeSpacing;if(!options.avoidOverlap){var firstLvlHasMulti=levels.length>0&&levels[0].length>1;var maxR=Math.min(bb.w,bb.h)/2-minDist;var rStep=maxR/(levels.length+firstLvlHasMulti?1:0);minDist=Math.min(minDist,rStep)}var r=0;for(var i=0;i<levels.length;i++){var level=levels[i];var sweep=options.sweep===undefined?2*Math.PI-2*Math.PI/level.length:options.sweep;var dTheta=level.dTheta=sweep/Math.max(1,level.length-1);if(level.length>1&&options.avoidOverlap){var dcos=Math.cos(dTheta)-Math.cos(0);var dsin=Math.sin(dTheta)-Math.sin(0);var rMin=Math.sqrt(minDist*minDist/(dcos*dcos+dsin*dsin));r=Math.max(rMin,r)}level.r=r;r+=minDist}if(options.equidistant){var rDeltaMax=0;var r=0;for(var i=0;i<levels.length;i++){var level=levels[i];var rDelta=level.r-r;rDeltaMax=Math.max(rDeltaMax,rDelta)}r=0;for(var i=0;i<levels.length;i++){var level=levels[i];if(i===0){r=level.r}level.r=r;r+=rDeltaMax}}var pos={};for(var i=0;i<levels.length;i++){var level=levels[i];var dTheta=level.dTheta;var r=level.r;for(var j=0;j<level.length;j++){var val=level[j];var theta=options.startAngle+(clockwise?1:-1)*dTheta*j;var p={x:center.x+r*Math.cos(theta),y:center.y+r*Math.sin(theta)};pos[val.node.id()]=p}}nodes.layoutPositions(this,options,function(){var id=this.id();return pos[id]});return this};module.exports=ConcentricLayout},{"../../math":119,"../../util":134}],85:[function(require,module,exports){"use strict";var util=require("../../util");var math=require("../../math");var Thread=require("../../thread");var is=require("../../is");var DEBUG;var defaults={ready:function(){},stop:function(){},animate:true,animationThreshold:250,refresh:20,fit:true,padding:30,boundingBox:undefined,randomize:false,componentSpacing:100,nodeRepulsion:function(node){return 4e5},nodeOverlap:10,idealEdgeLength:function(edge){return 10},edgeElasticity:function(edge){return 100},nestingFactor:5,gravity:80,numIter:1e3,initialTemp:200,coolingFactor:.95,minTemp:1,useMultitasking:true};function CoseLayout(options){this.options=util.extend({},defaults,options);this.options.layout=this}CoseLayout.prototype.run=function(){var options=this.options;var cy=options.cy;var layout=this;var thread=this.thread;if(!thread||thread.stopped()){thread=this.thread=Thread({disabled:!options.useMultitasking})}layout.stopped=false;layout.trigger({type:"layoutstart",layout:layout});if(true===options.debug){DEBUG=true}else{DEBUG=false}var layoutInfo=createLayoutInfo(cy,layout,options);if(DEBUG){printLayoutInfo(layoutInfo)}if(options.randomize){randomizePositions(layoutInfo,cy)}var startTime=Date.now();var refreshRequested=false;var refresh=function(rOpts){rOpts=rOpts||{};if(refreshRequested&&!rOpts.next){return}if(!rOpts.force&&Date.now()-startTime<options.animationThreshold){return}refreshRequested=true;util.requestAnimationFrame(function(){refreshPositions(layoutInfo,cy,options);if(true===options.fit){cy.fit(options.padding)}refreshRequested=false;if(rOpts.next){rOpts.next()}})};thread.on("message",function(e){var layoutNodes=e.message;layoutInfo.layoutNodes=layoutNodes;refresh()});thread.pass({layoutInfo:layoutInfo,options:{animate:options.animate,refresh:options.refresh,componentSpacing:options.componentSpacing,nodeOverlap:options.nodeOverlap,nestingFactor:options.nestingFactor,gravity:options.gravity,numIter:options.numIter,initialTemp:options.initialTemp,coolingFactor:options.coolingFactor,minTemp:options.minTemp}}).run(function(pass){var layoutInfo=pass.layoutInfo;var options=pass.options;var stopped=false;var step=function(layoutInfo,options,step){calculateNodeForces(layoutInfo,options);calculateEdgeForces(layoutInfo,options);calculateGravityForces(layoutInfo,options);propagateForces(layoutInfo,options);updatePositions(layoutInfo,options)};var calculateNodeForces=function(layoutInfo,options){for(var i=0;i<layoutInfo.graphSet.length;i++){var graph=layoutInfo.graphSet[i];var numNodes=graph.length;for(var j=0;j<numNodes;j++){var node1=layoutInfo.layoutNodes[layoutInfo.idToIndex[graph[j]]];for(var k=j+1;k<numNodes;k++){var node2=layoutInfo.layoutNodes[layoutInfo.idToIndex[graph[k]]];nodeRepulsion(node1,node2,layoutInfo,options)}}}};var nodeRepulsion=function(node1,node2,layoutInfo,options){var cmptId1=node1.cmptId;var cmptId2=node2.cmptId;if(cmptId1!==cmptId2&&!layoutInfo.isCompound){return}var directionX=node2.positionX-node1.positionX;var directionY=node2.positionY-node1.positionY;if(0===directionX&&0===directionY){return}var overlap=nodesOverlap(node1,node2,directionX,directionY);if(overlap>0){var force=options.nodeOverlap*overlap;var distance=Math.sqrt(directionX*directionX+directionY*directionY);var forceX=force*directionX/distance;var forceY=force*directionY/distance}else{var point1=findClippingPoint(node1,directionX,directionY);var point2=findClippingPoint(node2,-1*directionX,-1*directionY);var distanceX=point2.x-point1.x;var distanceY=point2.y-point1.y;var distanceSqr=distanceX*distanceX+distanceY*distanceY;var distance=Math.sqrt(distanceSqr);var force=(node1.nodeRepulsion+node2.nodeRepulsion)/distanceSqr;var forceX=force*distanceX/distance;var forceY=force*distanceY/distance}if(!node1.isLocked){node1.offsetX-=forceX;node1.offsetY-=forceY}if(!node2.isLocked){node2.offsetX+=forceX;node2.offsetY+=forceY}return};var nodesOverlap=function(node1,node2,dX,dY){if(dX>0){var overlapX=node1.maxX-node2.minX}else{var overlapX=node2.maxX-node1.minX}if(dY>0){var overlapY=node1.maxY-node2.minY}else{var overlapY=node2.maxY-node1.minY}if(overlapX>=0&&overlapY>=0){return Math.sqrt(overlapX*overlapX+overlapY*overlapY)}else{return 0}};var findClippingPoint=function(node,dX,dY){var X=node.positionX;var Y=node.positionY;var H=node.height||1;var W=node.width||1;var dirSlope=dY/dX;var nodeSlope=H/W;var res={};do{if(0===dX&&0<dY){res.x=X;res.y=Y+H/2;break}if(0===dX&&0>dY){res.x=X;res.y=Y+H/2;break}if(0<dX&&-1*nodeSlope<=dirSlope&&dirSlope<=nodeSlope){res.x=X+W/2;res.y=Y+W*dY/2/dX;break}if(0>dX&&-1*nodeSlope<=dirSlope&&dirSlope<=nodeSlope){res.x=X-W/2;res.y=Y-W*dY/2/dX;break}if(0<dY&&(dirSlope<=-1*nodeSlope||dirSlope>=nodeSlope)){res.x=X+H*dX/2/dY;res.y=Y+H/2;break}if(0>dY&&(dirSlope<=-1*nodeSlope||dirSlope>=nodeSlope)){res.x=X-H*dX/2/dY;res.y=Y-H/2;break}}while(false);return res};var calculateEdgeForces=function(layoutInfo,options){for(var i=0;i<layoutInfo.edgeSize;i++){var edge=layoutInfo.layoutEdges[i];var sourceIx=layoutInfo.idToIndex[edge.sourceId];var source=layoutInfo.layoutNodes[sourceIx];var targetIx=layoutInfo.idToIndex[edge.targetId];var target=layoutInfo.layoutNodes[targetIx];var directionX=target.positionX-source.positionX;var directionY=target.positionY-source.positionY;if(0===directionX&&0===directionY){return}var point1=findClippingPoint(source,directionX,directionY);var point2=findClippingPoint(target,-1*directionX,-1*directionY);var lx=point2.x-point1.x;var ly=point2.y-point1.y;var l=Math.sqrt(lx*lx+ly*ly);var force=Math.pow(edge.idealLength-l,2)/edge.elasticity;if(0!==l){var forceX=force*lx/l;var forceY=force*ly/l}else{var forceX=0;var forceY=0}if(!source.isLocked){source.offsetX+=forceX;source.offsetY+=forceY}if(!target.isLocked){target.offsetX-=forceX;target.offsetY-=forceY}}};var calculateGravityForces=function(layoutInfo,options){var distThreshold=1;for(var i=0;i<layoutInfo.graphSet.length;i++){var graph=layoutInfo.graphSet[i];var numNodes=graph.length;if(0===i){var centerX=layoutInfo.clientHeight/2;var centerY=layoutInfo.clientWidth/2}else{var temp=layoutInfo.layoutNodes[layoutInfo.idToIndex[graph[0]]];var parent=layoutInfo.layoutNodes[layoutInfo.idToIndex[temp.parentId]];var centerX=parent.positionX;var centerY=parent.positionY}for(var j=0;j<numNodes;j++){var node=layoutInfo.layoutNodes[layoutInfo.idToIndex[graph[j]]];if(node.isLocked){continue}var dx=centerX-node.positionX;var dy=centerY-node.positionY;var d=Math.sqrt(dx*dx+dy*dy);if(d>distThreshold){var fx=options.gravity*dx/d;var fy=options.gravity*dy/d;node.offsetX+=fx;node.offsetY+=fy}else{}}}};var propagateForces=function(layoutInfo,options){var queue=[];var start=0;var end=-1;queue.push.apply(queue,layoutInfo.graphSet[0]);end+=layoutInfo.graphSet[0].length;while(start<=end){var nodeId=queue[start++];var nodeIndex=layoutInfo.idToIndex[nodeId];var node=layoutInfo.layoutNodes[nodeIndex];var children=node.children;if(0<children.length&&!node.isLocked){var offX=node.offsetX;var offY=node.offsetY;for(var i=0;i<children.length;i++){var childNode=layoutInfo.layoutNodes[layoutInfo.idToIndex[children[i]]];childNode.offsetX+=offX;childNode.offsetY+=offY;queue[++end]=children[i]}node.offsetX=0;node.offsetY=0}}};var updatePositions=function(layoutInfo,options){for(var i=0;i<layoutInfo.nodeSize;i++){var n=layoutInfo.layoutNodes[i];if(0<n.children.length){n.maxX=undefined;n.minX=undefined;n.maxY=undefined;n.minY=undefined}}for(var i=0;i<layoutInfo.nodeSize;i++){var n=layoutInfo.layoutNodes[i];if(0<n.children.length||n.isLocked){continue}var tempForce=limitForce(n.offsetX,n.offsetY,layoutInfo.temperature);n.positionX+=tempForce.x;n.positionY+=tempForce.y;n.offsetX=0;n.offsetY=0;n.minX=n.positionX-n.width;n.maxX=n.positionX+n.width;n.minY=n.positionY-n.height;n.maxY=n.positionY+n.height;updateAncestryBoundaries(n,layoutInfo)}for(var i=0;i<layoutInfo.nodeSize;i++){var n=layoutInfo.layoutNodes[i];if(0<n.children.length&&!n.isLocked){n.positionX=(n.maxX+n.minX)/2;n.positionY=(n.maxY+n.minY)/2;n.width=n.maxX-n.minX;n.height=n.maxY-n.minY}}};var limitForce=function(forceX,forceY,max){var force=Math.sqrt(forceX*forceX+forceY*forceY);if(force>max){var res={x:max*forceX/force,y:max*forceY/force}}else{var res={x:forceX,y:forceY}}return res};var updateAncestryBoundaries=function(node,layoutInfo){var parentId=node.parentId;if(null==parentId){return}var p=layoutInfo.layoutNodes[layoutInfo.idToIndex[parentId]];var flag=false;if(null==p.maxX||node.maxX+p.padRight>p.maxX){p.maxX=node.maxX+p.padRight;flag=true}if(null==p.minX||node.minX-p.padLeft<p.minX){p.minX=node.minX-p.padLeft;flag=true}if(null==p.maxY||node.maxY+p.padBottom>p.maxY){p.maxY=node.maxY+p.padBottom;flag=true}if(null==p.minY||node.minY-p.padTop<p.minY){p.minY=node.minY-p.padTop;flag=true}if(flag){return updateAncestryBoundaries(p,layoutInfo)}return};var separateComponents=function(layutInfo,options){var nodes=layoutInfo.layoutNodes;var components=[];for(var i=0;i<nodes.length;i++){var node=nodes[i];var cid=node.cmptId;var component=components[cid]=components[cid]||[];component.push(node)}var totalA=0;for(var i=0;i<components.length;i++){var c=components[i];if(!c){continue}c.x1=Infinity;c.x2=-Infinity;c.y1=Infinity;c.y2=-Infinity;for(var j=0;j<c.length;j++){var n=c[j];c.x1=Math.min(c.x1,n.positionX-n.width/2);c.x2=Math.max(c.x2,n.positionX+n.width/2);c.y1=Math.min(c.y1,n.positionY-n.height/2);c.y2=Math.max(c.y2,n.positionY+n.height/2)}c.w=c.x2-c.x1;c.h=c.y2-c.y1;totalA+=c.w*c.h}components.sort(function(c1,c2){return c2.w*c2.h-c1.w*c1.h});var x=0;var y=0;var usedW=0;var rowH=0;var maxRowW=Math.sqrt(totalA)*layoutInfo.clientWidth/layoutInfo.clientHeight;for(var i=0;i<components.length;i++){var c=components[i];if(!c){continue}for(var j=0;j<c.length;j++){var n=c[j];if(!n.isLocked){n.positionX+=x;n.positionY+=y}}x+=c.w+options.componentSpacing;usedW+=c.w+options.componentSpacing;rowH=Math.max(rowH,c.h);if(usedW>maxRowW){y+=rowH+options.componentSpacing;x=0;usedW=0;rowH=0}}};var mainLoop=function(i){if(stopped){return false}step(layoutInfo,options,i);layoutInfo.temperature=layoutInfo.temperature*options.coolingFactor;if(layoutInfo.temperature<options.minTemp){return false}return true};var i=0;var loopRet;do{var f=0;while(f<options.refresh&&i<options.numIter){var loopRet=mainLoop(i);if(!loopRet){break}f++;i++}if(options.animate){broadcast(layoutInfo.layoutNodes)}}while(loopRet&&i+1<options.numIter);separateComponents(layoutInfo,options);return layoutInfo}).then(function(layoutInfoUpdated){layoutInfo.layoutNodes=layoutInfoUpdated.layoutNodes;thread.stop();done()});var done=function(){refresh({force:true,next:function(){layout.one("layoutstop",options.stop);layout.trigger({type:"layoutstop",layout:layout})}})};return this};CoseLayout.prototype.stop=function(){this.stopped=true;if(this.thread){this.thread.stop()}this.trigger("layoutstop");return this};CoseLayout.prototype.destroy=function(){if(this.thread){this.thread.stop()}return this};var createLayoutInfo=function(cy,layout,options){var edges=options.eles.edges();var nodes=options.eles.nodes();var layoutInfo={isCompound:cy.hasCompoundNodes(),layoutNodes:[],idToIndex:{},nodeSize:nodes.size(),graphSet:[],indexToGraph:[],layoutEdges:[],edgeSize:edges.size(),temperature:options.initialTemp,clientWidth:cy.width(),clientHeight:cy.width(),boundingBox:math.makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()})};var components=options.eles.components();var id2cmptId={};for(var i=0;i<components.length;i++){var component=components[i];for(var j=0;j<component.length;j++){var node=component[j];id2cmptId[node.id()]=i}}for(var i=0;i<layoutInfo.nodeSize;i++){var n=nodes[i];var nbb=n.boundingBox();var tempNode={};tempNode.isLocked=n.locked();tempNode.id=n.data("id");tempNode.parentId=n.data("parent");tempNode.cmptId=id2cmptId[n.id()];tempNode.children=[];tempNode.positionX=n.position("x");tempNode.positionY=n.position("y");tempNode.offsetX=0;tempNode.offsetY=0;tempNode.height=nbb.w;tempNode.width=nbb.h;tempNode.maxX=tempNode.positionX+tempNode.width/2;tempNode.minX=tempNode.positionX-tempNode.width/2;tempNode.maxY=tempNode.positionY+tempNode.height/2;tempNode.minY=tempNode.positionY-tempNode.height/2;tempNode.padLeft=parseFloat(n.style("padding-left"));tempNode.padRight=parseFloat(n.style("padding-right"));tempNode.padTop=parseFloat(n.style("padding-top"));tempNode.padBottom=parseFloat(n.style("padding-bottom"));tempNode.nodeRepulsion=is.fn(options.nodeRepulsion)?options.nodeRepulsion.call(n,n):options.nodeRepulsion;layoutInfo.layoutNodes.push(tempNode);layoutInfo.idToIndex[tempNode.id]=i}var queue=[];var start=0;var end=-1;var tempGraph=[];for(var i=0;i<layoutInfo.nodeSize;i++){var n=layoutInfo.layoutNodes[i];var p_id=n.parentId;if(null!=p_id){layoutInfo.layoutNodes[layoutInfo.idToIndex[p_id]].children.push(n.id)}else{queue[++end]=n.id;tempGraph.push(n.id)}}layoutInfo.graphSet.push(tempGraph);while(start<=end){var node_id=queue[start++];var node_ix=layoutInfo.idToIndex[node_id];var node=layoutInfo.layoutNodes[node_ix];var children=node.children;if(children.length>0){layoutInfo.graphSet.push(children);for(var i=0;i<children.length;i++){queue[++end]=children[i]}}}for(var i=0;i<layoutInfo.graphSet.length;i++){var graph=layoutInfo.graphSet[i];for(var j=0;j<graph.length;j++){var index=layoutInfo.idToIndex[graph[j]];layoutInfo.indexToGraph[index]=i}}for(var i=0;i<layoutInfo.edgeSize;i++){var e=edges[i];var tempEdge={};tempEdge.id=e.data("id");tempEdge.sourceId=e.data("source");tempEdge.targetId=e.data("target");var idealLength=is.fn(options.idealEdgeLength)?options.idealEdgeLength.call(e,e):options.idealEdgeLength;var elasticity=is.fn(options.edgeElasticity)?options.edgeElasticity.call(e,e):options.edgeElasticity;var sourceIx=layoutInfo.idToIndex[tempEdge.sourceId];var targetIx=layoutInfo.idToIndex[tempEdge.targetId];var sourceGraph=layoutInfo.indexToGraph[sourceIx];var targetGraph=layoutInfo.indexToGraph[targetIx];if(sourceGraph!=targetGraph){var lca=findLCA(tempEdge.sourceId,tempEdge.targetId,layoutInfo);var lcaGraph=layoutInfo.graphSet[lca];var depth=0;var tempNode=layoutInfo.layoutNodes[sourceIx];while(-1===lcaGraph.indexOf(tempNode.id)){tempNode=layoutInfo.layoutNodes[layoutInfo.idToIndex[tempNode.parentId]];depth++}tempNode=layoutInfo.layoutNodes[targetIx];while(-1===lcaGraph.indexOf(tempNode.id)){tempNode=layoutInfo.layoutNodes[layoutInfo.idToIndex[tempNode.parentId]];depth++}idealLength*=depth*options.nestingFactor}tempEdge.idealLength=idealLength;tempEdge.elasticity=elasticity;layoutInfo.layoutEdges.push(tempEdge)}return layoutInfo};var findLCA=function(node1,node2,layoutInfo){var res=findLCA_aux(node1,node2,0,layoutInfo);if(2>res.count){return 0}else{return res.graph}};var findLCA_aux=function(node1,node2,graphIx,layoutInfo){var graph=layoutInfo.graphSet[graphIx];if(-1<graph.indexOf(node1)&&-1<graph.indexOf(node2)){return{count:2,graph:graphIx}}var c=0;for(var i=0;i<graph.length;i++){var nodeId=graph[i];var nodeIx=layoutInfo.idToIndex[nodeId];var children=layoutInfo.layoutNodes[nodeIx].children;if(0===children.length){continue}var childGraphIx=layoutInfo.indexToGraph[layoutInfo.idToIndex[children[0]]];var result=findLCA_aux(node1,node2,childGraphIx,layoutInfo);if(0===result.count){continue}else if(1===result.count){c++;if(2===c){break}}else{return result}}return{count:c,graph:graphIx}};var printLayoutInfo=function(layoutInfo){if(!DEBUG){return}console.debug("layoutNodes:");for(var i=0;i<layoutInfo.nodeSize;i++){var n=layoutInfo.layoutNodes[i];var s="\nindex: "+i+"\nId: "+n.id+"\nChildren: "+n.children.toString()+"\nparentId: "+n.parentId+"\npositionX: "+n.positionX+"\npositionY: "+n.positionY+"\nOffsetX: "+n.offsetX+"\nOffsetY: "+n.offsetY+"\npadLeft: "+n.padLeft+"\npadRight: "+n.padRight+"\npadTop: "+n.padTop+"\npadBottom: "+n.padBottom;console.debug(s)}console.debug("idToIndex");for(var i in layoutInfo.idToIndex){console.debug("Id: "+i+"\nIndex: "+layoutInfo.idToIndex[i])}console.debug("Graph Set");var set=layoutInfo.graphSet;for(var i=0;i<set.length;i++){console.debug("Set : "+i+": "+set[i].toString())}var s="IndexToGraph";for(var i=0;i<layoutInfo.indexToGraph.length;i++){s+="\nIndex : "+i+" Graph: "+layoutInfo.indexToGraph[i]}console.debug(s);s="Layout Edges";for(var i=0;i<layoutInfo.layoutEdges.length;i++){var e=layoutInfo.layoutEdges[i];s+="\nEdge Index: "+i+" ID: "+e.id+" SouceID: "+e.sourceId+" TargetId: "+e.targetId+" Ideal Length: "+e.idealLength}console.debug(s);s="nodeSize: "+layoutInfo.nodeSize;s+="\nedgeSize: "+layoutInfo.edgeSize;s+="\ntemperature: "+layoutInfo.temperature;console.debug(s);return};var randomizePositions=function(layoutInfo,cy){var width=layoutInfo.clientWidth;var height=layoutInfo.clientHeight;for(var i=0;i<layoutInfo.nodeSize;i++){var n=layoutInfo.layoutNodes[i];if(0===n.children.length&&!n.isLocked){n.positionX=Math.random()*width;n.positionY=Math.random()*height}}};var refreshPositions=function(layoutInfo,cy,options){var layout=options.layout;var nodes=options.eles.nodes();var bb=layoutInfo.boundingBox;var coseBB={x1:Infinity,x2:-Infinity,y1:Infinity,y2:-Infinity};if(options.boundingBox){nodes.forEach(function(node){var lnode=layoutInfo.layoutNodes[layoutInfo.idToIndex[node.data("id")]];coseBB.x1=Math.min(coseBB.x1,lnode.positionX);coseBB.x2=Math.max(coseBB.x2,lnode.positionX);coseBB.y1=Math.min(coseBB.y1,lnode.positionY);coseBB.y2=Math.max(coseBB.y2,lnode.positionY)});coseBB.w=coseBB.x2-coseBB.x1;coseBB.h=coseBB.y2-coseBB.y1}nodes.positions(function(i,ele){var lnode=layoutInfo.layoutNodes[layoutInfo.idToIndex[ele.data("id")]];if(options.boundingBox){var pctX=(lnode.positionX-coseBB.x1)/coseBB.w;var pctY=(lnode.positionY-coseBB.y1)/coseBB.h;return{x:bb.x1+pctX*bb.w,y:bb.y1+pctY*bb.h}}else{return{x:lnode.positionX,y:lnode.positionY}}});if(true!==layoutInfo.ready){layoutInfo.ready=true;layout.one("layoutready",options.ready);layout.trigger({type:"layoutready",layout:this})}};module.exports=CoseLayout},{"../../is":117,"../../math":119,"../../thread":132,"../../util":134}],86:[function(require,module,exports){"use strict";var util=require("../../util");var math=require("../../math");var defaults={fit:true,padding:30,boundingBox:undefined,avoidOverlap:true,avoidOverlapPadding:10,condense:false,rows:undefined,cols:undefined,position:function(node){},sort:undefined,animate:false,animationDuration:500,animationEasing:undefined,ready:undefined,stop:undefined};function GridLayout(options){this.options=util.extend({},defaults,options)}GridLayout.prototype.run=function(){var params=this.options;var options=params;var cy=params.cy;var eles=options.eles;var nodes=eles.nodes().not(":parent");if(options.sort){nodes=nodes.sort(options.sort)}var bb=math.makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()});if(bb.h===0||bb.w===0){nodes.layoutPositions(this,options,function(){return{x:bb.x1,y:bb.y1}})}else{var cells=nodes.size();var splits=Math.sqrt(cells*bb.h/bb.w);var rows=Math.round(splits);var cols=Math.round(bb.w/bb.h*splits);var small=function(val){if(val==null){return Math.min(rows,cols)}else{var min=Math.min(rows,cols);if(min==rows){rows=val}else{cols=val}}};var large=function(val){if(val==null){return Math.max(rows,cols)}else{var max=Math.max(rows,cols);if(max==rows){rows=val}else{cols=val}}};var oRows=options.rows;var oCols=options.cols!=null?options.cols:options.columns;if(oRows!=null&&oCols!=null){rows=oRows;cols=oCols}else if(oRows!=null&&oCols==null){rows=oRows;cols=Math.ceil(cells/rows)}else if(oRows==null&&oCols!=null){cols=oCols;rows=Math.ceil(cells/cols)}else if(cols*rows>cells){var sm=small();var lg=large();if((sm-1)*lg>=cells){small(sm-1)}else if((lg-1)*sm>=cells){large(lg-1)}}else{while(cols*rows<cells){var sm=small();var lg=large();if((lg+1)*sm>=cells){large(lg+1)}else{small(sm+1)}}}var cellWidth=bb.w/cols;var cellHeight=bb.h/rows;if(options.condense){cellWidth=0;cellHeight=0}if(options.avoidOverlap){for(var i=0;i<nodes.length;i++){var node=nodes[i];var pos=node._private.position;if(pos.x==null||pos.y==null){pos.x=0;pos.y=0}var nbb=node.boundingBox();var p=options.avoidOverlapPadding;var w=nbb.w+p;var h=nbb.h+p;cellWidth=Math.max(cellWidth,w);cellHeight=Math.max(cellHeight,h)}}var cellUsed={};var used=function(row,col){return cellUsed["c-"+row+"-"+col]?true:false};var use=function(row,col){cellUsed["c-"+row+"-"+col]=true};var row=0;var col=0;var moveToNextCell=function(){col++;if(col>=cols){col=0;row++}};var id2manPos={};for(var i=0;i<nodes.length;i++){var node=nodes[i];var rcPos=options.position(node);if(rcPos&&(rcPos.row!==undefined||rcPos.col!==undefined)){var pos={row:rcPos.row,col:rcPos.col};if(pos.col===undefined){pos.col=0;while(used(pos.row,pos.col)){pos.col++}}else if(pos.row===undefined){pos.row=0;while(used(pos.row,pos.col)){pos.row++}}id2manPos[node.id()]=pos;use(pos.row,pos.col)}}var getPos=function(i,element){var x,y;if(element.locked()||element.isParent()){return false}var rcPos=id2manPos[element.id()];if(rcPos){x=rcPos.col*cellWidth+cellWidth/2+bb.x1;y=rcPos.row*cellHeight+cellHeight/2+bb.y1}else{while(used(row,col)){moveToNextCell()}x=col*cellWidth+cellWidth/2+bb.x1;y=row*cellHeight+cellHeight/2+bb.y1;use(row,col);moveToNextCell()}return{x:x,y:y}};nodes.layoutPositions(this,options,getPos)}return this};module.exports=GridLayout},{"../../math":119,"../../util":134}],87:[function(require,module,exports){"use strict";module.exports=[{name:"breadthfirst",impl:require("./breadthfirst")},{name:"circle",impl:require("./circle")},{name:"concentric",impl:require("./concentric")},{name:"cose",impl:require("./cose")},{name:"grid",impl:require("./grid")},{name:"null",impl:require("./null")},{name:"preset",impl:require("./preset")},{name:"random",impl:require("./random")}]},{"./breadthfirst":82,"./circle":83,"./concentric":84,"./cose":85,"./grid":86,"./null":88,"./preset":89,"./random":90}],88:[function(require,module,exports){"use strict";var util=require("../../util");var defaults={ready:function(){},stop:function(){}};function NullLayout(options){this.options=util.extend({},defaults,options)}NullLayout.prototype.run=function(){var options=this.options;var eles=options.eles;var layout=this;var cy=options.cy;layout.trigger("layoutstart");eles.nodes().positions(function(){return{x:0,y:0}});layout.one("layoutready",options.ready);layout.trigger("layoutready");layout.one("layoutstop",options.stop);layout.trigger("layoutstop");return this};NullLayout.prototype.stop=function(){return this};module.exports=NullLayout},{"../../util":134}],89:[function(require,module,exports){"use strict";var util=require("../../util");var is=require("../../is");var defaults={positions:undefined,zoom:undefined,pan:undefined,fit:true,padding:30,animate:false,animationDuration:500,animationEasing:undefined,ready:undefined,stop:undefined};function PresetLayout(options){this.options=util.extend({},defaults,options)}PresetLayout.prototype.run=function(){var options=this.options;var eles=options.eles;var nodes=eles.nodes();var posIsFn=is.fn(options.positions);function getPosition(node){if(options.positions==null){return null}if(posIsFn){return options.positions.apply(node,[node])}var pos=options.positions[node._private.data.id];if(pos==null){return null}return pos}nodes.layoutPositions(this,options,function(i,node){var position=getPosition(node);if(node.locked()||position==null){return false}return position});return this};module.exports=PresetLayout},{"../../is":117,"../../util":134}],90:[function(require,module,exports){"use strict";var util=require("../../util");var math=require("../../math");var defaults={fit:true,padding:30,boundingBox:undefined,animate:false,animationDuration:500,animationEasing:undefined,ready:undefined,stop:undefined};function RandomLayout(options){this.options=util.extend({},defaults,options)}RandomLayout.prototype.run=function(){var options=this.options;var cy=options.cy;var eles=options.eles;var nodes=eles.nodes().not(":parent");var bb=math.makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()});var getPos=function(i,node){return{x:bb.x1+Math.round(Math.random()*bb.w),y:bb.y1+Math.round(Math.random()*bb.h)}};nodes.layoutPositions(this,options,getPos);return this};module.exports=RandomLayout},{"../../math":119,"../../util":134}],91:[function(require,module,exports){"use strict";var math=require("../../../math");var is=require("../../../is");var util=require("../../../util");var BRp={};BRp.arrowShapeWidth=.3;BRp.registerArrowShapes=function(){var arrowShapes=this.arrowShapes={};var renderer=this;var bbCollide=function(x,y,size,angle,translation,padding){var x1=translation.x-size/2-padding;var x2=translation.x+size/2+padding;var y1=translation.y-size/2-padding;var y2=translation.y+size/2+padding;var inside=x1<=x&&x<=x2&&(y1<=y&&y<=y2);return inside};var transform=function(x,y,size,angle,translation){var xRotated=x*Math.cos(angle)-y*Math.sin(angle);var yRotated=x*Math.sin(angle)+y*Math.cos(angle);var xScaled=xRotated*size;var yScaled=yRotated*size;var xTranslated=xScaled+translation.x;var yTranslated=yScaled+translation.y;return{x:xTranslated,y:yTranslated}};var transformPoints=function(pts,size,angle,translation){var retPts=[];for(var i=0;i<pts.length;i+=2){var x=pts[i];var y=pts[i+1];retPts.push(transform(x,y,size,angle,translation))}return retPts};var pointsToArr=function(pts){var ret=[];for(var i=0;i<pts.length;i++){var p=pts[i];ret.push(p.x,p.y)}return ret};var defineArrowShape=function(name,defn){if(is.string(defn)){defn=arrowShapes[defn]}arrowShapes[name]=util.extend({name:name,points:[-.15,-.3,.15,-.3,.15,.3,-.15,.3],collide:function(x,y,size,angle,translation,padding){var points=pointsToArr(transformPoints(this.points,size+2*padding,angle,translation));var inside=math.pointInsidePolygonPoints(x,y,points);return inside},roughCollide:bbCollide,draw:function(context,size,angle,translation){var points=transformPoints(this.points,size,angle,translation);renderer.arrowShapeImpl("polygon")(context,points)},spacing:function(edge){return 0},gap:function(edge){return edge.pstyle("width").pfValue*2}},defn)};defineArrowShape("none",{collide:util.falsify,roughCollide:util.falsify,draw:util.noop,spacing:util.zeroify,gap:util.zeroify});defineArrowShape("triangle",{points:[-.15,-.3,0,0,.15,-.3]});defineArrowShape("arrow","triangle");defineArrowShape("triangle-backcurve",{points:arrowShapes["triangle"].points,controlPoint:[0,-.15],roughCollide:bbCollide,draw:function(context,size,angle,translation){var ptsTrans=transformPoints(this.points,size,angle,translation);var ctrlPt=this.controlPoint;var ctrlPtTrans=transform(ctrlPt[0],ctrlPt[1],size,angle,translation);renderer.arrowShapeImpl(this.name)(context,ptsTrans,ctrlPtTrans)},gap:function(edge){return edge.pstyle("width").pfValue}});defineArrowShape("triangle-tee",{points:[-.15,-.3,0,0,.15,-.3,-.15,-.3],pointsTee:[-.15,-.4,-.15,-.5,.15,-.5,.15,-.4],collide:function(x,y,size,angle,translation,padding){var triPts=pointsToArr(transformPoints(this.points,size+2*padding,angle,translation));var teePts=pointsToArr(transformPoints(this.pointsTee,size+2*padding,angle,translation));var inside=math.pointInsidePolygonPoints(x,y,triPts)||math.pointInsidePolygonPoints(x,y,teePts);return inside},draw:function(context,size,angle,translation){var triPts=transformPoints(this.points,size,angle,translation);var teePts=transformPoints(this.pointsTee,size,angle,translation);renderer.arrowShapeImpl(this.name)(context,triPts,teePts)}});defineArrowShape("vee",{points:[-.15,-.3,0,0,.15,-.3,0,-.15],gap:function(edge){return edge.pstyle("width").pfValue}});defineArrowShape("circle",{radius:.15,collide:function(x,y,size,angle,translation,padding){var t=translation;var inside=Math.pow(t.x-x,2)+Math.pow(t.y-y,2)<=Math.pow((size+2*padding)*this.radius,2);return inside},draw:function(context,size,angle,translation){renderer.arrowShapeImpl(this.name)(context,translation.x,translation.y,this.radius*size)},spacing:function(edge){return renderer.getArrowWidth(edge.pstyle("width").pfValue)*this.radius}});defineArrowShape("inhibitor",{points:[-.15,0,-.15,-.1,.15,-.1,.15,0],spacing:function(edge){return 1},gap:function(edge){return 1}});defineArrowShape("tee","inhibitor");defineArrowShape("square",{points:[-.15,0,.15,0,.15,-.3,-.15,-.3]});defineArrowShape("diamond",{points:[-.15,-.15,0,-.3,.15,-.15,0,0],gap:function(edge){return edge.pstyle("width").pfValue}})};module.exports=BRp},{"../../../is":117,"../../../math":119,"../../../util":134}],92:[function(require,module,exports){"use strict";var math=require("../../../math");var is=require("../../../is");var util=require("../../../util");var zIndexSort=require("../../../collection/zsort");var BRp={};BRp.registerCalculationListeners=function(){var cy=this.cy;var elesToUpdate=cy.collection();var r=this;var enqueue=function(eles,e){elesToUpdate.merge(eles);for(var i=0;i<eles.length;i++){var ele=eles[i];var _p=ele._private;var rstyle=_p.rstyle;rstyle.clean=false;_p.bbCache=null;var evts=rstyle.dirtyEvents=rstyle.dirtyEvents||{length:0};if(!evts[e.type]){evts[e.type]=true;evts.length++}}};r.binder(cy).on("position.* style.* free.*","node",function onDirtyModNode(e){var node=e.cyTarget;enqueue(node,e);enqueue(node.connectedEdges(),e);if(cy.hasCompoundNodes()){var parents=node.parents();enqueue(parents,e);enqueue(parents.connectedEdges(),e)}}).on("add.* background.*","node",function onDirtyAddNode(e){var ele=e.cyTarget;enqueue(ele,e)}).on("add.* style.*","edge",function onDirtyEdge(e){var edge=e.cyTarget;enqueue(edge,e);enqueue(edge.parallelEdges(),e)}).on("remove.*","edge",function onDirtyRemoveEdge(e){var edge=e.cyTarget;var pEdges=edge.parallelEdges();for(var i=0;i<pEdges.length;i++){var pEdge=pEdges[i];if(!pEdge.removed()){enqueue(pEdge,e)}}});var updateEleCalcs=function(willDraw){if(willDraw){var fns=r.onUpdateEleCalcsFns;if(fns){for(var i=0;i<fns.length;i++){var fn=fns[i];fn(willDraw,elesToUpdate)}}r.recalculateRenderedStyle(elesToUpdate,false);for(var i=0;i<elesToUpdate.length;i++){elesToUpdate[i]._private.rstyle.dirtyEvents=null}elesToUpdate=cy.collection()}};r.beforeRender(updateEleCalcs,r.beforeRenderPriorities.eleCalcs)};BRp.onUpdateEleCalcs=function(fn){var fns=this.onUpdateEleCalcsFns=this.onUpdateEleCalcsFns||[];fns.push(fn)};BRp.recalculateRenderedStyle=function(eles,useCache){var edges=[];var nodes=[];if(this.destroyed){return}if(useCache===undefined){useCache=true}for(var i=0;i<eles.length;i++){var ele=eles[i];var _p=ele._private;var rstyle=_p.rstyle;if(useCache&&rstyle.clean||ele.removed()){continue}if(_p.group==="nodes"){nodes.push(ele)}else{edges.push(ele)}rstyle.clean=true}for(var i=0;i<nodes.length;i++){var ele=nodes[i];var _p=ele._private;var rstyle=_p.rstyle;var pos=_p.position;this.recalculateNodeLabelProjection(ele);rstyle.nodeX=pos.x;rstyle.nodeY=pos.y;rstyle.nodeW=ele.pstyle("width").pfValue;rstyle.nodeH=ele.pstyle("height").pfValue}this.recalculateEdgeProjections(edges);for(var i=0;i<edges.length;i++){var ele=edges[i];var _p=ele._private;var rstyle=_p.rstyle;var rs=_p.rscratch;this.recalculateEdgeLabelProjections(ele);rstyle.srcX=rs.arrowStartX;rstyle.srcY=rs.arrowStartY;rstyle.tgtX=rs.arrowEndX;rstyle.tgtY=rs.arrowEndY;rstyle.midX=rs.midX;rstyle.midY=rs.midY;rstyle.labelAngle=rs.labelAngle;rstyle.sourceLabelAngle=rs.sourceLabelAngle;rstyle.targetLabelAngle=rs.targetLabelAngle}};BRp.projectIntoViewport=function(clientX,clientY){var offsets=this.findContainerClientCoords();var offsetLeft=offsets[0];var offsetTop=offsets[1];var x=clientX-offsetLeft;var y=clientY-offsetTop;x-=this.cy.pan().x;y-=this.cy.pan().y;x/=this.cy.zoom();y/=this.cy.zoom();return[x,y]};BRp.findContainerClientCoords=function(){var container=this.container;var bb=this.containerBB=this.containerBB||container.getBoundingClientRect();return[bb.left,bb.top,bb.right-bb.left,bb.bottom-bb.top]};BRp.invalidateContainerClientCoordsCache=function(){this.containerBB=null};BRp.findNearestElement=function(x,y,visibleElementsOnly,isTouch){return this.findNearestElements(x,y,visibleElementsOnly,isTouch)[0]};BRp.findNearestElements=function(x,y,visibleElementsOnly,isTouch){var self=this;var r=this;var eles=r.getCachedZSortedEles();var near=[];var zoom=r.cy.zoom();var hasCompounds=r.cy.hasCompoundNodes();var edgeThreshold=(isTouch?24:8)/zoom;var nodeThreshold=(isTouch?8:2)/zoom;var labelThreshold=(isTouch?8:2)/zoom;var minSqDist=Infinity;var nearEdge;var nearNode;function addEle(ele,sqDist){if(ele.isNode()){if(nearNode){return}else{nearNode=ele;near.push(ele)}}if(ele.isEdge()&&(sqDist==null||sqDist<minSqDist)){if(nearEdge){if(nearEdge.pstyle("z-index").value===ele.pstyle("z-index").value){for(var i=0;i<near.length;i++){if(near[i].isEdge()){near[i]=ele;nearEdge=ele;minSqDist=sqDist!=null?sqDist:minSqDist;break}}}}else{near.push(ele);nearEdge=ele;minSqDist=sqDist!=null?sqDist:minSqDist}}}function checkNode(node){var _p=node._private;if(node.pstyle("events").strValue==="no"){return}var width=node.outerWidth()+2*nodeThreshold;var height=node.outerHeight()+2*nodeThreshold;var hw=width/2;var hh=height/2;var pos=_p.position;if(pos.x-hw<=x&&x<=pos.x+hw&&pos.y-hh<=y&&y<=pos.y+hh){var visible=!visibleElementsOnly||node.visible()&&!node.transparent();if(visibleElementsOnly&&!visible){return}var shape=r.nodeShapes[self.getNodeShape(node)];if(shape.checkPoint(x,y,0,width,height,pos.x,pos.y)){addEle(node,0)}}}function checkEdge(edge){var _p=edge._private;if(edge.pstyle("events").strValue==="no"){return}var rs=_p.rscratch;var width=edge.pstyle("width").pfValue/2+edgeThreshold;var widthSq=width*width;var width2=width*2;var src=_p.source;var tgt=_p.target;var inEdgeBB=false;var sqDist;var passedVisibilityCheck;var passesVisibilityCheck=function(){if(passedVisibilityCheck!==undefined){return passedVisibilityCheck}if(!visibleElementsOnly){passedVisibilityCheck=true;return true}var visible=edge.visible()&&!edge.transparent();if(visible){passedVisibilityCheck=true;return true}passedVisibilityCheck=false;return false};if(rs.edgeType==="segments"||rs.edgeType==="straight"||rs.edgeType==="haystack"){var pts=rs.allpts;for(var i=0;i+3<pts.length;i+=2){if((inEdgeBB=math.inLineVicinity(x,y,pts[i],pts[i+1],pts[i+2],pts[i+3],width2))&&passesVisibilityCheck()&&widthSq>(sqDist=math.sqdistToFiniteLine(x,y,pts[i],pts[i+1],pts[i+2],pts[i+3]))){addEle(edge,sqDist)}}}else if(rs.edgeType==="bezier"||rs.edgeType==="multibezier"||rs.edgeType==="self"||rs.edgeType==="compound"){var pts=rs.allpts;for(var i=0;i+5<rs.allpts.length;i+=4){if((inEdgeBB=math.inBezierVicinity(x,y,pts[i],pts[i+1],pts[i+2],pts[i+3],pts[i+4],pts[i+5],width2))&&passesVisibilityCheck()&&widthSq>(sqDist=math.sqdistToQuadraticBezier(x,y,pts[i],pts[i+1],pts[i+2],pts[i+3],pts[i+4],pts[i+5]))){addEle(edge,sqDist)}}}if(inEdgeBB&&passesVisibilityCheck()){var src=src||_p.source;var tgt=tgt||_p.target;var eWidth=edge.pstyle("width").pfValue;var arSize=self.getArrowWidth(eWidth);var arrows=[{name:"source",x:rs.arrowStartX,y:rs.arrowStartY,angle:rs.srcArrowAngle},{name:"target",x:rs.arrowEndX,y:rs.arrowEndY,angle:rs.tgtArrowAngle},{name:"mid-source",x:rs.midX,y:rs.midY,angle:rs.midsrcArrowAngle},{name:"mid-target",x:rs.midX,y:rs.midY,angle:rs.midtgtArrowAngle}];for(var i=0;i<arrows.length;i++){var ar=arrows[i];var shape=r.arrowShapes[edge.pstyle(ar.name+"-arrow-shape").value];if(shape.roughCollide(x,y,arSize,ar.angle,{x:ar.x,y:ar.y},edgeThreshold)&&shape.collide(x,y,arSize,ar.angle,{x:ar.x,y:ar.y},edgeThreshold)){addEle(edge);break}}}if(hasCompounds&&near.length>0){checkNode(src);checkNode(tgt)}}function preprop(obj,name,pre){return util.getPrefixedProperty(obj,name,pre)}function checkLabel(ele,prefix){var _p=ele._private;var th=labelThreshold;var prefixDash;if(prefix){prefixDash=prefix+"-"}else{prefixDash=""}if(ele.pstyle("text-events").strValue==="no"){return}var rotation=ele.pstyle(prefixDash+"text-rotation");if(rotation.strValue==="autorotate"||!!rotation.pfValue){var rstyle=_p.rstyle;var bw=ele.pstyle("text-border-width").pfValue;var lw=preprop(rstyle,"labelWidth",prefix)+bw/2+2*th;var lh=preprop(rstyle,"labelHeight",prefix)+bw/2+2*th;var lx=preprop(rstyle,"labelX",prefix);var ly=preprop(rstyle,"labelY",prefix);var theta=preprop(_p.rscratch,"labelAngle",prefix);var cos=Math.cos(theta);var sin=Math.sin(theta);var rotate=function(x,y){x=x-lx;y=y-ly;return{x:x*cos-y*sin+lx,y:x*sin+y*cos+ly}};var lx1=lx-lw/2;var lx2=lx+lw/2;var ly1=ly-lh/2;var ly2=ly+lh/2;var px1y1=rotate(lx1,ly1);var px1y2=rotate(lx1,ly2);var px2y1=rotate(lx2,ly1);var px2y2=rotate(lx2,ly2);var points=[px1y1.x,px1y1.y,px2y1.x,px2y1.y,px2y2.x,px2y2.y,px1y2.x,px1y2.y];if(math.pointInsidePolygonPoints(x,y,points)){addEle(ele)}}else{var bb=ele.boundingBox({includeLabels:true,includeNodes:false,includeEdges:false});bb.x1-=th;bb.y1-=th;bb.x2+=th;bb.y2+=th;bb.w=bb.x2-bb.x1;bb.h=bb.y2-bb.y1;if(math.inBoundingBox(bb,x,y)){addEle(ele)}}}for(var i=eles.length-1;i>=0;i--){var ele=eles[i];if(ele.isNode()){checkNode(ele);checkLabel(ele)}else{checkEdge(ele);checkLabel(ele);checkLabel(ele,"source");checkLabel(ele,"target")}}return near};BRp.getAllInBox=function(x1,y1,x2,y2){var eles=this.getCachedZSortedEles();var nodes=eles.nodes;var edges=eles.edges;var box=[];var x1c=Math.min(x1,x2);var x2c=Math.max(x1,x2);var y1c=Math.min(y1,y2);var y2c=Math.max(y1,y2);x1=x1c;x2=x2c;y1=y1c;y2=y2c;var boxBb=math.makeBoundingBox({x1:x1,y1:y1,x2:x2,y2:y2});for(var i=0;i<nodes.length;i++){var node=nodes[i];var nodeBb=node.boundingBox({includeNodes:true,includeEdges:false,includeLabels:false,includeShadows:false});if(math.boundingBoxesIntersect(boxBb,nodeBb)){box.push(nodes[i])}}for(var e=0;e<edges.length;e++){var edge=edges[e];var _p=edge._private;var rs=_p.rscratch;if(rs.startX!=null&&rs.startY!=null&&!math.inBoundingBox(boxBb,rs.startX,rs.startY)){continue}if(rs.endX!=null&&rs.endY!=null&&!math.inBoundingBox(boxBb,rs.endX,rs.endY)){continue}if(rs.edgeType==="bezier"||rs.edgeType==="multibezier"||rs.edgeType==="self"||rs.edgeType==="compound"||rs.edgeType==="segments"||rs.edgeType==="haystack"){var pts=_p.rstyle.bezierPts||_p.rstyle.linePts||_p.rstyle.haystackPts;var allInside=true;for(var i=0;i<pts.length;i++){if(!math.pointInBoundingBox(boxBb,pts[i])){allInside=false;break}}if(allInside){box.push(edge)}}else if(rs.edgeType==="haystack"||rs.edgeType==="straight"){box.push(edge)}}return box};BRp.getNodeShape=function(node){var r=this;var shape=node.pstyle("shape").value;if(node.isParent()){if(shape==="rectangle"||shape==="roundrectangle"){return shape}else{return"rectangle"}}if(shape==="polygon"){var points=node.pstyle("shape-polygon-points").value;return r.nodeShapes.makePolygon(points).name}return shape};BRp.updateCachedZSortedEles=function(){this.getCachedZSortedEles(true)};BRp.updateCachedGrabbedEles=function(){var eles=this.cachedZSortedEles;eles.drag=[];eles.nondrag=[];var grabTarget;for(var i=0;i<eles.length;i++){var ele=eles[i];var rs=ele._private.rscratch;if(rs.isGrabTarget&&!ele.isParent()){grabTarget=ele}else if(rs.inDragLayer){eles.drag.push(ele)}else{eles.nondrag.push(ele)}}if(grabTarget){eles.drag.push(grabTarget)}};BRp.getCachedZSortedEles=function(forceRecalc){if(forceRecalc||!this.cachedZSortedEles){var cyEles=this.cy.mutableElements();var eles=[];eles.nodes=[];eles.edges=[];for(var i=0;i<cyEles.length;i++){var ele=cyEles[i];if(ele.animated()||ele.visible()&&!ele.transparent()){eles.push(ele);if(ele.isNode()){eles.nodes.push(ele)}else{eles.edges.push(ele)}}}eles.sort(zIndexSort);this.cachedZSortedEles=eles;this.updateCachedGrabbedEles()}else{eles=this.cachedZSortedEles}return eles};function pushBezierPts(r,edge,pts){var qbezierAt=function(p1,p2,p3,t){return math.qbezierAt(p1,p2,p3,t)};var _p=edge._private;var bpts=_p.rstyle.bezierPts;for(var i=0;i<r.bezierProjPcts.length;i++){var p=r.bezierProjPcts[i];bpts.push({x:qbezierAt(pts[0],pts[2],pts[4],p),y:qbezierAt(pts[1],pts[3],pts[5],p)})}}BRp.projectLines=function(edge){var _p=edge._private;var rs=_p.rscratch;var et=rs.edgeType;_p.rstyle.bezierPts=null;_p.rstyle.linePts=null;_p.rstyle.haystackPts=null;if(et==="multibezier"||et==="bezier"||et==="self"||et==="compound"){var bpts=_p.rstyle.bezierPts=[];for(var i=0;i+5<rs.allpts.length;i+=4){pushBezierPts(this,edge,rs.allpts.slice(i,i+6))}}else if(et==="segments"){var lpts=_p.rstyle.linePts=[];for(var i=0;i+1<rs.allpts.length;i+=2){lpts.push({x:rs.allpts[i],y:rs.allpts[i+1]})}}else if(et==="haystack"){var hpts=rs.haystackPts;_p.rstyle.haystackPts=[{x:hpts[0],y:hpts[1]},{x:hpts[2],y:hpts[3]}]}_p.rstyle.arrowWidth=this.getArrowWidth(edge.pstyle("width").pfValue)*this.arrowShapeWidth};BRp.projectBezier=BRp.projectLines;BRp.recalculateNodeLabelProjection=function(node){var content=node.pstyle("label").strValue;if(is.emptyString(content)){return}var textX,textY;var _p=node._private;var nodeWidth=node.width();var nodeHeight=node.height();var paddingLeft=node.pstyle("padding-left").pfValue;var paddingRight=node.pstyle("padding-right").pfValue;var paddingTop=node.pstyle("padding-top").pfValue;var paddingBottom=node.pstyle("padding-bottom").pfValue;var nodePos=_p.position;var textHalign=node.pstyle("text-halign").strValue;var textValign=node.pstyle("text-valign").strValue;var rs=_p.rscratch;var rstyle=_p.rstyle;switch(textHalign){case"left":textX=nodePos.x-nodeWidth/2-paddingLeft;break;case"right":textX=nodePos.x+nodeWidth/2+paddingRight;break;default:textX=nodePos.x}switch(textValign){case"top":textY=nodePos.y-nodeHeight/2-paddingTop;break;case"bottom":textY=nodePos.y+nodeHeight/2+paddingBottom;break;default:textY=nodePos.y}rs.labelX=textX;rs.labelY=textY;rstyle.labelX=textX;rstyle.labelY=textY;this.applyLabelDimensions(node)};BRp.recalculateEdgeLabelProjections=function(edge){var p;var _p=edge._private;var rs=_p.rscratch;var r=this;var content={mid:edge.pstyle("label").strValue,source:edge.pstyle("source-label").strValue,target:edge.pstyle("target-label").strValue};if(content.mid||content.source||content.target){}else{return}p={x:rs.midX,y:rs.midY};var setRs=function(propName,prefix,value){util.setPrefixedProperty(_p.rscratch,propName,prefix,value);util.setPrefixedProperty(_p.rstyle,propName,prefix,value)};setRs("labelX",null,p.x);setRs("labelY",null,p.y);var createControlPointInfo=function(){if(createControlPointInfo.cache){return createControlPointInfo.cache}var ctrlpts=[];for(var i=0;i+5<rs.allpts.length;i+=4){var p0={x:rs.allpts[i],y:rs.allpts[i+1]};var p1={x:rs.allpts[i+2],y:rs.allpts[i+3]};var p2={x:rs.allpts[i+4],y:rs.allpts[i+5]};ctrlpts.push({p0:p0,p1:p1,p2:p2,startDist:0,length:0,segments:[]})}var bpts=_p.rstyle.bezierPts;var nProjs=r.bezierProjPcts.length;function addSegment(cp,p0,p1,t0,t1){var length=math.dist(p0,p1);var prevSegment=cp.segments[cp.segments.length-1];var segment={p0:p0,p1:p1,t0:t0,t1:t1,startDist:prevSegment?prevSegment.startDist+prevSegment.length:0,length:length};cp.segments.push(segment);cp.length+=length}for(var i=0;i<ctrlpts.length;i++){var cp=ctrlpts[i];var prevCp=ctrlpts[i-1];if(prevCp){cp.startDist=prevCp.startDist+prevCp.length}addSegment(cp,cp.p0,bpts[i*nProjs],0,r.bezierProjPcts[0]);for(var j=0;j<nProjs-1;j++){addSegment(cp,bpts[i*nProjs+j],bpts[i*nProjs+j+1],r.bezierProjPcts[j],r.bezierProjPcts[j+1])}addSegment(cp,bpts[i*nProjs+nProjs-1],cp.p2,r.bezierProjPcts[nProjs-1],1)}return createControlPointInfo.cache=ctrlpts};var calculateEndProjection=function(prefix){var angle;var isSrc=prefix==="source";if(!content[prefix]){return}var offset=edge.pstyle(prefix+"-text-offset").pfValue;var lineAngle=function(p0,p1){var dx=p1.x-p0.x;var dy=p1.y-p0.y;return Math.atan(dy/dx)};var bezierAngle=function(p0,p1,p2,t){var t0=math.bound(0,t-.001,1);var t1=math.bound(0,t+.001,1);var lp0=math.qbezierPtAt(p0,p1,p2,t0);var lp1=math.qbezierPtAt(p0,p1,p2,t1);return lineAngle(lp0,lp1)};switch(rs.edgeType){case"self":case"compound":case"bezier":case"multibezier":var cps=createControlPointInfo();var selected;var startDist=0;var totalDist=0;for(var i=0;i<cps.length;i++){var cp=cps[isSrc?i:cps.length-1-i];for(var j=0;j<cp.segments.length;j++){var seg=cp.segments[isSrc?j:cp.segments.length-1-j];var lastSeg=i===cps.length-1&&j===cp.segments.length-1;startDist=totalDist;totalDist+=seg.length;if(totalDist>=offset||lastSeg){selected={cp:cp,segment:seg};break}}if(selected){break}}var cp=selected.cp;var seg=selected.segment;var tSegment=(offset-startDist)/seg.length;var segDt=seg.t1-seg.t0;var t=isSrc?seg.t0+segDt*tSegment:seg.t1-segDt*tSegment;t=math.bound(0,t,1);p=math.qbezierPtAt(cp.p0,cp.p1,cp.p2,t);angle=bezierAngle(cp.p0,cp.p1,cp.p2,t,p);break;case"straight":case"segments":case"haystack":var d=0,di,d0;var p0,p1;var l=rs.allpts.length;for(var i=0;i+3<l;i+=2){if(isSrc){p0={x:rs.allpts[i],y:rs.allpts[i+1]};p1={x:rs.allpts[i+2],y:rs.allpts[i+3]}}else{p0={x:rs.allpts[l-2-i],y:rs.allpts[l-1-i]};p1={x:rs.allpts[l-4-i],y:rs.allpts[l-3-i]}}di=math.dist(p0,p1);d0=d;d+=di;if(d>=offset){break}}var pD=offset-d0;var t=pD/di;t=math.bound(0,t,1);p=math.lineAt(p0,p1,t);angle=lineAngle(p0,p1);break}setRs("labelX",prefix,p.x);setRs("labelY",prefix,p.y);setRs("labelAutoAngle",prefix,angle)};calculateEndProjection("source");calculateEndProjection("target");this.applyLabelDimensions(edge)};BRp.applyLabelDimensions=function(ele){this.applyPrefixedLabelDimensions(ele);if(ele.isEdge()){this.applyPrefixedLabelDimensions(ele,"source");this.applyPrefixedLabelDimensions(ele,"target")}};BRp.applyPrefixedLabelDimensions=function(ele,prefix){var _p=ele._private;var text=this.getLabelText(ele,prefix);var labelDims=this.calculateLabelDimensions(ele,text);util.setPrefixedProperty(_p.rstyle,"labelWidth",prefix,labelDims.width);util.setPrefixedProperty(_p.rscratch,"labelWidth",prefix,labelDims.width);util.setPrefixedProperty(_p.rstyle,"labelHeight",prefix,labelDims.height);util.setPrefixedProperty(_p.rscratch,"labelHeight",prefix,labelDims.height)};BRp.getLabelText=function(ele,prefix){var _p=ele._private;var pfd=prefix?prefix+"-":"";var text=ele.pstyle(pfd+"label").strValue;var textTransform=ele.pstyle("text-transform").value;var rscratch=function(propName,value){if(value){util.setPrefixedProperty(_p.rscratch,propName,prefix,value);return value}else{return util.getPrefixedProperty(_p.rscratch,propName,prefix)}};if(textTransform=="none"){}else if(textTransform=="uppercase"){text=text.toUpperCase()}else if(textTransform=="lowercase"){text=text.toLowerCase()}if(ele.pstyle("text-wrap").value==="wrap"){var labelKey=rscratch("labelKey");if(labelKey&&rscratch("labelWrapKey")===labelKey){return rscratch("labelWrapCachedText")}var lines=text.split("\n");var maxW=ele.pstyle("text-max-width").pfValue;var wrappedLines=[];for(var l=0;l<lines.length;l++){var line=lines[l];var lineDims=this.calculateLabelDimensions(ele,line,"line="+line);var lineW=lineDims.width;if(lineW>maxW){var words=line.split(/\s+/);var subline="";for(var w=0;w<words.length;w++){var word=words[w];var testLine=subline.length===0?word:subline+" "+word;var testDims=this.calculateLabelDimensions(ele,testLine,"testLine="+testLine);var testW=testDims.width;if(testW<=maxW){subline+=word+" "}else{wrappedLines.push(subline);subline=word+" "}}if(!subline.match(/^\s+$/)){wrappedLines.push(subline)}}else{wrappedLines.push(line)}}rscratch("labelWrapCachedLines",wrappedLines);text=rscratch("labelWrapCachedText",wrappedLines.join("\n"));rscratch("labelWrapKey",labelKey)}return text};BRp.calculateLabelDimensions=function(ele,text,extraKey){var r=this;var cacheKey=ele._private.labelStyleKey+"$@$"+text;if(extraKey){cacheKey+="$@$"+extraKey}var cache=r.labelDimCache||(r.labelDimCache={});if(cache[cacheKey]){return cache[cacheKey]}var sizeMult=1;var fStyle=ele.pstyle("font-style").strValue;var size=sizeMult*ele.pstyle("font-size").pfValue+"px";var family=ele.pstyle("font-family").strValue;var weight=ele.pstyle("font-weight").strValue;var div=this.labelCalcDiv;if(!div){div=this.labelCalcDiv=document.createElement("div");document.body.appendChild(div)}var ds=div.style;ds.fontFamily=family;ds.fontStyle=fStyle;ds.fontSize=size;ds.fontWeight=weight;ds.position="absolute";ds.left="-9999px";ds.top="-9999px";ds.zIndex="-1";ds.visibility="hidden";ds.pointerEvents="none";ds.padding="0";ds.lineHeight="1";if(ele.pstyle("text-wrap").value==="wrap"){ds.whiteSpace="pre"}else{ds.whiteSpace="normal"}div.textContent=text;cache[cacheKey]={width:Math.ceil(div.clientWidth/sizeMult),height:Math.ceil(div.clientHeight/sizeMult)};return cache[cacheKey]};BRp.recalculateEdgeProjections=function(edges){this.findEdgeControlPoints(edges)};BRp.findEdgeControlPoints=function(edges){if(!edges||edges.length===0){return}var r=this;var cy=r.cy;var hasCompounds=cy.hasCompoundNodes();var hashTable={};var pairIds=[];var haystackEdges=[];var pairId;for(var i=0;i<edges.length;i++){var edge=edges[i];var _p=edge._private;var data=_p.data;var curveStyle=edge.pstyle("curve-style").value;var edgeIsUnbundled=curveStyle==="unbundled-bezier"||curveStyle==="segments";if(edge.pstyle("display").value==="none"){continue}if(curveStyle==="haystack"){haystackEdges.push(edge);continue}var srcId=data.source;var tgtId=data.target;pairId=srcId>tgtId?tgtId+"$-$"+srcId:srcId+"$-$"+tgtId;if(edgeIsUnbundled){pairId="unbundled"+"$-$"+data.id}if(hashTable[pairId]==null){hashTable[pairId]=[];pairIds.push(pairId)}hashTable[pairId].push(edge);if(edgeIsUnbundled){hashTable[pairId].hasUnbundled=true}}var src,tgt,src_p,tgt_p,srcPos,tgtPos,srcW,srcH,tgtW,tgtH,srcShape,tgtShape;var vectorNormInverse;var badBezier;for(var p=0;p<pairIds.length;p++){pairId=pairIds[p];var pairEdges=hashTable[pairId];pairEdges.sort(function(edge1,edge2){return edge1.poolIndex()-edge2.poolIndex()});src=pairEdges[0]._private.source;tgt=pairEdges[0]._private.target;if(!pairEdges.hasUnbundled&&src.id()>tgt.id()){var temp=src;src=tgt;tgt=temp}src_p=src._private;tgt_p=tgt._private;srcPos=src_p.position;tgtPos=tgt_p.position;srcW=src.outerWidth();srcH=src.outerHeight();tgtW=tgt.outerWidth();tgtH=tgt.outerHeight();srcShape=r.nodeShapes[this.getNodeShape(src)];tgtShape=r.nodeShapes[this.getNodeShape(tgt)];badBezier=false;if(pairEdges.length>1&&src!==tgt||pairEdges.hasUnbundled){var srcOutside=srcShape.intersectLine(srcPos.x,srcPos.y,srcW,srcH,tgtPos.x,tgtPos.y,0);var tgtOutside=tgtShape.intersectLine(tgtPos.x,tgtPos.y,tgtW,tgtH,srcPos.x,srcPos.y,0);var midptSrcPts={x1:srcOutside[0],x2:tgtOutside[0],y1:srcOutside[1],y2:tgtOutside[1]};var posPts={x1:srcPos.x,x2:tgtPos.x,y1:srcPos.y,y2:tgtPos.y};var dy=tgtOutside[1]-srcOutside[1];var dx=tgtOutside[0]-srcOutside[0];var l=Math.sqrt(dx*dx+dy*dy);var vector={x:dx,y:dy};var vectorNorm={x:vector.x/l,y:vector.y/l};vectorNormInverse={x:-vectorNorm.y,y:vectorNorm.x};if(tgtShape.checkPoint(srcOutside[0],srcOutside[1],0,tgtW,tgtH,tgtPos.x,tgtPos.y)&&srcShape.checkPoint(tgtOutside[0],tgtOutside[1],0,srcW,srcH,srcPos.x,srcPos.y)){vectorNormInverse={};badBezier=true}}var edge;var edge_p;var rs;for(var i=0;i<pairEdges.length;i++){edge=pairEdges[i];edge_p=edge._private;rs=edge_p.rscratch;var edgeIndex1=rs.lastEdgeIndex;var edgeIndex2=i;var numEdges1=rs.lastNumEdges;var numEdges2=pairEdges.length;var curveStyle=edge.pstyle("curve-style").value;var ctrlptDists=edge.pstyle("control-point-distances");var ctrlptWs=edge.pstyle("control-point-weights");var bezierN=ctrlptDists&&ctrlptWs?Math.min(ctrlptDists.value.length,ctrlptWs.value.length):1;var stepSize=edge.pstyle("control-point-step-size").pfValue;var ctrlptDist=ctrlptDists?ctrlptDists.pfValue[0]:undefined;var ctrlptWeight=ctrlptWs.value[0];var edgeIsUnbundled=curveStyle==="unbundled-bezier"||curveStyle==="segments";var srcX1=rs.lastSrcCtlPtX;var srcX2=srcPos.x;var srcY1=rs.lastSrcCtlPtY;var srcY2=srcPos.y;var srcW1=rs.lastSrcCtlPtW;var srcW2=src.outerWidth();var srcH1=rs.lastSrcCtlPtH;var srcH2=src.outerHeight();var tgtX1=rs.lastTgtCtlPtX;var tgtX2=tgtPos.x;var tgtY1=rs.lastTgtCtlPtY;var tgtY2=tgtPos.y;var tgtW1=rs.lastTgtCtlPtW;var tgtW2=tgt.outerWidth();var tgtH1=rs.lastTgtCtlPtH;var tgtH2=tgt.outerHeight();var width1=rs.lastW;var width2=edge.pstyle("control-point-step-size").pfValue;var edgeDistances=edge.pstyle("edge-distances").value;if(badBezier){rs.badBezier=true}else{rs.badBezier=false}if(srcX1===srcX2&&srcY1===srcY2&&srcW1===srcW2&&srcH1===srcH2&&tgtX1===tgtX2&&tgtY1===tgtY2&&tgtW1===tgtW2&&tgtH1===tgtH2&&width1===width2&&(edgeIndex1===edgeIndex2&&numEdges1===numEdges2||edgeIsUnbundled)){continue}else{rs.lastSrcCtlPtX=srcX2;rs.lastSrcCtlPtY=srcY2;rs.lastSrcCtlPtW=srcW2;rs.lastSrcCtlPtH=srcH2;rs.lastTgtCtlPtX=tgtX2;rs.lastTgtCtlPtY=tgtY2;rs.lastTgtCtlPtW=tgtW2;rs.lastTgtCtlPtH=tgtH2;rs.lastEdgeIndex=edgeIndex2;rs.lastNumEdges=numEdges2;rs.lastWidth=width2}if(src===tgt){rs.edgeType="self";var j=i;var loopDist=stepSize;if(edgeIsUnbundled){j=0;loopDist=ctrlptDist}rs.ctrlpts=[srcPos.x,srcPos.y-(1+Math.pow(srcH,1.12)/100)*loopDist*(j/3+1),srcPos.x-(1+Math.pow(srcW,1.12)/100)*loopDist*(j/3+1),srcPos.y]}else if(hasCompounds&&(src.isParent()||src.isChild()||tgt.isParent()||tgt.isChild())&&(src.parents().anySame(tgt)||tgt.parents().anySame(src))){rs.edgeType="compound";rs.badBezier=false;var j=i;var loopDist=stepSize;if(edgeIsUnbundled){j=0;loopDist=ctrlptDist}var loopW=50;var loopaPos={x:srcPos.x-srcW/2,y:srcPos.y-srcH/2};var loopbPos={x:tgtPos.x-tgtW/2,y:tgtPos.y-tgtH/2};var loopPos={x:Math.min(loopaPos.x,loopbPos.x),y:Math.min(loopaPos.y,loopbPos.y)};var minCompoundStretch=.5;var compoundStretchA=Math.max(minCompoundStretch,Math.log(srcW*.01));var compoundStretchB=Math.max(minCompoundStretch,Math.log(tgtW*.01));rs.ctrlpts=[loopPos.x,loopPos.y-(1+Math.pow(loopW,1.12)/100)*loopDist*(j/3+1)*compoundStretchA,loopPos.x-(1+Math.pow(loopW,1.12)/100)*loopDist*(j/3+1)*compoundStretchB,loopPos.y]}else if(curveStyle==="segments"){rs.edgeType="segments";rs.segpts=[];var segmentWs=edge.pstyle("segment-weights").pfValue;var segmentDs=edge.pstyle("segment-distances").pfValue;var segmentsN=Math.min(segmentWs.length,segmentDs.length);for(var s=0;s<segmentsN;s++){var w=segmentWs[s];var d=segmentDs[s];var w1=1-w;var w2=w;var midptPts=edgeDistances==="node-position"?posPts:midptSrcPts;var adjustedMidpt={x:midptPts.x1*w1+midptPts.x2*w2,y:midptPts.y1*w1+midptPts.y2*w2};rs.segpts.push(adjustedMidpt.x+vectorNormInverse.x*d,adjustedMidpt.y+vectorNormInverse.y*d)}}else if(pairEdges.length%2===1&&i===Math.floor(pairEdges.length/2)&&!edgeIsUnbundled){rs.edgeType="straight"}else{var multi=edgeIsUnbundled;rs.edgeType=multi?"multibezier":"bezier";rs.ctrlpts=[];for(var b=0;b<bezierN;b++){var normctrlptDist=(.5-pairEdges.length/2+i)*stepSize;var manctrlptDist;var sign=math.signum(normctrlptDist);if(multi){ctrlptDist=ctrlptDists?ctrlptDists.pfValue[b]:stepSize;ctrlptWeight=ctrlptWs.value[b]}if(edgeIsUnbundled){manctrlptDist=ctrlptDist}else{manctrlptDist=ctrlptDist!==undefined?sign*ctrlptDist:undefined}var distanceFromMidpoint=manctrlptDist!==undefined?manctrlptDist:normctrlptDist;var w1=1-ctrlptWeight;var w2=ctrlptWeight;var midptPts=edgeDistances==="node-position"?posPts:midptSrcPts;var adjustedMidpt={x:midptPts.x1*w1+midptPts.x2*w2,y:midptPts.y1*w1+midptPts.y2*w2};rs.ctrlpts.push(adjustedMidpt.x+vectorNormInverse.x*distanceFromMidpoint,adjustedMidpt.y+vectorNormInverse.y*distanceFromMidpoint)}}this.findEndpoints(edge);var badStart=!is.number(rs.startX)||!is.number(rs.startY);var badAStart=!is.number(rs.arrowStartX)||!is.number(rs.arrowStartY);var badEnd=!is.number(rs.endX)||!is.number(rs.endY);var badAEnd=!is.number(rs.arrowEndX)||!is.number(rs.arrowEndY);var minCpADistFactor=3;var arrowW=this.getArrowWidth(edge.pstyle("width").pfValue)*this.arrowShapeWidth;var minCpADist=minCpADistFactor*arrowW;if(rs.edgeType==="bezier"){var startACpDist=math.dist({x:rs.ctrlpts[0],y:rs.ctrlpts[1]},{x:rs.startX,y:rs.startY});var closeStartACp=startACpDist<minCpADist;var endACpDist=math.dist({x:rs.ctrlpts[0],y:rs.ctrlpts[1]},{x:rs.endX,y:rs.endY});var closeEndACp=endACpDist<minCpADist;var overlapping=false;if(badStart||badAStart||closeStartACp){overlapping=true;var cpD={x:rs.ctrlpts[0]-srcPos.x,y:rs.ctrlpts[1]-srcPos.y};var cpL=Math.sqrt(cpD.x*cpD.x+cpD.y*cpD.y);var cpM={x:cpD.x/cpL,y:cpD.y/cpL};var radius=Math.max(srcW,srcH);var cpProj={x:rs.ctrlpts[0]+cpM.x*2*radius,y:rs.ctrlpts[1]+cpM.y*2*radius};var srcCtrlPtIntn=srcShape.intersectLine(srcPos.x,srcPos.y,srcW,srcH,cpProj.x,cpProj.y,0);if(closeStartACp){rs.ctrlpts[0]=rs.ctrlpts[0]+cpM.x*(minCpADist-startACpDist);rs.ctrlpts[1]=rs.ctrlpts[1]+cpM.y*(minCpADist-startACpDist)}else{rs.ctrlpts[0]=srcCtrlPtIntn[0]+cpM.x*minCpADist;rs.ctrlpts[1]=srcCtrlPtIntn[1]+cpM.y*minCpADist}}if(badEnd||badAEnd||closeEndACp){overlapping=true;var cpD={x:rs.ctrlpts[0]-tgtPos.x,y:rs.ctrlpts[1]-tgtPos.y};var cpL=Math.sqrt(cpD.x*cpD.x+cpD.y*cpD.y);var cpM={x:cpD.x/cpL,y:cpD.y/cpL};var radius=Math.max(srcW,srcH);var cpProj={x:rs.ctrlpts[0]+cpM.x*2*radius,y:rs.ctrlpts[1]+cpM.y*2*radius};var tgtCtrlPtIntn=tgtShape.intersectLine(tgtPos.x,tgtPos.y,tgtW,tgtH,cpProj.x,cpProj.y,0);if(closeEndACp){rs.ctrlpts[0]=rs.ctrlpts[0]+cpM.x*(minCpADist-endACpDist);rs.ctrlpts[1]=rs.ctrlpts[1]+cpM.y*(minCpADist-endACpDist)}else{rs.ctrlpts[0]=tgtCtrlPtIntn[0]+cpM.x*minCpADist;rs.ctrlpts[1]=tgtCtrlPtIntn[1]+cpM.y*minCpADist}}if(overlapping){this.findEndpoints(edge)}}if(rs.edgeType==="multibezier"||rs.edgeType==="bezier"||rs.edgeType==="self"||rs.edgeType==="compound"){rs.allpts=[];rs.allpts.push(rs.startX,rs.startY);for(var b=0;b+1<rs.ctrlpts.length;b+=2){rs.allpts.push(rs.ctrlpts[b],rs.ctrlpts[b+1]);if(b+3<rs.ctrlpts.length){rs.allpts.push((rs.ctrlpts[b]+rs.ctrlpts[b+2])/2,(rs.ctrlpts[b+1]+rs.ctrlpts[b+3])/2)}}rs.allpts.push(rs.endX,rs.endY);var m,mt;if(rs.ctrlpts.length/2%2===0){m=rs.allpts.length/2-1;rs.midX=rs.allpts[m];rs.midY=rs.allpts[m+1]}else{m=rs.allpts.length/2-3;mt=.5;rs.midX=math.qbezierAt(rs.allpts[m],rs.allpts[m+2],rs.allpts[m+4],mt);rs.midY=math.qbezierAt(rs.allpts[m+1],rs.allpts[m+3],rs.allpts[m+5],mt)}}else if(rs.edgeType==="straight"){rs.allpts=[rs.startX,rs.startY,rs.endX,rs.endY];rs.midX=(rs.startX+rs.endX+rs.arrowStartX+rs.arrowEndX)/4;rs.midY=(rs.startY+rs.endY+rs.arrowStartY+rs.arrowEndY)/4}else if(rs.edgeType==="segments"){rs.allpts=[];rs.allpts.push(rs.startX,rs.startY);rs.allpts.push.apply(rs.allpts,rs.segpts);rs.allpts.push(rs.endX,rs.endY);if(rs.segpts.length%4===0){var i2=rs.segpts.length/2;var i1=i2-2;rs.midX=(rs.segpts[i1]+rs.segpts[i2])/2;rs.midY=(rs.segpts[i1+1]+rs.segpts[i2+1])/2}else{var i1=rs.segpts.length/2-1;rs.midX=rs.segpts[i1];rs.midY=rs.segpts[i1+1]}}this.projectLines(edge);this.calculateArrowAngles(edge);this.recalculateEdgeLabelProjections(edge);this.calculateLabelAngles(edge)}}for(var i=0;i<haystackEdges.length;i++){var edge=haystackEdges[i];var _p=edge._private;var rscratch=_p.rscratch;var rs=rscratch;if(!rscratch.haystack){var angle=Math.random()*2*Math.PI;rscratch.source={x:Math.cos(angle),y:Math.sin(angle)};var angle=Math.random()*2*Math.PI;rscratch.target={x:Math.cos(angle),y:Math.sin(angle)}}var src=_p.source;var tgt=_p.target;var srcPos=src._private.position;var tgtPos=tgt._private.position;var srcW=src.width();var tgtW=tgt.width();var srcH=src.height();var tgtH=tgt.height();var radius=edge.pstyle("haystack-radius").value;var halfRadius=radius/2;rs.haystackPts=rs.allpts=[rs.source.x*srcW*halfRadius+srcPos.x,rs.source.y*srcH*halfRadius+srcPos.y,rs.target.x*tgtW*halfRadius+tgtPos.x,rs.target.y*tgtH*halfRadius+tgtPos.y];rs.midX=(rs.allpts[0]+rs.allpts[2])/2;rs.midY=(rs.allpts[1]+rs.allpts[3])/2;rscratch.edgeType="haystack";rscratch.haystack=true;this.projectLines(edge);this.calculateArrowAngles(edge);this.recalculateEdgeLabelProjections(edge);this.calculateLabelAngles(edge)}return hashTable};var getAngleFromDisp=function(dispX,dispY){return Math.atan2(dispY,dispX)-Math.PI/2};BRp.calculateArrowAngles=function(edge){var rs=edge._private.rscratch;var isHaystack=rs.edgeType==="haystack";var isMultibezier=rs.edgeType==="multibezier";var isSegments=rs.edgeType==="segments";var isCompound=rs.edgeType==="compound";var isSelf=rs.edgeType==="self";var dispX,dispY;var startX,startY,endX,endY;var srcPos=edge._private.source._private.position;var tgtPos=edge._private.target._private.position;if(isHaystack){startX=rs.haystackPts[0];startY=rs.haystackPts[1];endX=rs.haystackPts[2];endY=rs.haystackPts[3]}else{startX=rs.arrowStartX;startY=rs.arrowStartY;endX=rs.arrowEndX;endY=rs.arrowEndY}dispX=srcPos.x-startX;dispY=srcPos.y-startY;rs.srcArrowAngle=getAngleFromDisp(dispX,dispY);var midX=rs.midX;var midY=rs.midY;if(isHaystack){midX=(startX+endX)/2;midY=(startY+endY)/2}dispX=endX-startX;dispY=endY-startY;if(isSelf){dispX=-1;dispY=1}else if(isSegments){var pts=rs.allpts;if(pts.length/2%2===0){var i2=pts.length/2;var i1=i2-2;dispX=pts[i2]-pts[i1];dispY=pts[i2+1]-pts[i1+1]}else{var i2=pts.length/2-1;var i1=i2-2;var i3=i2+2;dispX=pts[i2]-pts[i1];dispY=pts[i2+1]-pts[i1+1]}}else if(isMultibezier||isCompound){var pts=rs.allpts;var cpts=rs.ctrlpts;var bp0x,bp0y;var bp1x,bp1y;if(cpts.length/2%2===0){var p0=pts.length/2-1;var ic=p0+2;var p1=ic+2;bp0x=math.qbezierAt(pts[p0],pts[ic],pts[p1],0);bp0y=math.qbezierAt(pts[p0+1],pts[ic+1],pts[p1+1],0);bp1x=math.qbezierAt(pts[p0],pts[ic],pts[p1],1e-4);bp1y=math.qbezierAt(pts[p0+1],pts[ic+1],pts[p1+1],1e-4)}else{var ic=pts.length/2-1;var p0=ic-2;var p1=ic+2;bp0x=math.qbezierAt(pts[p0],pts[ic],pts[p1],.4999);bp0y=math.qbezierAt(pts[p0+1],pts[ic+1],pts[p1+1],.4999);bp1x=math.qbezierAt(pts[p0],pts[ic],pts[p1],.5);bp1y=math.qbezierAt(pts[p0+1],pts[ic+1],pts[p1+1],.5)}dispX=bp1x-bp0x;dispY=bp1y-bp0y}rs.midtgtArrowAngle=getAngleFromDisp(dispX,dispY);rs.midDispX=dispX;rs.midDispY=dispY;dispX*=-1;dispY*=-1;if(isSegments){var pts=rs.allpts;if(pts.length/2%2===0){}else{var i2=pts.length/2-1;var i3=i2+2;dispX=-(pts[i3]-pts[i2]);dispY=-(pts[i3+1]-pts[i2+1])}}rs.midsrcArrowAngle=getAngleFromDisp(dispX,dispY);dispX=tgtPos.x-endX;dispY=tgtPos.y-endY;rs.tgtArrowAngle=getAngleFromDisp(dispX,dispY)};BRp.calculateLabelAngles=function(ele){var _p=ele._private;var rs=_p.rscratch;var isEdge=ele.isEdge();var rot=ele.pstyle("text-rotation");var rotStr=rot.strValue;if(rotStr==="none"){rs.labelAngle=rs.sourceLabelAngle=rs.targetLabelAngle=0}else if(isEdge&&rotStr==="autorotate"){rs.labelAngle=Math.atan(rs.midDispY/rs.midDispX);rs.sourceLabelAngle=rs.sourceLabelAutoAngle;rs.targetLabelAngle=rs.targetLabelAutoAngle}else if(rotStr==="autorotate"){rs.labelAngle=rs.sourceLabelAngle=rs.targetLabelAngle=0}else{rs.labelAngle=rs.sourceLabelAngle=rs.targetLabelAngle=rot.pfValue}};BRp.findEndpoints=function(edge){var r=this;var intersect;var source=edge.source()[0];var target=edge.target()[0];var src_p=source._private;var tgt_p=target._private;var srcPos=src_p.position;var tgtPos=tgt_p.position;var tgtArShape=edge.pstyle("target-arrow-shape").value;var srcArShape=edge.pstyle("source-arrow-shape").value;var rs=edge._private.rscratch;var et=rs.edgeType;var bezier=et==="bezier"||et==="multibezier"||et==="self"||et==="compound";var multi=et!=="bezier";var lines=et==="straight"||et==="segments";var segments=et==="segments";var hasEndpts=bezier||multi||lines;var p1,p2;if(bezier){var cpStart=[rs.ctrlpts[0],rs.ctrlpts[1]];var cpEnd=multi?[rs.ctrlpts[rs.ctrlpts.length-2],rs.ctrlpts[rs.ctrlpts.length-1]]:cpStart;p1=cpEnd;p2=cpStart}else if(lines){var srcArrowFromPt=!segments?[tgtPos.x,tgtPos.y]:rs.segpts.slice(0,2);var tgtArrowFromPt=!segments?[srcPos.x,srcPos.y]:rs.segpts.slice(rs.segpts.length-2);p1=tgtArrowFromPt;p2=srcArrowFromPt}intersect=r.nodeShapes[this.getNodeShape(target)].intersectLine(tgtPos.x,tgtPos.y,target.outerWidth(),target.outerHeight(),p1[0],p1[1],0);var arrowEnd=math.shortenIntersection(intersect,p1,r.arrowShapes[tgtArShape].spacing(edge));var edgeEnd=math.shortenIntersection(intersect,p1,r.arrowShapes[tgtArShape].gap(edge));rs.endX=edgeEnd[0];rs.endY=edgeEnd[1];rs.arrowEndX=arrowEnd[0];rs.arrowEndY=arrowEnd[1];intersect=r.nodeShapes[this.getNodeShape(source)].intersectLine(srcPos.x,srcPos.y,source.outerWidth(),source.outerHeight(),p2[0],p2[1],0);var arrowStart=math.shortenIntersection(intersect,p2,r.arrowShapes[srcArShape].spacing(edge));var edgeStart=math.shortenIntersection(intersect,p2,r.arrowShapes[srcArShape].gap(edge));rs.startX=edgeStart[0];rs.startY=edgeStart[1];rs.arrowStartX=arrowStart[0];rs.arrowStartY=arrowStart[1];if(hasEndpts){if(!is.number(rs.startX)||!is.number(rs.startY)||!is.number(rs.endX)||!is.number(rs.endY)){rs.badLine=true}else{rs.badLine=false}}};BRp.getArrowWidth=BRp.getArrowHeight=function(edgeWidth){var cache=this.arrowWidthCache=this.arrowWidthCache||{};var cachedVal=cache[edgeWidth];if(cachedVal){return cachedVal}cachedVal=Math.max(Math.pow(edgeWidth*13.37,.9),29);cache[edgeWidth]=cachedVal;return cachedVal};module.exports=BRp},{"../../../collection/zsort":66,"../../../is":117,"../../../math":119,"../../../util":134}],93:[function(require,module,exports){"use strict";var BRp={};BRp.getCachedImage=function(url,onLoad){var r=this;var imageCache=r.imageCache=r.imageCache||{};var cache=imageCache[url];if(cache){if(!cache.image.complete){cache.image.addEventListener("load",onLoad)}return cache.image}else{cache=imageCache[url]=imageCache[url]||{};var image=cache.image=new Image;image.addEventListener("load",onLoad);var dataUriPrefix="data:";var isDataUri=url.substring(0,dataUriPrefix.length).toLowerCase()===dataUriPrefix;if(!isDataUri){image.crossOrigin="Anonymous"}image.src=url;return image}};module.exports=BRp},{}],94:[function(require,module,exports){"use strict";var is=require("../../../is");var util=require("../../../util");var BaseRenderer=function(options){this.init(options)};var BR=BaseRenderer;var BRp=BR.prototype;BRp.clientFunctions=["redrawHint","render","renderTo","matchCanvasSize","nodeShapeImpl","arrowShapeImpl"];BRp.init=function(options){var r=this;r.options=options;r.cy=options.cy;r.container=options.cy.container();r.selection=[undefined,undefined,undefined,undefined,0];r.bezierProjPcts=[.05,.225,.4,.5,.6,.775,.95];r.hoverData={down:null,last:null,downTime:null,triggerMode:null,dragging:false,initialPan:[null,null],capture:false};r.dragData={possibleDragElements:[]};r.touchData={start:null,capture:false,startPosition:[null,null,null,null,null,null],singleTouchStartTime:null,singleTouchMoved:true,now:[null,null,null,null,null,null],earlier:[null,null,null,null,null,null]};r.redraws=0;r.showFps=options.showFps;r.hideEdgesOnViewport=options.hideEdgesOnViewport;r.hideLabelsOnViewport=options.hideLabelsOnViewport;r.textureOnViewport=options.textureOnViewport;r.wheelSensitivity=options.wheelSensitivity;r.motionBlurEnabled=options.motionBlur;r.forcedPixelRatio=options.pixelRatio;r.motionBlur=options.motionBlur;r.motionBlurOpacity=options.motionBlurOpacity;r.motionBlurTransparency=1-r.motionBlurOpacity;r.motionBlurPxRatio=1;r.mbPxRBlurry=1;r.minMbLowQualFrames=4;r.fullQualityMb=false;r.clearedForMotionBlur=[];r.desktopTapThreshold=options.desktopTapThreshold;r.desktopTapThreshold2=options.desktopTapThreshold*options.desktopTapThreshold;r.touchTapThreshold=options.touchTapThreshold;r.touchTapThreshold2=options.touchTapThreshold*options.touchTapThreshold;r.tapholdDuration=500;r.bindings=[];r.beforeRenderCallbacks=[];r.beforeRenderPriorities={animations:400,eleCalcs:300,eleTxrDeq:200,lyrTxrDeq:100};r.registerNodeShapes();r.registerArrowShapes();r.registerCalculationListeners();r.load()};BRp.notify=function(params){var types;var r=this;if(this.destroyed){return}if(is.array(params.type)){types=params.type}else{types=[params.type]}var has={};for(var i=0;i<types.length;i++){var type=types[i];has[type]=true}if(has["destroy"]){r.destroy();return}if(has["add"]||has["remove"]||has["load"]||has["style"]){r.updateCachedZSortedEles()}if(has["viewport"]){r.redrawHint("select",true)}if(has["load"]||has["resize"]){r.invalidateContainerClientCoordsCache();r.matchCanvasSize(r.container)}r.redrawHint("eles",true);r.redrawHint("drag",true);this.startRenderLoop();this.redraw()};BRp.destroy=function(){var r=this;r.destroyed=true;r.cy.stopAnimationLoop();for(var i=0;i<r.bindings.length;i++){var binding=r.bindings[i];var b=binding;var tgt=b.target;(tgt.off||tgt.removeEventListener).apply(tgt,b.args)}r.bindings=[];r.beforeRenderCallbacks=[];r.onUpdateEleCalcsFns=[];if(r.removeObserver){r.removeObserver.disconnect()}if(r.styleObserver){r.styleObserver.disconnect()}if(r.labelCalcDiv){try{document.body.removeChild(r.labelCalcDiv)}catch(e){}}};[require("./arrow-shapes"),require("./coord-ele-math"),require("./images"),require("./load-listeners"),require("./node-shapes"),require("./redraw")].forEach(function(props){util.extend(BRp,props)});module.exports=BR},{"../../../is":117,"../../../util":134,"./arrow-shapes":91,"./coord-ele-math":92,"./images":93,"./load-listeners":95,"./node-shapes":96,"./redraw":97}],95:[function(require,module,exports){"use strict";var is=require("../../../is");var util=require("../../../util");var math=require("../../../math");var Event=require("../../../event");var BRp={};BRp.registerBinding=function(target,event,handler,useCapture){var args=Array.prototype.slice.apply(arguments,[1]);var b=this.binder(target);return b.on.apply(b,args)};BRp.binder=function(tgt){var r=this;var on=function(){var args=arguments;r.bindings.push({target:tgt,args:args});(tgt.addEventListener||tgt.on).apply(tgt,args);return this};return{on:on,addEventListener:on,addListener:on,bind:on}};BRp.nodeIsDraggable=function(node){return node&&node.isNode()&&!node.locked()&&node.grabbable()};BRp.nodeIsGrabbable=function(node){return this.nodeIsDraggable(node)&&node.pstyle("opacity").value!==0&&node.pstyle("visibility").value==="visible"&&node.pstyle("display").value==="element"};BRp.load=function(){var r=this;var triggerEvents=function(target,names,e,props){if(target==null){target=r.cy}for(var i=0;i<names.length;i++){var name=names[i];var event=new Event(e,util.extend({type:name},props));target.trigger(event)}};var isMultSelKeyDown=function(e){return e.shiftKey||e.metaKey||e.ctrlKey};var allowPanningPassthrough=function(down,downs){var allowPassthrough=true;if(r.cy.hasCompoundNodes()&&down&&down.isEdge()){for(var i=0;downs&&i<downs.length;i++){var down=downs[i];if(down.isNode()&&down.isParent()){allowPassthrough=false;break}}}else{allowPassthrough=true}return allowPassthrough};var getDragListIds=function(opts){var listHasId;if(opts.addToList&&r.cy.hasCompoundNodes()){if(!opts.addToList.hasId){opts.addToList.hasId={};for(var i=0;i<opts.addToList.length;i++){var ele=opts.addToList[i];opts.addToList.hasId[ele.id()]=true}}listHasId=opts.addToList.hasId}return listHasId||{}};var setGrabbed=function(ele){ele[0]._private.grabbed=true};var setFreed=function(ele){ele[0]._private.grabbed=false};var setInDragLayer=function(ele){ele[0]._private.rscratch.inDragLayer=true};var setOutDragLayer=function(ele){ele[0]._private.rscratch.inDragLayer=false};var setGrabTarget=function(ele){ele[0]._private.rscratch.isGrabTarget=true};var removeGrabTarget=function(ele){ele[0]._private.rscratch.isGrabTarget=false};var addToDragList=function(ele,opts){var listHasId=getDragListIds(opts);if(!listHasId[ele.id()]){opts.addToList.push(ele);listHasId[ele.id()]=true;setGrabbed(ele)}};var addDescendantsToDrag=function(node,opts){if(!node.cy().hasCompoundNodes()){return}if(opts.inDragLayer==null&&opts.addToList==null){return}var innerNodes=node.descendants();if(opts.inDragLayer){innerNodes.forEach(setInDragLayer);innerNodes.connectedEdges().forEach(setInDragLayer)}if(opts.addToList){innerNodes.forEach(function(ele){addToDragList(ele,opts)})}};var addNodesToDrag=function(nodes,opts){opts=opts||{};var hasCompoundNodes=nodes.cy().hasCompoundNodes();if(opts.inDragLayer){nodes.forEach(setInDragLayer);nodes.neighborhood().stdFilter(function(ele){return!hasCompoundNodes||ele.isEdge()}).forEach(setInDragLayer)}if(opts.addToList){nodes.forEach(function(ele){addToDragList(ele,opts)})}addDescendantsToDrag(nodes,opts);updateAncestorsInDragLayer(nodes,{inDragLayer:opts.inDragLayer});r.updateCachedGrabbedEles()};var addNodeToDrag=addNodesToDrag;var freeDraggedElements=function(grabbedEles){if(!grabbedEles){return}grabbedEles.hasId={};r.getCachedZSortedEles().forEach(function(ele){setFreed(ele);setOutDragLayer(ele);removeGrabTarget(ele)});r.updateCachedGrabbedEles()};var updateAncestorsInDragLayer=function(node,opts){if(opts.inDragLayer==null&&opts.addToList==null){return}if(!node.cy().hasCompoundNodes()){return}var parent=node.ancestors().orphans();if(parent.same(node)){return}var nodes=parent.descendants().spawnSelf().merge(parent).unmerge(node).unmerge(node.descendants());var edges=nodes.connectedEdges();if(opts.inDragLayer){edges.forEach(setInDragLayer);nodes.forEach(setInDragLayer)}if(opts.addToList){nodes.forEach(function(ele){addToDragList(ele,opts)})}};var haveMutationsApi=typeof MutationObserver!=="undefined";if(haveMutationsApi){r.removeObserver=new MutationObserver(function(mutns){for(var i=0;i<mutns.length;i++){var mutn=mutns[i];var rNodes=mutn.removedNodes;if(rNodes){for(var j=0;j<rNodes.length;j++){var rNode=rNodes[j];if(rNode===r.container){r.destroy();break}}}}});if(r.container.parentNode){r.removeObserver.observe(r.container.parentNode,{childList:true})}}else{r.registerBinding(r.container,"DOMNodeRemoved",function(e){r.destroy()})}var onResize=util.debounce(function(){r.cy.invalidateSize();r.invalidateContainerClientCoordsCache();r.matchCanvasSize(r.container);r.redrawHint("eles",true);r.redrawHint("drag",true);r.redraw()},100);if(haveMutationsApi){r.styleObserver=new MutationObserver(onResize);r.styleObserver.observe(r.container,{attributes:true})}r.registerBinding(window,"resize",onResize);var invalCtnrBBOnScroll=function(domEle){r.registerBinding(domEle,"scroll",function(e){r.invalidateContainerClientCoordsCache()})};var bbCtnr=r.cy.container();for(;;){invalCtnrBBOnScroll(bbCtnr);if(bbCtnr.parentNode){bbCtnr=bbCtnr.parentNode}else{break}}r.registerBinding(r.container,"contextmenu",function(e){e.preventDefault()});var inBoxSelection=function(){return r.selection[4]!==0};r.registerBinding(r.container,"mousedown",function mousedownHandler(e){e.preventDefault();r.hoverData.capture=true;r.hoverData.which=e.which;var cy=r.cy;var gpos=[e.clientX,e.clientY];var pos=r.projectIntoViewport(gpos[0],gpos[1]);var select=r.selection;var nears=r.findNearestElements(pos[0],pos[1],true,false);var near=nears[0];var draggedElements=r.dragData.possibleDragElements;r.hoverData.mdownPos=pos;r.hoverData.mdownGPos=gpos;var checkForTaphold=function(){r.hoverData.tapholdCancelled=false;clearTimeout(r.hoverData.tapholdTimeout);r.hoverData.tapholdTimeout=setTimeout(function(){if(r.hoverData.tapholdCancelled){return}else{var ele=r.hoverData.down;if(ele){ele.trigger(new Event(e,{type:"taphold",cyPosition:{x:pos[0],y:pos[1]}}))}else{cy.trigger(new Event(e,{type:"taphold",cyPosition:{x:pos[0],y:pos[1]}}))}}},r.tapholdDuration)};if(e.which==3){r.hoverData.cxtStarted=true;var cxtEvt=new Event(e,{type:"cxttapstart",cyPosition:{x:pos[0],y:pos[1]}});if(near){near.activate();near.trigger(cxtEvt);r.hoverData.down=near}else{cy.trigger(cxtEvt)}r.hoverData.downTime=(new Date).getTime();r.hoverData.cxtDragged=false}else if(e.which==1){if(near){near.activate()}{if(near!=null){if(r.nodeIsGrabbable(near)){var grabEvent=new Event(e,{type:"grab",cyPosition:{x:pos[0],y:pos[1]}});setGrabTarget(near);if(!near.selected()){draggedElements=r.dragData.possibleDragElements=[];addNodeToDrag(near,{addToList:draggedElements});near.trigger(grabEvent)}else if(near.selected()){draggedElements=r.dragData.possibleDragElements=[];var selectedNodes=cy.$(function(){return this.isNode()&&this.selected()&&r.nodeIsGrabbable(this)});addNodesToDrag(selectedNodes,{addToList:draggedElements});near.trigger(grabEvent)}r.redrawHint("eles",true);r.redrawHint("drag",true)}}r.hoverData.down=near;r.hoverData.downs=nears;r.hoverData.downTime=(new Date).getTime()}triggerEvents(near,["mousedown","tapstart","vmousedown"],e,{cyPosition:{x:pos[0],y:pos[1]}});if(near==null){select[4]=1;r.data.bgActivePosistion={x:pos[0],y:pos[1]};r.redrawHint("select",true);r.redraw()}else if(near.isEdge()){select[4]=1}checkForTaphold()}select[0]=select[2]=pos[0];select[1]=select[3]=pos[1]},false);r.registerBinding(window,"mousemove",function mousemoveHandler(e){var preventDefault=false;var capture=r.hoverData.capture;if(!capture){var containerPageCoords=r.findContainerClientCoords();if(e.clientX>containerPageCoords[0]&&e.clientX<containerPageCoords[0]+r.canvasWidth&&e.clientY>containerPageCoords[1]&&e.clientY<containerPageCoords[1]+r.canvasHeight){}else{return}var cyContainer=r.container;var target=e.target;var tParent=target.parentNode;var containerIsTarget=false;while(tParent){if(tParent===cyContainer){containerIsTarget=true;break}tParent=tParent.parentNode}if(!containerIsTarget){return}}var cy=r.cy;var zoom=cy.zoom();var gpos=[e.clientX,e.clientY];var pos=r.projectIntoViewport(gpos[0],gpos[1]);var mdownPos=r.hoverData.mdownPos;var mdownGPos=r.hoverData.mdownGPos;var select=r.selection;var near=null;if(!r.hoverData.draggingEles&&!r.hoverData.dragging&&!r.hoverData.selecting){near=r.findNearestElement(pos[0],pos[1],true,false)}var last=r.hoverData.last;var down=r.hoverData.down;var disp=[pos[0]-select[2],pos[1]-select[3]];var draggedElements=r.dragData.possibleDragElements;var isOverThresholdDrag;if(mdownGPos){var dx=gpos[0]-mdownGPos[0];var dx2=dx*dx;var dy=gpos[1]-mdownGPos[1];var dy2=dy*dy;var dist2=dx2+dy2;isOverThresholdDrag=dist2>=r.desktopTapThreshold2}var multSelKeyDown=isMultSelKeyDown(e);if(isOverThresholdDrag){r.hoverData.tapholdCancelled=true}var updateDragDelta=function(){var dragDelta=r.hoverData.dragDelta=r.hoverData.dragDelta||[];if(dragDelta.length===0){dragDelta.push(disp[0]);dragDelta.push(disp[1])}else{dragDelta[0]+=disp[0];dragDelta[1]+=disp[1]}};preventDefault=true;triggerEvents(near,["mousemove","vmousemove","tapdrag"],e,{cyPosition:{x:pos[0],y:pos[1]}});if(r.hoverData.which===3){if(isOverThresholdDrag){var cxtEvt=new Event(e,{type:"cxtdrag",cyPosition:{x:pos[0],y:pos[1]}});if(down){down.trigger(cxtEvt)}else{cy.trigger(cxtEvt)}r.hoverData.cxtDragged=true;if(!r.hoverData.cxtOver||near!==r.hoverData.cxtOver){if(r.hoverData.cxtOver){r.hoverData.cxtOver.trigger(new Event(e,{type:"cxtdragout",cyPosition:{x:pos[0],y:pos[1]}}))}r.hoverData.cxtOver=near;if(near){near.trigger(new Event(e,{type:"cxtdragover",cyPosition:{x:pos[0],y:pos[1]}}))}}}}else if(r.hoverData.dragging){preventDefault=true;if(cy.panningEnabled()&&cy.userPanningEnabled()){var deltaP;if(r.hoverData.justStartedPan){var mdPos=r.hoverData.mdownPos;deltaP={x:(pos[0]-mdPos[0])*zoom,y:(pos[1]-mdPos[1])*zoom};r.hoverData.justStartedPan=false}else{deltaP={x:disp[0]*zoom,y:disp[1]*zoom}}cy.panBy(deltaP);r.hoverData.dragged=true}pos=r.projectIntoViewport(e.clientX,e.clientY)}else if(select[4]==1&&(down==null||down.isEdge())){if(isOverThresholdDrag){if(!r.hoverData.dragging&&cy.boxSelectionEnabled()&&(multSelKeyDown||!cy.panningEnabled()||!cy.userPanningEnabled())){r.data.bgActivePosistion=undefined;if(!r.hoverData.selecting){cy.trigger("boxstart")}r.hoverData.selecting=true;r.redrawHint("select",true);r.redraw()}else if(!r.hoverData.selecting&&cy.panningEnabled()&&cy.userPanningEnabled()){var allowPassthrough=allowPanningPassthrough(down,r.hoverData.downs);if(allowPassthrough){r.hoverData.dragging=true;r.hoverData.justStartedPan=true;select[4]=0;r.data.bgActivePosistion=math.array2point(mdownPos);r.redrawHint("select",true);r.redraw()}}if(down&&down.isEdge()&&down.active()){down.unactivate()}}}else{if(down&&down.isEdge()&&down.active()){down.unactivate()}if((!down||!down.grabbed())&&near!=last){if(last){triggerEvents(last,["mouseout","tapdragout"],e,{cyPosition:{x:pos[0],y:pos[1]}})}if(near){triggerEvents(near,["mouseover","tapdragover"],e,{cyPosition:{x:pos[0],y:pos[1]}})}r.hoverData.last=near}if(down&&r.nodeIsDraggable(down)){if(isOverThresholdDrag){var justStartedDrag=!r.dragData.didDrag;if(justStartedDrag){r.redrawHint("eles",true)}r.dragData.didDrag=true;var toTrigger=[];if(!r.hoverData.draggingEles){addNodesToDrag(cy.collection(draggedElements),{inDragLayer:true})}for(var i=0;i<draggedElements.length;i++){var dEle=draggedElements[i];if(r.nodeIsDraggable(dEle)&&dEle.grabbed()){var dPos=dEle._private.position;toTrigger.push(dEle);if(is.number(disp[0])&&is.number(disp[1])){var updatePos=!dEle.isParent();if(updatePos){dPos.x+=disp[0];dPos.y+=disp[1]}if(justStartedDrag){var dragDelta=r.hoverData.dragDelta;if(updatePos&&dragDelta&&is.number(dragDelta[0])&&is.number(dragDelta[1])){dPos.x+=dragDelta[0];dPos.y+=dragDelta[1]}}}}}r.hoverData.draggingEles=true;var tcol=cy.collection(toTrigger);tcol.updateCompoundBounds();tcol.trigger("position drag");r.redrawHint("drag",true);r.redraw()}else{updateDragDelta()}}preventDefault=true}select[2]=pos[0];select[3]=pos[1];if(preventDefault){if(e.stopPropagation)e.stopPropagation();if(e.preventDefault)e.preventDefault();return false}},false);r.registerBinding(window,"mouseup",function mouseupHandler(e){var capture=r.hoverData.capture;if(!capture){return}r.hoverData.capture=false;var cy=r.cy;var pos=r.projectIntoViewport(e.clientX,e.clientY);var select=r.selection;var near=r.findNearestElement(pos[0],pos[1],true,false);var draggedElements=r.dragData.possibleDragElements;var down=r.hoverData.down;var multSelKeyDown=isMultSelKeyDown(e);if(r.data.bgActivePosistion){r.redrawHint("select",true);r.redraw()}r.hoverData.tapholdCancelled=true;r.data.bgActivePosistion=undefined;if(down){down.unactivate()}if(r.hoverData.which===3){var cxtEvt=new Event(e,{type:"cxttapend",cyPosition:{x:pos[0],y:pos[1]}});if(down){down.trigger(cxtEvt)}else{cy.trigger(cxtEvt)}if(!r.hoverData.cxtDragged){var cxtTap=new Event(e,{type:"cxttap",cyPosition:{x:pos[0],y:pos[1]}});if(down){down.trigger(cxtTap)}else{cy.trigger(cxtTap)}}r.hoverData.cxtDragged=false;r.hoverData.which=null}else if(r.hoverData.which===1){if(down==null&&!r.dragData.didDrag&&!r.hoverData.selecting&&!r.hoverData.dragged&&!isMultSelKeyDown(e)){cy.$(function(){return this.selected()}).unselect();if(draggedElements.length>0){r.redrawHint("eles",true)}r.dragData.possibleDragElements=draggedElements=[]}triggerEvents(near,["mouseup","tapend","vmouseup"],e,{cyPosition:{x:pos[0],y:pos[1]}});if(!r.dragData.didDrag&&!r.hoverData.dragged&&!r.hoverData.selecting){triggerEvents(down,["click","tap","vclick"],e,{cyPosition:{x:pos[0],y:pos[1]}})}if(near==down&&!r.dragData.didDrag&&!r.hoverData.selecting){if(near!=null&&near._private.selectable){if(r.hoverData.dragging){}else if(cy.selectionType()==="additive"||multSelKeyDown){if(near.selected()){near.unselect()}else{near.select()}}else{if(!multSelKeyDown){cy.$(":selected").unmerge(near).unselect();near.select()}}r.redrawHint("eles",true)}}if(r.hoverData.selecting){var box=cy.collection(r.getAllInBox(select[0],select[1],select[2],select[3]));r.redrawHint("select",true);if(box.length>0){r.redrawHint("eles",true)}cy.trigger("boxend");var eleWouldBeSelected=function(ele){return ele.selectable()&&!ele.selected()};if(cy.selectionType()==="additive"){box.trigger("box").stdFilter(eleWouldBeSelected).select().trigger("boxselect")}else{if(!multSelKeyDown){cy.$(":selected").unmerge(box).unselect()}box.trigger("box").stdFilter(eleWouldBeSelected).select().trigger("boxselect")}r.redraw()}if(r.hoverData.dragging){r.hoverData.dragging=false;r.redrawHint("select",true);r.redrawHint("eles",true);r.redraw()}if(!select[4]){r.redrawHint("drag",true);r.redrawHint("eles",true);var downWasGrabbed=down&&down.grabbed();freeDraggedElements(draggedElements);if(downWasGrabbed){down.trigger("free")}}}select[4]=0;r.hoverData.down=null;r.hoverData.cxtStarted=false;r.hoverData.draggingEles=false;r.hoverData.selecting=false;r.dragData.didDrag=false;r.hoverData.dragged=false;r.hoverData.dragDelta=[];r.hoverData.mdownPos=null;r.hoverData.mdownGPos=null},false);var wheelHandler=function(e){if(r.scrollingPage){return}var cy=r.cy;var pos=r.projectIntoViewport(e.clientX,e.clientY);var rpos=[pos[0]*cy.zoom()+cy.pan().x,pos[1]*cy.zoom()+cy.pan().y];if(r.hoverData.draggingEles||r.hoverData.dragging||r.hoverData.cxtStarted||inBoxSelection()){e.preventDefault();return}if(cy.panningEnabled()&&cy.userPanningEnabled()&&cy.zoomingEnabled()&&cy.userZoomingEnabled()){e.preventDefault();r.data.wheelZooming=true;clearTimeout(r.data.wheelTimeout);r.data.wheelTimeout=setTimeout(function(){r.data.wheelZooming=false;r.redrawHint("eles",true);r.redraw()},150);var diff;if(e.deltaY!=null){diff=e.deltaY/-250}else if(e.wheelDeltaY!=null){diff=e.wheelDeltaY/1e3}else{diff=e.wheelDelta/1e3}diff=diff*r.wheelSensitivity;var needsWheelFix=e.deltaMode===1;if(needsWheelFix){diff*=33}cy.zoom({level:cy.zoom()*Math.pow(10,diff),renderedPosition:{x:rpos[0],y:rpos[1]}})}};r.registerBinding(r.container,"wheel",wheelHandler,true);r.registerBinding(window,"scroll",function scrollHandler(e){r.scrollingPage=true;clearTimeout(r.scrollingPageTimeout);r.scrollingPageTimeout=setTimeout(function(){r.scrollingPage=false},250)},true);r.registerBinding(r.container,"mouseout",function mouseOutHandler(e){var pos=r.projectIntoViewport(e.clientX,e.clientY);r.cy.trigger(new Event(e,{type:"mouseout",cyPosition:{x:pos[0],y:pos[1]}}))},false);r.registerBinding(r.container,"mouseover",function mouseOverHandler(e){var pos=r.projectIntoViewport(e.clientX,e.clientY);r.cy.trigger(new Event(e,{type:"mouseover",cyPosition:{x:pos[0],y:pos[1]}}))},false);var f1x1,f1y1,f2x1,f2y1;var distance1,distance1Sq;var center1,modelCenter1;var offsetLeft,offsetTop;var containerWidth,containerHeight;var twoFingersStartInside;var distance=function(x1,y1,x2,y2){return Math.sqrt((x2-x1)*(x2-x1)+(y2-y1)*(y2-y1))};var distanceSq=function(x1,y1,x2,y2){return(x2-x1)*(x2-x1)+(y2-y1)*(y2-y1)};var touchstartHandler;r.registerBinding(r.container,"touchstart",touchstartHandler=function(e){r.touchData.capture=true;r.data.bgActivePosistion=undefined;var cy=r.cy;var now=r.touchData.now;var earlier=r.touchData.earlier;if(e.touches[0]){var pos=r.projectIntoViewport(e.touches[0].clientX,e.touches[0].clientY);now[0]=pos[0];now[1]=pos[1]}if(e.touches[1]){var pos=r.projectIntoViewport(e.touches[1].clientX,e.touches[1].clientY);now[2]=pos[0];now[3]=pos[1]}if(e.touches[2]){var pos=r.projectIntoViewport(e.touches[2].clientX,e.touches[2].clientY);now[4]=pos[0];now[5]=pos[1]}if(e.touches[1]){freeDraggedElements(r.dragData.touchDragEles);var offsets=r.findContainerClientCoords();offsetLeft=offsets[0];offsetTop=offsets[1];containerWidth=offsets[2];containerHeight=offsets[3];f1x1=e.touches[0].clientX-offsetLeft;f1y1=e.touches[0].clientY-offsetTop;f2x1=e.touches[1].clientX-offsetLeft;f2y1=e.touches[1].clientY-offsetTop;twoFingersStartInside=0<=f1x1&&f1x1<=containerWidth&&0<=f2x1&&f2x1<=containerWidth&&0<=f1y1&&f1y1<=containerHeight&&0<=f2y1&&f2y1<=containerHeight;var pan=cy.pan();var zoom=cy.zoom();distance1=distance(f1x1,f1y1,f2x1,f2y1);distance1Sq=distanceSq(f1x1,f1y1,f2x1,f2y1);center1=[(f1x1+f2x1)/2,(f1y1+f2y1)/2];modelCenter1=[(center1[0]-pan.x)/zoom,(center1[1]-pan.y)/zoom];var cxtDistThreshold=200;var cxtDistThresholdSq=cxtDistThreshold*cxtDistThreshold;if(distance1Sq<cxtDistThresholdSq&&!e.touches[2]){var near1=r.findNearestElement(now[0],now[1],true,true);var near2=r.findNearestElement(now[2],now[3],true,true);if(near1&&near1.isNode()){near1.activate().trigger(new Event(e,{type:"cxttapstart",cyPosition:{x:now[0],y:now[1]}}));r.touchData.start=near1}else if(near2&&near2.isNode()){near2.activate().trigger(new Event(e,{type:"cxttapstart",cyPosition:{x:now[0],y:now[1]}}));r.touchData.start=near2}else{cy.trigger(new Event(e,{type:"cxttapstart",cyPosition:{x:now[0],y:now[1]}}));r.touchData.start=null}if(r.touchData.start){r.touchData.start._private.grabbed=false}r.touchData.cxt=true;r.touchData.cxtDragged=false;r.data.bgActivePosistion=undefined;r.redraw();return}}if(e.touches[2]){}else if(e.touches[1]){}else if(e.touches[0]){var nears=r.findNearestElements(now[0],now[1],true,true);var near=nears[0];if(near!=null){near.activate();r.touchData.start=near;r.touchData.starts=nears;if(r.nodeIsGrabbable(near)){var draggedEles=r.dragData.touchDragEles=[];r.redrawHint("eles",true);r.redrawHint("drag",true);if(near.selected()){var selectedNodes=cy.$(function(){return this.selected()&&r.nodeIsGrabbable(this)});addNodesToDrag(selectedNodes,{addToList:draggedEles})}else{addNodeToDrag(near,{addToList:draggedEles})}setGrabTarget(near);near.trigger(new Event(e,{type:"grab",cyPosition:{x:now[0],y:now[1]}}))}}triggerEvents(near,["touchstart","tapstart","vmousedown"],e,{cyPosition:{x:now[0],y:now[1]}});if(near==null){r.data.bgActivePosistion={x:pos[0],y:pos[1]};r.redrawHint("select",true);r.redraw()}r.touchData.startPosition=[];for(var i=0;i<now.length;i++){earlier[i]=now[i];r.touchData.startPosition[i]=now[i]}r.touchData.startGPosition=[e.touches[0].clientX,e.touches[0].clientY];r.touchData.singleTouchMoved=false;r.touchData.singleTouchStartTime=+new Date;clearTimeout(r.touchData.tapholdTimeout);r.touchData.tapholdTimeout=setTimeout(function(){if(r.touchData.singleTouchMoved===false&&!r.pinching&&!r.touchData.selecting){triggerEvents(r.touchData.start,["taphold"],e,{cyPosition:{x:now[0],y:now[1]}});if(!r.touchData.start){cy.$(":selected").unselect()}}},r.tapholdDuration)}},false);var touchmoveHandler;r.registerBinding(window,"touchmove",touchmoveHandler=function(e){var select=r.selection;var capture=r.touchData.capture;var cy=r.cy;var now=r.touchData.now;var earlier=r.touchData.earlier;var zoom=cy.zoom();if(e.touches[0]){var pos=r.projectIntoViewport(e.touches[0].clientX,e.touches[0].clientY);now[0]=pos[0];now[1]=pos[1]}if(e.touches[1]){var pos=r.projectIntoViewport(e.touches[1].clientX,e.touches[1].clientY);now[2]=pos[0];now[3]=pos[1]}if(e.touches[2]){var pos=r.projectIntoViewport(e.touches[2].clientX,e.touches[2].clientY);now[4]=pos[0];now[5]=pos[1]}var isOverThresholdDrag;if(capture&&e.touches[0]){var disp=[];for(var j=0;j<now.length;j++){disp[j]=now[j]-earlier[j]}var startGPos=r.touchData.startGPosition;var dx=e.touches[0].clientX-startGPos[0];var dx2=dx*dx;var dy=e.touches[0].clientY-startGPos[1];var dy2=dy*dy;var dist2=dx2+dy2;isOverThresholdDrag=dist2>=r.touchTapThreshold2}if(capture&&r.touchData.cxt){e.preventDefault();var f1x2=e.touches[0].clientX-offsetLeft,f1y2=e.touches[0].clientY-offsetTop;var f2x2=e.touches[1].clientX-offsetLeft,f2y2=e.touches[1].clientY-offsetTop;var distance2Sq=distanceSq(f1x2,f1y2,f2x2,f2y2);var factorSq=distance2Sq/distance1Sq;var distThreshold=150;var distThresholdSq=distThreshold*distThreshold;var factorThreshold=1.5;var factorThresholdSq=factorThreshold*factorThreshold;if(factorSq>=factorThresholdSq||distance2Sq>=distThresholdSq){r.touchData.cxt=false;if(r.touchData.start){r.touchData.start.unactivate();r.touchData.start=null}r.data.bgActivePosistion=undefined;r.redrawHint("select",true);var cxtEvt=new Event(e,{type:"cxttapend",cyPosition:{x:now[0],y:now[1]}});if(r.touchData.start){r.touchData.start.trigger(cxtEvt)}else{cy.trigger(cxtEvt)}}}if(capture&&r.touchData.cxt){var cxtEvt=new Event(e,{type:"cxtdrag",cyPosition:{x:now[0],y:now[1]}});r.data.bgActivePosistion=undefined;r.redrawHint("select",true);if(r.touchData.start){r.touchData.start.trigger(cxtEvt)}else{cy.trigger(cxtEvt)}if(r.touchData.start){r.touchData.start._private.grabbed=false}r.touchData.cxtDragged=true;var near=r.findNearestElement(now[0],now[1],true,true);if(!r.touchData.cxtOver||near!==r.touchData.cxtOver){if(r.touchData.cxtOver){r.touchData.cxtOver.trigger(new Event(e,{type:"cxtdragout",cyPosition:{x:now[0],y:now[1]}}))}r.touchData.cxtOver=near;if(near){near.trigger(new Event(e,{type:"cxtdragover",cyPosition:{x:now[0],y:now[1]}}))}}}else if(capture&&e.touches[2]&&cy.boxSelectionEnabled()){e.preventDefault();r.data.bgActivePosistion=undefined;this.lastThreeTouch=+new Date;if(!r.touchData.selecting){cy.trigger("boxstart")}r.touchData.selecting=true;r.redrawHint("select",true);if(!select||select.length===0||select[0]===undefined){select[0]=(now[0]+now[2]+now[4])/3;select[1]=(now[1]+now[3]+now[5])/3;select[2]=(now[0]+now[2]+now[4])/3+1;select[3]=(now[1]+now[3]+now[5])/3+1}else{select[2]=(now[0]+now[2]+now[4])/3;select[3]=(now[1]+now[3]+now[5])/3}select[4]=1;r.touchData.selecting=true;r.redraw()}else if(capture&&e.touches[1]&&cy.zoomingEnabled()&&cy.panningEnabled()&&cy.userZoomingEnabled()&&cy.userPanningEnabled()){e.preventDefault();r.data.bgActivePosistion=undefined;r.redrawHint("select",true);var draggedEles=r.dragData.touchDragEles;if(draggedEles){r.redrawHint("drag",true);for(var i=0;i<draggedEles.length;i++){draggedEles[i]._private.grabbed=false;draggedEles[i]._private.rscratch.inDragLayer=false}}var f1x2=e.touches[0].clientX-offsetLeft,f1y2=e.touches[0].clientY-offsetTop;var f2x2=e.touches[1].clientX-offsetLeft,f2y2=e.touches[1].clientY-offsetTop;var distance2=distance(f1x2,f1y2,f2x2,f2y2);var factor=distance2/distance1;if(factor!=1&&twoFingersStartInside){var df1x=f1x2-f1x1;var df1y=f1y2-f1y1;var df2x=f2x2-f2x1;var df2y=f2y2-f2y1;var tx=(df1x+df2x)/2;var ty=(df1y+df2y)/2;var zoom1=cy.zoom();var zoom2=zoom1*factor;var pan1=cy.pan();var ctrx=modelCenter1[0]*zoom1+pan1.x;var ctry=modelCenter1[1]*zoom1+pan1.y;var pan2={x:-zoom2/zoom1*(ctrx-pan1.x-tx)+ctrx,y:-zoom2/zoom1*(ctry-pan1.y-ty)+ctry};if(r.touchData.start){var draggedEles=r.dragData.touchDragEles;freeDraggedElements(draggedEles);r.redrawHint("drag",true);r.redrawHint("eles",true);r.touchData.start.trigger("free").unactivate()}cy.viewport({zoom:zoom2,pan:pan2,cancelOnFailedZoom:true});distance1=distance2;f1x1=f1x2;f1y1=f1y2;f2x1=f2x2;f2y1=f2y2;r.pinching=true}if(e.touches[0]){var pos=r.projectIntoViewport(e.touches[0].clientX,e.touches[0].clientY);now[0]=pos[0];now[1]=pos[1]}if(e.touches[1]){var pos=r.projectIntoViewport(e.touches[1].clientX,e.touches[1].clientY);now[2]=pos[0];now[3]=pos[1]}if(e.touches[2]){var pos=r.projectIntoViewport(e.touches[2].clientX,e.touches[2].clientY);now[4]=pos[0];now[5]=pos[1]}}else if(e.touches[0]){var start=r.touchData.start;var last=r.touchData.last;var near;if(!r.hoverData.draggingEles&&!r.swipePanning){near=r.findNearestElement(now[0],now[1],true,true)}if(capture&&start!=null){e.preventDefault()}if(capture&&start!=null&&r.nodeIsDraggable(start)){if(isOverThresholdDrag){var draggedEles=r.dragData.touchDragEles;var justStartedDrag=!r.dragData.didDrag;if(justStartedDrag){addNodesToDrag(cy.collection(draggedEles),{inDragLayer:true})}for(var k=0;k<draggedEles.length;k++){var draggedEle=draggedEles[k];if(r.nodeIsDraggable(draggedEle)&&draggedEle.grabbed()){r.dragData.didDrag=true;var dPos=draggedEle._private.position;var updatePos=!draggedEle.isParent();if(updatePos&&is.number(disp[0])&&is.number(disp[1])){dPos.x+=disp[0];dPos.y+=disp[1]}if(justStartedDrag){r.redrawHint("eles",true);var dragDelta=r.touchData.dragDelta;if(updatePos&&dragDelta&&is.number(dragDelta[0])&&is.number(dragDelta[1])){dPos.x+=dragDelta[0];dPos.y+=dragDelta[1]}}}}var tcol=cy.collection(draggedEles);tcol.updateCompoundBounds();tcol.trigger("position drag");r.hoverData.draggingEles=true;r.redrawHint("drag",true);if(r.touchData.startPosition[0]==earlier[0]&&r.touchData.startPosition[1]==earlier[1]){r.redrawHint("eles",true)}r.redraw()}else{var dragDelta=r.touchData.dragDelta=r.touchData.dragDelta||[];if(dragDelta.length===0){dragDelta.push(disp[0]);dragDelta.push(disp[1])}else{dragDelta[0]+=disp[0];dragDelta[1]+=disp[1]}}}{triggerEvents(start||near,["touchmove","tapdrag","vmousemove"],e,{cyPosition:{x:now[0],y:now[1]}});if((!start||!start.grabbed())&&near!=last){if(last){last.trigger(new Event(e,{type:"tapdragout",cyPosition:{x:now[0],y:now[1]}}))}if(near){near.trigger(new Event(e,{type:"tapdragover",cyPosition:{x:now[0],y:now[1]}}))}}r.touchData.last=near}if(capture){for(var i=0;i<now.length;i++){if(now[i]&&r.touchData.startPosition[i]&&isOverThresholdDrag){r.touchData.singleTouchMoved=true}}}if(capture&&(start==null||start.isEdge())&&cy.panningEnabled()&&cy.userPanningEnabled()){var allowPassthrough=allowPanningPassthrough(start,r.touchData.starts);if(allowPassthrough){e.preventDefault();if(r.swipePanning){cy.panBy({x:disp[0]*zoom,y:disp[1]*zoom})}else if(isOverThresholdDrag){r.swipePanning=true;cy.panBy({x:dx*zoom,y:dy*zoom});if(start){start.unactivate();if(!r.data.bgActivePosistion){r.data.bgActivePosistion=math.array2point(r.touchData.startPosition)}r.redrawHint("select",true);r.touchData.start=null}}}var pos=r.projectIntoViewport(e.touches[0].clientX,e.touches[0].clientY);now[0]=pos[0];now[1]=pos[1]}}for(var j=0;j<now.length;j++){earlier[j]=now[j]}},false);var touchcancelHandler;r.registerBinding(window,"touchcancel",touchcancelHandler=function(e){var start=r.touchData.start;r.touchData.capture=false;if(start){start.unactivate()}});var touchendHandler;r.registerBinding(window,"touchend",touchendHandler=function(e){var start=r.touchData.start;var capture=r.touchData.capture;if(capture){r.touchData.capture=false;e.preventDefault()}else{return}var select=r.selection;r.swipePanning=false;r.hoverData.draggingEles=false;var cy=r.cy;var zoom=cy.zoom();var now=r.touchData.now;var earlier=r.touchData.earlier;if(e.touches[0]){var pos=r.projectIntoViewport(e.touches[0].clientX,e.touches[0].clientY);now[0]=pos[0];now[1]=pos[1]}if(e.touches[1]){var pos=r.projectIntoViewport(e.touches[1].clientX,e.touches[1].clientY);now[2]=pos[0];now[3]=pos[1]}if(e.touches[2]){var pos=r.projectIntoViewport(e.touches[2].clientX,e.touches[2].clientY);now[4]=pos[0];now[5]=pos[1]}if(start){start.unactivate()}var ctxTapend;if(r.touchData.cxt){ctxTapend=new Event(e,{type:"cxttapend",cyPosition:{x:now[0],y:now[1]}});if(start){start.trigger(ctxTapend)}else{cy.trigger(ctxTapend)}if(!r.touchData.cxtDragged){var ctxTap=new Event(e,{type:"cxttap",cyPosition:{x:now[0],y:now[1]}});if(start){start.trigger(ctxTap)}else{cy.trigger(ctxTap)}}if(r.touchData.start){r.touchData.start._private.grabbed=false}r.touchData.cxt=false;r.touchData.start=null;r.redraw();return}if(!e.touches[2]&&cy.boxSelectionEnabled()&&r.touchData.selecting){r.touchData.selecting=false;var box=cy.collection(r.getAllInBox(select[0],select[1],select[2],select[3]));select[0]=undefined;select[1]=undefined;select[2]=undefined;select[3]=undefined;select[4]=0;r.redrawHint("select",true);cy.trigger("boxend");var eleWouldBeSelected=function(ele){return ele.selectable()&&!ele.selected()};box.trigger("box").stdFilter(eleWouldBeSelected).select().trigger("boxselect");if(box.nonempty()){r.redrawHint("eles",true)}r.redraw()}if(start!=null){start.unactivate()}if(e.touches[2]){r.data.bgActivePosistion=undefined;r.redrawHint("select",true)}else if(e.touches[1]){}else if(e.touches[0]){}else if(!e.touches[0]){r.data.bgActivePosistion=undefined;r.redrawHint("select",true);var draggedEles=r.dragData.touchDragEles;if(start!=null){var startWasGrabbed=start._private.grabbed;freeDraggedElements(draggedEles);r.redrawHint("drag",true);r.redrawHint("eles",true);if(startWasGrabbed){start.trigger("free")}triggerEvents(start,["touchend","tapend","vmouseup","tapdragout"],e,{cyPosition:{x:now[0],y:now[1]}});start.unactivate();r.touchData.start=null}else{var near=r.findNearestElement(now[0],now[1],true,true);triggerEvents(near,["touchend","tapend","vmouseup","tapdragout"],e,{cyPosition:{x:now[0],y:now[1]}})}var dx=r.touchData.startPosition[0]-now[0];var dx2=dx*dx;var dy=r.touchData.startPosition[1]-now[1];var dy2=dy*dy;var dist2=dx2+dy2;var rdist2=dist2*zoom*zoom;if(start!=null&&!r.dragData.didDrag&&start._private.selectable&&rdist2<r.touchTapThreshold2&&!r.pinching){if(cy.selectionType()==="single"){cy.$(":selected").unmerge(start).unselect();start.select()}else{if(start.selected()){start.unselect()}else{start.select()}}r.redrawHint("eles",true)}if(!r.touchData.singleTouchMoved){triggerEvents(start,["tap","vclick"],e,{cyPosition:{x:now[0],y:now[1]}})}r.touchData.singleTouchMoved=true}for(var j=0;j<now.length;j++){earlier[j]=now[j]}r.dragData.didDrag=false;if(e.touches.length===0){r.touchData.dragDelta=[];r.touchData.startPosition=null;r.touchData.startGPosition=null}if(e.touches.length<2){r.pinching=false;r.redrawHint("eles",true);r.redraw()}},false);if(typeof TouchEvent==="undefined"){var pointers=[];var makeTouch=function(e){return{clientX:e.clientX,clientY:e.clientY,force:1,identifier:e.pointerId,pageX:e.pageX,pageY:e.pageY,radiusX:e.width/2,radiusY:e.height/2,screenX:e.screenX,screenY:e.screenY,target:e.target}};var makePointer=function(e){return{event:e,touch:makeTouch(e)}};var addPointer=function(e){pointers.push(makePointer(e))};var removePointer=function(e){for(var i=0;i<pointers.length;i++){var p=pointers[i];if(p.event.pointerId===e.pointerId){pointers.splice(i,1);return}}};var updatePointer=function(e){var p=pointers.filter(function(p){return p.event.pointerId===e.pointerId})[0];p.event=e;p.touch=makeTouch(e)};var addTouchesToEvent=function(e){e.touches=pointers.map(function(p){return p.touch})};r.registerBinding(r.container,"pointerdown",function(e){if(e.pointerType==="mouse"){return}e.preventDefault();addPointer(e);addTouchesToEvent(e);touchstartHandler(e)});r.registerBinding(r.container,"pointerup",function(e){if(e.pointerType==="mouse"){return}removePointer(e);addTouchesToEvent(e);touchendHandler(e)});r.registerBinding(r.container,"pointercancel",function(e){if(e.pointerType==="mouse"){return}removePointer(e);addTouchesToEvent(e);touchcancelHandler(e)});r.registerBinding(r.container,"pointermove",function(e){if(e.pointerType==="mouse"){return}e.preventDefault();updatePointer(e);addTouchesToEvent(e);touchmoveHandler(e)})}};module.exports=BRp},{"../../../event":79,"../../../is":117,"../../../math":119,"../../../util":134}],96:[function(require,module,exports){"use strict";var math=require("../../../math");var BRp={};BRp.generatePolygon=function(name,points){return this.nodeShapes[name]={renderer:this,name:name,points:points,draw:function(context,centerX,centerY,width,height){this.renderer.nodeShapeImpl("polygon",context,centerX,centerY,width,height,this.points)},intersectLine:function(nodeX,nodeY,width,height,x,y,padding){return math.polygonIntersectLine(x,y,this.points,nodeX,nodeY,width/2,height/2,padding)},checkPoint:function(x,y,padding,width,height,centerX,centerY){return math.pointInsidePolygon(x,y,this.points,centerX,centerY,width,height,[0,-1],padding)}}};BRp.generateEllipse=function(){return this.nodeShapes["ellipse"]={renderer:this,name:"ellipse",draw:function(context,centerX,centerY,width,height){this.renderer.nodeShapeImpl(this.name,context,centerX,centerY,width,height)},intersectLine:function(nodeX,nodeY,width,height,x,y,padding){return math.intersectLineEllipse(x,y,nodeX,nodeY,width/2+padding,height/2+padding)},checkPoint:function(x,y,padding,width,height,centerX,centerY){x-=centerX;y-=centerY;x/=width/2+padding;y/=height/2+padding;return x*x+y*y<=1}}};BRp.generateRoundRectangle=function(){return this.nodeShapes["roundrectangle"]={renderer:this,name:"roundrectangle",points:math.generateUnitNgonPointsFitToSquare(4,0),draw:function(context,centerX,centerY,width,height){this.renderer.nodeShapeImpl(this.name,context,centerX,centerY,width,height)},intersectLine:function(nodeX,nodeY,width,height,x,y,padding){return math.roundRectangleIntersectLine(x,y,nodeX,nodeY,width,height,padding)},checkPoint:function(x,y,padding,width,height,centerX,centerY){var cornerRadius=math.getRoundRectangleRadius(width,height);if(math.pointInsidePolygon(x,y,this.points,centerX,centerY,width,height-2*cornerRadius,[0,-1],padding)){return true}if(math.pointInsidePolygon(x,y,this.points,centerX,centerY,width-2*cornerRadius,height,[0,-1],padding)){return true}var checkInEllipse=function(x,y,centerX,centerY,width,height,padding){x-=centerX;y-=centerY;x/=width/2+padding;y/=height/2+padding;return x*x+y*y<=1};if(checkInEllipse(x,y,centerX-width/2+cornerRadius,centerY-height/2+cornerRadius,cornerRadius*2,cornerRadius*2,padding)){return true}if(checkInEllipse(x,y,centerX+width/2-cornerRadius,centerY-height/2+cornerRadius,cornerRadius*2,cornerRadius*2,padding)){return true}if(checkInEllipse(x,y,centerX+width/2-cornerRadius,centerY+height/2-cornerRadius,cornerRadius*2,cornerRadius*2,padding)){return true}if(checkInEllipse(x,y,centerX-width/2+cornerRadius,centerY+height/2-cornerRadius,cornerRadius*2,cornerRadius*2,padding)){return true}return false}}};BRp.registerNodeShapes=function(){var nodeShapes=this.nodeShapes={};var renderer=this;this.generateEllipse();this.generatePolygon("triangle",math.generateUnitNgonPointsFitToSquare(3,0));this.generatePolygon("rectangle",math.generateUnitNgonPointsFitToSquare(4,0));nodeShapes["square"]=nodeShapes["rectangle"];this.generateRoundRectangle();this.generatePolygon("diamond",[0,1,1,0,0,-1,-1,0]);this.generatePolygon("pentagon",math.generateUnitNgonPointsFitToSquare(5,0));this.generatePolygon("hexagon",math.generateUnitNgonPointsFitToSquare(6,0));this.generatePolygon("heptagon",math.generateUnitNgonPointsFitToSquare(7,0));this.generatePolygon("octagon",math.generateUnitNgonPointsFitToSquare(8,0));var star5Points=new Array(20);{var outerPoints=math.generateUnitNgonPoints(5,0);var innerPoints=math.generateUnitNgonPoints(5,Math.PI/5);var innerRadius=.5*(3-Math.sqrt(5));innerRadius*=1.57;for(var i=0;i<innerPoints.length/2;i++){innerPoints[i*2]*=innerRadius;innerPoints[i*2+1]*=innerRadius}for(var i=0;i<20/4;i++){star5Points[i*4]=outerPoints[i*2];star5Points[i*4+1]=outerPoints[i*2+1];star5Points[i*4+2]=innerPoints[i*2];star5Points[i*4+3]=innerPoints[i*2+1]}}star5Points=math.fitPolygonToSquare(star5Points);this.generatePolygon("star",star5Points);this.generatePolygon("vee",[-1,-1,0,-.333,1,-1,0,1]);this.generatePolygon("rhomboid",[-1,-1,.333,-1,1,1,-.333,1]);nodeShapes.makePolygon=function(points){var key=points.join("$");var name="polygon-"+key;var shape;if(shape=this[name]){return shape}return renderer.generatePolygon(name,points)}};module.exports=BRp},{"../../../math":119}],97:[function(require,module,exports){"use strict";var util=require("../../../util");var BRp={};BRp.timeToRender=function(){return this.redrawTotalTime/this.redrawCount};BRp.redraw=function(options){options=options||util.staticEmptyObject();var r=this;if(r.averageRedrawTime===undefined){r.averageRedrawTime=0}if(r.lastRedrawTime===undefined){r.lastRedrawTime=0}if(r.lastDrawTime===undefined){r.lastDrawTime=0}r.requestedFrame=true;r.renderOptions=options};BRp.beforeRender=function(fn,priority){if(this.destroyed){return}priority=priority||0;var cbs=this.beforeRenderCallbacks;cbs.push({fn:fn,priority:priority});cbs.sort(function(a,b){return b.priority-a.priority})};var beforeRenderCallbacks=function(r,willDraw,startTime){var cbs=r.beforeRenderCallbacks;for(var i=0;i<cbs.length;i++){cbs[i].fn(willDraw,startTime)}};BRp.startRenderLoop=function(){var r=this;if(r.renderLoopStarted){return}else{r.renderLoopStarted=true}var renderFn=function(requestTime){if(r.destroyed){return}if(r.requestedFrame&&!r.skipFrame){beforeRenderCallbacks(r,true,requestTime);var startTime=util.performanceNow();r.render(r.renderOptions);var endTime=r.lastDrawTime=util.performanceNow();if(r.averageRedrawTime===undefined){r.averageRedrawTime=endTime-startTime}if(r.redrawCount===undefined){r.redrawCount=0}r.redrawCount++;if(r.redrawTotalTime===undefined){r.redrawTotalTime=0}var duration=endTime-startTime;r.redrawTotalTime+=duration;r.lastRedrawTime=duration;r.averageRedrawTime=r.averageRedrawTime/2+duration/2;r.requestedFrame=false}else{beforeRenderCallbacks(r,false,requestTime)}r.skipFrame=false;util.requestAnimationFrame(renderFn)};util.requestAnimationFrame(renderFn)};module.exports=BRp},{"../../../util":134}],98:[function(require,module,exports){"use strict";var CRp={};var impl;CRp.arrowShapeImpl=function(name){return(impl||(impl={polygon:function(context,points){for(var i=0;i<points.length;i++){var pt=points[i];context.lineTo(pt.x,pt.y)}},"triangle-backcurve":function(context,points,controlPoint){var firstPt;for(var i=0;i<points.length;i++){var pt=points[i];if(i===0){firstPt=pt}context.lineTo(pt.x,pt.y)}context.quadraticCurveTo(controlPoint.x,controlPoint.y,firstPt.x,firstPt.y)},"triangle-tee":function(context,trianglePoints,teePoints){if(context.beginPath){context.beginPath()}var triPts=trianglePoints;for(var i=0;i<triPts.length;i++){var pt=triPts[i];context.lineTo(pt.x,pt.y)}if(context.closePath){context.closePath()}if(context.beginPath){context.beginPath()}var teePts=teePoints;var firstTeePt=teePoints[0];context.moveTo(firstTeePt.x,firstTeePt.y);for(var i=0;i<teePts.length;i++){var pt=teePts[i];context.lineTo(pt.x,pt.y)}if(context.closePath){context.closePath()}},circle:function(context,rx,ry,r){context.arc(rx,ry,r,0,Math.PI*2,false)}}))[name]};module.exports=CRp},{}],99:[function(require,module,exports){"use strict";var CRp={};CRp.drawEdge=function(context,edge,shiftToOriginWithBb,drawLabel,drawOverlayInstead){var rs=edge._private.rscratch;var usePaths=this.usePaths();if(rs.badLine||isNaN(rs.allpts[0])){return}if(!edge.visible()){return}var bb;if(shiftToOriginWithBb){bb=shiftToOriginWithBb;context.translate(-bb.x1,-bb.y1)}var overlayPadding=edge.pstyle("overlay-padding").pfValue;var overlayOpacity=edge.pstyle("overlay-opacity").value;var overlayColor=edge.pstyle("overlay-color").value;if(drawOverlayInstead){if(overlayOpacity===0){return}this.strokeStyle(context,overlayColor[0],overlayColor[1],overlayColor[2],overlayOpacity);context.lineCap="round";if(rs.edgeType=="self"&&!usePaths){context.lineCap="butt"}}else{var lineColor=edge.pstyle("line-color").value;this.strokeStyle(context,lineColor[0],lineColor[1],lineColor[2],edge.pstyle("opacity").value);context.lineCap="butt"}context.lineJoin="round";var edgeWidth=edge.pstyle("width").pfValue+(drawOverlayInstead?2*overlayPadding:0);var lineStyle=drawOverlayInstead?"solid":edge.pstyle("line-style").value;context.lineWidth=edgeWidth;var shadowBlur=edge.pstyle("shadow-blur").pfValue;var shadowOpacity=edge.pstyle("shadow-opacity").value;var shadowColor=edge.pstyle("shadow-color").value;var shadowOffsetX=edge.pstyle("shadow-offset-x").pfValue;var shadowOffsetY=edge.pstyle("shadow-offset-y").pfValue;this.shadowStyle(context,shadowColor,drawOverlayInstead?0:shadowOpacity,shadowBlur,shadowOffsetX,shadowOffsetY);this.drawEdgePath(edge,context,rs.allpts,lineStyle,edgeWidth);this.drawArrowheads(context,edge,drawOverlayInstead);this.shadowStyle(context,"transparent",0);if(!drawOverlayInstead){this.drawEdge(context,edge,false,drawLabel,true)}this.drawElementText(context,edge,drawLabel);if(shiftToOriginWithBb){context.translate(bb.x1,bb.y1)}};CRp.drawEdgePath=function(edge,context,pts,type,width){var rs=edge._private.rscratch;var canvasCxt=context;var path;var pathCacheHit=false;var usePaths=this.usePaths();if(usePaths){var pathCacheKey=pts.join("$");var keyMatches=rs.pathCacheKey&&rs.pathCacheKey===pathCacheKey;if(keyMatches){path=context=rs.pathCache;pathCacheHit=true}else{path=context=new Path2D;rs.pathCacheKey=pathCacheKey;rs.pathCache=path}}if(canvasCxt.setLineDash){switch(type){case"dotted":canvasCxt.setLineDash([1,1]);break;case"dashed":canvasCxt.setLineDash([6,3]);break;case"solid":canvasCxt.setLineDash([]);break}}if(!pathCacheHit&&!rs.badLine){if(context.beginPath){context.beginPath()}context.moveTo(pts[0],pts[1]);switch(rs.edgeType){case"bezier":case"self":case"compound":case"multibezier":for(var i=2;i+3<pts.length;i+=4){context.quadraticCurveTo(pts[i],pts[i+1],pts[i+2],pts[i+3])}break;case"straight":case"segments":case"haystack":for(var i=2;i+1<pts.length;i+=2){context.lineTo(pts[i],pts[i+1])}break}}context=canvasCxt;if(usePaths){context.stroke(path)}else{context.stroke()}if(context.setLineDash){context.setLineDash([])}};CRp.drawArrowheads=function(context,edge,drawOverlayInstead){if(drawOverlayInstead){return}var rs=edge._private.rscratch;var isHaystack=rs.edgeType==="haystack";if(!isHaystack){this.drawArrowhead(context,edge,"source",rs.arrowStartX,rs.arrowStartY,rs.srcArrowAngle)}this.drawArrowhead(context,edge,"mid-target",rs.midX,rs.midY,rs.midtgtArrowAngle);this.drawArrowhead(context,edge,"mid-source",rs.midX,rs.midY,rs.midsrcArrowAngle);if(!isHaystack){this.drawArrowhead(context,edge,"target",rs.arrowEndX,rs.arrowEndY,rs.tgtArrowAngle)}};CRp.drawArrowhead=function(context,edge,prefix,x,y,angle){if(isNaN(x)||x==null||isNaN(y)||y==null||isNaN(angle)||angle==null){return}var self=this;var arrowShape=edge.pstyle(prefix+"-arrow-shape").value;if(arrowShape==="none"){return}var gco=context.globalCompositeOperation;var arrowClearFill=edge.pstyle(prefix+"-arrow-fill").value==="hollow"?"both":"filled";var arrowFill=edge.pstyle(prefix+"-arrow-fill").value;var opacity=edge.pstyle("opacity").value;if(arrowShape==="half-triangle-overshot"){arrowFill="hollow";arrowClearFill="hollow"}if(opacity!==1||arrowFill==="hollow"){context.globalCompositeOperation="destination-out";self.fillStyle(context,255,255,255,1);self.strokeStyle(context,255,255,255,1);self.drawArrowShape(edge,prefix,context,arrowClearFill,edge.pstyle("width").pfValue,edge.pstyle(prefix+"-arrow-shape").value,x,y,angle);context.globalCompositeOperation=gco}var color=edge.pstyle(prefix+"-arrow-color").value;self.fillStyle(context,color[0],color[1],color[2],opacity);self.strokeStyle(context,color[0],color[1],color[2],opacity);self.drawArrowShape(edge,prefix,context,arrowFill,edge.pstyle("width").pfValue,edge.pstyle(prefix+"-arrow-shape").value,x,y,angle)};CRp.drawArrowShape=function(edge,arrowType,context,fill,edgeWidth,shape,x,y,angle){var r=this;var usePaths=this.usePaths();var rs=edge._private.rscratch;var pathCacheHit=false;var path;var canvasContext=context;var translation={x:x,y:y};var size=this.getArrowWidth(edgeWidth);var shapeImpl=r.arrowShapes[shape];if(usePaths){var pathCacheKey=size+"$"+shape+"$"+angle+"$"+x+"$"+y;rs.arrowPathCacheKey=rs.arrowPathCacheKey||{};rs.arrowPathCache=rs.arrowPathCache||{};var alreadyCached=rs.arrowPathCacheKey[arrowType]===pathCacheKey;if(alreadyCached){path=context=rs.arrowPathCache[arrowType];pathCacheHit=true}else{path=context=new Path2D;rs.arrowPathCacheKey[arrowType]=pathCacheKey;rs.arrowPathCache[arrowType]=path}}if(context.beginPath){context.beginPath()}if(!pathCacheHit){shapeImpl.draw(context,size,angle,translation)}if(!shapeImpl.leavePathOpen&&context.closePath){context.closePath()}context=canvasContext;if(fill==="filled"||fill==="both"){if(usePaths){context.fill(path)}else{context.fill()}}if(fill==="hollow"||fill==="both"){context.lineWidth=shapeImpl.matchEdgeWidth?edgeWidth:1;context.lineJoin="miter";if(usePaths){context.stroke(path)}else{context.stroke()}}};module.exports=CRp},{}],100:[function(require,module,exports){"use strict";var math=require("../../../math");var CRp={};CRp.drawElement=function(context,ele,shiftToOriginWithBb,showLabel){var r=this;if(ele.isNode()){r.drawNode(context,ele,shiftToOriginWithBb,showLabel)}else{r.drawEdge(context,ele,shiftToOriginWithBb,showLabel)}};CRp.drawCachedElement=function(context,ele,pxRatio,extent){var r=this;var bb=ele.boundingBox();if(bb.w===0||bb.h===0){return}if(!extent||math.boundingBoxesIntersect(bb,extent)){var cache=r.data.eleTxrCache.getElement(ele,bb,pxRatio);if(cache){context.drawImage(cache.texture.canvas,cache.x,0,cache.width,cache.height,bb.x1,bb.y1,bb.w,bb.h)}else{r.drawElement(context,ele)}}};CRp.drawElements=function(context,eles){var r=this;for(var i=0;i<eles.length;i++){var ele=eles[i];r.drawElement(context,ele)}};CRp.drawCachedElements=function(context,eles,pxRatio,extent){var r=this;for(var i=0;i<eles.length;i++){var ele=eles[i];r.drawCachedElement(context,ele,pxRatio,extent)}};CRp.drawCachedNodes=function(context,eles,pxRatio,extent){var r=this;for(var i=0;i<eles.length;i++){var ele=eles[i];if(!ele.isNode()){continue}r.drawCachedElement(context,ele,pxRatio,extent)}};CRp.drawLayeredElements=function(context,eles,pxRatio,extent){var r=this;var layers=r.data.lyrTxrCache.getLayers(eles,pxRatio);if(layers){for(var i=0;i<layers.length;i++){var layer=layers[i];var bb=layer.bb;if(bb.w===0||bb.h===0){continue}context.drawImage(layer.canvas,bb.x1,bb.y1,bb.w,bb.h)}}else{r.drawCachedElements(context,eles,pxRatio,extent)}};module.exports=CRp},{"../../../math":119}],101:[function(require,module,exports){"use strict";var CRp={};CRp.safeDrawImage=function(context,img,ix,iy,iw,ih,x,y,w,h){var r=this;try{context.drawImage(img,ix,iy,iw,ih,x,y,w,h)}catch(e){r.redrawHint("eles",true);r.redrawHint("drag",true);r.drawingImage=true;r.redraw()}};CRp.drawInscribedImage=function(context,img,node){var r=this;var nodeX=node._private.position.x;var nodeY=node._private.position.y;var fit=node.pstyle("background-fit").value;var xPos=node.pstyle("background-position-x");var yPos=node.pstyle("background-position-y");var repeat=node.pstyle("background-repeat").value;var nodeW=node.width();var nodeH=node.height();var rs=node._private.rscratch;var clip=node.pstyle("background-clip").value;var shouldClip=clip==="node";var imgOpacity=node.pstyle("background-image-opacity").value;var imgW=img.width||img.cachedW;var imgH=img.height||img.cachedH;if(null==imgW||null==imgH){document.body.appendChild(img);imgW=img.cachedW=img.width||img.offsetWidth;imgH=img.cachedH=img.height||img.offsetHeight;document.body.removeChild(img)}var w=imgW;var h=imgH;var bgW=node.pstyle("background-width");if(bgW.value!=="auto"){if(bgW.units==="%"){w=bgW.value/100*nodeW}else{w=bgW.pfValue}}var bgH=node.pstyle("background-height");if(bgH.value!=="auto"){if(bgH.units==="%"){h=bgH.value/100*nodeH}else{h=bgH.pfValue}}if(w===0||h===0){return}if(fit==="contain"){var scale=Math.min(nodeW/w,nodeH/h);w*=scale;h*=scale}else if(fit==="cover"){var scale=Math.max(nodeW/w,nodeH/h);w*=scale;h*=scale}var x=nodeX-nodeW/2;if(xPos.units==="%"){x+=(nodeW-w)*xPos.value/100}else{x+=xPos.pfValue}var y=nodeY-nodeH/2;if(yPos.units==="%"){y+=(nodeH-h)*yPos.value/100}else{y+=yPos.pfValue}if(rs.pathCache){x-=nodeX;y-=nodeY;nodeX=0;nodeY=0}var gAlpha=context.globalAlpha;context.globalAlpha=imgOpacity;if(repeat==="no-repeat"){if(shouldClip){context.save();if(rs.pathCache){context.clip(rs.pathCache)}else{r.nodeShapes[r.getNodeShape(node)].draw(context,nodeX,nodeY,nodeW,nodeH);context.clip()}}r.safeDrawImage(context,img,0,0,imgW,imgH,x,y,w,h);if(shouldClip){context.restore()}}else{var pattern=context.createPattern(img,repeat);context.fillStyle=pattern;r.nodeShapes[r.getNodeShape(node)].draw(context,nodeX,nodeY,nodeW,nodeH);context.translate(x,y);context.fill();context.translate(-x,-y)}context.globalAlpha=gAlpha};module.exports=CRp},{}],102:[function(require,module,exports){"use strict";var util=require("../../../util");var math=require("../../../math");var CRp={};CRp.eleTextBiggerThanMin=function(ele,scale){if(!scale){var zoom=ele.cy().zoom();var pxRatio=this.getPixelRatio();var lvl=Math.ceil(math.log2(zoom*pxRatio));scale=Math.pow(2,lvl)}var computedSize=ele.pstyle("font-size").pfValue*scale;var minSize=ele.pstyle("min-zoomed-font-size").pfValue;if(computedSize<minSize){return false}return true};CRp.drawElementText=function(context,ele,force){var r=this;if(force===undefined){if(!r.eleTextBiggerThanMin(ele)){return}}else{if(!force){return}}if(ele.isNode()){var label=ele.pstyle("label");if(!label||!label.value){return}var textHalign=ele.pstyle("text-halign").strValue;var textValign=ele.pstyle("text-valign").strValue;switch(textHalign){case"left":context.textAlign="right";break;case"right":context.textAlign="left";break;default:context.textAlign="center"}context.textBaseline="bottom"}else{var label=ele.pstyle("label");var srcLabel=ele.pstyle("source-label");var tgtLabel=ele.pstyle("target-label");if((!label||!label.value)&&(!srcLabel||!srcLabel.value)&&(!tgtLabel||!tgtLabel.value)){return}context.textAlign="center";context.textBaseline="bottom"}r.drawText(context,ele);if(ele.isEdge()){r.drawText(context,ele,"source");r.drawText(context,ele,"target")}};CRp.drawNodeText=CRp.drawEdgeText=CRp.drawElementText;CRp.getFontCache=function(context){var cache;this.fontCaches=this.fontCaches||[];for(var i=0;i<this.fontCaches.length;i++){cache=this.fontCaches[i];if(cache.context===context){return cache}}cache={context:context};this.fontCaches.push(cache);return cache};CRp.setupTextStyle=function(context,ele){var parentOpacity=ele.effectiveOpacity();var labelStyle=ele.pstyle("font-style").strValue;var labelSize=ele.pstyle("font-size").pfValue+"px";var labelFamily=ele.pstyle("font-family").strValue;var labelWeight=ele.pstyle("font-weight").strValue;var opacity=ele.pstyle("text-opacity").value*ele.pstyle("opacity").value*parentOpacity;var outlineOpacity=ele.pstyle("text-outline-opacity").value*opacity;var color=ele.pstyle("color").value;var outlineColor=ele.pstyle("text-outline-color").value;var shadowBlur=ele.pstyle("text-shadow-blur").pfValue;var shadowOpacity=ele.pstyle("text-shadow-opacity").value;var shadowColor=ele.pstyle("text-shadow-color").value;var shadowOffsetX=ele.pstyle("text-shadow-offset-x").pfValue;var shadowOffsetY=ele.pstyle("text-shadow-offset-y").pfValue;var fontCacheKey=ele._private.fontKey;var cache=this.getFontCache(context);if(cache.key!==fontCacheKey){context.font=labelStyle+" "+labelWeight+" "+labelSize+" "+labelFamily;cache.key=fontCacheKey}context.lineJoin="round";this.fillStyle(context,color[0],color[1],color[2],opacity);this.strokeStyle(context,outlineColor[0],outlineColor[1],outlineColor[2],outlineOpacity);this.shadowStyle(context,shadowColor,shadowOpacity,shadowBlur,shadowOffsetX,shadowOffsetY)};function roundRect(ctx,x,y,width,height,radius){var radius=radius||5;ctx.beginPath();ctx.moveTo(x+radius,y);ctx.lineTo(x+width-radius,y);ctx.quadraticCurveTo(x+width,y,x+width,y+radius);ctx.lineTo(x+width,y+height-radius);ctx.quadraticCurveTo(x+width,y+height,x+width-radius,y+height);ctx.lineTo(x+radius,y+height);ctx.quadraticCurveTo(x,y+height,x,y+height-radius);ctx.lineTo(x,y+radius);ctx.quadraticCurveTo(x,y,x+radius,y);ctx.closePath();ctx.fill()}CRp.drawText=function(context,ele,prefix){var _p=ele._private;var rscratch=_p.rscratch;var parentOpacity=ele.effectiveOpacity();if(parentOpacity===0||ele.pstyle("text-opacity").value===0){return}var textX=util.getPrefixedProperty(rscratch,"labelX",prefix);var textY=util.getPrefixedProperty(rscratch,"labelY",prefix);var text=this.getLabelText(ele,prefix);if(text!=null&&text!==""&&!isNaN(textX)&&!isNaN(textY)){this.setupTextStyle(context,ele);var pdash=prefix?prefix+"-":"";var textW=util.getPrefixedProperty(rscratch,"labelWidth",prefix);var textH=util.getPrefixedProperty(rscratch,"labelHeight",prefix);var textAngle=util.getPrefixedProperty(rscratch,"labelAngle",prefix);var marginX=ele.pstyle(pdash+"text-margin-x").pfValue;var marginY=ele.pstyle(pdash+"text-margin-y").pfValue;var isEdge=ele.isEdge();var isNode=ele.isNode();var halign=ele.pstyle("text-halign").value;var valign=ele.pstyle("text-valign").value;if(isEdge){halign="center";valign="center"}textX+=marginX;textY+=marginY;var rotation=ele.pstyle("text-rotation");var theta;if(rotation.strValue==="autorotate"){theta=isEdge?textAngle:0}else if(rotation.strValue==="none"){theta=0}else{theta=rotation.pfValue}if(theta!==0){var orgTextX=textX;var orgTextY=textY;context.translate(orgTextX,orgTextY);context.rotate(theta);textX=0;textY=0}if(isNode){var pLeft=ele.pstyle("padding-left").pfValue;var pRight=ele.pstyle("padding-right").pfValue;var pTop=ele.pstyle("padding-top").pfValue;var pBottom=ele.pstyle("padding-bottom").pfValue;textX+=pLeft/2;textX-=pRight/2;textY+=pTop/2;textY-=pBottom/2}switch(valign){case"top":break;case"center":textY+=textH/2;break;case"bottom":textY+=textH;break}var backgroundOpacity=ele.pstyle("text-background-opacity").value;var borderOpacity=ele.pstyle("text-border-opacity").value;var textBorderWidth=ele.pstyle("text-border-width").pfValue;if(backgroundOpacity>0||textBorderWidth>0&&borderOpacity>0){var bgX=textX;switch(halign){case"left":bgX-=textW;break;case"center":bgX-=textW/2;break;case"right":break}var bgY=textY-textH;if(backgroundOpacity>0){var textFill=context.fillStyle;var textBackgroundColor=ele.pstyle("text-background-color").value;context.fillStyle="rgba("+textBackgroundColor[0]+","+textBackgroundColor[1]+","+textBackgroundColor[2]+","+backgroundOpacity*parentOpacity+")";var styleShape=ele.pstyle("text-background-shape").strValue;if(styleShape=="roundrectangle"){roundRect(context,bgX,bgY,textW,textH,2)}else{context.fillRect(bgX,bgY,textW,textH)}context.fillStyle=textFill}if(textBorderWidth>0&&borderOpacity>0){var textStroke=context.strokeStyle;var textLineWidth=context.lineWidth;var textBorderColor=ele.pstyle("text-border-color").value;var textBorderStyle=ele.pstyle("text-border-style").value;context.strokeStyle="rgba("+textBorderColor[0]+","+textBorderColor[1]+","+textBorderColor[2]+","+borderOpacity*parentOpacity+")";context.lineWidth=textBorderWidth;if(context.setLineDash){switch(textBorderStyle){case"dotted":context.setLineDash([1,1]);break;case"dashed":context.setLineDash([4,2]);break;case"double":context.lineWidth=textBorderWidth/4;context.setLineDash([]);break;case"solid":context.setLineDash([]);break}}context.strokeRect(bgX,bgY,textW,textH);if(textBorderStyle==="double"){var whiteWidth=textBorderWidth/2;context.strokeRect(bgX+whiteWidth,bgY+whiteWidth,textW-whiteWidth*2,textH-whiteWidth*2)}if(context.setLineDash){context.setLineDash([])}context.lineWidth=textLineWidth;context.strokeStyle=textStroke}}var lineWidth=2*ele.pstyle("text-outline-width").pfValue;if(lineWidth>0){context.lineWidth=lineWidth}if(ele.pstyle("text-wrap").value==="wrap"){var lines=rscratch.labelWrapCachedLines;var lineHeight=textH/lines.length;switch(valign){case"top":textY-=(lines.length-1)*lineHeight;break;case"center":case"bottom":textY-=(lines.length-1)*lineHeight;break}for(var l=0;l<lines.length;l++){if(lineWidth>0){context.strokeText(lines[l],textX,textY)}context.fillText(lines[l],textX,textY);textY+=lineHeight}}else{if(lineWidth>0){context.strokeText(text,textX,textY)}context.fillText(text,textX,textY)}if(theta!==0){context.rotate(-theta);context.translate(-orgTextX,-orgTextY)}this.shadowStyle(context,"transparent",0)}};module.exports=CRp},{"../../../math":119,"../../../util":134}],103:[function(require,module,exports){"use strict";var is=require("../../../is");var CRp={};CRp.drawNode=function(context,node,shiftToOriginWithBb,drawLabel){var r=this;var nodeWidth,nodeHeight;var rs=node._private.rscratch;var _p=node._private;var pos=pos||_p.position;if(!is.number(pos.x)||!is.number(pos.y)){return}if(!node.visible()){return}var parentOpacity=node.effectiveOpacity();var usePaths=this.usePaths();var path;var pathCacheHit=false;nodeWidth=node.width()+node.pstyle("padding-left").pfValue+node.pstyle("padding-right").pfValue;nodeHeight=node.height()+node.pstyle("padding-top").pfValue+node.pstyle("padding-bottom").pfValue;context.lineWidth=node.pstyle("border-width").pfValue;var bb;if(shiftToOriginWithBb){bb=shiftToOriginWithBb;context.translate(-bb.x1,-bb.y1)}var bgImgProp=node.pstyle("background-image");var url=bgImgProp.value[2]||bgImgProp.value[1];var image;if(url!==undefined){image=this.getCachedImage(url,function(){node.trigger("background");r.redrawHint("eles",true);r.redrawHint("drag",true);r.drawingImage=true;r.redraw()});var prevBging=_p.backgrounding;_p.backgrounding=!image.complete;if(prevBging!==_p.backgrounding){node.updateStyle(false)}}var bgColor=node.pstyle("background-color").value;var borderColor=node.pstyle("border-color").value;var borderStyle=node.pstyle("border-style").value;this.fillStyle(context,bgColor[0],bgColor[1],bgColor[2],node.pstyle("background-opacity").value*parentOpacity);this.strokeStyle(context,borderColor[0],borderColor[1],borderColor[2],node.pstyle("border-opacity").value*parentOpacity);var shadowBlur=node.pstyle("shadow-blur").pfValue;var shadowOpacity=node.pstyle("shadow-opacity").value;var shadowColor=node.pstyle("shadow-color").value;var shadowOffsetX=node.pstyle("shadow-offset-x").pfValue;var shadowOffsetY=node.pstyle("shadow-offset-y").pfValue;this.shadowStyle(context,shadowColor,shadowOpacity,shadowBlur,shadowOffsetX,shadowOffsetY);context.lineJoin="miter";if(context.setLineDash){switch(borderStyle){case"dotted":context.setLineDash([1,1]);break;case"dashed":context.setLineDash([4,2]);break;case"solid":case"double":context.setLineDash([]);break}}var styleShape=node.pstyle("shape").strValue;var shapePts=node.pstyle("shape-polygon-points").pfValue;if(usePaths){var pathCacheKey=styleShape+"$"+nodeWidth+"$"+nodeHeight+(styleShape==="polygon"?"$"+shapePts.join("$"):"");context.translate(pos.x,pos.y);if(rs.pathCacheKey===pathCacheKey){path=rs.pathCache;pathCacheHit=true}else{path=new Path2D;rs.pathCacheKey=pathCacheKey;rs.pathCache=path}}if(!pathCacheHit){var npos=pos;if(usePaths){npos={x:0,y:0}}r.nodeShapes[this.getNodeShape(node)].draw(path||context,npos.x,npos.y,nodeWidth,nodeHeight)}if(usePaths){context.fill(path)}else{context.fill()}this.shadowStyle(context,"transparent",0);if(url!==undefined){if(image.complete){this.drawInscribedImage(context,image,node)}}var darkness=node.pstyle("background-blacken").value;var borderWidth=node.pstyle("border-width").pfValue;if(this.hasPie(node)){this.drawPie(context,node,parentOpacity);if(darkness!==0||borderWidth!==0){if(!usePaths){r.nodeShapes[this.getNodeShape(node)].draw(context,pos.x,pos.y,nodeWidth,nodeHeight)}}}if(darkness>0){this.fillStyle(context,0,0,0,darkness);if(usePaths){context.fill(path)}else{context.fill()}}else if(darkness<0){this.fillStyle(context,255,255,255,-darkness);if(usePaths){context.fill(path)}else{context.fill()}}if(borderWidth>0){if(usePaths){context.stroke(path)}else{context.stroke()}if(borderStyle==="double"){context.lineWidth=node.pstyle("border-width").pfValue/3;var gco=context.globalCompositeOperation;context.globalCompositeOperation="destination-out";if(usePaths){context.stroke(path)}else{context.stroke()}context.globalCompositeOperation=gco}}if(usePaths){context.translate(-pos.x,-pos.y)}if(context.setLineDash){context.setLineDash([])}r.drawElementText(context,node,drawLabel);var overlayPadding=node.pstyle("overlay-padding").pfValue;var overlayOpacity=node.pstyle("overlay-opacity").value;var overlayColor=node.pstyle("overlay-color").value;if(overlayOpacity>0){this.fillStyle(context,overlayColor[0],overlayColor[1],overlayColor[2],overlayOpacity);r.nodeShapes["roundrectangle"].draw(context,node._private.position.x,node._private.position.y,nodeWidth+overlayPadding*2,nodeHeight+overlayPadding*2);context.fill()}if(shiftToOriginWithBb){context.translate(bb.x1,bb.y1)}};CRp.hasPie=function(node){node=node[0];return node._private.hasPie};CRp.drawPie=function(context,node,nodeOpacity,pos){node=node[0];var _p=node._private;var cyStyle=node.cy().style();var pieSize=node.pstyle("pie-size");var nodeW=node.width();var nodeH=node.height();var pos=pos||_p.position;var x=pos.x;var y=pos.y;var radius=Math.min(nodeW,nodeH)/2;var lastPercent=0;var usePaths=this.usePaths();if(usePaths){x=0;y=0}if(pieSize.units==="%"){radius=radius*pieSize.value/100}else if(pieSize.pfValue!==undefined){radius=pieSize.pfValue/2}for(var i=1;i<=cyStyle.pieBackgroundN;i++){var size=node.pstyle("pie-"+i+"-background-size").value;var color=node.pstyle("pie-"+i+"-background-color").value;var opacity=node.pstyle("pie-"+i+"-background-opacity").value*nodeOpacity;var percent=size/100;if(percent+lastPercent>1){percent=1-lastPercent}var angleStart=1.5*Math.PI+2*Math.PI*lastPercent;var angleDelta=2*Math.PI*percent;var angleEnd=angleStart+angleDelta;if(size===0||lastPercent>=1||lastPercent+percent>1){continue}context.beginPath();context.moveTo(x,y);context.arc(x,y,radius,angleStart,angleEnd);context.closePath();this.fillStyle(context,color[0],color[1],color[2],opacity);context.fill();lastPercent+=percent}};module.exports=CRp},{"../../../is":117}],104:[function(require,module,exports){"use strict";var CRp={};var util=require("../../../util");var motionBlurDelay=100;CRp.getPixelRatio=function(){var context=this.data.contexts[0];if(this.forcedPixelRatio!=null){return this.forcedPixelRatio}var backingStore=context.backingStorePixelRatio||context.webkitBackingStorePixelRatio||context.mozBackingStorePixelRatio||context.msBackingStorePixelRatio||context.oBackingStorePixelRatio||context.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/backingStore};CRp.paintCache=function(context){var caches=this.paintCaches=this.paintCaches||[];var needToCreateCache=true;var cache;for(var i=0;i<caches.length;i++){cache=caches[i];if(cache.context===context){needToCreateCache=false;break}}if(needToCreateCache){cache={context:context};caches.push(cache)}return cache};CRp.fillStyle=function(context,r,g,b,a){context.fillStyle="rgba("+r+","+g+","+b+","+a+")"};CRp.strokeStyle=function(context,r,g,b,a){context.strokeStyle="rgba("+r+","+g+","+b+","+a+")"};CRp.shadowStyle=function(context,color,opacity,blur,offsetX,offsetY){var zoom=this.cy.zoom();if(opacity>0){context.shadowBlur=blur*zoom;context.shadowColor="rgba("+color[0]+","+color[1]+","+color[2]+","+opacity+")";context.shadowOffsetX=offsetX*zoom;context.shadowOffsetY=offsetY*zoom}else{context.shadowBlur=0;context.shadowColor="transparent";context.shadowOffsetX=0;context.shadowOffsetY=0}};CRp.matchCanvasSize=function(container){var r=this;var data=r.data;var width=container.clientWidth;var height=container.clientHeight;var pixelRatio=r.getPixelRatio();var mbPxRatio=r.motionBlurPxRatio;if(container===r.data.bufferCanvases[r.MOTIONBLUR_BUFFER_NODE]||container===r.data.bufferCanvases[r.MOTIONBLUR_BUFFER_DRAG]){pixelRatio=mbPxRatio}var canvasWidth=width*pixelRatio;var canvasHeight=height*pixelRatio;var canvas;if(canvasWidth===r.canvasWidth&&canvasHeight===r.canvasHeight){return}r.fontCaches=null;var canvasContainer=data.canvasContainer;canvasContainer.style.width=width+"px";canvasContainer.style.height=height+"px";for(var i=0;i<r.CANVAS_LAYERS;i++){canvas=data.canvases[i];if(canvas.width!==canvasWidth||canvas.height!==canvasHeight){canvas.width=canvasWidth;canvas.height=canvasHeight;canvas.style.width=width+"px";canvas.style.height=height+"px"}}for(var i=0;i<r.BUFFER_COUNT;i++){canvas=data.bufferCanvases[i];if(canvas.width!==canvasWidth||canvas.height!==canvasHeight){canvas.width=canvasWidth;canvas.height=canvasHeight;canvas.style.width=width+"px";canvas.style.height=height+"px"}}r.textureMult=1;if(pixelRatio<=1){canvas=data.bufferCanvases[r.TEXTURE_BUFFER];r.textureMult=2;canvas.width=canvasWidth*r.textureMult;canvas.height=canvasHeight*r.textureMult}r.canvasWidth=canvasWidth;r.canvasHeight=canvasHeight};CRp.renderTo=function(cxt,zoom,pan,pxRatio){this.render({forcedContext:cxt,forcedZoom:zoom,forcedPan:pan,drawAllLayers:true,forcedPxRatio:pxRatio})};CRp.render=function(options){options=options||util.staticEmptyObject();var forcedContext=options.forcedContext;var drawAllLayers=options.drawAllLayers;var drawOnlyNodeLayer=options.drawOnlyNodeLayer;var forcedZoom=options.forcedZoom;var forcedPan=options.forcedPan;var r=this;var pixelRatio=options.forcedPxRatio===undefined?this.getPixelRatio():options.forcedPxRatio;var cy=r.cy;var data=r.data;var needDraw=data.canvasNeedsRedraw;var textureDraw=r.textureOnViewport&&!forcedContext&&(r.pinching||r.hoverData.dragging||r.swipePanning||r.data.wheelZooming);var motionBlur=options.motionBlur!==undefined?options.motionBlur:r.motionBlur;var mbPxRatio=r.motionBlurPxRatio;var hasCompoundNodes=cy.hasCompoundNodes();var inNodeDragGesture=r.hoverData.draggingEles;var inBoxSelection=r.hoverData.selecting||r.touchData.selecting?true:false;motionBlur=motionBlur&&!forcedContext&&r.motionBlurEnabled&&!inBoxSelection;var motionBlurFadeEffect=motionBlur;if(!forcedContext){if(r.prevPxRatio!==pixelRatio){r.invalidateContainerClientCoordsCache();r.matchCanvasSize(r.container);r.redrawHint("eles",true);r.redrawHint("drag",true)}r.prevPxRatio=pixelRatio}if(!forcedContext&&r.motionBlurTimeout){clearTimeout(r.motionBlurTimeout)}if(motionBlur){if(r.mbFrames==null){r.mbFrames=0}if(!r.drawingImage){r.mbFrames++}if(r.mbFrames<3){motionBlurFadeEffect=false}if(r.mbFrames>r.minMbLowQualFrames){r.motionBlurPxRatio=r.mbPxRBlurry}}if(r.clearingMotionBlur){r.motionBlurPxRatio=1}if(r.textureDrawLastFrame&&!textureDraw){needDraw[r.NODE]=true;needDraw[r.SELECT_BOX]=true}var coreStyle=cy.style()._private.coreStyle;var zoom=cy.zoom();var effectiveZoom=forcedZoom!==undefined?forcedZoom:zoom;var pan=cy.pan();var effectivePan={x:pan.x,y:pan.y};var vp={zoom:zoom,pan:{x:pan.x,y:pan.y}};var prevVp=r.prevViewport;var viewportIsDiff=prevVp===undefined||vp.zoom!==prevVp.zoom||vp.pan.x!==prevVp.pan.x||vp.pan.y!==prevVp.pan.y;if(!viewportIsDiff&&!(inNodeDragGesture&&!hasCompoundNodes)){r.motionBlurPxRatio=1}if(forcedPan){effectivePan=forcedPan}effectiveZoom*=pixelRatio;effectivePan.x*=pixelRatio;effectivePan.y*=pixelRatio;var eles=r.getCachedZSortedEles();function mbclear(context,x,y,w,h){var gco=context.globalCompositeOperation;context.globalCompositeOperation="destination-out";r.fillStyle(context,255,255,255,r.motionBlurTransparency);context.fillRect(x,y,w,h);context.globalCompositeOperation=gco}function setContextTransform(context,clear){var ePan,eZoom,w,h;if(!r.clearingMotionBlur&&(context===data.bufferContexts[r.MOTIONBLUR_BUFFER_NODE]||context===data.bufferContexts[r.MOTIONBLUR_BUFFER_DRAG])){ePan={x:pan.x*mbPxRatio,y:pan.y*mbPxRatio};eZoom=zoom*mbPxRatio;w=r.canvasWidth*mbPxRatio;h=r.canvasHeight*mbPxRatio}else{ePan=effectivePan;eZoom=effectiveZoom;w=r.canvasWidth;h=r.canvasHeight}context.setTransform(1,0,0,1,0,0);if(clear==="motionBlur"){mbclear(context,0,0,w,h)}else if(!forcedContext&&(clear===undefined||clear)){context.clearRect(0,0,w,h)}if(!drawAllLayers){context.translate(ePan.x,ePan.y);context.scale(eZoom,eZoom)}if(forcedPan){context.translate(forcedPan.x,forcedPan.y)}if(forcedZoom){context.scale(forcedZoom,forcedZoom)}}if(!textureDraw){r.textureDrawLastFrame=false}if(textureDraw){r.textureDrawLastFrame=true;var bb;if(!r.textureCache){r.textureCache={};bb=r.textureCache.bb=cy.mutableElements().boundingBox();r.textureCache.texture=r.data.bufferCanvases[r.TEXTURE_BUFFER];var cxt=r.data.bufferContexts[r.TEXTURE_BUFFER];cxt.setTransform(1,0,0,1,0,0);cxt.clearRect(0,0,r.canvasWidth*r.textureMult,r.canvasHeight*r.textureMult);r.render({forcedContext:cxt,drawOnlyNodeLayer:true,forcedPxRatio:pixelRatio*r.textureMult});var vp=r.textureCache.viewport={zoom:cy.zoom(),pan:cy.pan(),width:r.canvasWidth,height:r.canvasHeight};vp.mpan={x:(0-vp.pan.x)/vp.zoom,y:(0-vp.pan.y)/vp.zoom}}needDraw[r.DRAG]=false;needDraw[r.NODE]=false;var context=data.contexts[r.NODE];var texture=r.textureCache.texture;var vp=r.textureCache.viewport;bb=r.textureCache.bb;context.setTransform(1,0,0,1,0,0);if(motionBlur){mbclear(context,0,0,vp.width,vp.height)}else{context.clearRect(0,0,vp.width,vp.height)}var outsideBgColor=coreStyle["outside-texture-bg-color"].value;var outsideBgOpacity=coreStyle["outside-texture-bg-opacity"].value;r.fillStyle(context,outsideBgColor[0],outsideBgColor[1],outsideBgColor[2],outsideBgOpacity);context.fillRect(0,0,vp.width,vp.height);var zoom=cy.zoom();setContextTransform(context,false);context.clearRect(vp.mpan.x,vp.mpan.y,vp.width/vp.zoom/pixelRatio,vp.height/vp.zoom/pixelRatio);context.drawImage(texture,vp.mpan.x,vp.mpan.y,vp.width/vp.zoom/pixelRatio,vp.height/vp.zoom/pixelRatio)}else if(r.textureOnViewport&&!forcedContext){r.textureCache=null}var extent=cy.extent();var vpManip=r.pinching||r.hoverData.dragging||r.swipePanning||r.data.wheelZooming||r.hoverData.draggingEles;var hideEdges=r.hideEdgesOnViewport&&vpManip;var needMbClear=[];needMbClear[r.NODE]=!needDraw[r.NODE]&&motionBlur&&!r.clearedForMotionBlur[r.NODE]||r.clearingMotionBlur;if(needMbClear[r.NODE]){r.clearedForMotionBlur[r.NODE]=true}needMbClear[r.DRAG]=!needDraw[r.DRAG]&&motionBlur&&!r.clearedForMotionBlur[r.DRAG]||r.clearingMotionBlur;if(needMbClear[r.DRAG]){r.clearedForMotionBlur[r.DRAG]=true}if(needDraw[r.NODE]||drawAllLayers||drawOnlyNodeLayer||needMbClear[r.NODE]){var useBuffer=motionBlur&&!needMbClear[r.NODE]&&mbPxRatio!==1;var context=forcedContext||(useBuffer?r.data.bufferContexts[r.MOTIONBLUR_BUFFER_NODE]:data.contexts[r.NODE]);var clear=motionBlur&&!useBuffer?"motionBlur":undefined;setContextTransform(context,clear);if(hideEdges){r.drawCachedNodes(context,eles.nondrag,pixelRatio,extent)}else{r.drawLayeredElements(context,eles.nondrag,pixelRatio,extent)}if(!drawAllLayers&&!motionBlur){needDraw[r.NODE]=false}}if(!drawOnlyNodeLayer&&(needDraw[r.DRAG]||drawAllLayers||needMbClear[r.DRAG])){var useBuffer=motionBlur&&!needMbClear[r.DRAG]&&mbPxRatio!==1;var context=forcedContext||(useBuffer?r.data.bufferContexts[r.MOTIONBLUR_BUFFER_DRAG]:data.contexts[r.DRAG]);setContextTransform(context,motionBlur&&!useBuffer?"motionBlur":undefined);if(hideEdges){r.drawCachedNodes(context,eles.drag,pixelRatio,extent)}else{r.drawCachedElements(context,eles.drag,pixelRatio,extent)}if(!drawAllLayers&&!motionBlur){needDraw[r.DRAG]=false}}if(r.showFps||!drawOnlyNodeLayer&&(needDraw[r.SELECT_BOX]&&!drawAllLayers)){var context=forcedContext||data.contexts[r.SELECT_BOX];setContextTransform(context);if(r.selection[4]==1&&(r.hoverData.selecting||r.touchData.selecting)){var zoom=r.cy.zoom();var borderWidth=coreStyle["selection-box-border-width"].value/zoom;context.lineWidth=borderWidth;context.fillStyle="rgba("+coreStyle["selection-box-color"].value[0]+","+coreStyle["selection-box-color"].value[1]+","+coreStyle["selection-box-color"].value[2]+","+coreStyle["selection-box-opacity"].value+")";context.fillRect(r.selection[0],r.selection[1],r.selection[2]-r.selection[0],r.selection[3]-r.selection[1]);if(borderWidth>0){context.strokeStyle="rgba("+coreStyle["selection-box-border-color"].value[0]+","+coreStyle["selection-box-border-color"].value[1]+","+coreStyle["selection-box-border-color"].value[2]+","+coreStyle["selection-box-opacity"].value+")";context.strokeRect(r.selection[0],r.selection[1],r.selection[2]-r.selection[0],r.selection[3]-r.selection[1])}}if(data.bgActivePosistion&&!r.hoverData.selecting){var zoom=r.cy.zoom();var pos=data.bgActivePosistion;context.fillStyle="rgba("+coreStyle["active-bg-color"].value[0]+","+coreStyle["active-bg-color"].value[1]+","+coreStyle["active-bg-color"].value[2]+","+coreStyle["active-bg-opacity"].value+")";context.beginPath();context.arc(pos.x,pos.y,coreStyle["active-bg-size"].pfValue/zoom,0,2*Math.PI);context.fill()}var timeToRender=r.lastRedrawTime;if(r.showFps&&timeToRender){timeToRender=Math.round(timeToRender);var fps=Math.round(1e3/timeToRender);context.setTransform(1,0,0,1,0,0);context.fillStyle="rgba(255, 0, 0, 0.75)";context.strokeStyle="rgba(255, 0, 0, 0.75)";context.lineWidth=1;context.fillText("1 frame = "+timeToRender+" ms = "+fps+" fps",0,20);var maxFps=60;context.strokeRect(0,30,250,20);context.fillRect(0,30,250*Math.min(fps/maxFps,1),20)}if(!drawAllLayers){needDraw[r.SELECT_BOX]=false}}if(motionBlur&&mbPxRatio!==1){var cxtNode=data.contexts[r.NODE];var txtNode=r.data.bufferCanvases[r.MOTIONBLUR_BUFFER_NODE];var cxtDrag=data.contexts[r.DRAG];var txtDrag=r.data.bufferCanvases[r.MOTIONBLUR_BUFFER_DRAG];var drawMotionBlur=function(cxt,txt,needClear){cxt.setTransform(1,0,0,1,0,0);if(needClear||!motionBlurFadeEffect){cxt.clearRect(0,0,r.canvasWidth,r.canvasHeight)}else{mbclear(cxt,0,0,r.canvasWidth,r.canvasHeight)}var pxr=mbPxRatio;cxt.drawImage(txt,0,0,r.canvasWidth*pxr,r.canvasHeight*pxr,0,0,r.canvasWidth,r.canvasHeight)};if(needDraw[r.NODE]||needMbClear[r.NODE]){drawMotionBlur(cxtNode,txtNode,needMbClear[r.NODE]);needDraw[r.NODE]=false}if(needDraw[r.DRAG]||needMbClear[r.DRAG]){drawMotionBlur(cxtDrag,txtDrag,needMbClear[r.DRAG]);needDraw[r.DRAG]=false}}r.prevViewport=vp;if(r.clearingMotionBlur){r.clearingMotionBlur=false;r.motionBlurCleared=true;r.motionBlur=true}if(motionBlur){r.motionBlurTimeout=setTimeout(function(){r.motionBlurTimeout=null;r.clearedForMotionBlur[r.NODE]=false;r.clearedForMotionBlur[r.DRAG]=false;r.motionBlur=false;r.clearingMotionBlur=!textureDraw;r.mbFrames=0;needDraw[r.NODE]=true;needDraw[r.DRAG]=true;r.redraw()},motionBlurDelay)}r.drawingImage=false;if(!forcedContext&&!r.initrender){r.initrender=true;cy.trigger("initrender")}if(!forcedContext){cy.trigger("render")}};module.exports=CRp},{"../../../util":134}],105:[function(require,module,exports){"use strict";var math=require("../../../math");var CRp={};CRp.drawPolygonPath=function(context,x,y,width,height,points){var halfW=width/2;var halfH=height/2;if(context.beginPath){context.beginPath()}context.moveTo(x+halfW*points[0],y+halfH*points[1]);for(var i=1;i<points.length/2;i++){context.lineTo(x+halfW*points[i*2],y+halfH*points[i*2+1])}context.closePath()};CRp.drawRoundRectanglePath=function(context,x,y,width,height){var halfWidth=width/2;var halfHeight=height/2;var cornerRadius=math.getRoundRectangleRadius(width,height);if(context.beginPath){context.beginPath()}context.moveTo(x,y-halfHeight);context.arcTo(x+halfWidth,y-halfHeight,x+halfWidth,y,cornerRadius);context.arcTo(x+halfWidth,y+halfHeight,x,y+halfHeight,cornerRadius);context.arcTo(x-halfWidth,y+halfHeight,x-halfWidth,y,cornerRadius);context.arcTo(x-halfWidth,y-halfHeight,x,y-halfHeight,cornerRadius);context.lineTo(x,y-halfHeight);context.closePath()};var sin0=Math.sin(0);var cos0=Math.cos(0);var sin={};var cos={};var ellipseStepSize=Math.PI/40;for(var i=0*Math.PI;i<2*Math.PI;i+=ellipseStepSize){sin[i]=Math.sin(i);cos[i]=Math.cos(i)}CRp.drawEllipsePath=function(context,centerX,centerY,width,height){if(context.beginPath){context.beginPath()}if(context.ellipse){context.ellipse(centerX,centerY,width/2,height/2,0,0,2*Math.PI)}else{var xPos,yPos;var rw=width/2;var rh=height/2;for(var i=0*Math.PI;i<2*Math.PI;i+=ellipseStepSize){xPos=centerX-rw*sin[i]*sin0+rw*cos[i]*cos0;yPos=centerY+rh*cos[i]*sin0+rh*sin[i]*cos0;if(i===0){context.moveTo(xPos,yPos)}else{context.lineTo(xPos,yPos)}}}context.closePath()};module.exports=CRp},{"../../../math":119}],106:[function(require,module,exports){"use strict";var math=require("../../../math");var util=require("../../../util");var Heap=require("../../../heap");var defs=require("./texture-cache-defs");var minTxrH=25;var txrStepH=50;var minLvl=-4;var maxLvl=2;var maxZoom=3.99;var eleTxrSpacing=8;var defTxrWidth=1024;var maxTxrW=1024;var maxTxrH=1024;var minUtility=.5;var maxFullness=.8;var maxFullnessChecks=10;var allowEdgeTxrCaching=false;var allowParentTxrCaching=false;var deqCost=.15;var deqAvgCost=.1;var deqNoDrawCost=.9;var deqFastCost=.9;var deqRedrawThreshold=100;var maxDeqSize=1;var getTxrReasons={dequeue:"dequeue",downscale:"downscale",highQuality:"highQuality"};var ElementTextureCache=function(renderer){var self=this;self.renderer=renderer;self.onDequeues=[];self.setupDequeueing()};var ETCp=ElementTextureCache.prototype;ETCp.reasons=getTxrReasons;ETCp.getTextureQueue=function(txrH){var self=this;self.eleImgCaches=self.eleImgCaches||{};return self.eleImgCaches[txrH]=self.eleImgCaches[txrH]||[]};ETCp.getRetiredTextureQueue=function(txrH){var self=this;var rtxtrQs=self.eleImgCaches.retired=self.eleImgCaches.retired||{};var rtxtrQ=rtxtrQs[txrH]=rtxtrQs[txrH]||[];return rtxtrQ};ETCp.getElementQueue=function(){var self=this;var q=self.eleCacheQueue=self.eleCacheQueue||new Heap(function(a,b){return b.reqs-a.reqs});return q};ETCp.getElementIdToQueue=function(){var self=this;var id2q=self.eleIdToCacheQueue=self.eleIdToCacheQueue||{};return id2q};ETCp.getElement=function(ele,bb,pxRatio,lvl,reason){var self=this;var r=this.renderer;var rs=ele._private.rscratch;var zoom=r.cy.zoom();if(bb.w===0||bb.h===0){return null}if(lvl==null){lvl=Math.ceil(math.log2(zoom*pxRatio))}if(lvl<minLvl){lvl=minLvl}else if(zoom>=maxZoom||lvl>maxLvl){return null}var scale=Math.pow(2,lvl);var eleScaledH=bb.h*scale;var eleScaledW=bb.w*scale;var caches=rs.imgCaches=rs.imgCaches||{};var eleCache=caches[lvl];if(eleCache){return eleCache}var txrH;if(eleScaledH<=minTxrH){txrH=minTxrH}else if(eleScaledH<=txrStepH){txrH=txrStepH}else{txrH=Math.ceil(eleScaledH/txrStepH)*txrStepH}if(eleScaledH>maxTxrH||eleScaledW>maxTxrW||!allowEdgeTxrCaching&&ele.isEdge()||!allowParentTxrCaching&&ele.isParent()){return null}var txrQ=self.getTextureQueue(txrH);var txr=txrQ[txrQ.length-2];var addNewTxr=function(){return self.recycleTexture(txrH,eleScaledW)||self.addTexture(txrH,eleScaledW)};if(!txr){txr=txrQ[txrQ.length-1]}if(!txr){txr=addNewTxr()}if(txr.width-txr.usedWidth<eleScaledW){txr=addNewTxr()}var scaledLabelShown=r.eleTextBiggerThanMin(ele,scale);var scalableFrom=function(otherCache){return otherCache&&otherCache.scaledLabelShown===scaledLabelShown};var deqing=reason&&reason===getTxrReasons.dequeue;var highQualityReq=reason&&reason===getTxrReasons.highQuality;var downscaleReq=reason&&reason===getTxrReasons.downscale;var higherCache;for(var l=lvl+1;l<=maxLvl;l++){var c=caches[l];if(c){higherCache=c;break}}var oneUpCache=higherCache&&higherCache.level===lvl+1?higherCache:null;var downscale=function(){txr.context.drawImage(oneUpCache.texture.canvas,oneUpCache.x,0,oneUpCache.width,oneUpCache.height,txr.usedWidth,0,eleScaledW,eleScaledH)};if(scalableFrom(oneUpCache)){downscale()}else if(scalableFrom(higherCache)){if(highQualityReq){for(var l=higherCache.level;l>lvl;l--){oneUpCache=self.getElement(ele,bb,pxRatio,l,getTxrReasons.downscale)}downscale()}else{self.queueElement(ele,bb,higherCache.level-1);return higherCache}}else{var lowerCache;if(!deqing&&!highQualityReq&&!downscaleReq){for(var l=lvl-1;l>=minLvl;l--){var c=caches[l];if(c){lowerCache=c;break}}}if(scalableFrom(lowerCache)){self.queueElement(ele,bb,lvl);return lowerCache}txr.context.translate(txr.usedWidth,0);txr.context.scale(scale,scale);r.drawElement(txr.context,ele,bb,scaledLabelShown);txr.context.scale(1/scale,1/scale);txr.context.translate(-txr.usedWidth,0)}eleCache=caches[lvl]={ele:ele,x:txr.usedWidth,texture:txr,level:lvl,scale:scale,width:eleScaledW,height:eleScaledH,scaledLabelShown:scaledLabelShown};txr.usedWidth+=Math.ceil(eleScaledW+eleTxrSpacing);txr.eleCaches.push(eleCache);self.checkTextureFullness(txr);return eleCache};ETCp.invalidateElement=function(ele){var self=this;var caches=ele._private.rscratch.imgCaches;if(caches){for(var lvl=minLvl;lvl<=maxLvl;lvl++){var cache=caches[lvl];if(cache){var txr=cache.texture;txr.invalidatedWidth+=cache.width;caches[lvl]=null;util.removeFromArray(txr.eleCaches,cache);self.checkTextureUtility(txr)}}}};ETCp.checkTextureUtility=function(txr){if(txr.invalidatedWidth>=minUtility*txr.width){this.retireTexture(txr)}};ETCp.checkTextureFullness=function(txr){var self=this;var txrQ=self.getTextureQueue(txr.height);if(txr.usedWidth/txr.width>maxFullness&&txr.fullnessChecks>=maxFullnessChecks){util.removeFromArray(txrQ,txr)}else{txr.fullnessChecks++}};ETCp.retireTexture=function(txr){var self=this;var txrH=txr.height;var txrQ=self.getTextureQueue(txrH);util.removeFromArray(txrQ,txr);txr.retired=true;var eleCaches=txr.eleCaches;for(var i=0;i<eleCaches.length;i++){var eleCache=eleCaches[i];var ele=eleCache.ele;var lvl=eleCache.level;var imgCaches=ele._private.rscratch.imgCaches;if(imgCaches){imgCaches[lvl]=null}}util.clearArray(eleCaches);var rtxtrQ=self.getRetiredTextureQueue(txrH);rtxtrQ.push(txr)};ETCp.addTexture=function(txrH,minW){var self=this;var txrQ=self.getTextureQueue(txrH);var txr={};txrQ.push(txr);txr.eleCaches=[];txr.height=txrH;txr.width=Math.max(defTxrWidth,minW);txr.usedWidth=0;txr.invalidatedWidth=0;txr.fullnessChecks=0;txr.canvas=document.createElement("canvas");txr.canvas.width=txr.width;txr.canvas.height=txr.height;txr.context=txr.canvas.getContext("2d");return txr};ETCp.recycleTexture=function(txrH,minW){var self=this;var txrQ=self.getTextureQueue(txrH);var rtxtrQ=self.getRetiredTextureQueue(txrH);for(var i=0;i<rtxtrQ.length;i++){var txr=rtxtrQ[i];if(txr.width>=minW){txr.retired=false;txr.usedWidth=0;txr.invalidatedWidth=0;txr.fullnessChecks=0;util.clearArray(txr.eleCaches);txr.context.clearRect(0,0,txr.width,txr.height);util.removeFromArray(rtxtrQ,txr);txrQ.push(txr);return txr}}};ETCp.queueElement=function(ele,bb,lvl){var self=this;var q=self.getElementQueue();var id2q=self.getElementIdToQueue();var id=ele.id();var existingReq=id2q[id];if(existingReq){existingReq.level=Math.max(existingReq.level,lvl);existingReq.reqs++;q.updateItem(existingReq)}else{var req={ele:ele,bb:bb,position:math.copyPosition(ele.position()),level:lvl,reqs:1};if(ele.isEdge()){req.positions={source:math.copyPosition(ele.source().position()),target:math.copyPosition(ele.target().position())}}q.push(req);id2q[id]=req}};ETCp.dequeue=function(pxRatio,extent){var self=this;var q=self.getElementQueue();var id2q=self.getElementIdToQueue();var dequeued=[];for(var i=0;i<maxDeqSize;i++){if(q.size()>0){var req=q.pop();id2q[req.ele.id()]=null;dequeued.push(req);var ele=req.ele;var bb;if(ele.isEdge()&&(!math.arePositionsSame(ele.source().position(),req.positions.source)||!math.arePositionsSame(ele.target().position(),req.positions.target))||!math.arePositionsSame(ele.position(),req.position)){bb=ele.boundingBox()}else{bb=req.bb}self.getElement(req.ele,bb,pxRatio,req.level,getTxrReasons.dequeue)}else{break}}return dequeued};ETCp.onDequeue=function(fn){this.onDequeues.push(fn)};ETCp.offDequeue=function(fn){util.removeFromArray(this.onDequeues,fn)};ETCp.setupDequeueing=defs.setupDequeueing({deqRedrawThreshold:deqRedrawThreshold,deqCost:deqCost,deqAvgCost:deqAvgCost,deqNoDrawCost:deqNoDrawCost,deqFastCost:deqFastCost,deq:function(self,pxRatio,extent){return self.dequeue(pxRatio,extent)},onDeqd:function(self,deqd){for(var i=0;i<self.onDequeues.length;i++){var fn=self.onDequeues[i];fn(deqd)}},shouldRedraw:function(self,deqd,pxRatio,extent){for(var i=0;i<deqd.length;i++){var bb=deqd[i].bb;if(math.boundingBoxesIntersect(bb,extent)){return true}}return false},priority:function(self){return self.renderer.beforeRenderPriorities.eleTxrDeq}});module.exports=ElementTextureCache},{"../../../heap":115,"../../../math":119,"../../../util":134,"./texture-cache-defs":111}],107:[function(require,module,exports){"use strict";var is=require("../../../is");var CRp={};CRp.createBuffer=function(w,h){var buffer=document.createElement("canvas");buffer.width=w;buffer.height=h;return[buffer,buffer.getContext("2d")]};CRp.bufferCanvasImage=function(options){var cy=this.cy;var eles=cy.mutableElements();var bb=eles.boundingBox();var width=options.full?Math.ceil(bb.w):this.container.clientWidth;var height=options.full?Math.ceil(bb.h):this.container.clientHeight;var specdMaxDims=is.number(options.maxWidth)||is.number(options.maxHeight);var pxRatio=this.getPixelRatio();var scale=1;if(options.scale!==undefined){width*=options.scale;height*=options.scale;scale=options.scale}else if(specdMaxDims){var maxScaleW=Infinity;var maxScaleH=Infinity;if(is.number(options.maxWidth)){maxScaleW=scale*options.maxWidth/width}if(is.number(options.maxHeight)){maxScaleH=scale*options.maxHeight/height}scale=Math.min(maxScaleW,maxScaleH);width*=scale;height*=scale}if(!specdMaxDims){width*=pxRatio;height*=pxRatio;scale*=pxRatio}var buffCanvas=document.createElement("canvas");buffCanvas.width=width;buffCanvas.height=height;buffCanvas.style.width=width+"px";buffCanvas.style.height=height+"px";var buffCxt=buffCanvas.getContext("2d");if(width>0&&height>0){buffCxt.clearRect(0,0,width,height);if(options.bg){buffCxt.fillStyle=options.bg;buffCxt.rect(0,0,width,height);buffCxt.fill()}buffCxt.globalCompositeOperation="source-over";var zsortedEles=this.getCachedZSortedEles();if(options.full){buffCxt.translate(-bb.x1*scale,-bb.y1*scale);buffCxt.scale(scale,scale);this.drawElements(buffCxt,zsortedEles)}else{var pan=cy.pan();var translation={x:pan.x*scale,y:pan.y*scale};scale*=cy.zoom();buffCxt.translate(translation.x,translation.y);buffCxt.scale(scale,scale);this.drawElements(buffCxt,zsortedEles)}}return buffCanvas};CRp.png=function(options){return this.bufferCanvasImage(options).toDataURL("image/png")};CRp.jpg=function(options){return this.bufferCanvasImage(options).toDataURL("image/jpeg")};module.exports=CRp},{"../../../is":117}],108:[function(require,module,exports){"use strict";var util=require("../../../util");var is=require("../../../is");var ElementTextureCache=require("./ele-texture-cache");var LayeredTextureCache=require("./layered-texture-cache");var CR=CanvasRenderer;var CRp=CanvasRenderer.prototype;CRp.CANVAS_LAYERS=3;CRp.SELECT_BOX=0;CRp.DRAG=1;CRp.NODE=2;CRp.BUFFER_COUNT=3;CRp.TEXTURE_BUFFER=0;CRp.MOTIONBLUR_BUFFER_NODE=1;CRp.MOTIONBLUR_BUFFER_DRAG=2;function CanvasRenderer(options){var r=this;r.data={canvases:new Array(CRp.CANVAS_LAYERS),contexts:new Array(CRp.CANVAS_LAYERS),canvasNeedsRedraw:new Array(CRp.CANVAS_LAYERS),bufferCanvases:new Array(CRp.BUFFER_COUNT),bufferContexts:new Array(CRp.CANVAS_LAYERS)};r.data.canvasContainer=document.createElement("div");var containerStyle=r.data.canvasContainer.style;r.data.canvasContainer.setAttribute("style","-webkit-tap-highlight-color: rgba(0,0,0,0);");containerStyle.position="relative";containerStyle.zIndex="0";containerStyle.overflow="hidden";var container=options.cy.container();container.appendChild(r.data.canvasContainer);container.setAttribute("style",(container.getAttribute("style")||"")+"-webkit-tap-highlight-color: rgba(0,0,0,0);");for(var i=0;i<CRp.CANVAS_LAYERS;i++){var canvas=r.data.canvases[i]=document.createElement("canvas");r.data.contexts[i]=canvas.getContext("2d");canvas.setAttribute("style","-webkit-user-select: none; -moz-user-select: -moz-none; user-select: none; -webkit-tap-highlight-color: rgba(0,0,0,0); outline-style: none;"+(is.ms()?" -ms-touch-action: none; touch-action: none; ":""));canvas.style.position="absolute";canvas.setAttribute("data-id","layer"+i);canvas.style.zIndex=String(CRp.CANVAS_LAYERS-i);r.data.canvasContainer.appendChild(canvas);r.data.canvasNeedsRedraw[i]=false}r.data.topCanvas=r.data.canvases[0];r.data.canvases[CRp.NODE].setAttribute("data-id","layer"+CRp.NODE+"-node");r.data.canvases[CRp.SELECT_BOX].setAttribute("data-id","layer"+CRp.SELECT_BOX+"-selectbox");r.data.canvases[CRp.DRAG].setAttribute("data-id","layer"+CRp.DRAG+"-drag");for(var i=0;i<CRp.BUFFER_COUNT;i++){r.data.bufferCanvases[i]=document.createElement("canvas");r.data.bufferContexts[i]=r.data.bufferCanvases[i].getContext("2d");r.data.bufferCanvases[i].style.position="absolute";r.data.bufferCanvases[i].setAttribute("data-id","buffer"+i);r.data.bufferCanvases[i].style.zIndex=String(-i-1);r.data.bufferCanvases[i].style.visibility="hidden"}r.pathsEnabled=true;r.data.eleTxrCache=new ElementTextureCache(r);r.data.lyrTxrCache=new LayeredTextureCache(r,r.data.eleTxrCache);r.onUpdateEleCalcs(function invalidateTextureCaches(willDraw,eles){for(var i=0;i<eles.length;i++){var ele=eles[i];var rs=ele._private.rstyle;var de=rs.dirtyEvents;if(ele.isNode()&&de&&de.length===1&&de["position"]){}else{r.data.eleTxrCache.invalidateElement(ele)}}if(eles.length>0){r.data.lyrTxrCache.invalidateElements(eles)}})}CRp.redrawHint=function(group,bool){var r=this;switch(group){case"eles":r.data.canvasNeedsRedraw[CRp.NODE]=bool;break;case"drag":r.data.canvasNeedsRedraw[CRp.DRAG]=bool;break;case"select":r.data.canvasNeedsRedraw[CRp.SELECT_BOX]=bool;break}};var pathsImpld=typeof Path2D!=="undefined";CRp.path2dEnabled=function(on){if(on===undefined){return this.pathsEnabled}this.pathsEnabled=on?true:false};CRp.usePaths=function(){return pathsImpld&&this.pathsEnabled};[require("./arrow-shapes"),require("./drawing-elements"),require("./drawing-edges"),require("./drawing-images"),require("./drawing-label-text"),require("./drawing-nodes"),require("./drawing-redraw"),require("./drawing-shapes"),require("./export-image"),require("./node-shapes")].forEach(function(props){util.extend(CRp,props)});module.exports=CR},{"../../../is":117,"../../../util":134,"./arrow-shapes":98,"./drawing-edges":99,"./drawing-elements":100,"./drawing-images":101,"./drawing-label-text":102,"./drawing-nodes":103,"./drawing-redraw":104,"./drawing-shapes":105,"./ele-texture-cache":106,"./export-image":107,"./layered-texture-cache":109,"./node-shapes":110}],109:[function(require,module,exports){"use strict";var util=require("../../../util");var math=require("../../../math");var Heap=require("../../../heap");var is=require("../../../is");var defs=require("./texture-cache-defs");var defNumLayers=1;var minLvl=-4;var maxLvl=2;var maxZoom=3.99;var deqRedrawThreshold=50;var refineEleDebounceTime=50;var disableEleImgSmoothing=true;var deqCost=.15;var deqAvgCost=.1;var deqNoDrawCost=.9;var deqFastCost=.9;var maxDeqSize=1;var invalidThreshold=250;var maxLayerArea=4e3*4e3;var alwaysQueue=true;var useHighQualityEleTxrReqs=true;var useEleTxrCaching=true;var LayeredTextureCache=function(renderer,eleTxrCache){var self=this;var r=self.renderer=renderer;self.layersByLevel={};self.firstGet=true;self.lastInvalidationTime=util.performanceNow()-2*invalidThreshold;self.skipping=false;r.beforeRender(function(willDraw,now){if(now-self.lastInvalidationTime<=invalidThreshold){self.skipping=true}else{self.skipping=false}});var qSort=function(a,b){return b.reqs-a.reqs};self.layersQueue=new Heap(qSort);self.eleTxrCache=eleTxrCache;self.setupEleCacheInvalidation();self.setupDequeueing()};var LTCp=LayeredTextureCache.prototype;var layerIdPool=0;var MAX_INT=Math.pow(2,53)-1;LTCp.makeLayer=function(bb,lvl){var scale=Math.pow(2,lvl);var w=Math.ceil(bb.w*scale);var h=Math.ceil(bb.h*scale);var canvas=document.createElement("canvas");canvas.width=w;canvas.height=h;var layer={id:layerIdPool=++layerIdPool%MAX_INT,bb:bb,level:lvl,width:w,height:h,canvas:canvas,context:canvas.getContext("2d"),eles:[],elesQueue:[],reqs:0};var cxt=layer.context;var dx=-layer.bb.x1;var dy=-layer.bb.y1;cxt.scale(scale,scale);cxt.translate(dx,dy);return layer};LTCp.getLayers=function(eles,pxRatio,lvl){var self=this;var r=self.renderer;var cy=r.cy;var zoom=cy.zoom();var firstGet=self.firstGet;self.firstGet=false;if(lvl==null){lvl=Math.ceil(math.log2(zoom*pxRatio));if(lvl<minLvl){lvl=minLvl}else if(zoom>=maxZoom||lvl>maxLvl){return null}}self.validateLayersElesOrdering(lvl,eles);var layersByLvl=self.layersByLevel;var scale=Math.pow(2,lvl);var layers=layersByLvl[lvl]=layersByLvl[lvl]||[];var bb;var lvlComplete=self.levelIsComplete(lvl,eles);var tmpLayers;var checkTempLevels=function(){var canUseAsTmpLvl=function(l){self.validateLayersElesOrdering(l,eles);if(self.levelIsComplete(l,eles)){tmpLayers=layersByLvl[l];return true}};var checkLvls=function(dir){if(tmpLayers){return}for(var l=lvl+dir;minLvl<=l&&l<=maxLvl;l+=dir){if(canUseAsTmpLvl(l)){break}}};checkLvls(+1);checkLvls(-1);for(var i=layers.length-1;i>=0;i--){var layer=layers[i];if(layer.invalid){util.removeFromArray(layers,layer)}}};if(!lvlComplete){checkTempLevels()}else{return layers}var getBb=function(){if(!bb){bb=math.makeBoundingBox();for(var i=0;i<eles.length;i++){math.updateBoundingBox(bb,eles[i].boundingBox())}}return bb};var makeLayer=function(opts){opts=opts||{};var after=opts.after;getBb();var area=bb.w*scale*(bb.h*scale);if(area>maxLayerArea){return null}var layer=self.makeLayer(bb,lvl);if(after!=null){var index=layers.indexOf(after)+1;layers.splice(index,0,layer)}else if(opts.insert===undefined||opts.insert){layers.unshift(layer)}return layer};if(self.skipping&&!firstGet){return null}var layer=null;var maxElesPerLayer=eles.length/defNumLayers;var allowLazyQueueing=alwaysQueue&&!firstGet;for(var i=0;i<eles.length;i++){var ele=eles[i];var rs=ele._private.rscratch;var caches=rs.imgLayerCaches=rs.imgLayerCaches||{};var existingLayer=caches[lvl];if(existingLayer){layer=existingLayer;continue}if(!layer||layer.eles.length>=maxElesPerLayer||!math.boundingBoxInBoundingBox(layer.bb,ele.boundingBox())){layer=makeLayer({insert:true,after:layer});if(!layer){return null}}if(tmpLayers||allowLazyQueueing){self.queueLayer(layer,ele)}else{self.drawEleInLayer(layer,ele,lvl,pxRatio)}layer.eles.push(ele);caches[lvl]=layer}if(tmpLayers){return tmpLayers}if(allowLazyQueueing){return null}return layers};LTCp.getEleLevelForLayerLevel=function(lvl,pxRatio){return lvl};function imgSmoothing(context,bool){if(context.imageSmoothingEnabled!=null){context.imageSmoothingEnabled=bool}else{context.webkitImageSmoothingEnabled=bool;context.mozImageSmoothingEnabled=bool;context.msImageSmoothingEnabled=bool}}LTCp.drawEleInLayer=function(layer,ele,lvl,pxRatio){var self=this;var r=this.renderer;var context=layer.context;var bb=ele.boundingBox();if(bb.w===0||bb.h===0){return}var eleCache=self.eleTxrCache;var reason=useHighQualityEleTxrReqs?eleCache.reasons.highQuality:undefined;lvl=self.getEleLevelForLayerLevel(lvl,pxRatio);var cache=useEleTxrCaching?eleCache.getElement(ele,bb,null,lvl,reason):null;if(cache){if(disableEleImgSmoothing){imgSmoothing(context,false)}context.drawImage(cache.texture.canvas,cache.x,0,cache.width,cache.height,bb.x1,bb.y1,bb.w,bb.h);if(disableEleImgSmoothing){imgSmoothing(context,true)}}else{r.drawElement(context,ele)}};LTCp.levelIsComplete=function(lvl,eles){var self=this;var layers=self.layersByLevel[lvl];if(!layers||layers.length===0){return false}var numElesInLayers=0;for(var i=0;i<layers.length;i++){var layer=layers[i];if(layer.reqs>0){return false}if(layer.invalid){return false}numElesInLayers+=layer.eles.length}if(numElesInLayers!==eles.length){return false}return true};LTCp.validateLayersElesOrdering=function(lvl,eles){var layers=this.layersByLevel[lvl];if(!layers){return}for(var i=0;i<layers.length;i++){var layer=layers[i];var offset=-1;for(var j=0;j<eles.length;j++){if(layer.eles[0]===eles[j]){offset=j;break}}if(offset<0){this.invalidateLayer(layer);continue}var o=offset;for(var j=0;j<layer.eles.length;j++){if(layer.eles[j]!==eles[o+j]){this.invalidateLayer(layer);break}}}};LTCp.updateElementsInLayers=function(eles,update){var self=this;var isEles=is.element(eles[0]);for(var i=0;i<eles.length;i++){var req=isEles?null:eles[i];var ele=isEles?eles[i]:eles[i].ele;var rs=ele._private.rscratch;var caches=rs.imgLayerCaches=rs.imgLayerCaches||{};for(var l=minLvl;l<=maxLvl;l++){var layer=caches[l];if(!layer){continue}if(req&&self.getEleLevelForLayerLevel(layer.level)!==req.level){continue}update(layer,ele,req)}}};LTCp.haveLayers=function(){var self=this;var haveLayers=false;for(var l=minLvl;l<=maxLvl;l++){var layers=self.layersByLevel[l];if(layers&&layers.length>0){haveLayers=true;break}}return haveLayers};LTCp.invalidateElements=function(eles){var self=this;self.lastInvalidationTime=util.performanceNow();if(eles.length===0||!self.haveLayers()){return}self.updateElementsInLayers(eles,function invalAssocLayers(layer,ele,req){self.invalidateLayer(layer)})};LTCp.invalidateLayer=function(layer){this.lastInvalidationTime=util.performanceNow();if(layer.invalid){return}var lvl=layer.level;var eles=layer.eles;var layers=this.layersByLevel[lvl];util.removeFromArray(layers,layer);layer.elesQueue=[];layer.invalid=true;if(layer.replacement){layer.replacement.invalid=true}for(var i=0;i<eles.length;i++){var caches=eles[i]._private.rscratch.imgLayerCaches;if(caches){caches[lvl]=null}}};LTCp.refineElementTextures=function(eles){var self=this;self.updateElementsInLayers(eles,function refineEachEle(layer,ele,req){var rLyr=layer.replacement;if(!rLyr){rLyr=layer.replacement=self.makeLayer(layer.bb,layer.level);rLyr.replaces=layer;rLyr.eles=layer.eles}if(!rLyr.reqs){for(var i=0;i<rLyr.eles.length;i++){self.queueLayer(rLyr,rLyr.eles[i])}}})};LTCp.setupEleCacheInvalidation=function(){var self=this;var eleDeqs=[];if(!useEleTxrCaching){return}var updatedElesInLayers=util.debounce(function(){self.refineElementTextures(eleDeqs);eleDeqs=[]},refineEleDebounceTime);self.eleTxrCache.onDequeue(function(reqs){for(var i=0;i<reqs.length;i++){eleDeqs.push(reqs[i])}updatedElesInLayers()})};LTCp.queueLayer=function(layer,ele){var self=this;var q=self.layersQueue;var elesQ=layer.elesQueue;var hasId=elesQ.hasId=elesQ.hasId||{};if(layer.replacement){return}if(ele){if(hasId[ele.id()]){return}elesQ.push(ele);hasId[ele.id()]=true}if(layer.reqs){layer.reqs++;q.updateItem(layer)}else{layer.reqs=1;q.push(layer)}};LTCp.dequeue=function(pxRatio){var self=this;var q=self.layersQueue;var deqd=[];var eleDeqs=0;while(eleDeqs<maxDeqSize){if(q.size()===0){break}var layer=q.peek();if(layer.replacement){q.pop();continue}if(layer.replaces&&layer!==layer.replaces.replacement){q.pop();continue}if(layer.invalid){q.pop();continue}var ele=layer.elesQueue.shift();if(ele){self.drawEleInLayer(layer,ele,layer.level,pxRatio);eleDeqs++}if(deqd.length===0){deqd.push(true)}if(layer.elesQueue.length===0){q.pop();layer.reqs=0;if(layer.replaces){self.applyLayerReplacement(layer)}self.requestRedraw()}}return deqd};LTCp.applyLayerReplacement=function(layer){var self=this;var layersInLevel=self.layersByLevel[layer.level];var replaced=layer.replaces;var index=layersInLevel.indexOf(replaced);if(index<0||replaced.invalid){return}layersInLevel[index]=layer;for(var i=0;i<layer.eles.length;i++){var _p=layer.eles[i]._private;var cache=_p.imgLayerCaches=_p.imgLayerCaches||{};if(cache){cache[layer.level]=layer}}self.requestRedraw()};LTCp.requestRedraw=util.debounce(function(){var r=this.renderer;r.redrawHint("eles",true);r.redrawHint("drag",true);r.redraw()},100);LTCp.setupDequeueing=defs.setupDequeueing({deqRedrawThreshold:deqRedrawThreshold,deqCost:deqCost,deqAvgCost:deqAvgCost,deqNoDrawCost:deqNoDrawCost,deqFastCost:deqFastCost,deq:function(self,pxRatio){return self.dequeue(pxRatio)},onDeqd:util.noop,shouldRedraw:util.trueify,priority:function(self){return self.renderer.beforeRenderPriorities.lyrTxrDeq}});module.exports=LayeredTextureCache},{"../../../heap":115,"../../../is":117,"../../../math":119,"../../../util":134,"./texture-cache-defs":111}],110:[function(require,module,exports){"use strict";var CRp={};CRp.nodeShapeImpl=function(name,context,centerX,centerY,width,height,points){switch(name){case"ellipse":return this.drawEllipsePath(context,centerX,centerY,width,height);case"polygon":return this.drawPolygonPath(context,centerX,centerY,width,height,points);case"roundrectangle":return this.drawRoundRectanglePath(context,centerX,centerY,width,height)}};module.exports=CRp},{}],111:[function(require,module,exports){"use strict";var util=require("../../../util");var fullFpsTime=1e3/60;module.exports={setupDequeueing:function(opts){return function setupDequeueingImpl(){var self=this;var r=this.renderer;if(self.dequeueingSetup){return}else{self.dequeueingSetup=true}var queueRedraw=util.debounce(function(){r.redrawHint("eles",true);r.redrawHint("drag",true);r.redraw()},opts.deqRedrawThreshold);var dequeue=function(willDraw,frameStartTime){var startTime=util.performanceNow();var avgRenderTime=r.averageRedrawTime;var renderTime=r.lastRedrawTime;var deqd=[];var extent=r.cy.extent();var pixelRatio=r.getPixelRatio();while(true){var now=util.performanceNow();var duration=now-startTime;var frameDuration=now-frameStartTime;if(renderTime<fullFpsTime){var timeAvailable=fullFpsTime-(willDraw?avgRenderTime:0);if(frameDuration>=opts.deqFastCost*timeAvailable){break}}else{if(willDraw){if(duration>=opts.deqCost*renderTime||duration>=opts.deqAvgCost*avgRenderTime){break}}else if(frameDuration>=opts.deqNoDrawCost*fullFpsTime){break}}var thisDeqd=opts.deq(self,pixelRatio,extent);if(thisDeqd.length>0){for(var i=0;i<thisDeqd.length;i++){deqd.push(thisDeqd[i])}}else{break}}if(deqd.length>0){opts.onDeqd(self,deqd);if(!willDraw&&opts.shouldRedraw(self,deqd,pixelRatio,extent)){queueRedraw()}}};var priority=opts.priority||util.noop;r.beforeRender(dequeue,priority(self))}}}},{"../../../util":134}],112:[function(require,module,exports){"use strict";module.exports=[{name:"null",impl:require("./null")},{name:"base",impl:require("./base")},{name:"canvas",impl:require("./canvas")}]},{"./base":94,"./canvas":108,"./null":113}],113:[function(require,module,exports){"use strict";function NullRenderer(options){this.options=options;this.notifications=0}var noop=function(){};NullRenderer.prototype={recalculateRenderedStyle:noop,notify:function(){this.notifications++},init:noop};module.exports=NullRenderer},{}],114:[function(require,module,exports){"use strict";var is=require("./is");var util=require("./util");var Thread=require("./thread");var Promise=require("./promise");var define=require("./define");var Fabric=function(N){if(!(this instanceof Fabric)){return new Fabric(N)}this._private={pass:[]};var defN=4;if(is.number(N)){}if(typeof navigator!=="undefined"&&navigator.hardwareConcurrency!=null){N=navigator.hardwareConcurrency}else{try{N=require("os").cpus().length}catch(err){N=defN}}for(var i=0;i<N;i++){this[i]=new Thread}this.length=N};var fabfn=Fabric.prototype;util.extend(fabfn,{instanceString:function(){return"fabric"},require:function(fn,as){for(var i=0;i<this.length;i++){var thread=this[i];thread.require(fn,as)}return this},random:function(){var i=Math.round((this.length-1)*Math.random());var thread=this[i];return thread},run:function(fn){var pass=this._private.pass.shift();return this.random().pass(pass).run(fn)},message:function(m){return this.random().message(m)},broadcast:function(m){for(var i=0;i<this.length;i++){var thread=this[i];thread.message(m)}return this},stop:function(){for(var i=0;i<this.length;i++){var thread=this[i];thread.stop()}return this},pass:function(data){var pass=this._private.pass;if(is.array(data)){pass.push(data)}else{throw"Only arrays may be used with fabric.pass()"}return this},spreadSize:function(){var subsize=Math.ceil(this._private.pass[0].length/this.length);subsize=Math.max(1,subsize);return subsize},spread:function(fn){var self=this;var _p=self._private;var subsize=self.spreadSize();var pass=_p.pass.shift().concat([]);var runPs=[];for(var i=0;i<this.length;i++){var thread=this[i];var slice=pass.splice(0,subsize);var runP=thread.pass(slice).run(fn);runPs.push(runP);var doneEarly=pass.length===0;if(doneEarly){break}}return Promise.all(runPs).then(function(thens){var postpass=[];var p=0;for(var i=0;i<thens.length;i++){var then=thens[i];for(var j=0;j<then.length;j++){var t=then[j];postpass[p++]=t}}return postpass})},map:function(fn){var self=this;self.require(fn,"_$_$_fabmap");return self.spread(function(split){var mapped=[];var origResolve=resolve;resolve=function(val){mapped.push(val)};for(var i=0;i<split.length;i++){var oldLen=mapped.length;var ret=_$_$_fabmap(split[i]);var nothingInsdByResolve=oldLen===mapped.length;if(nothingInsdByResolve){mapped.push(ret)}}resolve=origResolve;return mapped})},filter:function(fn){var _p=this._private;var pass=_p.pass[0];return this.map(fn).then(function(include){var ret=[];for(var i=0;i<pass.length;i++){var datum=pass[i];var incDatum=include[i];if(incDatum){ret.push(datum)}}return ret})},sort:function(cmp){var self=this;var P=this._private.pass[0].length;var subsize=this.spreadSize();cmp=cmp||function(a,b){if(a<b){return-1}else if(a>b){return 1}return 0};self.require(cmp,"_$_$_cmp");return self.spread(function(split){var sortedSplit=split.sort(_$_$_cmp);resolve(sortedSplit)}).then(function(joined){var merge=function(i,j,max){j=Math.min(j,P);max=Math.min(max,P);var l=i;var r=j;var sorted=[];for(var k=l;k<max;k++){var eleI=joined[i];var eleJ=joined[j];if(i<r&&(j>=max||cmp(eleI,eleJ)<=0)){sorted.push(eleI);i++}else{sorted.push(eleJ);j++}}for(var k=0;k<sorted.length;k++){var index=l+k;joined[index]=sorted[k]}};for(var splitL=subsize;splitL<P;splitL*=2){for(var i=0;i<P;i+=2*splitL){merge(i,i+splitL,i+2*splitL)}}return joined})}});var defineRandomPasser=function(opts){opts=opts||{};return function(fn,arg1){var pass=this._private.pass.shift();return this.random().pass(pass)[opts.threadFn](fn,arg1)}};util.extend(fabfn,{randomMap:defineRandomPasser({threadFn:"map"}),reduce:defineRandomPasser({threadFn:"reduce"}),reduceRight:defineRandomPasser({threadFn:"reduceRight"})});var fn=fabfn;fn.promise=fn.run;fn.terminate=fn.halt=fn.stop;fn.include=fn.require;util.extend(fabfn,{on:define.on(),one:define.on({unbindSelfOnTrigger:true}),off:define.off(),trigger:define.trigger()});define.eventAliasesOn(fabfn);module.exports=Fabric},{"./define":78,"./is":117,"./promise":120,"./thread":132,"./util":134,os:205}],115:[function(require,module,exports){"use strict";var Heap,defaultCmp,floor,heapify,heappop,heappush,heappushpop,heapreplace,insort,min,nlargest,nsmallest,updateItem,_siftdown,_siftup;floor=Math.floor,min=Math.min;defaultCmp=function(x,y){if(x<y){return-1}if(x>y){return 1}return 0};insort=function(a,x,lo,hi,cmp){var mid;if(lo==null){lo=0}if(cmp==null){cmp=defaultCmp}if(lo<0){throw new Error("lo must be non-negative")}if(hi==null){hi=a.length}while(lo<hi){mid=floor((lo+hi)/2);if(cmp(x,a[mid])<0){hi=mid}else{lo=mid+1}}return[].splice.apply(a,[lo,lo-lo].concat(x)),x};heappush=function(array,item,cmp){if(cmp==null){cmp=defaultCmp}array.push(item);return _siftdown(array,0,array.length-1,cmp)};heappop=function(array,cmp){var lastelt,returnitem;if(cmp==null){cmp=defaultCmp}lastelt=array.pop();if(array.length){returnitem=array[0];array[0]=lastelt;_siftup(array,0,cmp)}else{returnitem=lastelt}return returnitem};heapreplace=function(array,item,cmp){var returnitem;if(cmp==null){cmp=defaultCmp}returnitem=array[0];array[0]=item;_siftup(array,0,cmp);return returnitem};heappushpop=function(array,item,cmp){var _ref;if(cmp==null){cmp=defaultCmp}if(array.length&&cmp(array[0],item)<0){_ref=[array[0],item],item=_ref[0],array[0]=_ref[1];_siftup(array,0,cmp)}return item};heapify=function(array,cmp){var i,_i,_j,_len,_ref,_ref1,_results,_results1;if(cmp==null){cmp=defaultCmp}_ref1=function(){_results1=[];for(var _j=0,_ref=floor(array.length/2);0<=_ref?_j<_ref:_j>_ref;0<=_ref?_j++:_j--){_results1.push(_j)}return _results1}.apply(this).reverse();_results=[];for(_i=0,_len=_ref1.length;_i<_len;_i++){i=_ref1[_i];_results.push(_siftup(array,i,cmp))}return _results};updateItem=function(array,item,cmp){var pos;if(cmp==null){cmp=defaultCmp}pos=array.indexOf(item);if(pos===-1){return}_siftdown(array,0,pos,cmp);return _siftup(array,pos,cmp)};nlargest=function(array,n,cmp){var elem,result,_i,_len,_ref;if(cmp==null){cmp=defaultCmp}result=array.slice(0,n);if(!result.length){return result}heapify(result,cmp);_ref=array.slice(n);for(_i=0,_len=_ref.length;_i<_len;_i++){elem=_ref[_i];heappushpop(result,elem,cmp)}return result.sort(cmp).reverse()};nsmallest=function(array,n,cmp){var elem,i,los,result,_i,_j,_len,_ref,_ref1,_results;if(cmp==null){cmp=defaultCmp}if(n*10<=array.length){result=array.slice(0,n).sort(cmp);if(!result.length){return result}los=result[result.length-1];_ref=array.slice(n);for(_i=0,_len=_ref.length;_i<_len;_i++){elem=_ref[_i];if(cmp(elem,los)<0){insort(result,elem,0,null,cmp);result.pop();los=result[result.length-1]}}return result}heapify(array,cmp);_results=[];for(i=_j=0,_ref1=min(n,array.length);0<=_ref1?_j<_ref1:_j>_ref1;i=0<=_ref1?++_j:--_j){_results.push(heappop(array,cmp))}return _results};_siftdown=function(array,startpos,pos,cmp){var newitem,parent,parentpos;if(cmp==null){cmp=defaultCmp}newitem=array[pos];while(pos>startpos){parentpos=pos-1>>1;parent=array[parentpos];if(cmp(newitem,parent)<0){array[pos]=parent;pos=parentpos;continue}break}return array[pos]=newitem};_siftup=function(array,pos,cmp){var childpos,endpos,newitem,rightpos,startpos;if(cmp==null){cmp=defaultCmp}endpos=array.length;startpos=pos;newitem=array[pos];childpos=2*pos+1;while(childpos<endpos){rightpos=childpos+1;if(rightpos<endpos&&!(cmp(array[childpos],array[rightpos])<0)){childpos=rightpos}array[pos]=array[childpos];pos=childpos;childpos=2*pos+1}array[pos]=newitem;return _siftdown(array,startpos,pos,cmp)};Heap=function(){Heap.push=heappush;Heap.pop=heappop;Heap.replace=heapreplace;Heap.pushpop=heappushpop;Heap.heapify=heapify;Heap.updateItem=updateItem;Heap.nlargest=nlargest;Heap.nsmallest=nsmallest;function Heap(cmp){this.cmp=cmp!=null?cmp:defaultCmp;this.nodes=[]}Heap.prototype.push=function(x){return heappush(this.nodes,x,this.cmp)};Heap.prototype.pop=function(){return heappop(this.nodes,this.cmp)};Heap.prototype.peek=function(){return this.nodes[0]};Heap.prototype.contains=function(x){return this.nodes.indexOf(x)!==-1};Heap.prototype.replace=function(x){return heapreplace(this.nodes,x,this.cmp)};Heap.prototype.pushpop=function(x){return heappushpop(this.nodes,x,this.cmp)};Heap.prototype.heapify=function(){return heapify(this.nodes,this.cmp)};Heap.prototype.updateItem=function(x){return updateItem(this.nodes,x,this.cmp)};Heap.prototype.clear=function(){return this.nodes=[]};Heap.prototype.empty=function(){return this.nodes.length===0};Heap.prototype.size=function(){return this.nodes.length};Heap.prototype.clone=function(){var heap;heap=new Heap;heap.nodes=this.nodes.slice(0);return heap};Heap.prototype.toArray=function(){return this.nodes.slice(0)};Heap.prototype.insert=Heap.prototype.push;Heap.prototype.top=Heap.prototype.peek;Heap.prototype.front=Heap.prototype.peek;Heap.prototype.has=Heap.prototype.contains;Heap.prototype.copy=Heap.prototype.clone;return Heap}();module.exports=Heap},{}],116:[function(require,module,exports){"use strict";require("./-preamble");var window=require("./window");var is=require("./is");var Core=require("./core");var extension=require("./extension");var registerJquery=require("./jquery-plugin");var Stylesheet=require("./stylesheet");var Thread=require("./thread");var Fabric=require("./fabric");var cytoscape=function(options){if(options===undefined){options={}}if(is.plainObject(options)){return new Core(options)}else if(is.string(options)){return extension.apply(extension,arguments)}};cytoscape.version=require("./version.json");if(window&&window.jQuery){registerJquery(window.jQuery,cytoscape)}cytoscape.registerJquery=function(jQuery){registerJquery(jQuery,cytoscape)};cytoscape.stylesheet=cytoscape.Stylesheet=Stylesheet;cytoscape.thread=cytoscape.Thread=Thread;cytoscape.fabric=cytoscape.Fabric=Fabric;module.exports=cytoscape},{"./-preamble":35,"./core":71,"./extension":80,"./fabric":114,"./is":117,"./jquery-plugin":118,"./stylesheet":131,"./thread":132,"./version.json":140,"./window":141}],117:[function(require,module,exports){"use strict";var window=require("./window");var navigator=window?window.navigator:null;var document=window?window.document:null;var typeofstr=typeof"";var typeofobj=typeof{};var typeoffn=typeof function(){};var typeofhtmlele=typeof HTMLElement;var instanceStr=function(obj){return obj&&obj.instanceString&&is.fn(obj.instanceString)?obj.instanceString():null};var is={defined:function(obj){return obj!=null},string:function(obj){return obj!=null&&typeof obj==typeofstr},fn:function(obj){return obj!=null&&typeof obj===typeoffn},array:function(obj){return Array.isArray?Array.isArray(obj):obj!=null&&obj instanceof Array},plainObject:function(obj){return obj!=null&&typeof obj===typeofobj&&!is.array(obj)&&obj.constructor===Object},object:function(obj){return obj!=null&&typeof obj===typeofobj},number:function(obj){return obj!=null&&typeof obj===typeof 1&&!isNaN(obj)},integer:function(obj){return is.number(obj)&&Math.floor(obj)===obj},bool:function(obj){return obj!=null&&typeof obj===typeof true},htmlElement:function(obj){if("undefined"===typeofhtmlele){return undefined}else{return null!=obj&&obj instanceof HTMLElement}},elementOrCollection:function(obj){return is.element(obj)||is.collection(obj)},element:function(obj){return instanceStr(obj)==="collection"&&obj._private.single},collection:function(obj){return instanceStr(obj)==="collection"&&!obj._private.single},core:function(obj){return instanceStr(obj)==="core"},style:function(obj){return instanceStr(obj)==="style"},stylesheet:function(obj){return instanceStr(obj)==="stylesheet"},event:function(obj){return instanceStr(obj)==="event"},thread:function(obj){return instanceStr(obj)==="thread"},fabric:function(obj){return instanceStr(obj)==="fabric"},emptyString:function(obj){if(obj===undefined||obj===null){return true}else if(obj===""||obj.match(/^\s+$/)){return true}return false},nonemptyString:function(obj){if(obj&&is.string(obj)&&obj!==""&&!obj.match(/^\s+$/)){return true}return false},domElement:function(obj){if(typeof HTMLElement==="undefined"){return false}else{return obj instanceof HTMLElement}},boundingBox:function(obj){return is.plainObject(obj)&&is.number(obj.x1)&&is.number(obj.x2)&&is.number(obj.y1)&&is.number(obj.y2)},promise:function(obj){return is.object(obj)&&is.fn(obj.then)},touch:function(){return window&&("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)},gecko:function(){return window&&(typeof InstallTrigger!=="undefined"||"MozAppearance"in document.documentElement.style)},webkit:function(){return window&&(typeof webkitURL!=="undefined"||"WebkitAppearance"in document.documentElement.style)},chromium:function(){return window&&typeof chrome!=="undefined"},khtml:function(){return navigator&&navigator.vendor.match(/kde/i)},khtmlEtc:function(){return is.khtml()||is.webkit()||is.chromium()},ms:function(){return navigator&&navigator.userAgent.match(/msie|trident|edge/i)},windows:function(){return navigator&&navigator.appVersion.match(/Win/i)},mac:function(){return navigator&&navigator.appVersion.match(/Mac/i)},linux:function(){return navigator&&navigator.appVersion.match(/Linux/i)},unix:function(){return navigator&&navigator.appVersion.match(/X11/i)}};module.exports=is},{"./window":141}],118:[function(require,module,exports){"use strict";var is=require("./is");var cyReg=function($ele){var d=$ele[0]._cyreg=$ele[0]._cyreg||{};return d};var registerJquery=function($,cytoscape){if(!$){return}if($.fn.cytoscape){return}$.fn.cytoscape=function(opts){var $this=$(this);if(opts==="get"){return cyReg($this).cy}else if(is.fn(opts)){var ready=opts;var cy=cyReg($this).cy;if(cy&&cy.isReady()){cy.trigger("ready",[],ready)}else{var data=cyReg($this);var readies=data.readies=data.readies||[];readies.push(ready)}}else if(is.plainObject(opts)){return $this.each(function(){var options=$.extend({},opts,{container:$(this)[0]});cytoscape(options)})}};$.cytoscape=cytoscape;if($.fn.cy==null&&$.cy==null){$.fn.cy=$.fn.cytoscape;$.cy=$.cytoscape}};module.exports=registerJquery},{"./is":117}],119:[function(require,module,exports){"use strict";var math={};math.arePositionsSame=function(p1,p2){return p1.x===p2.x&&p1.y===p2.y};math.copyPosition=function(p){return{x:p.x,y:p.y}};math.array2point=function(arr){return{x:arr[0],y:arr[1]}};math.deg2rad=function(deg){return Math.PI*deg/180};math.log2=Math.log2||function(n){return Math.log(n)/Math.log(2)};math.signum=function(x){if(x>0){return 1}else if(x<0){return-1}else{return 0}};math.dist=function(p1,p2){return Math.sqrt(math.sqdist(p1,p2))};math.sqdist=function(p1,p2){var dx=p2.x-p1.x;var dy=p2.y-p1.y;return dx*dx+dy*dy};math.qbezierAt=function(p0,p1,p2,t){return(1-t)*(1-t)*p0+2*(1-t)*t*p1+t*t*p2};math.qbezierPtAt=function(p0,p1,p2,t){return{x:math.qbezierAt(p0.x,p1.x,p2.x,t),y:math.qbezierAt(p0.y,p1.y,p2.y,t)}};math.lineAt=function(p0,p1,t,d){var vec={x:p1.x-p0.x,y:p1.y-p0.y};var vecDist=math.dist(p0,p1);var normVec={x:vec.x/vecDist,y:vec.y/vecDist};t=t==null?0:t;var d=d!=null?d:t*vecDist;return{x:p0.x+normVec.x*d,y:p0.y+normVec.y*d}};math.lineAtDist=function(p0,p1,d){return math.lineAt(p0,p1,undefined,d)};math.triangleAngle=function(A,B,C){var a=math.dist(B,C);var b=math.dist(A,C);var c=math.dist(A,B);return Math.acos((a*a+b*b-c*c)/(2*a*b))};math.bound=function(min,val,max){return Math.max(min,Math.min(max,val))};math.makeBoundingBox=function(bb){if(bb==null){return{x1:Infinity,y1:Infinity,x2:-Infinity,y2:-Infinity,w:0,h:0}}else if(bb.x1!=null&&bb.y1!=null){if(bb.x2!=null&&bb.y2!=null&&bb.x2>=bb.x1&&bb.y2>=bb.y1){return{x1:bb.x1,y1:bb.y1,x2:bb.x2,y2:bb.y2,w:bb.x2-bb.x1,h:bb.y2-bb.y1}}else if(bb.w!=null&&bb.h!=null&&bb.w>=0&&bb.h>=0){return{x1:bb.x1,y1:bb.y1,x2:bb.x1+bb.w,y2:bb.y1+bb.h,w:bb.w,h:bb.h}}}};math.updateBoundingBox=function(bb1,bb2){bb1.x1=Math.min(bb1.x1,bb2.x1);bb1.x2=Math.max(bb1.x2,bb2.x2);bb1.w=bb1.x2-bb1.x1;bb1.y1=Math.min(bb1.y1,bb2.y1);bb1.y2=Math.max(bb1.y2,bb2.y2);bb1.h=bb1.y2-bb1.y1};math.expandBoundingBox=function(bb,padding){bb.x1-=padding;bb.x2+=padding;bb.y1-=padding;bb.y2+=padding;bb.w=bb.x2-bb.x1;bb.h=bb.y2-bb.y1;return bb};math.boundingBoxesIntersect=function(bb1,bb2){if(bb1.x1>bb2.x2){return false}if(bb2.x1>bb1.x2){return false}if(bb1.x2<bb2.x1){return false}if(bb2.x2<bb1.x1){return false}if(bb1.y2<bb2.y1){return false}if(bb2.y2<bb1.y1){return false}if(bb1.y1>bb2.y2){return false}if(bb2.y1>bb1.y2){return false}return true};math.inBoundingBox=function(bb,x,y){return bb.x1<=x&&x<=bb.x2&&bb.y1<=y&&y<=bb.y2};math.pointInBoundingBox=function(bb,pt){return this.inBoundingBox(bb,pt.x,pt.y)};math.boundingBoxInBoundingBox=function(bb1,bb2){return math.inBoundingBox(bb1,bb2.x1,bb2.y1)&&math.inBoundingBox(bb1,bb2.x2,bb2.y2)};math.roundRectangleIntersectLine=function(x,y,nodeX,nodeY,width,height,padding){var cornerRadius=this.getRoundRectangleRadius(width,height);var halfWidth=width/2;var halfHeight=height/2;var straightLineIntersections;{var topStartX=nodeX-halfWidth+cornerRadius-padding;var topStartY=nodeY-halfHeight-padding;var topEndX=nodeX+halfWidth-cornerRadius+padding;var topEndY=topStartY;straightLineIntersections=this.finiteLinesIntersect(x,y,nodeX,nodeY,topStartX,topStartY,topEndX,topEndY,false);if(straightLineIntersections.length>0){return straightLineIntersections}}{var rightStartX=nodeX+halfWidth+padding;var rightStartY=nodeY-halfHeight+cornerRadius-padding;var rightEndX=rightStartX;var rightEndY=nodeY+halfHeight-cornerRadius+padding;straightLineIntersections=this.finiteLinesIntersect(x,y,nodeX,nodeY,rightStartX,rightStartY,rightEndX,rightEndY,false);if(straightLineIntersections.length>0){return straightLineIntersections}}{var bottomStartX=nodeX-halfWidth+cornerRadius-padding;var bottomStartY=nodeY+halfHeight+padding;var bottomEndX=nodeX+halfWidth-cornerRadius+padding;var bottomEndY=bottomStartY;straightLineIntersections=this.finiteLinesIntersect(x,y,nodeX,nodeY,bottomStartX,bottomStartY,bottomEndX,bottomEndY,false);if(straightLineIntersections.length>0){return straightLineIntersections}}{var leftStartX=nodeX-halfWidth-padding;var leftStartY=nodeY-halfHeight+cornerRadius-padding;var leftEndX=leftStartX;var leftEndY=nodeY+halfHeight-cornerRadius+padding;straightLineIntersections=this.finiteLinesIntersect(x,y,nodeX,nodeY,leftStartX,leftStartY,leftEndX,leftEndY,false);if(straightLineIntersections.length>0){return straightLineIntersections}}var arcIntersections;{var topLeftCenterX=nodeX-halfWidth+cornerRadius;var topLeftCenterY=nodeY-halfHeight+cornerRadius;arcIntersections=this.intersectLineCircle(x,y,nodeX,nodeY,topLeftCenterX,topLeftCenterY,cornerRadius+padding);if(arcIntersections.length>0&&arcIntersections[0]<=topLeftCenterX&&arcIntersections[1]<=topLeftCenterY){return[arcIntersections[0],arcIntersections[1]]}}{var topRightCenterX=nodeX+halfWidth-cornerRadius;var topRightCenterY=nodeY-halfHeight+cornerRadius;arcIntersections=this.intersectLineCircle(x,y,nodeX,nodeY,topRightCenterX,topRightCenterY,cornerRadius+padding);if(arcIntersections.length>0&&arcIntersections[0]>=topRightCenterX&&arcIntersections[1]<=topRightCenterY){return[arcIntersections[0],arcIntersections[1]]}}{var bottomRightCenterX=nodeX+halfWidth-cornerRadius;var bottomRightCenterY=nodeY+halfHeight-cornerRadius;arcIntersections=this.intersectLineCircle(x,y,nodeX,nodeY,bottomRightCenterX,bottomRightCenterY,cornerRadius+padding);if(arcIntersections.length>0&&arcIntersections[0]>=bottomRightCenterX&&arcIntersections[1]>=bottomRightCenterY){return[arcIntersections[0],arcIntersections[1]]}}{var bottomLeftCenterX=nodeX-halfWidth+cornerRadius;var bottomLeftCenterY=nodeY+halfHeight-cornerRadius;arcIntersections=this.intersectLineCircle(x,y,nodeX,nodeY,bottomLeftCenterX,bottomLeftCenterY,cornerRadius+padding);if(arcIntersections.length>0&&arcIntersections[0]<=bottomLeftCenterX&&arcIntersections[1]>=bottomLeftCenterY){return[arcIntersections[0],arcIntersections[1]]}}return[]};math.inLineVicinity=function(x,y,lx1,ly1,lx2,ly2,tolerance){var t=tolerance;var x1=Math.min(lx1,lx2);var x2=Math.max(lx1,lx2);var y1=Math.min(ly1,ly2);var y2=Math.max(ly1,ly2);return x1-t<=x&&x<=x2+t&&y1-t<=y&&y<=y2+t};math.inBezierVicinity=function(x,y,x1,y1,x2,y2,x3,y3,tolerance){var bb={x1:Math.min(x1,x3,x2)-tolerance,x2:Math.max(x1,x3,x2)+tolerance,y1:Math.min(y1,y3,y2)-tolerance,y2:Math.max(y1,y3,y2)+tolerance};if(x<bb.x1||x>bb.x2||y<bb.y1||y>bb.y2){return false}else{return true}};math.solveCubic=function(a,b,c,d,result){b/=a;c/=a;d/=a;var discriminant,q,r,dum1,s,t,term1,r13;q=(3*c-b*b)/9;r=-(27*d)+b*(9*c-2*(b*b));r/=54;discriminant=q*q*q+r*r;result[1]=0;term1=b/3;if(discriminant>0){s=r+Math.sqrt(discriminant);s=s<0?-Math.pow(-s,1/3):Math.pow(s,1/3);t=r-Math.sqrt(discriminant);t=t<0?-Math.pow(-t,1/3):Math.pow(t,1/3);result[0]=-term1+s+t;term1+=(s+t)/2;result[4]=result[2]=-term1;term1=Math.sqrt(3)*(-t+s)/2;result[3]=term1;result[5]=-term1;return}result[5]=result[3]=0;if(discriminant===0){r13=r<0?-Math.pow(-r,1/3):Math.pow(r,1/3);result[0]=-term1+2*r13;result[4]=result[2]=-(r13+term1);return}q=-q;dum1=q*q*q;dum1=Math.acos(r/Math.sqrt(dum1));r13=2*Math.sqrt(q);result[0]=-term1+r13*Math.cos(dum1/3);result[2]=-term1+r13*Math.cos((dum1+2*Math.PI)/3);result[4]=-term1+r13*Math.cos((dum1+4*Math.PI)/3);return};math.sqdistToQuadraticBezier=function(x,y,x1,y1,x2,y2,x3,y3){var a=1*x1*x1-4*x1*x2+2*x1*x3+4*x2*x2-4*x2*x3+x3*x3+y1*y1-4*y1*y2+2*y1*y3+4*y2*y2-4*y2*y3+y3*y3;var b=1*9*x1*x2-3*x1*x1-3*x1*x3-6*x2*x2+3*x2*x3+9*y1*y2-3*y1*y1-3*y1*y3-6*y2*y2+3*y2*y3;var c=1*3*x1*x1-6*x1*x2+x1*x3-x1*x+2*x2*x2+2*x2*x-x3*x+3*y1*y1-6*y1*y2+y1*y3-y1*y+2*y2*y2+2*y2*y-y3*y;var d=1*x1*x2-x1*x1+x1*x-x2*x+y1*y2-y1*y1+y1*y-y2*y;var roots=[];this.solveCubic(a,b,c,d,roots);var zeroThreshold=1e-7;var params=[];for(var index=0;index<6;index+=2){if(Math.abs(roots[index+1])<zeroThreshold&&roots[index]>=0&&roots[index]<=1){params.push(roots[index])}}params.push(1);params.push(0);var minDistanceSquared=-1;var closestParam;var curX,curY,distSquared;for(var i=0;i<params.length;i++){curX=Math.pow(1-params[i],2)*x1+2*(1-params[i])*params[i]*x2+params[i]*params[i]*x3;curY=Math.pow(1-params[i],2)*y1+2*(1-params[i])*params[i]*y2+params[i]*params[i]*y3;distSquared=Math.pow(curX-x,2)+Math.pow(curY-y,2);if(minDistanceSquared>=0){if(distSquared<minDistanceSquared){minDistanceSquared=distSquared;closestParam=params[i]}}else{minDistanceSquared=distSquared;closestParam=params[i]}}return minDistanceSquared};math.sqdistToFiniteLine=function(x,y,x1,y1,x2,y2){var offset=[x-x1,y-y1];var line=[x2-x1,y2-y1];var lineSq=line[0]*line[0]+line[1]*line[1];var hypSq=offset[0]*offset[0]+offset[1]*offset[1];var dotProduct=offset[0]*line[0]+offset[1]*line[1];var adjSq=dotProduct*dotProduct/lineSq;if(dotProduct<0){return hypSq}if(adjSq>lineSq){return(x-x2)*(x-x2)+(y-y2)*(y-y2)}return hypSq-adjSq};math.pointInsidePolygonPoints=function(x,y,points){var x1,y1,x2,y2;var y3;var up=0;var down=0;for(var i=0;i<points.length/2;i++){x1=points[i*2];y1=points[i*2+1];if(i+1<points.length/2){x2=points[(i+1)*2];y2=points[(i+1)*2+1]}else{x2=points[(i+1-points.length/2)*2];y2=points[(i+1-points.length/2)*2+1]}if(x1==x&&x2==x){}else if(x1>=x&&x>=x2||x1<=x&&x<=x2){y3=(x-x1)/(x2-x1)*(y2-y1)+y1;if(y3>y){up++}if(y3<y){down++}}else{continue}}if(up%2===0){return false}else{return true}};math.pointInsidePolygon=function(x,y,basePoints,centerX,centerY,width,height,direction,padding){var transformedPoints=new Array(basePoints.length);var angle;if(direction[0]!=null){angle=Math.atan(direction[1]/direction[0]);if(direction[0]<0){angle=angle+Math.PI/2}else{angle=-angle-Math.PI/2}}else{angle=direction}var cos=Math.cos(-angle);var sin=Math.sin(-angle);for(var i=0;i<transformedPoints.length/2;i++){transformedPoints[i*2]=width/2*(basePoints[i*2]*cos-basePoints[i*2+1]*sin);transformedPoints[i*2+1]=height/2*(basePoints[i*2+1]*cos+basePoints[i*2]*sin);transformedPoints[i*2]+=centerX;transformedPoints[i*2+1]+=centerY}var points;if(padding>0){var expandedLineSet=this.expandPolygon(transformedPoints,-padding);points=this.joinLines(expandedLineSet)}else{points=transformedPoints}return math.pointInsidePolygonPoints(x,y,points)};math.joinLines=function(lineSet){var vertices=new Array(lineSet.length/2);var currentLineStartX,currentLineStartY,currentLineEndX,currentLineEndY;var nextLineStartX,nextLineStartY,nextLineEndX,nextLineEndY;for(var i=0;i<lineSet.length/4;i++){currentLineStartX=lineSet[i*4];currentLineStartY=lineSet[i*4+1];currentLineEndX=lineSet[i*4+2];currentLineEndY=lineSet[i*4+3];if(i<lineSet.length/4-1){nextLineStartX=lineSet[(i+1)*4];nextLineStartY=lineSet[(i+1)*4+1];nextLineEndX=lineSet[(i+1)*4+2];nextLineEndY=lineSet[(i+1)*4+3]}else{nextLineStartX=lineSet[0];nextLineStartY=lineSet[1];nextLineEndX=lineSet[2];nextLineEndY=lineSet[3]}var intersection=this.finiteLinesIntersect(currentLineStartX,currentLineStartY,currentLineEndX,currentLineEndY,nextLineStartX,nextLineStartY,nextLineEndX,nextLineEndY,true);vertices[i*2]=intersection[0];vertices[i*2+1]=intersection[1]}return vertices};math.expandPolygon=function(points,pad){var expandedLineSet=new Array(points.length*2);var currentPointX,currentPointY,nextPointX,nextPointY;for(var i=0;i<points.length/2;i++){currentPointX=points[i*2];currentPointY=points[i*2+1];if(i<points.length/2-1){nextPointX=points[(i+1)*2];nextPointY=points[(i+1)*2+1]}else{nextPointX=points[0];nextPointY=points[1]}var offsetX=nextPointY-currentPointY;var offsetY=-(nextPointX-currentPointX);var offsetLength=Math.sqrt(offsetX*offsetX+offsetY*offsetY);var normalizedOffsetX=offsetX/offsetLength;var normalizedOffsetY=offsetY/offsetLength;expandedLineSet[i*4]=currentPointX+normalizedOffsetX*pad;expandedLineSet[i*4+1]=currentPointY+normalizedOffsetY*pad;expandedLineSet[i*4+2]=nextPointX+normalizedOffsetX*pad;expandedLineSet[i*4+3]=nextPointY+normalizedOffsetY*pad}return expandedLineSet};math.intersectLineEllipse=function(x,y,centerX,centerY,ellipseWradius,ellipseHradius){var dispX=centerX-x;var dispY=centerY-y;dispX/=ellipseWradius;dispY/=ellipseHradius;var len=Math.sqrt(dispX*dispX+dispY*dispY);var newLength=len-1;if(newLength<0){return[]}var lenProportion=newLength/len;return[(centerX-x)*lenProportion+x,(centerY-y)*lenProportion+y]};math.intersectLineCircle=function(x1,y1,x2,y2,centerX,centerY,radius){var d=[x2-x1,y2-y1];var c=[centerX,centerY];var f=[x1-centerX,y1-centerY];var a=d[0]*d[0]+d[1]*d[1];var b=2*(f[0]*d[0]+f[1]*d[1]);var c=f[0]*f[0]+f[1]*f[1]-radius*radius;var discriminant=b*b-4*a*c;if(discriminant<0){return[]}var t1=(-b+Math.sqrt(discriminant))/(2*a);var t2=(-b-Math.sqrt(discriminant))/(2*a);var tMin=Math.min(t1,t2);var tMax=Math.max(t1,t2);var inRangeParams=[];if(tMin>=0&&tMin<=1){inRangeParams.push(tMin)}if(tMax>=0&&tMax<=1){inRangeParams.push(tMax)}if(inRangeParams.length===0){return[]}var nearIntersectionX=inRangeParams[0]*d[0]+x1;var nearIntersectionY=inRangeParams[0]*d[1]+y1;if(inRangeParams.length>1){if(inRangeParams[0]==inRangeParams[1]){return[nearIntersectionX,nearIntersectionY]}else{var farIntersectionX=inRangeParams[1]*d[0]+x1;var farIntersectionY=inRangeParams[1]*d[1]+y1;return[nearIntersectionX,nearIntersectionY,farIntersectionX,farIntersectionY]}}else{return[nearIntersectionX,nearIntersectionY]}};math.findCircleNearPoint=function(centerX,centerY,radius,farX,farY){var displacementX=farX-centerX;var displacementY=farY-centerY;var distance=Math.sqrt(displacementX*displacementX+displacementY*displacementY);var unitDisplacementX=displacementX/distance;var unitDisplacementY=displacementY/distance;return[centerX+unitDisplacementX*radius,centerY+unitDisplacementY*radius]};math.findMaxSqDistanceToOrigin=function(points){var maxSqDistance=1e-6;var sqDistance;for(var i=0;i<points.length/2;i++){sqDistance=points[i*2]*points[i*2]+points[i*2+1]*points[i*2+1];if(sqDistance>maxSqDistance){maxSqDistance=sqDistance}}return maxSqDistance};math.midOfThree=function(a,b,c){if(b<=a&&a<=c||c<=a&&a<=b){return a}else if(a<=b&&b<=c||c<=b&&b<=a){return b}else{return c}};math.finiteLinesIntersect=function(x1,y1,x2,y2,x3,y3,x4,y4,infiniteLines){var dx13=x1-x3;var dx21=x2-x1;var dx43=x4-x3;var dy13=y1-y3;var dy21=y2-y1;var dy43=y4-y3;var ua_t=dx43*dy13-dy43*dx13;var ub_t=dx21*dy13-dy21*dx13;var u_b=dy43*dx21-dx43*dy21;if(u_b!==0){var ua=ua_t/u_b;var ub=ub_t/u_b;var flptThreshold=.001;var min=0-flptThreshold;var max=1+flptThreshold;if(min<=ua&&ua<=max&&min<=ub&&ub<=max){return[x1+ua*dx21,y1+ua*dy21]}else{if(!infiniteLines){return[]}else{return[x1+ua*dx21,y1+ua*dy21]}}}else{if(ua_t===0||ub_t===0){if(this.midOfThree(x1,x2,x4)===x4){return[x4,y4]}if(this.midOfThree(x1,x2,x3)===x3){return[x3,y3]}if(this.midOfThree(x3,x4,x2)===x2){return[x2,y2]}return[]}else{return[]}}};math.polygonIntersectLine=function(x,y,basePoints,centerX,centerY,width,height,padding){var intersections=[];var intersection;var transformedPoints=new Array(basePoints.length);for(var i=0;i<transformedPoints.length/2;i++){transformedPoints[i*2]=basePoints[i*2]*width+centerX;transformedPoints[i*2+1]=basePoints[i*2+1]*height+centerY}var points;if(padding>0){var expandedLineSet=math.expandPolygon(transformedPoints,-padding);points=math.joinLines(expandedLineSet)}else{points=transformedPoints}var currentX,currentY,nextX,nextY;for(var i=0;i<points.length/2;i++){currentX=points[i*2];currentY=points[i*2+1];if(i<points.length/2-1){nextX=points[(i+1)*2];nextY=points[(i+1)*2+1]}else{nextX=points[0];nextY=points[1]}intersection=this.finiteLinesIntersect(x,y,centerX,centerY,currentX,currentY,nextX,nextY);if(intersection.length!==0){intersections.push(intersection[0],intersection[1])}}return intersections};math.shortenIntersection=function(intersection,offset,amount){var disp=[intersection[0]-offset[0],intersection[1]-offset[1]];var length=Math.sqrt(disp[0]*disp[0]+disp[1]*disp[1]);var lenRatio=(length-amount)/length;if(lenRatio<0){lenRatio=1e-5}return[offset[0]+lenRatio*disp[0],offset[1]+lenRatio*disp[1]]};math.generateUnitNgonPointsFitToSquare=function(sides,rotationRadians){var points=math.generateUnitNgonPoints(sides,rotationRadians);points=math.fitPolygonToSquare(points);return points};math.fitPolygonToSquare=function(points){var x,y;var sides=points.length/2;var minX=Infinity,minY=Infinity,maxX=-Infinity,maxY=-Infinity;for(var i=0;i<sides;i++){x=points[2*i];y=points[2*i+1];minX=Math.min(minX,x);maxX=Math.max(maxX,x);minY=Math.min(minY,y);maxY=Math.max(maxY,y)}var sx=2/(maxX-minX);var sy=2/(maxY-minY);for(var i=0;i<sides;i++){x=points[2*i]=points[2*i]*sx;y=points[2*i+1]=points[2*i+1]*sy;minX=Math.min(minX,x);maxX=Math.max(maxX,x);minY=Math.min(minY,y);maxY=Math.max(maxY,y)}if(minY<-1){for(var i=0;i<sides;i++){y=points[2*i+1]=points[2*i+1]+(-1-minY)}}return points};math.generateUnitNgonPoints=function(sides,rotationRadians){var increment=1/sides*2*Math.PI;var startAngle=sides%2===0?Math.PI/2+increment/2:Math.PI/2;startAngle+=rotationRadians;var points=new Array(sides*2);var currentAngle,x,y;for(var i=0;i<sides;i++){currentAngle=i*increment+startAngle;x=points[2*i]=Math.cos(currentAngle);y=points[2*i+1]=Math.sin(-currentAngle)}return points};math.getRoundRectangleRadius=function(width,height){return Math.min(width/4,height/4,8)};module.exports=math},{}],120:[function(require,module,exports){(function(setImmediate){"use strict";var STATE_PENDING=0;var STATE_FULFILLED=1;var STATE_REJECTED=2;var api=function(executor){if(!(this instanceof api))return new api(executor);this.id="Thenable/1.0.7";this.state=STATE_PENDING;this.fulfillValue=undefined;this.rejectReason=undefined;this.onFulfilled=[];this.onRejected=[];this.proxy={then:this.then.bind(this)};if(typeof executor==="function")executor.call(this,this.fulfill.bind(this),this.reject.bind(this))};api.prototype={fulfill:function(value){return deliver(this,STATE_FULFILLED,"fulfillValue",value)},reject:function(value){return deliver(this,STATE_REJECTED,"rejectReason",value)},then:function(onFulfilled,onRejected){var curr=this;var next=new api;curr.onFulfilled.push(resolver(onFulfilled,next,"fulfill"));curr.onRejected.push(resolver(onRejected,next,"reject"));execute(curr);return next.proxy}};var deliver=function(curr,state,name,value){if(curr.state===STATE_PENDING){curr.state=state;curr[name]=value;execute(curr)}return curr};var execute=function(curr){if(curr.state===STATE_FULFILLED)execute_handlers(curr,"onFulfilled",curr.fulfillValue);else if(curr.state===STATE_REJECTED)execute_handlers(curr,"onRejected",curr.rejectReason)};var execute_handlers=function(curr,name,value){if(curr[name].length===0)return;var handlers=curr[name];curr[name]=[];var func=function(){for(var i=0;i<handlers.length;i++)handlers[i](value)};if(typeof setImmediate==="function")setImmediate(func);else setTimeout(func,0)};var resolver=function(cb,next,method){return function(value){if(typeof cb!=="function")next[method].call(next,value);else{var result;try{result=cb(value)}catch(e){next.reject(e);return}resolve(next,result)}}};var resolve=function(promise,x){if(promise===x||promise.proxy===x){promise.reject(new TypeError("cannot resolve promise with itself"));return}var then;if(typeof x==="object"&&x!==null||typeof x==="function"){try{then=x.then}catch(e){promise.reject(e);return}}if(typeof then==="function"){var resolved=false;try{then.call(x,function(y){if(resolved)return;resolved=true;if(y===x)promise.reject(new TypeError("circular thenable chain"));else resolve(promise,y)},function(r){if(resolved)return;resolved=true;promise.reject(r)})}catch(e){if(!resolved)promise.reject(e)}return}promise.fulfill(x)};api.all=function(ps){return new api(function(resolveAll,rejectAll){var vals=new Array(ps.length);var doneCount=0;var fulfill=function(i,val){vals[i]=val;doneCount++;if(doneCount===ps.length){resolveAll(vals)}};for(var i=0;i<ps.length;i++){(function(i){var p=ps[i];var isPromise=p!=null&&p.then!=null;if(isPromise){p.then(function(val){fulfill(i,val)},function(err){rejectAll(err)})}else{var val=p;fulfill(i,val)}})(i)}})};api.resolve=function(val){return new api(function(resolve,reject){resolve(val)})};api.reject=function(val){return new api(function(resolve,reject){reject(val)})};module.exports=typeof Promise!=="undefined"?Promise:api}).call(this,require("timers").setImmediate)},{timers:208}],121:[function(require,module,exports){"use strict";var is=require("./is");var util=require("./util");var Selector=function(selector){if(!(this instanceof Selector)){return new Selector(selector)}var self=this;self._private={selectorText:null,invalid:true};var newQuery=function(){return{classes:[],colonSelectors:[],data:[],group:null,ids:[],meta:[],collection:null,filter:null,parent:null,ancestor:null,subject:null,child:null,descendant:null}};if(!selector||is.string(selector)&&selector.match(/^\s*$/)){self.length=0}else if(selector==="*"||selector==="edge"||selector==="node"){self[0]=newQuery();self[0].group=selector==="*"?selector:selector+"s";self[0].groupOnly=true;self._private.invalid=false;self._private.selectorText=selector;self.length=1}else if(is.elementOrCollection(selector)){var collection=selector.collection();self[0]=newQuery();self[0].collection=collection;self.length=1}else if(is.fn(selector)){self[0]=newQuery();self[0].filter=selector;self.length=1}else if(is.string(selector)){var currentSubject=null;var tokens={metaChar:"[\\!\\\"\\#\\$\\%\\&\\'\\(\\)\\*\\+\\,\\.\\/\\:\\;\\<\\=\\>\\?\\@\\[\\]\\^\\`\\{\\|\\}\\~]",comparatorOp:"=|\\!=|>|>=|<|<=|\\$=|\\^=|\\*=",boolOp:"\\?|\\!|\\^",string:'"(?:\\\\"|[^"])+"'+"|"+"'(?:\\\\'|[^'])+'",number:util.regex.number,meta:"degree|indegree|outdegree",separator:"\\s*,\\s*",descendant:"\\s+",child:"\\s+>\\s+",subject:"\\$"};tokens.variable="(?:[\\w-]|(?:\\\\"+tokens.metaChar+"))+";tokens.value=tokens.string+"|"+tokens.number;tokens.className=tokens.variable;tokens.id=tokens.variable;var cleanMetaChars=function(str){return str.replace(new RegExp("\\\\("+tokens.metaChar+")","g"),function(match,$1,offset,original){return $1})};var ops=tokens.comparatorOp.split("|");for(var i=0;i<ops.length;i++){var op=ops[i];tokens.comparatorOp+="|@"+op}var ops=tokens.comparatorOp.split("|");for(var i=0;i<ops.length;i++){var op=ops[i];if(op.indexOf("!")>=0){continue}if(op==="="){continue}tokens.comparatorOp+="|\\!"+op}var exprs=[{name:"group",query:true,regex:"(node|edge|\\*)",populate:function(group){this.group=group==="*"?group:group+"s"}},{name:"state",query:true,regex:"(:selected|:unselected|:locked|:unlocked|:visible|:hidden|:transparent|:grabbed|:free|:removed|:inside|:grabbable|:ungrabbable|:animated|:unanimated|:selectable|:unselectable|:orphan|:nonorphan|:parent|:child|:loop|:simple|:active|:inactive|:touch|:backgrounding|:nonbackgrounding)",populate:function(state){this.colonSelectors.push(state)}},{name:"id",query:true,regex:"\\#("+tokens.id+")",populate:function(id){this.ids.push(cleanMetaChars(id))}},{name:"className",query:true,regex:"\\.("+tokens.className+")",populate:function(className){this.classes.push(cleanMetaChars(className))}},{name:"dataExists",query:true,regex:"\\[\\s*("+tokens.variable+")\\s*\\]",populate:function(variable){this.data.push({field:cleanMetaChars(variable)})}},{name:"dataCompare",query:true,regex:"\\[\\s*("+tokens.variable+")\\s*("+tokens.comparatorOp+")\\s*("+tokens.value+")\\s*\\]",populate:function(variable,comparatorOp,value){var valueIsString=new RegExp("^"+tokens.string+"$").exec(value)!=null;if(valueIsString){value=value.substring(1,value.length-1)}else{value=parseFloat(value)}this.data.push({field:cleanMetaChars(variable),operator:comparatorOp,value:value})}},{name:"dataBool",query:true,regex:"\\[\\s*("+tokens.boolOp+")\\s*("+tokens.variable+")\\s*\\]",populate:function(boolOp,variable){this.data.push({field:cleanMetaChars(variable),operator:boolOp})}},{name:"metaCompare",query:true,regex:"\\[\\[\\s*("+tokens.meta+")\\s*("+tokens.comparatorOp+")\\s*("+tokens.number+")\\s*\\]\\]",populate:function(meta,comparatorOp,number){this.meta.push({field:cleanMetaChars(meta),operator:comparatorOp,value:parseFloat(number)})}},{name:"nextQuery",separator:true,regex:tokens.separator,populate:function(){self[++i]=newQuery();currentSubject=null}},{name:"child",separator:true,regex:tokens.child,populate:function(){var childQuery=newQuery();childQuery.parent=this;childQuery.subject=currentSubject;self[i]=childQuery}},{name:"descendant",separator:true,regex:tokens.descendant,populate:function(){var descendantQuery=newQuery();descendantQuery.ancestor=this;descendantQuery.subject=currentSubject;self[i]=descendantQuery}},{name:"subject",modifier:true,regex:tokens.subject,populate:function(){if(currentSubject!=null&&this.subject!=this){util.error("Redefinition of subject in selector `"+selector+"`");return false}currentSubject=this;this.subject=this}}];self._private.selectorText=selector;var remaining=selector;var i=0;var consumeExpr=function(expectation){var expr;var match;var name;for(var j=0;j<exprs.length;j++){var e=exprs[j];var n=e.name;if(is.fn(expectation)&&!expectation(n,e)){continue}var m=remaining.match(new RegExp("^"+e.regex));if(m!=null){match=m;expr=e;name=n;var consumed=m[0];remaining=remaining.substring(consumed.length);break}}return{expr:expr,match:match,name:name}};var consumeWhitespace=function(){var match=remaining.match(/^\s+/);if(match){var consumed=match[0];remaining=remaining.substring(consumed.length)}};self[0]=newQuery();consumeWhitespace();for(;;){var check=consumeExpr();if(check.expr==null){util.error("The selector `"+selector+"`is invalid");return}else{var args=[];for(var j=1;j<check.match.length;j++){args.push(check.match[j])}var ret=check.expr.populate.apply(self[i],args);if(ret===false){return}}if(remaining.match(/^\s*$/)){break}}self.length=i+1;for(var j=0;j<self.length;j++){var query=self[j];if(query.subject!=null){for(;;){if(query.subject==query){break}if(query.parent!=null){var parent=query.parent;var child=query;child.parent=null;parent.child=child;query=parent}else if(query.ancestor!=null){var ancestor=query.ancestor;var descendant=query;descendant.ancestor=null;ancestor.descendant=descendant;query=ancestor}else{util.error("When adjusting references for the selector `"+query+"`, neither parent nor ancestor was found");break}}self[j]=query.subject}}}else{util.error("A selector must be created from a string; found "+selector);return}self._private.invalid=false};var selfn=Selector.prototype;selfn.size=function(){return this.length};selfn.eq=function(i){return this[i]};var queryMatches=function(query,ele){var ele_p=ele._private;if(query.groupOnly){return query.group==="*"||query.group===ele_p.group}if(query.group!=null&&query.group!="*"&&query.group!=ele_p.group){return false}var cy=ele.cy();var allColonSelectorsMatch=true;for(var k=0;k<query.colonSelectors.length;k++){var sel=query.colonSelectors[k];switch(sel){case":selected":allColonSelectorsMatch=ele.selected();break;case":unselected":allColonSelectorsMatch=!ele.selected();break;case":selectable":allColonSelectorsMatch=ele.selectable();break;case":unselectable":allColonSelectorsMatch=!ele.selectable();break;case":locked":allColonSelectorsMatch=ele.locked();break;case":unlocked":allColonSelectorsMatch=!ele.locked();break;case":visible":allColonSelectorsMatch=ele.visible();break;case":hidden":allColonSelectorsMatch=!ele.visible();break;case":transparent":allColonSelectorsMatch=ele.transparent();break;case":grabbed":allColonSelectorsMatch=ele.grabbed();break;case":free":allColonSelectorsMatch=!ele.grabbed();break;case":removed":allColonSelectorsMatch=ele.removed();break;case":inside":allColonSelectorsMatch=!ele.removed();break;case":grabbable":allColonSelectorsMatch=ele.grabbable();break;case":ungrabbable":allColonSelectorsMatch=!ele.grabbable();break;case":animated":allColonSelectorsMatch=ele.animated();break;case":unanimated":allColonSelectorsMatch=!ele.animated();break;case":parent":allColonSelectorsMatch=ele.isNode()&&ele.children().nonempty();break;case":child":case":nonorphan":allColonSelectorsMatch=ele.isNode()&&ele.parent().nonempty();break;case":orphan":allColonSelectorsMatch=ele.isNode()&&ele.parent().empty();break;case":loop":allColonSelectorsMatch=ele.isEdge()&&ele.data("source")===ele.data("target");break;case":simple":allColonSelectorsMatch=ele.isEdge()&&ele.data("source")!==ele.data("target");break;case":active":allColonSelectorsMatch=ele.active();break;case":inactive":allColonSelectorsMatch=!ele.active();break;case":touch":allColonSelectorsMatch=is.touch();break;case":backgrounding":allColonSelectorsMatch=ele.backgrounding();break;case":nonbackgrounding":allColonSelectorsMatch=!ele.backgrounding();break}if(!allColonSelectorsMatch)break}if(!allColonSelectorsMatch)return false;var allIdsMatch=true;for(var k=0;k<query.ids.length;k++){var id=query.ids[k];var actualId=ele_p.data.id;allIdsMatch=allIdsMatch&&id==actualId;if(!allIdsMatch)break}if(!allIdsMatch)return false;var allClassesMatch=true;for(var k=0;k<query.classes.length;k++){var cls=query.classes[k];allClassesMatch=allClassesMatch&&ele.hasClass(cls);if(!allClassesMatch)break}if(!allClassesMatch)return false;var operandsMatch=function(params){var allDataMatches=true;for(var k=0;k<query[params.name].length;k++){var data=query[params.name][k];var operator=data.operator;var value=data.value;var field=data.field;var matches;if(operator!=null&&value!=null){var fieldVal=params.fieldValue(field);var fieldStr=!is.string(fieldVal)&&!is.number(fieldVal)?"":""+fieldVal;var valStr=""+value;var caseInsensitive=false;if(operator.indexOf("@")>=0){fieldStr=fieldStr.toLowerCase();valStr=valStr.toLowerCase();operator=operator.replace("@","");caseInsensitive=true}var notExpr=false;if(operator.indexOf("!")>=0){operator=operator.replace("!","");notExpr=true}if(caseInsensitive){value=valStr.toLowerCase();fieldVal=fieldStr.toLowerCase()}var isIneqCmp=false;switch(operator){case"*=":matches=fieldStr.indexOf(valStr)>=0;break;case"$=":matches=fieldStr.indexOf(valStr,fieldStr.length-valStr.length)>=0;break;case"^=":matches=fieldStr.indexOf(valStr)===0;break;case"=":matches=fieldVal===value;break;case">":isIneqCmp=true;matches=fieldVal>value;break;case">=":isIneqCmp=true;matches=fieldVal>=value;break;case"<":isIneqCmp=true;matches=fieldVal<value;break;case"<=":isIneqCmp=true;matches=fieldVal<=value;break;default:matches=false;break}if(notExpr&&(fieldVal!=null||!isIneqCmp)){matches=!matches}}else if(operator!=null){switch(operator){case"?":matches=params.fieldTruthy(field);break;case"!":matches=!params.fieldTruthy(field);break;case"^":matches=params.fieldUndefined(field);break}}else{matches=!params.fieldUndefined(field)}if(!matches){allDataMatches=false;break}}return allDataMatches};var allDataMatches=operandsMatch({name:"data",fieldValue:function(field){return ele_p.data[field]},fieldUndefined:function(field){return ele_p.data[field]===undefined},fieldTruthy:function(field){if(ele_p.data[field]){return true}return false}});if(!allDataMatches){return false}var allMetaMatches=operandsMatch({name:"meta",fieldValue:function(field){return ele[field]()},fieldUndefined:function(field){return ele[field]()==null},fieldTruthy:function(field){if(ele[field]()){return true}return false}});if(!allMetaMatches){return false}if(query.collection!=null){var matchesAny=query.collection.hasElementWithId(ele.id());if(!matchesAny){return false}}if(query.filter!=null&&ele.collection().filter(query.filter).size()===0){return false}var confirmRelations=function(query,eles){if(query!=null){var matches=false;if(!cy.hasCompoundNodes()){return false}eles=eles();for(var i=0;i<eles.length;i++){if(queryMatches(query,eles[i])){matches=true;break}}return matches}else{return true}};if(!confirmRelations(query.parent,function(){return ele.parent()})){return false}if(!confirmRelations(query.ancestor,function(){return ele.parents()})){return false}if(!confirmRelations(query.child,function(){return ele.children()})){return false}if(!confirmRelations(query.descendant,function(){return ele.descendants()})){return false}return true};selfn.filter=function(collection){var self=this;var cy=collection.cy();if(self._private.invalid){return cy.collection()}var selectorFunction=function(i,element){for(var j=0;j<self.length;j++){var query=self[j];if(queryMatches(query,element)){return true}}return false};if(self._private.selectorText==null){selectorFunction=function(){return true}}var filteredCollection=collection.filter(selectorFunction);return filteredCollection};selfn.matches=function(ele){var self=this;if(self._private.invalid){return false}for(var j=0;j<self.length;j++){var query=self[j];if(queryMatches(query,ele)){return true}}return false};selfn.toString=selfn.selector=function(){var str="";var clean=function(obj){if(obj==null){return""}else{return obj}};var cleanVal=function(val){if(is.string(val)){return'"'+val+'"'}else{return clean(val)}};var space=function(val){return" "+val+" "};var queryToString=function(query){var str="";if(query.subject===query){str+="$"}var group=clean(query.group);str+=group.substring(0,group.length-1);for(var j=0;j<query.data.length;j++){var data=query.data[j];if(data.value){str+="["+data.field+space(clean(data.operator))+cleanVal(data.value)+"]"}else{str+="["+clean(data.operator)+data.field+"]"}}for(var j=0;j<query.meta.length;j++){var meta=query.meta[j];str+="[["+meta.field+space(clean(meta.operator))+cleanVal(meta.value)+"]]"}for(var j=0;j<query.colonSelectors.length;j++){var sel=query.colonSelectors[i];str+=sel}for(var j=0;j<query.ids.length;j++){var sel="#"+query.ids[i];str+=sel}for(var j=0;j<query.classes.length;j++){var sel="."+query.classes[j];str+=sel}if(query.parent!=null){str=queryToString(query.parent)+" > "+str}if(query.ancestor!=null){str=queryToString(query.ancestor)+" "+str}if(query.child!=null){str+=" > "+queryToString(query.child)}if(query.descendant!=null){str+=" "+queryToString(query.descendant)}return str};for(var i=0;i<this.length;i++){var query=this[i];str+=queryToString(query);if(this.length>1&&i<this.length-1){str+=", "}}return str};module.exports=Selector},{"./is":117,"./util":134}],122:[function(require,module,exports){"use strict";var util=require("../util");var is=require("../is");var styfn={};styfn.apply=function(eles){var self=this;var _p=self._private;if(_p.newStyle){_p.contextStyles={};_p.propDiffs={};self.cleanElements(eles,true)}for(var ie=0;ie<eles.length;ie++){var ele=eles[ie];var cxtMeta=self.getContextMeta(ele);var cxtStyle=self.getContextStyle(cxtMeta);var app=self.applyContextStyle(cxtMeta,cxtStyle,ele);self.updateTransitions(ele,app.diffProps);self.updateStyleHints(ele)}_p.newStyle=false};styfn.getPropertiesDiff=function(oldCxtKey,newCxtKey){var self=this;var cache=self._private.propDiffs=self._private.propDiffs||{};var dualCxtKey=oldCxtKey+"-"+newCxtKey;var cachedVal=cache[dualCxtKey];if(cachedVal){return cachedVal}var diffProps=[];var addedProp={};for(var i=0;i<self.length;i++){var cxt=self[i];var oldHasCxt=oldCxtKey[i]==="t";var newHasCxt=newCxtKey[i]==="t";var cxtHasDiffed=oldHasCxt!==newHasCxt;var cxtHasMappedProps=cxt.mappedProperties.length>0;if(cxtHasDiffed||cxtHasMappedProps){var props;if(cxtHasDiffed&&cxtHasMappedProps){props=cxt.properties}else if(cxtHasDiffed){props=cxt.properties}else if(cxtHasMappedProps){props=cxt.mappedProperties}for(var j=0;j<props.length;j++){var prop=props[j];var name=prop.name;var laterCxtOverrides=false;for(var k=i+1;k<self.length;k++){var laterCxt=self[k];var hasLaterCxt=newCxtKey[k]==="t";if(!hasLaterCxt){continue}laterCxtOverrides=laterCxt.properties[prop.name]!=null;if(laterCxtOverrides){break}}if(!addedProp[name]&&!laterCxtOverrides){addedProp[name]=true;diffProps.push(name)}}}}cache[dualCxtKey]=diffProps;return diffProps};styfn.getContextMeta=function(ele){var self=this;var cxtKey="";var diffProps;var prevKey=ele._private.styleCxtKey||"";if(self._private.newStyle){prevKey=""}for(var i=0;i<self.length;i++){var context=self[i];var contextSelectorMatches=context.selector&&context.selector.matches(ele);if(contextSelectorMatches){cxtKey+="t"}else{cxtKey+="f"}}diffProps=self.getPropertiesDiff(prevKey,cxtKey);ele._private.styleCxtKey=cxtKey;return{key:cxtKey,diffPropNames:diffProps}};styfn.getContextStyle=function(cxtMeta){var cxtKey=cxtMeta.key;var self=this;var cxtStyles=this._private.contextStyles=this._private.contextStyles||{};if(cxtStyles[cxtKey]){return cxtStyles[cxtKey]}var style={_private:{key:cxtKey}};for(var i=0;i<self.length;i++){var cxt=self[i];var hasCxt=cxtKey[i]==="t";if(!hasCxt){continue}for(var j=0;j<cxt.properties.length;j++){var prop=cxt.properties[j];var styProp=style[prop.name]=prop;styProp.context=cxt}}cxtStyles[cxtKey]=style;return style};styfn.applyContextStyle=function(cxtMeta,cxtStyle,ele){var self=this;var diffProps=cxtMeta.diffPropNames;var retDiffProps={};for(var i=0;i<diffProps.length;i++){var diffPropName=diffProps[i];var cxtProp=cxtStyle[diffPropName];var eleProp=ele.pstyle(diffPropName);if(!cxtProp){if(!eleProp){continue}else if(eleProp.bypass){cxtProp={name:diffPropName,deleteBypassed:true}}else{cxtProp={name:diffPropName,delete:true}}}if(eleProp===cxtProp){continue}var retDiffProp=retDiffProps[diffPropName]={prev:eleProp};self.applyParsedProperty(ele,cxtProp);retDiffProp.next=ele.pstyle(diffPropName);if(retDiffProp.next&&retDiffProp.next.bypass){retDiffProp.next=retDiffProp.next.bypassed}}return{diffProps:retDiffProps}};styfn.updateStyleHints=function(ele){var _p=ele._private;var self=this;if(ele.removed()){return}var hasPie=false;if(_p.group==="nodes"){for(var i=1;i<=self.pieBackgroundN;i++){var size=ele.pstyle("pie-"+i+"-background-size").value;if(size>0){hasPie=true;break}}}_p.hasPie=hasPie;var transform=ele.pstyle("text-transform").strValue;var content=ele.pstyle("label").strValue;var srcContent=ele.pstyle("source-label").strValue;var tgtContent=ele.pstyle("target-label").strValue;var fStyle=ele.pstyle("font-style").strValue;var size=ele.pstyle("font-size").pfValue+"px";var family=ele.pstyle("font-family").strValue;var weight=ele.pstyle("font-weight").strValue;var valign=ele.pstyle("text-valign").strValue;var halign=ele.pstyle("text-valign").strValue;var oWidth=ele.pstyle("text-outline-width").pfValue;var wrap=ele.pstyle("text-wrap").strValue;var wrapW=ele.pstyle("text-max-width").pfValue;var labelStyleKey=fStyle+"$"+size+"$"+family+"$"+weight+"$"+transform+"$"+valign+"$"+halign+"$"+oWidth+"$"+wrap+"$"+wrapW;_p.labelStyleKey=labelStyleKey;_p.sourceLabelKey=labelStyleKey+"$"+srcContent;_p.targetLabelKey=labelStyleKey+"$"+tgtContent;_p.labelKey=labelStyleKey+"$"+content;_p.fontKey=fStyle+"$"+weight+"$"+size+"$"+family;_p.styleKey=Date.now()};styfn.applyParsedProperty=function(ele,parsedProp){var self=this;var prop=parsedProp;var style=ele._private.style;var fieldVal,flatProp;var types=self.types;var type=self.properties[prop.name].type;var propIsBypass=prop.bypass;var origProp=style[prop.name];var origPropIsBypass=origProp&&origProp.bypass;var _p=ele._private;if(parsedProp.name==="curve-style"&&parsedProp.value==="haystack"&&ele.isEdge()&&(ele.isLoop()||ele.source().isParent()||ele.target().isParent())){prop=parsedProp=this.parse(parsedProp.name,"bezier",propIsBypass)}if(prop.delete){style[prop.name]=undefined;return true}if(prop.deleteBypassed){if(!origProp){return true}else if(origProp.bypass){origProp.bypassed=undefined;return true}else{return false}}if(prop.deleteBypass){if(!origProp){return true}else if(origProp.bypass){style[prop.name]=origProp.bypassed;return true}else{return false}}var printMappingErr=function(){util.error("Do not assign mappings to elements without corresponding data (e.g. ele `"+ele.id()+"` for property `"+prop.name+"` with data field `"+prop.field+"`); try a `["+prop.field+"]` selector to limit scope to elements with `"+prop.field+"` defined")};switch(prop.mapped){case types.mapData:case types.mapLayoutData:case types.mapScratch:var isLayout=prop.mapped===types.mapLayoutData;var isScratch=prop.mapped===types.mapScratch;var fields=prop.field.split(".");var fieldVal;if(isScratch||isLayout){fieldVal=_p.scratch}else{fieldVal=_p.data}for(var i=0;i<fields.length&&fieldVal;i++){var field=fields[i];fieldVal=fieldVal[field]}var percent;if(!is.number(fieldVal)){percent=0}else{percent=(fieldVal-prop.fieldMin)/(prop.fieldMax-prop.fieldMin)}if(percent<0){percent=0}else if(percent>1){percent=1}if(type.color){var r1=prop.valueMin[0];var r2=prop.valueMax[0];var g1=prop.valueMin[1];var g2=prop.valueMax[1];var b1=prop.valueMin[2];var b2=prop.valueMax[2];var a1=prop.valueMin[3]==null?1:prop.valueMin[3];var a2=prop.valueMax[3]==null?1:prop.valueMax[3];var clr=[Math.round(r1+(r2-r1)*percent),Math.round(g1+(g2-g1)*percent),Math.round(b1+(b2-b1)*percent),Math.round(a1+(a2-a1)*percent)];flatProp={bypass:prop.bypass,name:prop.name,value:clr,strValue:"rgb("+clr[0]+", "+clr[1]+", "+clr[2]+")"}}else if(type.number){var calcValue=prop.valueMin+(prop.valueMax-prop.valueMin)*percent;flatProp=this.parse(prop.name,calcValue,prop.bypass,true)}else{return false}if(!flatProp){flatProp=this.parse(prop.name,origProp.strValue,prop.bypass,true)}if(!flatProp){printMappingErr()}flatProp.mapping=prop;prop=flatProp;break;case types.data:case types.layoutData:case types.scratch:var isLayout=prop.mapped===types.layoutData;var isScratch=prop.mapped===types.scratch;var fields=prop.field.split(".");var fieldVal;if(isScratch||isLayout){fieldVal=_p.scratch}else{fieldVal=_p.data}if(fieldVal){for(var i=0;i<fields.length;i++){var field=fields[i];fieldVal=fieldVal[field]}}flatProp=this.parse(prop.name,fieldVal,prop.bypass,true);if(!flatProp){var flatPropVal=origProp?origProp.strValue:"";flatProp=this.parse(prop.name,flatPropVal,prop.bypass,true)}if(!flatProp){printMappingErr()}flatProp.mapping=prop;prop=flatProp;break;case types.fn:var fn=prop.value;var fnRetVal=fn(ele);flatProp=this.parse(prop.name,fnRetVal,prop.bypass,true);flatProp.mapping=prop;prop=flatProp;break;case undefined:break;default:return false}if(propIsBypass){if(origPropIsBypass){prop.bypassed=origProp.bypassed}else{prop.bypassed=origProp}style[prop.name]=prop}else{if(origPropIsBypass){origProp.bypassed=prop}else{style[prop.name]=prop}}return true};styfn.cleanElements=function(eles,keepBypasses){var self=this;var props=self.properties;for(var i=0;i<eles.length;i++){var ele=eles[i];if(!keepBypasses){ele._private.style={}}else{var style=ele._private.style;for(var j=0;j<props.length;j++){var prop=props[j];var eleProp=style[prop.name];if(eleProp){if(eleProp.bypass){eleProp.bypassed=null}else{style[prop.name]=null}}}}}};styfn.update=function(){var cy=this._private.cy;var eles=cy.mutableElements();eles.updateStyle()};styfn.updateMappers=function(eles){var self=this;for(var i=0;i<eles.length;i++){var ele=eles[i];var style=ele._private.style;for(var j=0;j<self.properties.length;j++){var prop=self.properties[j];var propInStyle=style[prop.name];if(propInStyle&&propInStyle.mapping){var mapping=propInStyle.mapping;this.applyParsedProperty(ele,mapping)}}this.updateStyleHints(ele)}};styfn.updateTransitions=function(ele,diffProps,isBypass){var self=this;var _p=ele._private;var props=ele.pstyle("transition-property").value;var duration=ele.pstyle("transition-duration").pfValue;var delay=ele.pstyle("transition-delay").pfValue;if(props.length>0&&duration>0){var css={};var anyPrev=false;for(var i=0;i<props.length;i++){var prop=props[i];var styProp=ele.pstyle(prop);var diffProp=diffProps[prop];if(!diffProp){continue}var prevProp=diffProp.prev;var fromProp=prevProp;var toProp=diffProp.next!=null?diffProp.next:styProp;var diff=false;var initVal;var initDt=1e-6;if(!fromProp){continue}if(is.number(fromProp.pfValue)&&is.number(toProp.pfValue)){diff=toProp.pfValue-fromProp.pfValue;initVal=fromProp.pfValue+initDt*diff}else if(is.number(fromProp.value)&&is.number(toProp.value)){diff=toProp.value-fromProp.value;initVal=fromProp.value+initDt*diff}else if(is.array(fromProp.value)&&is.array(toProp.value)){diff=fromProp.value[0]!==toProp.value[0]||fromProp.value[1]!==toProp.value[1]||fromProp.value[2]!==toProp.value[2];initVal=fromProp.strValue}if(diff){css[prop]=toProp.strValue;this.applyBypass(ele,prop,initVal);anyPrev=true}}if(!anyPrev){return}_p.transitioning=true;ele.stop();if(delay>0){ele.delay(delay)}ele.animate({css:css},{duration:duration,easing:ele.pstyle("transition-timing-function").value,queue:false,complete:function(){if(!isBypass){self.removeBypasses(ele,props)}_p.transitioning=false}})}else if(_p.transitioning){ele.stop();this.removeBypasses(ele,props);_p.transitioning=false}};module.exports=styfn},{"../is":117,"../util":134}],123:[function(require,module,exports){"use strict";var is=require("../is");var util=require("../util");var styfn={};styfn.applyBypass=function(eles,name,value,updateTransitions){var self=this;var props=[];var isBypass=true;if(name==="*"||name==="**"){if(value!==undefined){for(var i=0;i<self.properties.length;i++){var prop=self.properties[i];var name=prop.name;var parsedProp=this.parse(name,value,true);if(parsedProp){props.push(parsedProp)}}}}else if(is.string(name)){var parsedProp=this.parse(name,value,true);if(parsedProp){props.push(parsedProp)}}else if(is.plainObject(name)){var specifiedProps=name;updateTransitions=value;for(var i=0;i<self.properties.length;i++){var prop=self.properties[i];var name=prop.name;var value=specifiedProps[name];if(value===undefined){value=specifiedProps[util.dash2camel(name)]}if(value!==undefined){var parsedProp=this.parse(name,value,true);if(parsedProp){props.push(parsedProp)}}}}else{return false}if(props.length===0){return false}var ret=false;for(var i=0;i<eles.length;i++){var ele=eles[i];var diffProps={};var diffProp;for(var j=0;j<props.length;j++){var prop=props[j];if(updateTransitions){var prevProp=ele.pstyle(prop.name);diffProp=diffProps[prop.name]={prev:prevProp}}ret=this.applyParsedProperty(ele,prop)||ret;if(updateTransitions){diffProp.next=ele.pstyle(prop.name)}}if(ret){this.updateStyleHints(ele)}if(updateTransitions){this.updateTransitions(ele,diffProps,isBypass)}}return ret};styfn.overrideBypass=function(eles,name,value){name=util.camel2dash(name);for(var i=0;i<eles.length;i++){var ele=eles[i];var prop=ele._private.style[name];var type=this.properties[name].type;var isColor=type.color;var isMulti=type.mutiple;if(!prop||!prop.bypass){this.applyBypass(ele,name,value);continue}prop.value=value;if(prop.pfValue!=null){prop.pfValue=value}if(isColor){prop.strValue="rgb("+value.join(",")+")"}else if(isMulti){prop.strValue=value.join(" ")}else{prop.strValue=""+value}}};styfn.removeAllBypasses=function(eles,updateTransitions){return this.removeBypasses(eles,this.propertyNames,updateTransitions)};styfn.removeBypasses=function(eles,props,updateTransitions){var isBypass=true;for(var j=0;j<eles.length;j++){var ele=eles[j];var diffProps={};for(var i=0;i<props.length;i++){var name=props[i];var prop=this.properties[name];var prevProp=ele.pstyle(prop.name);if(!prevProp||!prevProp.bypass){continue}var value="";var parsedProp=this.parse(name,value,true);var diffProp=diffProps[prop.name]={prev:prevProp};this.applyParsedProperty(ele,parsedProp);diffProp.next=ele.pstyle(prop.name)}this.updateStyleHints(ele);if(updateTransitions){this.updateTransitions(ele,diffProps,isBypass)}}};module.exports=styfn},{"../is":117,"../util":134}],124:[function(require,module,exports){"use strict";var window=require("../window");var styfn={};styfn.getEmSizeInPixels=function(){var px=this.containerCss("font-size");if(px!=null){return parseFloat(px)}else{return 1}};styfn.containerCss=function(propName){var cy=this._private.cy;var domElement=cy.container();if(window&&domElement&&window.getComputedStyle){return window.getComputedStyle(domElement).getPropertyValue(propName)}};module.exports=styfn},{"../window":141}],125:[function(require,module,exports){"use strict";var util=require("../util");var is=require("../is");var styfn={};styfn.getRenderedStyle=function(ele){return this.getRawStyle(ele,true)};styfn.getRawStyle=function(ele,isRenderedVal){var self=this;var ele=ele[0];if(ele){var rstyle={};for(var i=0;i<self.properties.length;i++){var prop=self.properties[i];var val=self.getStylePropertyValue(ele,prop.name,isRenderedVal);if(val){rstyle[prop.name]=val;rstyle[util.dash2camel(prop.name)]=val}}return rstyle}};styfn.getStylePropertyValue=function(ele,propName,isRenderedVal){var self=this;var ele=ele[0];if(ele){var prop=self.properties[propName];var type=prop.type;var styleProp=ele.pstyle(prop.name);var zoom=ele.cy().zoom();if(styleProp){var units=styleProp.units?type.implicitUnits||"px":null;var val=units?[].concat(styleProp.pfValue).map(function(pfValue){return pfValue*(isRenderedVal?zoom:1)+units}).join(" "):styleProp.strValue;return val}}};styfn.getAnimationStartStyle=function(ele,aniProps){var rstyle={};for(var i=0;i<aniProps.length;i++){var aniProp=aniProps[i];var name=aniProp.name;var styleProp=ele.pstyle(name);if(styleProp!==undefined){if(is.plainObject(styleProp)){styleProp=this.parse(name,styleProp.strValue)}else{styleProp=this.parse(name,styleProp)}}if(styleProp){rstyle[name]=styleProp}}return rstyle};styfn.getPropsList=function(propsObj){var self=this;var rstyle=[];var style=propsObj;var props=self.properties;if(style){var names=Object.keys(style);for(var i=0;i<names.length;i++){var name=names[i];var val=style[name];var prop=props[name]||props[util.camel2dash(name)];var styleProp=this.parse(prop.name,val);rstyle.push(styleProp)}}return rstyle};module.exports=styfn},{"../is":117,"../util":134}],126:[function(require,module,exports){"use strict";var is=require("../is");var util=require("../util");var Selector=require("../selector");var Style=function(cy){if(!(this instanceof Style)){return new Style(cy)}if(!is.core(cy)){util.error("A style must have a core reference");return}this._private={cy:cy,coreStyle:{}};this.length=0;this.resetToDefault()};var styfn=Style.prototype;styfn.instanceString=function(){return"style"};styfn.clear=function(){for(var i=0;i<this.length;i++){this[i]=undefined}this.length=0;var _p=this._private;_p.newStyle=true;return this};styfn.resetToDefault=function(){this.clear();this.addDefaultStylesheet();return this};styfn.core=function(){return this._private.coreStyle};styfn.selector=function(selectorStr){var selector=selectorStr==="core"?null:new Selector(selectorStr);var i=this.length++;this[i]={selector:selector,properties:[],mappedProperties:[],index:i};return this};styfn.css=function(){var self=this;var args=arguments;switch(args.length){case 1:var map=args[0];for(var i=0;i<self.properties.length;i++){var prop=self.properties[i];var mapVal=map[prop.name];if(mapVal===undefined){mapVal=map[util.dash2camel(prop.name)]}if(mapVal!==undefined){this.cssRule(prop.name,mapVal)}}break;case 2:this.cssRule(args[0],args[1]);break;default:break}return this};styfn.style=styfn.css;styfn.cssRule=function(name,value){var property=this.parse(name,value);if(property){var i=this.length-1;this[i].properties.push(property);this[i].properties[property.name]=property;if(property.name.match(/pie-(\d+)-background-size/)&&property.value){this._private.hasPie=true}if(property.mapped){this[i].mappedProperties.push(property)}var currentSelectorIsCore=!this[i].selector;if(currentSelectorIsCore){this._private.coreStyle[property.name]=property}}return this};Style.fromJson=function(cy,json){var style=new Style(cy);style.fromJson(json);return style};Style.fromString=function(cy,string){return new Style(cy).fromString(string)};[require("./apply"),require("./bypass"),require("./container"),require("./get-for-ele"),require("./json"),require("./string-sheet"),require("./properties"),require("./parse")].forEach(function(props){util.extend(styfn,props)});Style.types=styfn.types;Style.properties=styfn.properties;module.exports=Style},{"../is":117,"../selector":121,"../util":134,"./apply":122,"./bypass":123,"./container":124,"./get-for-ele":125,"./json":127,"./parse":128,"./properties":129,"./string-sheet":130}],127:[function(require,module,exports){"use strict";var styfn={};styfn.applyFromJson=function(json){var style=this;for(var i=0;i<json.length;i++){var context=json[i];var selector=context.selector;var props=context.style||context.css;var names=Object.keys(props);style.selector(selector);for(var j=0;j<names.length;j++){var name=names[j];var value=props[name];style.css(name,value)}}return style};styfn.fromJson=function(json){var style=this;style.resetToDefault();style.applyFromJson(json);return style};styfn.json=function(){var json=[];for(var i=this.defaultLength;i<this.length;i++){var cxt=this[i];var selector=cxt.selector;var props=cxt.properties;var css={};for(var j=0;j<props.length;j++){var prop=props[j];css[prop.name]=prop.strValue}json.push({selector:!selector?"core":selector.toString(),style:css})}return json};module.exports=styfn},{}],128:[function(require,module,exports){"use strict";var util=require("../util");var is=require("../is");var math=require("../math");var styfn={};styfn.parse=function(name,value,propIsBypass,propIsFlat){var self=this;if(is.fn(value)){return self.parseImpl(name,value,propIsBypass,propIsFlat)}var argHash=[name,value,propIsBypass,propIsFlat].join("$");var propCache=self.propCache=self.propCache||{};var ret;if(!(ret=propCache[argHash])){ret=propCache[argHash]=self.parseImpl(name,value,propIsBypass,propIsFlat)}ret=util.copy(ret);if(ret){ret.value=util.copy(ret.value)}return ret};var parseImpl=function(name,value,propIsBypass,propIsFlat){var self=this;name=util.camel2dash(name);var property=self.properties[name];var passedValue=value;var types=self.types;if(!property){return null}if(value===undefined||value===null){return null}if(property.alias){property=property.pointsTo;name=property.name}var valueIsString=is.string(value);if(valueIsString){value=value.trim()}var type=property.type;if(!type){return null}if(propIsBypass&&(value===""||value===null)){return{name:name,value:value,bypass:true,deleteBypass:true}}if(is.fn(value)){return{name:name,value:value,strValue:"fn",mapped:types.fn,bypass:propIsBypass}}var data,mapData,layoutData,mapLayoutData,scratch,mapScratch;if(!valueIsString||propIsFlat){}else if((data=new RegExp(types.data.regex).exec(value))||(layoutData=new RegExp(types.layoutData.regex).exec(value))||(scratch=new RegExp(types.scratch.regex).exec(value))){if(propIsBypass){return false}var mapped;if(data){mapped=types.data}else if(layoutData){mapped=types.layoutData}else{mapped=types.scratch}data=data||layoutData||scratch;return{name:name,value:data,strValue:""+value,mapped:mapped,field:data[1],bypass:propIsBypass}}else if((mapData=new RegExp(types.mapData.regex).exec(value))||(mapLayoutData=new RegExp(types.mapLayoutData.regex).exec(value))||(mapScratch=new RegExp(types.mapScratch.regex).exec(value))){if(propIsBypass){return false}if(type.multiple){return false}var mapped;if(mapData){mapped=types.mapData}else if(mapLayoutData){mapped=types.mapLayoutData}else{mapped=types.mapScratch}mapData=mapData||mapLayoutData||mapScratch;if(!(type.color||type.number)){return false}var valueMin=this.parse(name,mapData[4]);if(!valueMin||valueMin.mapped){return false}var valueMax=this.parse(name,mapData[5]);if(!valueMax||valueMax.mapped){return false}if(valueMin.value===valueMax.value){return false}else if(type.color){var c1=valueMin.value;var c2=valueMax.value;var same=c1[0]===c2[0]&&c1[1]===c2[1]&&c1[2]===c2[2]&&(c1[3]===c2[3]||(c1[3]==null||c1[3]===1)&&(c2[3]==null||c2[3]===1));if(same){return false}}return{name:name,value:mapData,strValue:""+value,mapped:mapped,field:mapData[1],fieldMin:parseFloat(mapData[2]),fieldMax:parseFloat(mapData[3]),valueMin:valueMin.value,valueMax:valueMax.value,bypass:propIsBypass}}if(type.multiple&&propIsFlat!=="multiple"){var vals;if(valueIsString){vals=value.split(/\s+/)}else if(is.array(value)){vals=value}else{vals=[value]}if(type.evenMultiple&&vals.length%2!==0){return null}var valArr=vals.map(function(v){var p=self.parse(name,v,propIsBypass,"multiple");if(p.pfValue!=null){return p.pfValue}else{return p.value}});return{name:name,value:valArr,pfValue:valArr,strValue:valArr.join(" "),bypass:propIsBypass,units:type.number&&!type.unitless?type.implicitUnits||"px":undefined}}var checkEnums=function(){for(var i=0;i<type.enums.length;i++){var en=type.enums[i];if(en===value){return{name:name,value:value,strValue:""+value,bypass:propIsBypass}}}return null};if(type.number){var units;var implicitUnits="px";if(type.units){units=type.units}if(type.implicitUnits){implicitUnits=type.implicitUnits}if(!type.unitless){if(valueIsString){var unitsRegex="px|em"+(type.allowPercent?"|\\%":"");if(units){unitsRegex=units}var match=value.match("^("+util.regex.number+")("+unitsRegex+")?"+"$");if(match){value=match[1];units=match[2]||implicitUnits}}else if(!units||type.implicitUnits){units=implicitUnits}}value=parseFloat(value);if(isNaN(value)&&type.enums===undefined){return null}if(isNaN(value)&&type.enums!==undefined){value=passedValue;return checkEnums()}if(type.integer&&!is.integer(value)){return null}if(type.min!==undefined&&value<type.min||type.max!==undefined&&value>type.max){return null}var ret={name:name,value:value,strValue:""+value+(units?units:""),units:units,bypass:propIsBypass};if(type.unitless||units!=="px"&&units!=="em"){ret.pfValue=value}else{ret.pfValue=units==="px"||!units?value:this.getEmSizeInPixels()*value}if(units==="ms"||units==="s"){ret.pfValue=units==="ms"?value:1e3*value}if(units==="deg"||units==="rad"){ret.pfValue=units==="rad"?value:math.deg2rad(value)}return ret}else if(type.propList){var props=[];var propsStr=""+value;if(propsStr==="none"){}else{var propsSplit=propsStr.split(",");for(var i=0;i<propsSplit.length;i++){var propName=propsSplit[i].trim();if(self.properties[propName]){props.push(propName)}}if(props.length===0){return null}}return{name:name,value:props,strValue:props.length===0?"none":props.join(", "),bypass:propIsBypass}}else if(type.color){var tuple=util.color2tuple(value);if(!tuple){return null}return{name:name,value:tuple,strValue:""+value,bypass:propIsBypass,roundValue:true}}else if(type.regex||type.regexes){if(type.enums){var enumProp=checkEnums();if(enumProp){return enumProp}}var regexes=type.regexes?type.regexes:[type.regex];for(var i=0;i<regexes.length;i++){var regex=new RegExp(regexes[i]);var m=regex.exec(value);if(m){return{name:name,value:m,strValue:""+value,bypass:propIsBypass}}}return null}else if(type.string){return{name:name,value:value,strValue:""+value,bypass:propIsBypass}}else if(type.enums){return checkEnums()}else{return null}};styfn.parseImpl=parseImpl;module.exports=styfn},{"../is":117,"../math":119,"../util":134}],129:[function(require,module,exports){"use strict";var util=require("../util");var styfn={};(function(){var number=util.regex.number;var rgba=util.regex.rgbaNoBackRefs;var hsla=util.regex.hslaNoBackRefs;var hex3=util.regex.hex3;var hex6=util.regex.hex6;var data=function(prefix){return"^"+prefix+"\\s*\\(\\s*([\\w\\.]+)\\s*\\)$"};var mapData=function(prefix){var mapArg=number+"|\\w+|"+rgba+"|"+hsla+"|"+hex3+"|"+hex6;return"^"+prefix+"\\s*\\(([\\w\\.]+)\\s*\\,\\s*("+number+")\\s*\\,\\s*("+number+")\\s*,\\s*("+mapArg+")\\s*\\,\\s*("+mapArg+")\\)$"};styfn.types={time:{number:true,min:0,units:"s|ms",implicitUnits:"ms"},percent:{number:true,min:0,max:100,units:"%",implicitUnits:"%"},zeroOneNumber:{number:true,min:0,max:1,unitless:true},nOneOneNumber:{number:true,min:-1,max:1,unitless:true},nonNegativeInt:{number:true,min:0,integer:true,unitless:true},position:{enums:["parent","origin"]},nodeSize:{number:true,min:0,enums:["label"]},number:{number:true,unitless:true},numbers:{number:true,unitless:true,multiple:true},size:{number:true,min:0},bidirectionalSize:{number:true},bidirectionalSizes:{number:true,multiple:true},bgSize:{number:true,min:0,allowPercent:true},bgWH:{number:true,min:0,allowPercent:true,enums:["auto"]},bgPos:{number:true,allowPercent:true},bgRepeat:{enums:["repeat","repeat-x","repeat-y","no-repeat"]},bgFit:{enums:["none","contain","cover"]},bgClip:{enums:["none","node"]},color:{color:true},bool:{enums:["yes","no"]},lineStyle:{enums:["solid","dotted","dashed"]},borderStyle:{enums:["solid","dotted","dashed","double"]},curveStyle:{enums:["bezier","unbundled-bezier","haystack","segments"]},fontFamily:{regex:'^([\\w- \\"]+(?:\\s*,\\s*[\\w- \\"]+)*)$'},fontVariant:{enums:["small-caps","normal"]},fontStyle:{enums:["italic","normal","oblique"]},fontWeight:{enums:["normal","bold","bolder","lighter","100","200","300","400","500","600","800","900",100,200,300,400,500,600,700,800,900]},textDecoration:{enums:["none","underline","overline","line-through"]},textTransform:{enums:["none","uppercase","lowercase"]},textWrap:{enums:["none","wrap"]},textBackgroundShape:{enums:["rectangle","roundrectangle"]},nodeShape:{enums:["rectangle","roundrectangle","ellipse","triangle","square","pentagon","hexagon","heptagon","octagon","star","diamond","vee","rhomboid","polygon"]},compoundIncludeLabels:{enums:["include","exclude"]},arrowShape:{enums:["tee","triangle","triangle-tee","triangle-backcurve","half-triangle-overshot","vee","square","circle","diamond","none"]},arrowFill:{enums:["filled","hollow"]},display:{enums:["element","none"]},visibility:{enums:["hidden","visible"]},valign:{enums:["top","center","bottom"]},halign:{enums:["left","center","right"]},text:{string:true},data:{mapping:true,regex:data("data")},layoutData:{mapping:true,regex:data("layoutData")},scratch:{mapping:true,regex:data("scratch")},mapData:{mapping:true,regex:mapData("mapData")},mapLayoutData:{mapping:true,regex:mapData("mapLayoutData")},mapScratch:{mapping:true,regex:mapData("mapScratch")},fn:{mapping:true,fn:true},url:{regex:"url\\s*\\(\\s*['\"]?(.+?)['\"]?\\s*\\)|none|(.+)$"},propList:{propList:true},angle:{number:true,units:"deg|rad",implicitUnits:"rad"},textRotation:{number:true,units:"deg|rad",implicitUnits:"rad",enums:["none","autorotate"]},polygonPointList:{number:true,multiple:true,evenMultiple:true,min:-1,max:1,unitless:true},edgeDistances:{enums:["intersection","node-position"]},easing:{regexes:["^(spring)\\s*\\(\\s*("+number+")\\s*,\\s*("+number+")\\s*\\)$","^(cubic-bezier)\\s*\\(\\s*("+number+")\\s*,\\s*("+number+")\\s*,\\s*("+number+")\\s*,\\s*("+number+")\\s*\\)$"],enums:["linear","ease","ease-in","ease-out","ease-in-out","ease-in-sine","ease-out-sine","ease-in-out-sine","ease-in-quad","ease-out-quad","ease-in-out-quad","ease-in-cubic","ease-out-cubic","ease-in-out-cubic","ease-in-quart","ease-out-quart","ease-in-out-quart","ease-in-quint","ease-out-quint","ease-in-out-quint","ease-in-expo","ease-out-expo","ease-in-out-expo","ease-in-circ","ease-out-circ","ease-in-out-circ"]}};var t=styfn.types;var props=styfn.properties=[{name:"label",type:t.text},{name:"text-rotation",type:t.textRotation},{name:"text-margin-x",type:t.bidirectionalSize},{name:"text-margin-y",type:t.bidirectionalSize},{name:"source-label",type:t.text},{name:"source-text-rotation",type:t.textRotation},{name:"source-text-margin-x",type:t.bidirectionalSize},{name:"source-text-margin-y",type:t.bidirectionalSize},{name:"source-text-offset",type:t.size},{name:"target-label",type:t.text},{name:"target-text-rotation",type:t.textRotation},{name:"target-text-margin-x",type:t.bidirectionalSize},{name:"target-text-margin-y",type:t.bidirectionalSize},{name:"target-text-offset",type:t.size},{name:"text-valign",type:t.valign},{name:"text-halign",type:t.halign},{name:"color",type:t.color},{name:"text-outline-color",type:t.color},{name:"text-outline-width",type:t.size},{name:"text-outline-opacity",type:t.zeroOneNumber},{name:"text-opacity",type:t.zeroOneNumber},{name:"text-background-color",type:t.color},{name:"text-background-margin",type:t.size},{name:"text-background-opacity",type:t.zeroOneNumber},{name:"text-border-opacity",type:t.zeroOneNumber},{name:"text-border-color",type:t.color},{name:"text-border-width",type:t.size},{name:"text-border-style",type:t.borderStyle},{name:"text-background-shape",type:t.textBackgroundShape},{name:"text-transform",type:t.textTransform},{name:"text-wrap",type:t.textWrap},{name:"text-max-width",type:t.size},{name:"text-events",type:t.bool},{name:"font-family",type:t.fontFamily},{name:"font-style",type:t.fontStyle},{name:"font-weight",type:t.fontWeight},{name:"font-size",type:t.size},{name:"min-zoomed-font-size",type:t.size},{name:"events",type:t.bool},{name:"display",type:t.display},{name:"visibility",type:t.visibility},{name:"opacity",type:t.zeroOneNumber},{name:"z-index",type:t.nonNegativeInt},{name:"overlay-padding",type:t.size},{name:"overlay-color",type:t.color},{name:"overlay-opacity",type:t.zeroOneNumber},{name:"shadow-blur",type:t.size},{name:"shadow-color",type:t.color},{name:"shadow-opacity",type:t.zeroOneNumber},{name:"shadow-offset-x",type:t.bidirectionalSize},{name:"shadow-offset-y",type:t.bidirectionalSize},{name:"text-shadow-blur",type:t.size},{name:"text-shadow-color",type:t.color},{name:"text-shadow-opacity",type:t.zeroOneNumber},{name:"text-shadow-offset-x",type:t.bidirectionalSize},{name:"text-shadow-offset-y",type:t.bidirectionalSize},{name:"transition-property",type:t.propList},{name:"transition-duration",type:t.time},{name:"transition-delay",type:t.time},{name:"transition-timing-function",type:t.easing},{name:"height",type:t.nodeSize},{name:"width",type:t.nodeSize},{name:"shape",type:t.nodeShape},{name:"shape-polygon-points",type:t.polygonPointList},{name:"background-color",type:t.color},{name:"background-opacity",type:t.zeroOneNumber},{name:"background-blacken",type:t.nOneOneNumber},{name:"padding-left",type:t.size},{name:"padding-right",type:t.size},{name:"padding-top",type:t.size},{name:"padding-bottom",type:t.size},{name:"border-color",type:t.color},{name:"border-opacity",type:t.zeroOneNumber},{name:"border-width",type:t.size},{name:"border-style",type:t.borderStyle},{name:"background-image",type:t.url},{name:"background-image-opacity",type:t.zeroOneNumber},{name:"background-position-x",type:t.bgPos},{name:"background-position-y",type:t.bgPos},{name:"background-repeat",type:t.bgRepeat},{name:"background-fit",type:t.bgFit},{name:"background-clip",type:t.bgClip},{name:"background-width",type:t.bgWH},{name:"background-height",type:t.bgWH},{name:"position",type:t.position},{name:"compound-sizing-wrt-labels",type:t.compoundIncludeLabels},{name:"line-style",type:t.lineStyle},{name:"line-color",type:t.color},{name:"curve-style",type:t.curveStyle},{name:"haystack-radius",type:t.zeroOneNumber},{name:"control-point-step-size",type:t.size},{name:"control-point-distances",type:t.bidirectionalSizes},{name:"control-point-weights",type:t.numbers},{name:"segment-distances",type:t.bidirectionalSizes},{name:"segment-weights",type:t.numbers},{name:"edge-distances",type:t.edgeDistances},{name:"selection-box-color",type:t.color},{name:"selection-box-opacity",type:t.zeroOneNumber},{name:"selection-box-border-color",type:t.color},{name:"selection-box-border-width",type:t.size},{name:"active-bg-color",type:t.color},{name:"active-bg-opacity",type:t.zeroOneNumber},{name:"active-bg-size",type:t.size},{name:"outside-texture-bg-color",type:t.color},{name:"outside-texture-bg-opacity",type:t.zeroOneNumber}];var aliases=styfn.aliases=[{name:"content",pointsTo:"label"},{name:"control-point-distance",pointsTo:"control-point-distances"},{name:"control-point-weight",pointsTo:"control-point-weights"},{name:"edge-text-rotation",pointsTo:"text-rotation"}];styfn.pieBackgroundN=16;props.push({name:"pie-size",type:t.bgSize});for(var i=1;i<=styfn.pieBackgroundN;i++){props.push({name:"pie-"+i+"-background-color",type:t.color});props.push({name:"pie-"+i+"-background-size",type:t.percent});props.push({name:"pie-"+i+"-background-opacity",type:t.zeroOneNumber})}var arrowPrefixes=styfn.arrowPrefixes=["source","mid-source","target","mid-target"];[{name:"arrow-shape",type:t.arrowShape},{name:"arrow-color",type:t.color},{name:"arrow-fill",type:t.arrowFill}].forEach(function(prop){arrowPrefixes.forEach(function(prefix){var name=prefix+"-"+prop.name;var type=prop.type;props.push({name:name,type:type})})},{});styfn.propertyNames=props.map(function(p){return p.name});for(var i=0;i<props.length;i++){var prop=props[i];props[prop.name]=prop}for(var i=0;i<aliases.length;i++){var alias=aliases[i];var pointsToProp=props[alias.pointsTo];var aliasProp={name:alias.name,alias:true,pointsTo:pointsToProp};props.push(aliasProp);props[alias.name]=aliasProp}})();styfn.getDefaultProperty=function(name){return this.getDefaultProperties()[name]};styfn.getDefaultProperties=util.memoize(function(){var rawProps=util.extend({events:"yes","text-events":"no","text-valign":"top","text-halign":"center",color:"#000","text-outline-color":"#000","text-outline-width":0,"text-outline-opacity":1,"text-opacity":1,"text-decoration":"none","text-transform":"none","text-wrap":"none","text-max-width":9999,"text-background-color":"#000","text-background-opacity":0,"text-background-margin":0,"text-border-opacity":0,"text-border-width":0,"text-border-style":"solid","text-border-color":"#000","text-background-shape":"rectangle","font-family":"Helvetica Neue, Helvetica, sans-serif","font-style":"normal","font-weight":"normal","font-size":16,"min-zoomed-font-size":0,"text-rotation":"none","source-text-rotation":"none","target-text-rotation":"none",visibility:"visible",display:"element",opacity:1,"z-index":0,label:"","text-margin-x":0,"text-margin-y":0,"source-label":"","source-text-offset":0,"source-text-margin-x":0,"source-text-margin-y":0,"target-label":"","target-text-offset":0,"target-text-margin-x":0,"target-text-margin-y":0,"overlay-opacity":0,"overlay-color":"#000","overlay-padding":10,"shadow-opacity":0,"shadow-color":"#000","shadow-blur":10,"shadow-offset-x":0,"shadow-offset-y":0,"text-shadow-opacity":0,"text-shadow-color":"#000","text-shadow-blur":5,"text-shadow-offset-x":0,"text-shadow-offset-y":0,"transition-property":"none","transition-duration":0,"transition-delay":0,"transition-timing-function":"linear","background-blacken":0,"background-color":"#999","background-opacity":1,"background-image":"none","background-image-opacity":1,"background-position-x":"50%","background-position-y":"50%","background-repeat":"no-repeat","background-fit":"none","background-clip":"node","background-width":"auto","background-height":"auto","border-color":"#000","border-opacity":1,"border-width":0,"border-style":"solid",height:30,width:30,shape:"ellipse","shape-polygon-points":"-1, -1,   1, -1,   1, 1,   -1, 1","padding-top":0,"padding-bottom":0,"padding-left":0,"padding-right":0,position:"origin","compound-sizing-wrt-labels":"include"},{"pie-size":"100%"},[{name:"pie-{{i}}-background-color",value:"black"},{name:"pie-{{i}}-background-size",value:"0%"},{name:"pie-{{i}}-background-opacity",value:1}].reduce(function(css,prop){for(var i=1;i<=styfn.pieBackgroundN;i++){var name=prop.name.replace("{{i}}",i);var val=prop.value;css[name]=val}return css},{}),{"line-style":"solid","line-color":"#999","control-point-step-size":40,"control-point-weights":.5,"segment-weights":.5,"segment-distances":20,"edge-distances":"intersection","curve-style":"bezier","haystack-radius":0},[{name:"arrow-shape",value:"none"},{name:"arrow-color",value:"#999"},{name:"arrow-fill",value:"filled"}].reduce(function(css,prop){styfn.arrowPrefixes.forEach(function(prefix){var name=prefix+"-"+prop.name;var val=prop.value;css[name]=val});return css},{}));var parsedProps={};for(var i=0;i<this.properties.length;i++){var prop=this.properties[i];if(prop.pointsTo){continue}var name=prop.name;var val=rawProps[name];var parsedProp=this.parse(name,val);parsedProps[name]=parsedProp}return parsedProps});styfn.addDefaultStylesheet=function(){this.selector("$node > node").css({shape:"rectangle","padding-top":10,"padding-right":10,"padding-left":10,"padding-bottom":10,"background-color":"#eee","border-color":"#ccc","border-width":1}).selector("edge").css({width:3,"curve-style":"haystack"}).selector(":selected").css({"background-color":"#0169D9","line-color":"#0169D9","source-arrow-color":"#0169D9","target-arrow-color":"#0169D9","mid-source-arrow-color":"#0169D9","mid-target-arrow-color":"#0169D9"}).selector("node:parent:selected").css({"background-color":"#CCE1F9","border-color":"#aec8e5"}).selector(":active").css({"overlay-color":"black","overlay-padding":10,"overlay-opacity":.25}).selector("core").css({"selection-box-color":"#ddd","selection-box-opacity":.65,"selection-box-border-color":"#aaa","selection-box-border-width":1,"active-bg-color":"black","active-bg-opacity":.15,"active-bg-size":30,"outside-texture-bg-color":"#000","outside-texture-bg-opacity":.125});this.defaultLength=this.length};module.exports=styfn},{"../util":134}],130:[function(require,module,exports){"use strict";var util=require("../util");var Selector=require("../selector");var styfn={};styfn.applyFromString=function(string){var self=this;var style=this;var remaining=""+string;var selAndBlockStr;var blockRem;var propAndValStr;remaining=remaining.replace(/[/][*](\s|.)+?[*][/]/g,"");function removeSelAndBlockFromRemaining(){if(remaining.length>selAndBlockStr.length){remaining=remaining.substr(selAndBlockStr.length)}else{remaining=""}}function removePropAndValFromRem(){if(blockRem.length>propAndValStr.length){blockRem=blockRem.substr(propAndValStr.length)}else{blockRem=""}}while(true){var nothingLeftToParse=remaining.match(/^\s*$/);if(nothingLeftToParse){break}var selAndBlock=remaining.match(/^\s*((?:.|\s)+?)\s*\{((?:.|\s)+?)\}/);if(!selAndBlock){util.error("Halting stylesheet parsing: String stylesheet contains more to parse but no selector and block found in: "+remaining);break}selAndBlockStr=selAndBlock[0];var selectorStr=selAndBlock[1];if(selectorStr!=="core"){var selector=new Selector(selectorStr);if(selector._private.invalid){util.error("Skipping parsing of block: Invalid selector found in string stylesheet: "+selectorStr);removeSelAndBlockFromRemaining();continue}}var blockStr=selAndBlock[2];var invalidBlock=false;blockRem=blockStr;var props=[];while(true){var nothingLeftToParse=blockRem.match(/^\s*$/);if(nothingLeftToParse){break}var propAndVal=blockRem.match(/^\s*(.+?)\s*:\s*(.+?)\s*;/);if(!propAndVal){util.error("Skipping parsing of block: Invalid formatting of style property and value definitions found in:"+blockStr);invalidBlock=true;break}propAndValStr=propAndVal[0];var propStr=propAndVal[1];var valStr=propAndVal[2];var prop=self.properties[propStr];if(!prop){util.error("Skipping property: Invalid property name in: "+propAndValStr);removePropAndValFromRem();continue}var parsedProp=style.parse(propStr,valStr);if(!parsedProp){util.error("Skipping property: Invalid property definition in: "+propAndValStr);removePropAndValFromRem();continue}props.push({name:propStr,val:valStr});removePropAndValFromRem()}if(invalidBlock){removeSelAndBlockFromRemaining();break}style.selector(selectorStr);for(var i=0;i<props.length;i++){var prop=props[i];style.css(prop.name,prop.val)}removeSelAndBlockFromRemaining()}return style};styfn.fromString=function(string){var style=this;style.resetToDefault();style.applyFromString(string);return style};module.exports=styfn},{"../selector":121,"../util":134}],131:[function(require,module,exports){"use strict";var is=require("./is");var util=require("./util");var Style=require("./style");var Stylesheet=function(){if(!(this instanceof Stylesheet)){return new Stylesheet}this.length=0};var sheetfn=Stylesheet.prototype;sheetfn.instanceString=function(){return"stylesheet"};sheetfn.selector=function(selector){var i=this.length++;this[i]={selector:selector,properties:[]};return this};sheetfn.css=function(name,value){var i=this.length-1;if(is.string(name)){this[i].properties.push({name:name,value:value})}else if(is.plainObject(name)){var map=name;for(var j=0;j<Style.properties.length;j++){var prop=Style.properties[j];var mapVal=map[prop.name];if(mapVal===undefined){mapVal=map[util.dash2camel(prop.name)]}if(mapVal!==undefined){var name=prop.name;var value=mapVal;this[i].properties.push({name:name,value:value})}}}return this};sheetfn.style=sheetfn.css;sheetfn.generateStyle=function(cy){var style=new Style(cy);for(var i=0;i<this.length;i++){var context=this[i];var selector=context.selector;var props=context.properties;style.selector(selector);for(var j=0;j<props.length;j++){var prop=props[j];style.css(prop.name,prop.value)}}return style};module.exports=Stylesheet},{"./is":117,"./style":126,"./util":134}],132:[function(require,module,exports){(function(__dirname){"use strict";var window=require("./window");var util=require("./util");var Promise=require("./promise");var Event=require("./event");var define=require("./define");var is=require("./is");var Thread=function(opts){if(!(this instanceof Thread)){return new Thread(opts)}var _p=this._private={requires:[],files:[],queue:null,pass:[],disabled:false};if(is.plainObject(opts)){if(opts.disabled!=null){_p.disabled=!!opts.disabled}}};var thdfn=Thread.prototype;var stringifyFieldVal=function(val){var valStr=is.fn(val)?val.toString():"JSON.parse('"+JSON.stringify(val)+"')";return valStr};var fnAsRequire=function(fn){var req;var fnName;if(is.object(fn)&&fn.fn){req=fnAs(fn.fn,fn.name);fnName=fn.name;fn=fn.fn}else if(is.fn(fn)){req=fn.toString();fnName=fn.name}else if(is.string(fn)){req=fn}else if(is.object(fn)){if(fn.proto){req=""}else{req=fn.name+" = {};"}fnName=fn.name;fn=fn.obj}req+="\n";var protoreq=function(val,subname){if(val.prototype){var protoNonempty=false;for(var prop in val.prototype){protoNonempty=true;break}if(protoNonempty){req+=fnAsRequire({name:subname,obj:val,proto:true},val)}}};if(fn.prototype&&fnName!=null){for(var name in fn.prototype){var protoStr="";var val=fn.prototype[name];var valStr=stringifyFieldVal(val);var subname=fnName+".prototype."+name;protoStr+=subname+" = "+valStr+";\n";if(protoStr){req+=protoStr}protoreq(val,subname)}}if(!is.string(fn)){for(var name in fn){var propsStr="";if(fn.hasOwnProperty(name)){var val=fn[name];var valStr=stringifyFieldVal(val);var subname=fnName+'["'+name+'"]';propsStr+=subname+" = "+valStr+";\n"}if(propsStr){req+=propsStr}protoreq(val,subname)}}return req};var isPathStr=function(str){return is.string(str)&&str.match(/\.js$/)};util.extend(thdfn,{instanceString:function(){return"thread"},require:function(fn,as){var requires=this._private.requires;if(isPathStr(fn)){this._private.files.push(fn);return this}if(as){if(is.fn(fn)){fn={name:as,fn:fn}}else{fn={name:as,obj:fn}}}else{if(is.fn(fn)){if(!fn.name){throw'The function name could not be automatically determined.  Use thread.require( someFunction, "someFunction" )'}fn={name:fn.name,fn:fn}}}requires.push(fn);return this},pass:function(data){this._private.pass.push(data);return this},run:function(fn,pass){var self=this;var _p=this._private;pass=pass||_p.pass.shift();if(_p.stopped){throw"Attempted to run a stopped thread!  Start a new thread or do not stop the existing thread and reuse it."}if(_p.running){return _p.queue=_p.queue.then(function(){return self.run(fn,pass)})}var useWW=window!=null&&!_p.disabled;var useNode=!window&&typeof module!=="undefined"&&!_p.disabled;self.trigger("run");var runP=new Promise(function(resolve,reject){_p.running=true;var threadTechAlreadyExists=_p.ran;var fnImplStr=is.string(fn)?fn:fn.toString();var fnStr="\n"+_p.requires.map(function(r){return fnAsRequire(r)}).concat(_p.files.map(function(f){if(useWW){var wwifyFile=function(file){if(file.match(/^\.\//)||file.match(/^\.\./)){return window.location.origin+window.location.pathname+file}else if(file.match(/^\//)){return window.location.origin+"/"+file}return file};return'importScripts("'+wwifyFile(f)+'");'}else if(useNode){return'eval( require("fs").readFileSync("'+f+'", { encoding: "utf8" }) );'}else{throw"External file `"+f+"` can not be required without any threading technology."}})).concat(["( function(){","var ret = ("+fnImplStr+")("+JSON.stringify(pass)+");","if( ret !== undefined ){ resolve(ret); }","} )()\n"]).join("\n");_p.requires=[];_p.files=[];if(useWW){var fnBlob,fnUrl;if(!threadTechAlreadyExists){var fnPre=fnStr+"";fnStr=["function _ref_(o){ return eval(o); };","function broadcast(m){ return message(m); };","function message(m){ postMessage(m); };","function listen(fn){",'  self.addEventListener("message", function(m){ ','    if( typeof m === "object" && (m.data.$$eval || m.data === "$$start") ){',"    } else { ","      fn( m.data );","    }","  });","};",'self.addEventListener("message", function(m){  if( m.data.$$eval ){ eval( m.data.$$eval ); }  });',"function resolve(v){ postMessage({ $$resolve: v }); };","function reject(v){ postMessage({ $$reject: v }); };"].join("\n");fnStr+=fnPre;fnBlob=new Blob([fnStr],{type:"application/javascript"});fnUrl=window.URL.createObjectURL(fnBlob)}var ww=_p.webworker=_p.webworker||new Worker(fnUrl);if(threadTechAlreadyExists){ww.postMessage({$$eval:fnStr})}var cb;ww.addEventListener("message",cb=function(m){var isObject=is.object(m)&&is.object(m.data);if(isObject&&"$$resolve"in m.data){ww.removeEventListener("message",cb);resolve(m.data.$$resolve)}else if(isObject&&"$$reject"in m.data){ww.removeEventListener("message",cb);reject(m.data.$$reject)}else{self.trigger(new Event(m,{type:"message",message:m.data}))}},false);if(!threadTechAlreadyExists){ww.postMessage("$$start")}}else if(useNode){if(!_p.child){_p.child=require("child_process").fork(require("path").join(__dirname,"thread-node-fork"))}var child=_p.child;var cb;child.on("message",cb=function(m){if(is.object(m)&&"$$resolve"in m){child.removeListener("message",cb);resolve(m.$$resolve)}else if(is.object(m)&&"$$reject"in m){child.removeListener("message",cb);reject(m.$$reject)}else{self.trigger(new Event({},{type:"message",message:m}))}});child.send({$$eval:fnStr})}else{var promiseResolve=resolve;var promiseReject=reject;var timer=_p.timer=_p.timer||{listeners:[],exec:function(){fnStr=["function _ref_(o){ return eval(o); };","function broadcast(m){ return message(m); };",'function message(m){ self.trigger( new Event({}, { type: "message", message: m }) ); };',"function listen(fn){ timer.listeners.push( fn ); };","function resolve(v){ promiseResolve(v); };","function reject(v){ promiseReject(v); };"].join("\n")+fnStr;eval(fnStr)},message:function(m){var ls=timer.listeners;for(var i=0;i<ls.length;i++){var fn=ls[i];fn(m)}}};timer.exec()}}).then(function(v){_p.running=false;_p.ran=true;self.trigger("ran");return v});if(_p.queue==null){_p.queue=runP}return runP},message:function(m){var _p=this._private;if(_p.webworker){_p.webworker.postMessage(m)}if(_p.child){_p.child.send(m)}if(_p.timer){_p.timer.message(m)}return this},stop:function(){var _p=this._private;if(_p.webworker){_p.webworker.terminate()}if(_p.child){_p.child.kill()}if(_p.timer){}_p.stopped=true;return this.trigger("stop")},stopped:function(){return this._private.stopped}});var fnAs=function(fn,name){var fnStr=fn.toString();fnStr=fnStr.replace(/function\s*?\S*?\s*?\(/,"function "+name+"(");return fnStr};var defineFnal=function(opts){opts=opts||{};return function fnalImpl(fn,arg1){var fnStr=fnAs(fn,"_$_$_"+opts.name);this.require(fnStr);return this.run(["function( data ){","  var origResolve = resolve;","  var res = [];","  ","  resolve = function( val ){","    res.push( val );","  };","  ","  var ret = data."+opts.name+"( _$_$_"+opts.name+(arguments.length>1?", "+JSON.stringify(arg1):"")+" );","  ","  resolve = origResolve;","  resolve( res.length > 0 ? res : ret );","}"].join("\n"))}};util.extend(thdfn,{reduce:defineFnal({name:"reduce"}),reduceRight:defineFnal({name:"reduceRight"}),map:defineFnal({name:"map"})});var fn=thdfn;fn.promise=fn.run;fn.terminate=fn.halt=fn.stop;fn.include=fn.require;util.extend(thdfn,{on:define.on(),one:define.on({unbindSelfOnTrigger:true}),off:define.off(),trigger:define.trigger()});define.eventAliasesOn(thdfn);module.exports=Thread}).call(this,"/node_modules/cytoscape/src")},{"./define":78,"./event":79,"./is":117,"./promise":120,"./util":134,"./window":141,child_process:204,path:206}],133:[function(require,module,exports){"use strict";var is=require("../is");module.exports={hex2tuple:function(hex){if(!(hex.length===4||hex.length===7)||hex[0]!=="#"){return}var shortHex=hex.length===4;var r,g,b;var base=16;if(shortHex){r=parseInt(hex[1]+hex[1],base);g=parseInt(hex[2]+hex[2],base);b=parseInt(hex[3]+hex[3],base)}else{r=parseInt(hex[1]+hex[2],base);g=parseInt(hex[3]+hex[4],base);b=parseInt(hex[5]+hex[6],base)}return[r,g,b]},hsl2tuple:function(hsl){var ret;var h,s,l,a,r,g,b;function hue2rgb(p,q,t){if(t<0)t+=1;if(t>1)t-=1;if(t<1/6)return p+(q-p)*6*t;if(t<1/2)return q;if(t<2/3)return p+(q-p)*(2/3-t)*6;return p}var m=new RegExp("^"+this.regex.hsla+"$").exec(hsl);if(m){h=parseInt(m[1]);if(h<0){h=(360- -1*h%360)%360}else if(h>360){h=h%360}h/=360;s=parseFloat(m[2]);if(s<0||s>100){return}s=s/100;l=parseFloat(m[3]);if(l<0||l>100){return}l=l/100;a=m[4];if(a!==undefined){a=parseFloat(a);if(a<0||a>1){return}}if(s===0){r=g=b=Math.round(l*255)}else{var q=l<.5?l*(1+s):l+s-l*s;var p=2*l-q;r=Math.round(255*hue2rgb(p,q,h+1/3));g=Math.round(255*hue2rgb(p,q,h));b=Math.round(255*hue2rgb(p,q,h-1/3))}ret=[r,g,b,a]}return ret},rgb2tuple:function(rgb){var ret;var m=new RegExp("^"+this.regex.rgba+"$").exec(rgb);if(m){ret=[];var isPct=[];for(var i=1;i<=3;i++){var channel=m[i];if(channel[channel.length-1]==="%"){isPct[i]=true}channel=parseFloat(channel);if(isPct[i]){channel=channel/100*255}if(channel<0||channel>255){return}ret.push(Math.floor(channel))}var atLeastOneIsPct=isPct[1]||isPct[2]||isPct[3];var allArePct=isPct[1]&&isPct[2]&&isPct[3];if(atLeastOneIsPct&&!allArePct){return}var alpha=m[4];if(alpha!==undefined){alpha=parseFloat(alpha);if(alpha<0||alpha>1){return}ret.push(alpha)}}return ret},colorname2tuple:function(color){return this.colors[color.toLowerCase()]},color2tuple:function(color){return(is.array(color)?color:null)||this.colorname2tuple(color)||this.hex2tuple(color)||this.rgb2tuple(color)||this.hsl2tuple(color)},colors:{transparent:[0,0,0,0],aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],grey:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}}},{"../is":117}],134:[function(require,module,exports){"use strict";var is=require("../is");var math=require("../math");var util={trueify:function(){return true},falsify:function(){return false},zeroify:function(){return 0},noop:function(){},error:function(msg){if(console.error){console.error.apply(console,arguments);if(console.trace){console.trace()}}else{console.log.apply(console,arguments);if(console.trace){console.trace()}}},clone:function(obj){return this.extend({},obj)},copy:function(obj){if(obj==null){return obj}if(is.array(obj)){return obj.slice()}else if(is.plainObject(obj)){return this.clone(obj)}else{return obj}},uuid:function(a,b){for(b=a="";a++<36;b+=a*51&52?(a^15?8^Math.random()*(a^20?16:4):4).toString(16):"-");return b}};util.makeBoundingBox=math.makeBoundingBox.bind(math);util._staticEmptyObject={};util.staticEmptyObject=function(){return util._staticEmptyObject};util.extend=Object.assign!=null?Object.assign:function(tgt){var args=arguments;for(var i=1;i<args.length;i++){var obj=args[i];if(!obj){continue}var keys=Object.keys(obj);for(var j=0;j<keys.length;j++){var k=keys[j];tgt[k]=obj[k]}}return tgt};util.default=function(val,def){if(val===undefined){return def}else{return val}};util.removeFromArray=function(arr,ele,manyCopies){for(var i=arr.length;i>=0;i--){if(arr[i]===ele){arr.splice(i,1);if(!manyCopies){break}}}};util.clearArray=function(arr){arr.splice(0,arr.length)};util.getPrefixedProperty=function(obj,propName,prefix){if(prefix){propName=this.prependCamel(prefix,propName)}return obj[propName]};util.setPrefixedProperty=function(obj,propName,prefix,value){if(prefix){propName=this.prependCamel(prefix,propName)}obj[propName]=value};[require("./colors"),require("./maps"),{memoize:require("./memoize")},require("./regex"),require("./strings"),require("./timing")].forEach(function(req){util.extend(util,req)});module.exports=util},{"../is":117,"../math":119,"./colors":133,"./maps":135,"./memoize":136,"./regex":137,"./strings":138,"./timing":139}],135:[function(require,module,exports){"use strict";var is=require("../is");module.exports={mapEmpty:function(map){var empty=true;if(map!=null){return Object.keys(map).length===0}return empty},pushMap:function(options){var array=this.getMap(options);if(array==null){this.setMap(this.extend({},options,{value:[options.value]}))}else{array.push(options.value)}},setMap:function(options){var obj=options.map;var key;var keys=options.keys;var l=keys.length;for(var i=0;i<l;i++){var key=keys[i];if(is.plainObject(key)){this.error("Tried to set map with object key")}if(i<keys.length-1){if(obj[key]==null){obj[key]={}}obj=obj[key]}else{obj[key]=options.value}}},getMap:function(options){var obj=options.map;var keys=options.keys;var l=keys.length;for(var i=0;i<l;i++){var key=keys[i];if(is.plainObject(key)){this.error("Tried to get map with object key")}obj=obj[key];if(obj==null){return obj}}return obj},deleteMap:function(options){var obj=options.map;var keys=options.keys;var l=keys.length;var keepChildren=options.keepChildren;for(var i=0;i<l;i++){var key=keys[i];if(is.plainObject(key)){this.error("Tried to delete map with object key")}var lastKey=i===options.keys.length-1;if(lastKey){if(keepChildren){var children=Object.keys(obj);for(var j=0;j<children.length;j++){var child=children[j];if(!keepChildren[child]){obj[child]=undefined}}}else{obj[key]=undefined}}else{obj=obj[key]}}}}},{"../is":117}],136:[function(require,module,exports){"use strict";module.exports=function memoize(fn,keyFn){if(!keyFn){keyFn=function(){if(arguments.length===1){return arguments[0]}else if(arguments.length===0){return"undefined"}var args=[];for(var i=0;i<arguments.length;i++){args.push(arguments[i])}return args.join("$")}}var memoizedFn=function(){var self=this;var args=arguments;var ret;var k=keyFn.apply(self,args);var cache=memoizedFn.cache;if(!(ret=cache[k])){ret=cache[k]=fn.apply(self,args)}return ret};memoizedFn.cache={};return memoizedFn}},{}],137:[function(require,module,exports){"use strict";var number="(?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))";var rgba="rgb[a]?\\(("+number+"[%]?)\\s*,\\s*("+number+"[%]?)\\s*,\\s*("+number+"[%]?)(?:\\s*,\\s*("+number+"))?\\)";var rgbaNoBackRefs="rgb[a]?\\((?:"+number+"[%]?)\\s*,\\s*(?:"+number+"[%]?)\\s*,\\s*(?:"+number+"[%]?)(?:\\s*,\\s*(?:"+number+"))?\\)";var hsla="hsl[a]?\\(("+number+")\\s*,\\s*("+number+"[%])\\s*,\\s*("+number+"[%])(?:\\s*,\\s*("+number+"))?\\)";var hslaNoBackRefs="hsl[a]?\\((?:"+number+")\\s*,\\s*(?:"+number+"[%])\\s*,\\s*(?:"+number+"[%])(?:\\s*,\\s*(?:"+number+"))?\\)";var hex3="\\#[0-9a-fA-F]{3}";var hex6="\\#[0-9a-fA-F]{6}";module.exports={regex:{number:number,rgba:rgba,rgbaNoBackRefs:rgbaNoBackRefs,hsla:hsla,hslaNoBackRefs:hslaNoBackRefs,hex3:hex3,hex6:hex6}}},{}],138:[function(require,module,exports){"use strict";var memoize=require("./memoize");var is=require("../is");module.exports={camel2dash:memoize(function(str){return str.replace(/([A-Z])/g,function(v){return"-"+v.toLowerCase()})}),dash2camel:memoize(function(str){return str.replace(/(-\w)/g,function(v){return v[1].toUpperCase()})}),prependCamel:memoize(function(prefix,str){return prefix+str[0].toUpperCase()+str.substring(1)},function(prefix,str){return prefix+"$"+str}),capitalize:function(str){if(is.emptyString(str)){return str}return str.charAt(0).toUpperCase()+str.substring(1)}}},{"../is":117,"./memoize":136}],139:[function(require,module,exports){"use strict";var window=require("../window");var is=require("../is");var performance=window?window.performance:null;var util={};var raf=!window?null:window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;raf=raf||function(fn){if(fn){setTimeout(function(){fn(pnow())},1e3/60)}};util.requestAnimationFrame=function(fn){raf(fn)};var pnow=performance&&performance.now?function(){return performance.now()}:function(){return Date.now()};util.performanceNow=pnow;util.throttle=function(func,wait,options){var leading=true,trailing=true;if(options===false){leading=false}else if(is.plainObject(options)){leading="leading"in options?options.leading:leading;trailing="trailing"in options?options.trailing:trailing}options=options||{};options.leading=leading;options.maxWait=wait;options.trailing=trailing;return util.debounce(func,wait,options)};util.now=function(){return Date.now()};util.debounce=function(func,wait,options){var util=this;var args,maxTimeoutId,result,stamp,thisArg,timeoutId,trailingCall,lastCalled=0,maxWait=false,trailing=true;if(!is.fn(func)){return}wait=Math.max(0,wait)||0;if(options===true){var leading=true;trailing=false}else if(is.plainObject(options)){leading=options.leading;maxWait="maxWait"in options&&(Math.max(wait,options.maxWait)||0);trailing="trailing"in options?options.trailing:trailing}var delayed=function(){var remaining=wait-(util.now()-stamp);if(remaining<=0){if(maxTimeoutId){clearTimeout(maxTimeoutId)}var isCalled=trailingCall;maxTimeoutId=timeoutId=trailingCall=undefined;if(isCalled){lastCalled=util.now();result=func.apply(thisArg,args);if(!timeoutId&&!maxTimeoutId){args=thisArg=null}}}else{timeoutId=setTimeout(delayed,remaining)}};var maxDelayed=function(){if(timeoutId){clearTimeout(timeoutId)}maxTimeoutId=timeoutId=trailingCall=undefined;if(trailing||maxWait!==wait){lastCalled=util.now();result=func.apply(thisArg,args);if(!timeoutId&&!maxTimeoutId){args=thisArg=null}}};return function(){args=arguments;stamp=util.now();thisArg=this;trailingCall=trailing&&(timeoutId||!leading);if(maxWait===false){var leadingCall=leading&&!timeoutId}else{if(!maxTimeoutId&&!leading){lastCalled=stamp}var remaining=maxWait-(stamp-lastCalled),isCalled=remaining<=0;if(isCalled){if(maxTimeoutId){maxTimeoutId=clearTimeout(maxTimeoutId)}lastCalled=stamp;result=func.apply(thisArg,args)}else if(!maxTimeoutId){maxTimeoutId=setTimeout(maxDelayed,remaining)}}if(isCalled&&timeoutId){timeoutId=clearTimeout(timeoutId)}else if(!timeoutId&&wait!==maxWait){timeoutId=setTimeout(delayed,wait)}if(leadingCall){isCalled=true;result=func.apply(thisArg,args)}if(isCalled&&!timeoutId&&!maxTimeoutId){args=thisArg=null}return result}};module.exports=util},{"../is":117,"../window":141}],140:[function(require,module,exports){module.exports="2.7.11"},{}],141:[function(require,module,exports){module.exports=typeof window==="undefined"?null:window},{}],142:[function(require,module,exports){(function(global,factory){if(typeof module==="object"&&typeof module.exports==="object"){module.exports=global.document?factory(global,true):function(w){if(!w.document){throw new Error("jQuery requires a window with a document")}return factory(w)}}else{factory(global)}})(typeof window!=="undefined"?window:this,function(window,noGlobal){var arr=[];var document=window.document;var slice=arr.slice;var concat=arr.concat;var push=arr.push;var indexOf=arr.indexOf;var class2type={};var toString=class2type.toString;var hasOwn=class2type.hasOwnProperty;var support={};var version="2.2.4",jQuery=function(selector,context){return new jQuery.fn.init(selector,context)},rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(all,letter){return letter.toUpperCase()};jQuery.fn=jQuery.prototype={jquery:version,constructor:jQuery,selector:"",length:0,toArray:function(){return slice.call(this)},get:function(num){return num!=null?num<0?this[num+this.length]:this[num]:slice.call(this)},pushStack:function(elems){var ret=jQuery.merge(this.constructor(),elems);ret.prevObject=this;ret.context=this.context;return ret},each:function(callback){return jQuery.each(this,callback)},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem)}))},slice:function(){return this.pushStack(slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(i){var len=this.length,j=+i+(i<0?len:0);return this.pushStack(j>=0&&j<len?[this[j]]:[])},end:function(){return this.prevObject||this.constructor()},push:push,sort:arr.sort,splice:arr.splice};jQuery.extend=jQuery.fn.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[i]||{};i++}if(typeof target!=="object"&&!jQuery.isFunction(target)){target={}}if(i===length){target=this;i--}for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){src=target[name];copy=options[name];if(target===copy){continue}if(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&jQuery.isArray(src)?src:[]}else{clone=src&&jQuery.isPlainObject(src)?src:{}}target[name]=jQuery.extend(deep,clone,copy)}else if(copy!==undefined){target[name]=copy}}}}return target};jQuery.extend({expando:"jQuery"+(version+Math.random()).replace(/\D/g,""),isReady:true,error:function(msg){throw new Error(msg)},noop:function(){},isFunction:function(obj){return jQuery.type(obj)==="function"},isArray:Array.isArray,isWindow:function(obj){return obj!=null&&obj===obj.window},isNumeric:function(obj){var realStringObj=obj&&obj.toString();return!jQuery.isArray(obj)&&realStringObj-parseFloat(realStringObj)+1>=0},isPlainObject:function(obj){var key;if(jQuery.type(obj)!=="object"||obj.nodeType||jQuery.isWindow(obj)){return false}if(obj.constructor&&!hasOwn.call(obj,"constructor")&&!hasOwn.call(obj.constructor.prototype||{},"isPrototypeOf")){return false}for(key in obj){}return key===undefined||hasOwn.call(obj,key)},isEmptyObject:function(obj){var name;for(name in obj){return false}return true},type:function(obj){if(obj==null){return obj+""}return typeof obj==="object"||typeof obj==="function"?class2type[toString.call(obj)]||"object":typeof obj},globalEval:function(code){var script,indirect=eval;code=jQuery.trim(code);if(code){if(code.indexOf("use strict")===1){script=document.createElement("script");script.text=code;document.head.appendChild(script).parentNode.removeChild(script)}else{indirect(code)}}},camelCase:function(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase()},each:function(obj,callback){var length,i=0;if(isArrayLike(obj)){length=obj.length;for(;i<length;i++){if(callback.call(obj[i],i,obj[i])===false){break}}}else{for(i in obj){if(callback.call(obj[i],i,obj[i])===false){break}}}return obj},trim:function(text){return text==null?"":(text+"").replace(rtrim,"")},makeArray:function(arr,results){var ret=results||[];if(arr!=null){if(isArrayLike(Object(arr))){jQuery.merge(ret,typeof arr==="string"?[arr]:arr)}else{push.call(ret,arr)}}return ret},inArray:function(elem,arr,i){return arr==null?-1:indexOf.call(arr,elem,i)},merge:function(first,second){var len=+second.length,j=0,i=first.length;for(;j<len;j++){first[i++]=second[j]}first.length=i;return first},grep:function(elems,callback,invert){var callbackInverse,matches=[],i=0,length=elems.length,callbackExpect=!invert;for(;i<length;i++){callbackInverse=!callback(elems[i],i);if(callbackInverse!==callbackExpect){matches.push(elems[i])}}return matches},map:function(elems,callback,arg){var length,value,i=0,ret=[];if(isArrayLike(elems)){length=elems.length;for(;i<length;i++){value=callback(elems[i],i,arg);if(value!=null){ret.push(value)}}}else{for(i in elems){value=callback(elems[i],i,arg);if(value!=null){ret.push(value)}}}return concat.apply([],ret)},guid:1,proxy:function(fn,context){var tmp,args,proxy;if(typeof context==="string"){tmp=fn[context];context=fn;fn=tmp}if(!jQuery.isFunction(fn)){return undefined}args=slice.call(arguments,2);proxy=function(){return fn.apply(context||this,args.concat(slice.call(arguments)))};proxy.guid=fn.guid=fn.guid||jQuery.guid++;return proxy},now:Date.now,support:support});if(typeof Symbol==="function"){jQuery.fn[Symbol.iterator]=arr[Symbol.iterator]}jQuery.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase()});function isArrayLike(obj){var length=!!obj&&"length"in obj&&obj.length,type=jQuery.type(obj);if(type==="function"||jQuery.isWindow(obj)){return false}return type==="array"||length===0||typeof length==="number"&&length>0&&length-1 in obj}var Sizzle=function(window){var i,support,Expr,getText,isXML,tokenize,compile,select,outermostContext,sortInput,hasDuplicate,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+1*new Date,preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),sortOrder=function(a,b){if(a===b){hasDuplicate=true}return 0},MAX_NEGATIVE=1<<31,hasOwn={}.hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=function(list,elem){var i=0,len=list.length;for(;i<len;i++){if(list[i]===elem){return i}}return-1},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",identifier="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",attributes="\\["+whitespace+"*("+identifier+")(?:"+whitespace+"*([*^$|!~]?=)"+whitespace+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+identifier+"))|)"+whitespace+"*\\]",pseudos=":("+identifier+")(?:\\(("+"('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|"+"((?:\\\\.|[^\\\\()[\\]]|"+attributes+")*)|"+".*"+")\\)|)",rwhitespace=new RegExp(whitespace+"+","g"),rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rattributeQuotes=new RegExp("="+whitespace+"*([^\\]'\"]*?)"+whitespace+"*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={ID:new RegExp("^#("+identifier+")"),CLASS:new RegExp("^\\.("+identifier+")"),TAG:new RegExp("^("+identifier+"|[*])"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),bool:new RegExp("^(?:"+booleans+")$","i"),needsContext:new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rsibling=/[+~]/,rescape=/'|\\/g,runescape=new RegExp("\\\\([\\da-f]{1,6}"+whitespace+"?|("+whitespace+")|.)","ig"),funescape=function(_,escaped,escapedWhitespace){var high="0x"+escaped-65536;return high!==high||escapedWhitespace?escaped:high<0?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,high&1023|56320)},unloadHandler=function(){setDocument()};try{push.apply(arr=slice.call(preferredDoc.childNodes),preferredDoc.childNodes);arr[preferredDoc.childNodes.length].nodeType}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els))}:function(target,els){var j=target.length,i=0;while(target[j++]=els[i++]){}target.length=j-1}}}function Sizzle(selector,context,results,seed){var m,i,elem,nid,nidselect,match,groups,newSelector,newContext=context&&context.ownerDocument,nodeType=context?context.nodeType:9;results=results||[];if(typeof selector!=="string"||!selector||nodeType!==1&&nodeType!==9&&nodeType!==11){return results}if(!seed){if((context?context.ownerDocument||context:preferredDoc)!==document){setDocument(context)}context=context||document;if(documentIsHTML){if(nodeType!==11&&(match=rquickExpr.exec(selector))){if(m=match[1]){if(nodeType===9){if(elem=context.getElementById(m)){if(elem.id===m){results.push(elem);return results}}else{return results}}else{if(newContext&&(elem=newContext.getElementById(m))&&contains(context,elem)&&elem.id===m){results.push(elem);return results}}}else if(match[2]){push.apply(results,context.getElementsByTagName(selector));return results}else if((m=match[3])&&support.getElementsByClassName&&context.getElementsByClassName){push.apply(results,context.getElementsByClassName(m));return results}}if(support.qsa&&!compilerCache[selector+" "]&&(!rbuggyQSA||!rbuggyQSA.test(selector))){if(nodeType!==1){newContext=context;newSelector=selector}else if(context.nodeName.toLowerCase()!=="object"){if(nid=context.getAttribute("id")){nid=nid.replace(rescape,"\\$&")}else{context.setAttribute("id",nid=expando)}groups=tokenize(selector);i=groups.length;nidselect=ridentifier.test(nid)?"#"+nid:"[id='"+nid+"']";while(i--){groups[i]=nidselect+" "+toSelector(groups[i])}newSelector=groups.join(",");newContext=rsibling.test(selector)&&testContext(context.parentNode)||context}if(newSelector){try{push.apply(results,newContext.querySelectorAll(newSelector));return results}catch(qsaError){}finally{if(nid===expando){context.removeAttribute("id")}}}}}}return select(selector.replace(rtrim,"$1"),context,results,seed)}function createCache(){var keys=[];function cache(key,value){if(keys.push(key+" ")>Expr.cacheLength){delete cache[keys.shift()]}return cache[key+" "]=value}return cache}function markFunction(fn){fn[expando]=true;return fn}function assert(fn){var div=document.createElement("div");try{return!!fn(div)}catch(e){return false}finally{if(div.parentNode){div.parentNode.removeChild(div)}div=null}}function addHandle(attrs,handler){var arr=attrs.split("|"),i=arr.length;while(i--){Expr.attrHandle[arr[i]]=handler}}function siblingCheck(a,b){var cur=b&&a,diff=cur&&a.nodeType===1&&b.nodeType===1&&(~b.sourceIndex||MAX_NEGATIVE)-(~a.sourceIndex||MAX_NEGATIVE);if(diff){return diff}if(cur){while(cur=cur.nextSibling){if(cur===b){return-1}}}return a?1:-1}function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return(name==="input"||name==="button")&&elem.type===type}}function createPositionalPseudo(fn){return markFunction(function(argument){argument=+argument;return markFunction(function(seed,matches){var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;while(i--){if(seed[j=matchIndexes[i]]){seed[j]=!(matches[j]=seed[j])}}})})}function testContext(context){return context&&typeof context.getElementsByTagName!=="undefined"&&context}support=Sizzle.support={};isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return documentElement?documentElement.nodeName!=="HTML":false};setDocument=Sizzle.setDocument=function(node){var hasCompare,parent,doc=node?node.ownerDocument||node:preferredDoc;if(doc===document||doc.nodeType!==9||!doc.documentElement){return document}document=doc;docElem=document.documentElement;documentIsHTML=!isXML(document);if((parent=document.defaultView)&&parent.top!==parent){if(parent.addEventListener){parent.addEventListener("unload",unloadHandler,false)}else if(parent.attachEvent){parent.attachEvent("onunload",unloadHandler)}}support.attributes=assert(function(div){div.className="i";return!div.getAttribute("className")});support.getElementsByTagName=assert(function(div){div.appendChild(document.createComment(""));return!div.getElementsByTagName("*").length});support.getElementsByClassName=rnative.test(document.getElementsByClassName);support.getById=assert(function(div){docElem.appendChild(div).id=expando;return!document.getElementsByName||!document.getElementsByName(expando).length});if(support.getById){Expr.find["ID"]=function(id,context){if(typeof context.getElementById!=="undefined"&&documentIsHTML){var m=context.getElementById(id);return m?[m]:[]}};Expr.filter["ID"]=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}}}else{delete Expr.find["ID"];Expr.filter["ID"]=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node=typeof elem.getAttributeNode!=="undefined"&&elem.getAttributeNode("id");return node&&node.value===attrId}}}Expr.find["TAG"]=support.getElementsByTagName?function(tag,context){if(typeof context.getElementsByTagName!=="undefined"){return context.getElementsByTagName(tag)}else if(support.qsa){return context.querySelectorAll(tag)}}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if(tag==="*"){while(elem=results[i++]){if(elem.nodeType===1){tmp.push(elem)}}return tmp}return results};Expr.find["CLASS"]=support.getElementsByClassName&&function(className,context){if(typeof context.getElementsByClassName!=="undefined"&&documentIsHTML){return context.getElementsByClassName(className)}};rbuggyMatches=[];rbuggyQSA=[];if(support.qsa=rnative.test(document.querySelectorAll)){assert(function(div){docElem.appendChild(div).innerHTML="<a id='"+expando+"'></a>"+"<select id='"+expando+"-\r\\' msallowcapture=''>"+"<option selected=''></option></select>";if(div.querySelectorAll("[msallowcapture^='']").length){rbuggyQSA.push("[*^$]="+whitespace+"*(?:''|\"\")")}if(!div.querySelectorAll("[selected]").length){rbuggyQSA.push("\\["+whitespace+"*(?:value|"+booleans+")")}if(!div.querySelectorAll("[id~="+expando+"-]").length){rbuggyQSA.push("~=")}if(!div.querySelectorAll(":checked").length){rbuggyQSA.push(":checked")}if(!div.querySelectorAll("a#"+expando+"+*").length){rbuggyQSA.push(".#.+[+~]")}});assert(function(div){var input=document.createElement("input");input.setAttribute("type","hidden");div.appendChild(input).setAttribute("name","D");if(div.querySelectorAll("[name=d]").length){rbuggyQSA.push("name"+whitespace+"*[*^$|!~]?=")}if(!div.querySelectorAll(":enabled").length){rbuggyQSA.push(":enabled",":disabled")}div.querySelectorAll("*,:x");rbuggyQSA.push(",.*:")})}if(support.matchesSelector=rnative.test(matches=docElem.matches||docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector)){assert(function(div){support.disconnectedMatch=matches.call(div,"div");matches.call(div,"[s!='']:x");rbuggyMatches.push("!=",pseudos)})}rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|"));rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|"));hasCompare=rnative.test(docElem.compareDocumentPosition);contains=hasCompare||rnative.test(docElem.contains)?function(a,b){var adown=a.nodeType===9?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!!(bup&&bup.nodeType===1&&(adown.contains?adown.contains(bup):a.compareDocumentPosition&&a.compareDocumentPosition(bup)&16))}:function(a,b){if(b){while(b=b.parentNode){if(b===a){return true}}}return false};sortOrder=hasCompare?function(a,b){if(a===b){hasDuplicate=true;return 0}var compare=!a.compareDocumentPosition-!b.compareDocumentPosition;if(compare){return compare}compare=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1;if(compare&1||!support.sortDetached&&b.compareDocumentPosition(a)===compare){if(a===document||a.ownerDocument===preferredDoc&&contains(preferredDoc,a)){return-1}if(b===document||b.ownerDocument===preferredDoc&&contains(preferredDoc,b)){return 1}return sortInput?indexOf(sortInput,a)-indexOf(sortInput,b):0}return compare&4?-1:1}:function(a,b){if(a===b){hasDuplicate=true;return 0}var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(!aup||!bup){return a===document?-1:b===document?1:aup?-1:bup?1:sortInput?indexOf(sortInput,a)-indexOf(sortInput,b):0}else if(aup===bup){return siblingCheck(a,b)}cur=a;while(cur=cur.parentNode){ap.unshift(cur)}cur=b;while(cur=cur.parentNode){bp.unshift(cur)}while(ap[i]===bp[i]){i++}return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0};return document};Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)};Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document){setDocument(elem)}expr=expr.replace(rattributeQuotes,"='$1']");if(support.matchesSelector&&documentIsHTML&&!compilerCache[expr+" "]&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr))){try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&elem.document.nodeType!==11){return ret}}catch(e){}}return Sizzle(expr,document,null,[elem]).length>0};Sizzle.contains=function(context,elem){if((context.ownerDocument||context)!==document){setDocument(context)}return contains(context,elem)};Sizzle.attr=function(elem,name){if((elem.ownerDocument||elem)!==document){setDocument(elem)}var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):undefined;return val!==undefined?val:support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null};Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)};Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;hasDuplicate=!support.detectDuplicates;sortInput=!support.sortStable&&results.slice(0);results.sort(sortOrder);if(hasDuplicate){while(elem=results[i++]){if(elem===results[i]){j=duplicates.push(i)}}while(j--){results.splice(duplicates[j],1)}}sortInput=null;return results};getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(!nodeType){while(node=elem[i++]){ret+=getText(node)}}else if(nodeType===1||nodeType===9||nodeType===11){if(typeof elem.textContent==="string"){return elem.textContent}else{for(elem=elem.firstChild;elem;elem=elem.nextSibling){ret+=getText(elem)}}}else if(nodeType===3||nodeType===4){return elem.nodeValue}return ret};Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:true}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:true},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){match[1]=match[1].replace(runescape,funescape);match[3]=(match[3]||match[4]||match[5]||"").replace(runescape,funescape);if(match[2]==="~="){match[3]=" "+match[3]+" "}return match.slice(0,4)},CHILD:function(match){match[1]=match[1].toLowerCase();if(match[1].slice(0,3)==="nth"){if(!match[3]){Sizzle.error(match[0])}match[4]=+(match[4]?match[5]+(match[6]||1):2*(match[3]==="even"||match[3]==="odd"));match[5]=+(match[7]+match[8]||match[3]==="odd")}else if(match[3]){Sizzle.error(match[0])}return match},PSEUDO:function(match){var excess,unquoted=!match[6]&&match[2];if(matchExpr["CHILD"].test(match[0])){return null}if(match[3]){match[2]=match[4]||match[5]||""}else if(unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,true))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)){match[0]=match[0].slice(0,excess);match[2]=unquoted.slice(0,excess)}return match.slice(0,3)}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return nodeNameSelector==="*"?function(){return true}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test(typeof elem.className==="string"&&elem.className||typeof elem.getAttribute!=="undefined"&&elem.getAttribute("class")||"")})},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);if(result==null){return operator==="!="}if(!operator){return true}result+="";return operator==="="?result===check:operator==="!="?result!==check:operator==="^="?check&&result.indexOf(check)===0:operator==="*="?check&&result.indexOf(check)>-1:operator==="$="?check&&result.slice(-check.length)===check:operator==="~="?(" "+result.replace(rwhitespace," ")+" ").indexOf(check)>-1:operator==="|="?result===check||result.slice(0,check.length+1)===check+"-":false}},CHILD:function(type,what,argument,first,last){var simple=type.slice(0,3)!=="nth",forward=type.slice(-4)!=="last",ofType=what==="of-type";return first===1&&last===0?function(elem){return!!elem.parentNode}:function(elem,context,xml){var cache,uniqueCache,outerCache,node,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType,diff=false;if(parent){if(simple){while(dir){node=elem;while(node=node[dir]){if(ofType?node.nodeName.toLowerCase()===name:node.nodeType===1){return false}}start=dir=type==="only"&&!start&&"nextSibling"}return true}start=[forward?parent.firstChild:parent.lastChild];if(forward&&useCache){node=parent;outerCache=node[expando]||(node[expando]={});uniqueCache=outerCache[node.uniqueID]||(outerCache[node.uniqueID]={});cache=uniqueCache[type]||[];nodeIndex=cache[0]===dirruns&&cache[1];diff=nodeIndex&&cache[2];node=nodeIndex&&parent.childNodes[nodeIndex];while(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop()){if(node.nodeType===1&&++diff&&node===elem){uniqueCache[type]=[dirruns,nodeIndex,diff];break}}}else{if(useCache){node=elem;outerCache=node[expando]||(node[expando]={});uniqueCache=outerCache[node.uniqueID]||(outerCache[node.uniqueID]={});cache=uniqueCache[type]||[];nodeIndex=cache[0]===dirruns&&cache[1];diff=nodeIndex}if(diff===false){while(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop()){if((ofType?node.nodeName.toLowerCase()===name:node.nodeType===1)&&++diff){if(useCache){outerCache=node[expando]||(node[expando]={});uniqueCache=outerCache[node.uniqueID]||(outerCache[node.uniqueID]={});uniqueCache[type]=[dirruns,diff]}if(node===elem){break}}}}}diff-=last;return diff===first||diff%first===0&&diff/first>=0}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);if(fn[expando]){return fn(argument)}if(fn.length>1){args=[pseudo,pseudo,"",argument];return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){var idx,matched=fn(seed,argument),i=matched.length;while(i--){idx=indexOf(seed,matched[i]);seed[idx]=!(matches[idx]=matched[i])}}):function(elem){return fn(elem,0,args)}}return fn}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;while(i--){if(elem=unmatched[i]){seed[i]=!(matches[i]=elem)}}}):function(elem,context,xml){input[0]=elem;matcher(input,null,xml,results);input[0]=null;return!results.pop()}}),has:markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0}}),contains:markFunction(function(text){text=text.replace(runescape,funescape);return function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1}}),lang:markFunction(function(lang){if(!ridentifier.test(lang||"")){Sizzle.error("unsupported lang: "+lang)}lang=lang.replace(runescape,funescape).toLowerCase();return function(elem){var elemLang;do{if(elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang")){elemLang=elemLang.toLowerCase();return elemLang===lang||elemLang.indexOf(lang+"-")===0}}while((elem=elem.parentNode)&&elem.nodeType===1);return false}}),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:function(elem){return elem.disabled===false},disabled:function(elem){return elem.disabled===true},checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return nodeName==="input"&&!!elem.checked||nodeName==="option"&&!!elem.selected},selected:function(elem){if(elem.parentNode){elem.parentNode.selectedIndex}return elem.selected===true},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling){if(elem.nodeType<6){return false}}return true},parent:function(elem){return!Expr.pseudos["empty"](elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type==="button"||name==="button"},text:function(elem){var attr;return elem.nodeName.toLowerCase()==="input"&&elem.type==="text"&&((attr=elem.getAttribute("type"))==null||attr.toLowerCase()==="text")},first:createPositionalPseudo(function(){return[0]}),last:createPositionalPseudo(function(matchIndexes,length){return[length-1]}),eq:createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument]}),even:createPositionalPseudo(function(matchIndexes,length){var i=0;for(;i<length;i+=2){matchIndexes.push(i)}return matchIndexes}),odd:createPositionalPseudo(function(matchIndexes,length){var i=1;for(;i<length;i+=2){matchIndexes.push(i)}return matchIndexes}),lt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;--i>=0;){matchIndexes.push(i)}return matchIndexes}),gt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;++i<length;){matchIndexes.push(i)}return matchIndexes})}};Expr.pseudos["nth"]=Expr.pseudos["eq"];for(i in{radio:true,checkbox:true,file:true,password:true,image:true}){Expr.pseudos[i]=createInputPseudo(i)}for(i in{submit:true,reset:true}){Expr.pseudos[i]=createButtonPseudo(i)}function setFilters(){}setFilters.prototype=Expr.filters=Expr.pseudos;Expr.setFilters=new setFilters;tokenize=Sizzle.tokenize=function(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached){return parseOnly?0:cached.slice(0)}soFar=selector;groups=[];preFilters=Expr.preFilter;while(soFar){if(!matched||(match=rcomma.exec(soFar))){if(match){soFar=soFar.slice(match[0].length)||soFar}groups.push(tokens=[])}matched=false;if(match=rcombinators.exec(soFar)){matched=match.shift();tokens.push({value:matched,type:match[0].replace(rtrim," ")});soFar=soFar.slice(matched.length)}for(type in Expr.filter){if((match=matchExpr[type].exec(soFar))&&(!preFilters[type]||(match=preFilters[type](match)))){matched=match.shift();tokens.push({value:matched,type:type,matches:match});soFar=soFar.slice(matched.length)}}if(!matched){break}}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)};function toSelector(tokens){var i=0,len=tokens.length,selector="";for(;i<len;i++){selector+=tokens[i].value}return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&dir==="parentNode",doneName=done++;return combinator.first?function(elem,context,xml){while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){return matcher(elem,context,xml)}}}:function(elem,context,xml){var oldCache,uniqueCache,outerCache,newCache=[dirruns,doneName];if(xml){while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){if(matcher(elem,context,xml)){return true}}}}else{while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){outerCache=elem[expando]||(elem[expando]={});uniqueCache=outerCache[elem.uniqueID]||(outerCache[elem.uniqueID]={});if((oldCache=uniqueCache[dir])&&oldCache[0]===dirruns&&oldCache[1]===doneName){return newCache[2]=oldCache[2]}else{uniqueCache[dir]=newCache;if(newCache[2]=matcher(elem,context,xml)){return true}}}}}}}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){var i=matchers.length;while(i--){if(!matchers[i](elem,context,xml)){return false}}return true}:matchers[0]}function multipleContexts(selector,contexts,results){var i=0,len=contexts.length;for(;i<len;i++){Sizzle(selector,contexts[i],results)}return results}function condense(unmatched,map,filter,context,xml){var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=map!=null;for(;i<len;i++){if(elem=unmatched[i]){if(!filter||filter(elem,context,xml)){newUnmatched.push(elem);if(mapped){map.push(i)}}}}return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){if(postFilter&&!postFilter[expando]){postFilter=setMatcher(postFilter)}if(postFinder&&!postFinder[expando]){postFinder=setMatcher(postFinder,postSelector)}return markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType?[context]:context,[]),matcherIn=preFilter&&(seed||!selector)?condense(elems,preMap,preFilter,context,xml):elems,matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher){matcher(matcherIn,matcherOut,context,xml)}if(postFilter){temp=condense(matcherOut,postMap);postFilter(temp,[],context,xml);i=temp.length;while(i--){if(elem=temp[i]){matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem)}}}if(seed){if(postFinder||preFilter){if(postFinder){temp=[];i=matcherOut.length;while(i--){if(elem=matcherOut[i]){temp.push(matcherIn[i]=elem)}}postFinder(null,matcherOut=[],temp,xml)}i=matcherOut.length;while(i--){if((elem=matcherOut[i])&&(temp=postFinder?indexOf(seed,elem):preMap[i])>-1){seed[temp]=!(results[temp]=elem)}}}}else{matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut);if(postFinder){postFinder(null,results,matcherOut,xml)}else{push.apply(results,matcherOut)}}})}function matcherFromTokens(tokens){var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext},implicitRelative,true),matchAnyContext=addCombinator(function(elem){return indexOf(checkContext,elem)>-1},implicitRelative,true),matchers=[function(elem,context,xml){var ret=!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml));checkContext=null;return ret}];for(;i<len;i++){if(matcher=Expr.relative[tokens[i].type]){matchers=[addCombinator(elementMatcher(matchers),matcher)]}else{matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches);if(matcher[expando]){j=++i;for(;j<len;j++){if(Expr.relative[tokens[j].type]){break}}return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:tokens[i-2].type===" "?"*":""})).replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens(tokens=tokens.slice(j)),j<len&&toSelector(tokens))}matchers.push(matcher)}}return elementMatcher(matchers)}function matcherFromGroupMatchers(elementMatchers,setMatchers){var bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,outermost){var elem,j,matcher,matchedCount=0,i="0",unmatched=seed&&[],setMatched=[],contextBackup=outermostContext,elems=seed||byElement&&Expr.find["TAG"]("*",outermost),dirrunsUnique=dirruns+=contextBackup==null?1:Math.random()||.1,len=elems.length;if(outermost){outermostContext=context===document||context||outermost}for(;i!==len&&(elem=elems[i])!=null;i++){if(byElement&&elem){j=0;if(!context&&elem.ownerDocument!==document){setDocument(elem);xml=!documentIsHTML}while(matcher=elementMatchers[j++]){if(matcher(elem,context||document,xml)){results.push(elem);break}}if(outermost){dirruns=dirrunsUnique}}if(bySet){if(elem=!matcher&&elem){matchedCount--}if(seed){unmatched.push(elem)}}}matchedCount+=i;if(bySet&&i!==matchedCount){j=0;while(matcher=setMatchers[j++]){matcher(unmatched,setMatched,context,xml)}if(seed){if(matchedCount>0){while(i--){if(!(unmatched[i]||setMatched[i])){setMatched[i]=pop.call(results)}}}setMatched=condense(setMatched)}push.apply(results,setMatched);if(outermost&&!seed&&setMatched.length>0&&matchedCount+setMatchers.length>1){Sizzle.uniqueSort(results)}}if(outermost){dirruns=dirrunsUnique;outermostContext=contextBackup}return unmatched};return bySet?markFunction(superMatcher):superMatcher}compile=Sizzle.compile=function(selector,match){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){if(!match){match=tokenize(selector)}i=match.length;while(i--){cached=matcherFromTokens(match[i]);if(cached[expando]){setMatchers.push(cached)}else{elementMatchers.push(cached)}}cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers));cached.selector=selector}return cached};select=Sizzle.select=function(selector,context,results,seed){var i,tokens,token,type,find,compiled=typeof selector==="function"&&selector,match=!seed&&tokenize(selector=compiled.selector||selector);results=results||[];if(match.length===1){tokens=match[0]=match[0].slice(0);if(tokens.length>2&&(token=tokens[0]).type==="ID"&&support.getById&&context.nodeType===9&&documentIsHTML&&Expr.relative[tokens[1].type]){context=(Expr.find["ID"](token.matches[0].replace(runescape,funescape),context)||[])[0];if(!context){return results}else if(compiled){context=context.parentNode}selector=selector.slice(tokens.shift().value.length)}i=matchExpr["needsContext"].test(selector)?0:tokens.length;while(i--){token=tokens[i];if(Expr.relative[type=token.type]){break}if(find=Expr.find[type]){if(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&testContext(context.parentNode)||context)){tokens.splice(i,1);selector=seed.length&&toSelector(tokens);if(!selector){push.apply(results,seed);return results}break}}}}(compiled||compile(selector,match))(seed,context,!documentIsHTML,results,!context||rsibling.test(selector)&&testContext(context.parentNode)||context);return results};support.sortStable=expando.split("").sort(sortOrder).join("")===expando;support.detectDuplicates=!!hasDuplicate;setDocument();support.sortDetached=assert(function(div1){return div1.compareDocumentPosition(document.createElement("div"))&1});if(!assert(function(div){div.innerHTML="<a href='#'></a>";return div.firstChild.getAttribute("href")==="#"})){addHandle("type|href|height|width",function(elem,name,isXML){if(!isXML){return elem.getAttribute(name,name.toLowerCase()==="type"?1:2)}})}if(!support.attributes||!assert(function(div){div.innerHTML="<input/>";div.firstChild.setAttribute("value","");return div.firstChild.getAttribute("value")===""})){addHandle("value",function(elem,name,isXML){if(!isXML&&elem.nodeName.toLowerCase()==="input"){return elem.defaultValue}})}if(!assert(function(div){return div.getAttribute("disabled")==null})){addHandle(booleans,function(elem,name,isXML){var val;if(!isXML){return elem[name]===true?name.toLowerCase():(val=elem.getAttributeNode(name))&&val.specified?val.value:null}})}return Sizzle}(window);jQuery.find=Sizzle;jQuery.expr=Sizzle.selectors;jQuery.expr[":"]=jQuery.expr.pseudos;jQuery.uniqueSort=jQuery.unique=Sizzle.uniqueSort;jQuery.text=Sizzle.getText;jQuery.isXMLDoc=Sizzle.isXML;jQuery.contains=Sizzle.contains;var dir=function(elem,dir,until){var matched=[],truncate=until!==undefined;while((elem=elem[dir])&&elem.nodeType!==9){if(elem.nodeType===1){if(truncate&&jQuery(elem).is(until)){break}matched.push(elem)}}return matched};var siblings=function(n,elem){var matched=[];for(;n;n=n.nextSibling){if(n.nodeType===1&&n!==elem){matched.push(n)}}return matched};var rneedsContext=jQuery.expr.match.needsContext;var rsingleTag=/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/;var risSimple=/^.[^:#\[\.,]*$/;function winnow(elements,qualifier,not){if(jQuery.isFunction(qualifier)){return jQuery.grep(elements,function(elem,i){return!!qualifier.call(elem,i,elem)!==not})}if(qualifier.nodeType){return jQuery.grep(elements,function(elem){return elem===qualifier!==not})}if(typeof qualifier==="string"){if(risSimple.test(qualifier)){return jQuery.filter(qualifier,elements,not)}qualifier=jQuery.filter(qualifier,elements)}return jQuery.grep(elements,function(elem){return indexOf.call(qualifier,elem)>-1!==not})}jQuery.filter=function(expr,elems,not){var elem=elems[0];if(not){expr=":not("+expr+")"}return elems.length===1&&elem.nodeType===1?jQuery.find.matchesSelector(elem,expr)?[elem]:[]:jQuery.find.matches(expr,jQuery.grep(elems,function(elem){return elem.nodeType===1}))};jQuery.fn.extend({find:function(selector){var i,len=this.length,ret=[],self=this;if(typeof selector!=="string"){return this.pushStack(jQuery(selector).filter(function(){for(i=0;i<len;i++){if(jQuery.contains(self[i],this)){return true}}}))}for(i=0;i<len;i++){jQuery.find(selector,self[i],ret)}ret=this.pushStack(len>1?jQuery.unique(ret):ret);ret.selector=this.selector?this.selector+" "+selector:selector;return ret},filter:function(selector){return this.pushStack(winnow(this,selector||[],false))},not:function(selector){return this.pushStack(winnow(this,selector||[],true))},is:function(selector){return!!winnow(this,typeof selector==="string"&&rneedsContext.test(selector)?jQuery(selector):selector||[],false).length}});var rootjQuery,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,init=jQuery.fn.init=function(selector,context,root){var match,elem;if(!selector){return this}root=root||rootjQuery;if(typeof selector==="string"){if(selector[0]==="<"&&selector[selector.length-1]===">"&&selector.length>=3){match=[null,selector,null]}else{match=rquickExpr.exec(selector)}if(match&&(match[1]||!context)){if(match[1]){context=context instanceof jQuery?context[0]:context;jQuery.merge(this,jQuery.parseHTML(match[1],context&&context.nodeType?context.ownerDocument||context:document,true));if(rsingleTag.test(match[1])&&jQuery.isPlainObject(context)){for(match in context){if(jQuery.isFunction(this[match])){this[match](context[match])}else{this.attr(match,context[match])}}}return this}else{elem=document.getElementById(match[2]);if(elem&&elem.parentNode){this.length=1;this[0]=elem}this.context=document;this.selector=selector;return this}}else if(!context||context.jquery){return(context||root).find(selector)}else{return this.constructor(context).find(selector)}}else if(selector.nodeType){this.context=this[0]=selector;this.length=1;return this}else if(jQuery.isFunction(selector)){return root.ready!==undefined?root.ready(selector):selector(jQuery)}if(selector.selector!==undefined){this.selector=selector.selector;this.context=selector.context}return jQuery.makeArray(selector,this)};init.prototype=jQuery.fn;rootjQuery=jQuery(document);var rparentsprev=/^(?:parents|prev(?:Until|All))/,guaranteedUnique={children:true,contents:true,next:true,prev:true};jQuery.fn.extend({has:function(target){var targets=jQuery(target,this),l=targets.length;return this.filter(function(){var i=0;for(;i<l;i++){if(jQuery.contains(this,targets[i])){return true}}})},closest:function(selectors,context){var cur,i=0,l=this.length,matched=[],pos=rneedsContext.test(selectors)||typeof selectors!=="string"?jQuery(selectors,context||this.context):0;for(;i<l;i++){for(cur=this[i];cur&&cur!==context;cur=cur.parentNode){if(cur.nodeType<11&&(pos?pos.index(cur)>-1:cur.nodeType===1&&jQuery.find.matchesSelector(cur,selectors))){matched.push(cur);break}}}return this.pushStack(matched.length>1?jQuery.uniqueSort(matched):matched)},index:function(elem){if(!elem){return this[0]&&this[0].parentNode?this.first().prevAll().length:-1}if(typeof elem==="string"){return indexOf.call(jQuery(elem),this[0])}return indexOf.call(this,elem.jquery?elem[0]:elem)},add:function(selector,context){return this.pushStack(jQuery.uniqueSort(jQuery.merge(this.get(),jQuery(selector,context))))},addBack:function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector))}});function sibling(cur,dir){while((cur=cur[dir])&&cur.nodeType!==1){}return cur}jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&parent.nodeType!==11?parent:null},parents:function(elem){return dir(elem,"parentNode")},parentsUntil:function(elem,i,until){return dir(elem,"parentNode",until)},next:function(elem){return sibling(elem,"nextSibling")},prev:function(elem){return sibling(elem,"previousSibling")},nextAll:function(elem){return dir(elem,"nextSibling")},prevAll:function(elem){return dir(elem,"previousSibling")},nextUntil:function(elem,i,until){return dir(elem,"nextSibling",until)},prevUntil:function(elem,i,until){return dir(elem,"previousSibling",until)},siblings:function(elem){return siblings((elem.parentNode||{}).firstChild,elem)},children:function(elem){return siblings(elem.firstChild)},contents:function(elem){return elem.contentDocument||jQuery.merge([],elem.childNodes)}},function(name,fn){jQuery.fn[name]=function(until,selector){var matched=jQuery.map(this,fn,until);if(name.slice(-5)!=="Until"){selector=until}if(selector&&typeof selector==="string"){matched=jQuery.filter(selector,matched)}if(this.length>1){if(!guaranteedUnique[name]){jQuery.uniqueSort(matched)}if(rparentsprev.test(name)){matched.reverse()}}return this.pushStack(matched)}});var rnotwhite=/\S+/g;function createOptions(options){var object={};jQuery.each(options.match(rnotwhite)||[],function(_,flag){object[flag]=true});return object}jQuery.Callbacks=function(options){options=typeof options==="string"?createOptions(options):jQuery.extend({},options);var firing,memory,fired,locked,list=[],queue=[],firingIndex=-1,fire=function(){locked=options.once;fired=firing=true;for(;queue.length;firingIndex=-1){memory=queue.shift();while(++firingIndex<list.length){if(list[firingIndex].apply(memory[0],memory[1])===false&&options.stopOnFalse){firingIndex=list.length;memory=false}}}if(!options.memory){memory=false}firing=false;if(locked){if(memory){list=[]}else{list=""}}},self={add:function(){if(list){if(memory&&!firing){firingIndex=list.length-1;queue.push(memory)}(function add(args){jQuery.each(args,function(_,arg){if(jQuery.isFunction(arg)){if(!options.unique||!self.has(arg)){list.push(arg)}}else if(arg&&arg.length&&jQuery.type(arg)!=="string"){add(arg)}})})(arguments);if(memory&&!firing){fire()}}return this},remove:function(){jQuery.each(arguments,function(_,arg){var index;while((index=jQuery.inArray(arg,list,index))>-1){list.splice(index,1);if(index<=firingIndex){firingIndex--}}});return this},has:function(fn){return fn?jQuery.inArray(fn,list)>-1:list.length>0},empty:function(){if(list){list=[]}return this},disable:function(){locked=queue=[];list=memory="";return this},disabled:function(){return!list},lock:function(){locked=queue=[];if(!memory){list=memory=""}return this},locked:function(){return!!locked},fireWith:function(context,args){if(!locked){args=args||[];args=[context,args.slice?args.slice():args];queue.push(args);if(!firing){fire()}}return this},fire:function(){self.fireWith(this,arguments);return this},fired:function(){return!!fired}};return self};jQuery.extend({Deferred:function(func){var tuples=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],state="pending",promise={state:function(){return state},always:function(){deferred.done(arguments).fail(arguments);return this},then:function(){var fns=arguments;return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var fn=jQuery.isFunction(fns[i])&&fns[i];deferred[tuple[1]](function(){var returned=fn&&fn.apply(this,arguments);if(returned&&jQuery.isFunction(returned.promise)){returned.promise().progress(newDefer.notify).done(newDefer.resolve).fail(newDefer.reject)}else{newDefer[tuple[0]+"With"](this===promise?newDefer.promise():this,fn?[returned]:arguments)}})});fns=null}).promise()},promise:function(obj){return obj!=null?jQuery.extend(obj,promise):promise}},deferred={};promise.pipe=promise.then;jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[3];promise[tuple[1]]=list.add;if(stateString){list.add(function(){state=stateString},tuples[i^1][2].disable,tuples[2][2].lock)}deferred[tuple[0]]=function(){deferred[tuple[0]+"With"](this===deferred?promise:this,arguments);return this};deferred[tuple[0]+"With"]=list.fireWith});promise.promise(deferred);if(func){func.call(deferred,deferred)}return deferred},when:function(subordinate){var i=0,resolveValues=slice.call(arguments),length=resolveValues.length,remaining=length!==1||subordinate&&jQuery.isFunction(subordinate.promise)?length:0,deferred=remaining===1?subordinate:jQuery.Deferred(),updateFunc=function(i,contexts,values){return function(value){contexts[i]=this;values[i]=arguments.length>1?slice.call(arguments):value;if(values===progressValues){deferred.notifyWith(contexts,values)}else if(!--remaining){deferred.resolveWith(contexts,values)}}},progressValues,progressContexts,resolveContexts;if(length>1){progressValues=new Array(length);progressContexts=new Array(length);resolveContexts=new Array(length);for(;i<length;i++){if(resolveValues[i]&&jQuery.isFunction(resolveValues[i].promise)){resolveValues[i].promise().progress(updateFunc(i,progressContexts,progressValues)).done(updateFunc(i,resolveContexts,resolveValues)).fail(deferred.reject)}else{--remaining}}}if(!remaining){deferred.resolveWith(resolveContexts,resolveValues)}return deferred.promise()}});var readyList;jQuery.fn.ready=function(fn){jQuery.ready.promise().done(fn);return this};jQuery.extend({isReady:false,readyWait:1,holdReady:function(hold){if(hold){jQuery.readyWait++}else{jQuery.ready(true)}},ready:function(wait){if(wait===true?--jQuery.readyWait:jQuery.isReady){return}jQuery.isReady=true;if(wait!==true&&--jQuery.readyWait>0){return}readyList.resolveWith(document,[jQuery]);if(jQuery.fn.triggerHandler){jQuery(document).triggerHandler("ready");jQuery(document).off("ready")}}});function completed(){document.removeEventListener("DOMContentLoaded",completed);window.removeEventListener("load",completed);jQuery.ready()}jQuery.ready.promise=function(obj){if(!readyList){readyList=jQuery.Deferred();if(document.readyState==="complete"||document.readyState!=="loading"&&!document.documentElement.doScroll){window.setTimeout(jQuery.ready)}else{document.addEventListener("DOMContentLoaded",completed);window.addEventListener("load",completed)}}return readyList.promise(obj)};jQuery.ready.promise();var access=function(elems,fn,key,value,chainable,emptyGet,raw){var i=0,len=elems.length,bulk=key==null;if(jQuery.type(key)==="object"){chainable=true;for(i in key){access(elems,fn,i,key[i],true,emptyGet,raw)}}else if(value!==undefined){chainable=true;if(!jQuery.isFunction(value)){raw=true}if(bulk){if(raw){fn.call(elems,value);fn=null}else{bulk=fn;fn=function(elem,key,value){return bulk.call(jQuery(elem),value)}}}if(fn){for(;i<len;i++){fn(elems[i],key,raw?value:value.call(elems[i],i,fn(elems[i],key)))}}}return chainable?elems:bulk?fn.call(elems):len?fn(elems[0],key):emptyGet};var acceptData=function(owner){return owner.nodeType===1||owner.nodeType===9||!+owner.nodeType};function Data(){this.expando=jQuery.expando+Data.uid++}Data.uid=1;Data.prototype={register:function(owner,initial){var value=initial||{};if(owner.nodeType){owner[this.expando]=value}else{Object.defineProperty(owner,this.expando,{value:value,writable:true,configurable:true})}return owner[this.expando]},cache:function(owner){if(!acceptData(owner)){return{}}var value=owner[this.expando];if(!value){value={};if(acceptData(owner)){if(owner.nodeType){owner[this.expando]=value}else{Object.defineProperty(owner,this.expando,{value:value,configurable:true})}}}return value},set:function(owner,data,value){var prop,cache=this.cache(owner);if(typeof data==="string"){cache[data]=value}else{for(prop in data){cache[prop]=data[prop]}}return cache},get:function(owner,key){return key===undefined?this.cache(owner):owner[this.expando]&&owner[this.expando][key]},access:function(owner,key,value){var stored;if(key===undefined||key&&typeof key==="string"&&value===undefined){stored=this.get(owner,key);return stored!==undefined?stored:this.get(owner,jQuery.camelCase(key))}this.set(owner,key,value);return value!==undefined?value:key},remove:function(owner,key){var i,name,camel,cache=owner[this.expando];if(cache===undefined){return}if(key===undefined){this.register(owner)}else{if(jQuery.isArray(key)){name=key.concat(key.map(jQuery.camelCase))}else{camel=jQuery.camelCase(key);if(key in cache){name=[key,camel]}else{name=camel;name=name in cache?[name]:name.match(rnotwhite)||[]}}i=name.length;while(i--){delete cache[name[i]]}}if(key===undefined||jQuery.isEmptyObject(cache)){if(owner.nodeType){owner[this.expando]=undefined}else{delete owner[this.expando]}}},hasData:function(owner){var cache=owner[this.expando];return cache!==undefined&&!jQuery.isEmptyObject(cache)}};var dataPriv=new Data;var dataUser=new Data;var rbrace=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,rmultiDash=/[A-Z]/g;function dataAttr(elem,key,data){var name;if(data===undefined&&elem.nodeType===1){name="data-"+key.replace(rmultiDash,"-$&").toLowerCase();data=elem.getAttribute(name);if(typeof data==="string"){try{data=data==="true"?true:data==="false"?false:data==="null"?null:+data+""===data?+data:rbrace.test(data)?jQuery.parseJSON(data):data}catch(e){}dataUser.set(elem,key,data)}else{data=undefined}}return data}jQuery.extend({hasData:function(elem){return dataUser.hasData(elem)||dataPriv.hasData(elem)},data:function(elem,name,data){return dataUser.access(elem,name,data)},removeData:function(elem,name){dataUser.remove(elem,name)},_data:function(elem,name,data){return dataPriv.access(elem,name,data)},_removeData:function(elem,name){dataPriv.remove(elem,name)}});jQuery.fn.extend({data:function(key,value){var i,name,data,elem=this[0],attrs=elem&&elem.attributes;if(key===undefined){if(this.length){data=dataUser.get(elem);if(elem.nodeType===1&&!dataPriv.get(elem,"hasDataAttrs")){i=attrs.length;while(i--){if(attrs[i]){name=attrs[i].name;if(name.indexOf("data-")===0){name=jQuery.camelCase(name.slice(5));dataAttr(elem,name,data[name])}}}dataPriv.set(elem,"hasDataAttrs",true)}}return data}if(typeof key==="object"){return this.each(function(){dataUser.set(this,key)})}return access(this,function(value){var data,camelKey;if(elem&&value===undefined){data=dataUser.get(elem,key)||dataUser.get(elem,key.replace(rmultiDash,"-$&").toLowerCase());if(data!==undefined){return data}camelKey=jQuery.camelCase(key);data=dataUser.get(elem,camelKey);if(data!==undefined){return data}data=dataAttr(elem,camelKey,undefined);if(data!==undefined){return data}return}camelKey=jQuery.camelCase(key);this.each(function(){var data=dataUser.get(this,camelKey);dataUser.set(this,camelKey,value);if(key.indexOf("-")>-1&&data!==undefined){dataUser.set(this,key,value)}})},null,value,arguments.length>1,null,true)},removeData:function(key){return this.each(function(){dataUser.remove(this,key)})}});jQuery.extend({queue:function(elem,type,data){var queue;if(elem){type=(type||"fx")+"queue";queue=dataPriv.get(elem,type);if(data){if(!queue||jQuery.isArray(data)){queue=dataPriv.access(elem,type,jQuery.makeArray(data))}else{queue.push(data)}}return queue||[]}},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type),next=function(){jQuery.dequeue(elem,type)};if(fn==="inprogress"){fn=queue.shift();startLength--}if(fn){if(type==="fx"){queue.unshift("inprogress")}delete hooks.stop;fn.call(elem,next,hooks)}if(!startLength&&hooks){hooks.empty.fire()}},_queueHooks:function(elem,type){var key=type+"queueHooks";return dataPriv.get(elem,key)||dataPriv.access(elem,key,{empty:jQuery.Callbacks("once memory").add(function(){dataPriv.remove(elem,[type+"queue",key])})})}});jQuery.fn.extend({queue:function(type,data){var setter=2;if(typeof type!=="string"){data=type;type="fx";setter--}if(arguments.length<setter){return jQuery.queue(this[0],type)}return data===undefined?this:this.each(function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type);if(type==="fx"&&queue[0]!=="inprogress"){jQuery.dequeue(this,type)}})},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type)})},clearQueue:function(type){return this.queue(type||"fx",[])},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){if(!--count){defer.resolveWith(elements,[elements])}};if(typeof type!=="string"){obj=type;type=undefined}type=type||"fx";while(i--){tmp=dataPriv.get(elements[i],type+"queueHooks");if(tmp&&tmp.empty){count++;tmp.empty.add(resolve)}}resolve();return defer.promise(obj)}});var pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source;var rcssNum=new RegExp("^(?:([+-])=|)("+pnum+")([a-z%]*)$","i");var cssExpand=["Top","Right","Bottom","Left"];var isHidden=function(elem,el){elem=el||elem;return jQuery.css(elem,"display")==="none"||!jQuery.contains(elem.ownerDocument,elem)};function adjustCSS(elem,prop,valueParts,tween){var adjusted,scale=1,maxIterations=20,currentValue=tween?function(){return tween.cur()}:function(){return jQuery.css(elem,prop,"")},initial=currentValue(),unit=valueParts&&valueParts[3]||(jQuery.cssNumber[prop]?"":"px"),initialInUnit=(jQuery.cssNumber[prop]||unit!=="px"&&+initial)&&rcssNum.exec(jQuery.css(elem,prop));if(initialInUnit&&initialInUnit[3]!==unit){unit=unit||initialInUnit[3];valueParts=valueParts||[];initialInUnit=+initial||1;do{scale=scale||".5";initialInUnit=initialInUnit/scale;jQuery.style(elem,prop,initialInUnit+unit)}while(scale!==(scale=currentValue()/initial)&&scale!==1&&--maxIterations)}if(valueParts){initialInUnit=+initialInUnit||+initial||0;adjusted=valueParts[1]?initialInUnit+(valueParts[1]+1)*valueParts[2]:+valueParts[2];if(tween){tween.unit=unit;tween.start=initialInUnit;tween.end=adjusted}}return adjusted}var rcheckableType=/^(?:checkbox|radio)$/i;var rtagName=/<([\w:-]+)/;var rscriptType=/^$|\/(?:java|ecma)script/i;var wrapMap={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};wrapMap.optgroup=wrapMap.option;wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead;wrapMap.th=wrapMap.td;function getAll(context,tag){var ret=typeof context.getElementsByTagName!=="undefined"?context.getElementsByTagName(tag||"*"):typeof context.querySelectorAll!=="undefined"?context.querySelectorAll(tag||"*"):[];return tag===undefined||tag&&jQuery.nodeName(context,tag)?jQuery.merge([context],ret):ret}function setGlobalEval(elems,refElements){var i=0,l=elems.length;for(;i<l;i++){dataPriv.set(elems[i],"globalEval",!refElements||dataPriv.get(refElements[i],"globalEval"))}}var rhtml=/<|&#?\w+;/;function buildFragment(elems,context,scripts,selection,ignored){var elem,tmp,tag,wrap,contains,j,fragment=context.createDocumentFragment(),nodes=[],i=0,l=elems.length;for(;i<l;i++){elem=elems[i];if(elem||elem===0){if(jQuery.type(elem)==="object"){jQuery.merge(nodes,elem.nodeType?[elem]:elem)}else if(!rhtml.test(elem)){nodes.push(context.createTextNode(elem))}else{tmp=tmp||fragment.appendChild(context.createElement("div"));tag=(rtagName.exec(elem)||["",""])[1].toLowerCase();wrap=wrapMap[tag]||wrapMap._default;tmp.innerHTML=wrap[1]+jQuery.htmlPrefilter(elem)+wrap[2];j=wrap[0];while(j--){tmp=tmp.lastChild}jQuery.merge(nodes,tmp.childNodes);tmp=fragment.firstChild;tmp.textContent=""}}}fragment.textContent="";i=0;while(elem=nodes[i++]){if(selection&&jQuery.inArray(elem,selection)>-1){if(ignored){ignored.push(elem)}continue}contains=jQuery.contains(elem.ownerDocument,elem);tmp=getAll(fragment.appendChild(elem),"script");if(contains){setGlobalEval(tmp)}if(scripts){j=0;while(elem=tmp[j++]){if(rscriptType.test(elem.type||"")){scripts.push(elem)}}}}return fragment}(function(){var fragment=document.createDocumentFragment(),div=fragment.appendChild(document.createElement("div")),input=document.createElement("input");input.setAttribute("type","radio");input.setAttribute("checked","checked");input.setAttribute("name","t");div.appendChild(input);support.checkClone=div.cloneNode(true).cloneNode(true).lastChild.checked;div.innerHTML="<textarea>x</textarea>";support.noCloneChecked=!!div.cloneNode(true).lastChild.defaultValue})();var rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,rtypenamespace=/^([^.]*)(?:\.(.+)|)/;function returnTrue(){return true}function returnFalse(){return false}function safeActiveElement(){try{return document.activeElement}catch(err){}}function on(elem,types,selector,data,fn,one){var origFn,type;if(typeof types==="object"){if(typeof selector!=="string"){data=data||selector;selector=undefined}for(type in types){on(elem,type,selector,data,types[type],one)}return elem}if(data==null&&fn==null){fn=selector;data=selector=undefined}else if(fn==null){if(typeof selector==="string"){fn=data;data=undefined}else{fn=data;data=selector;selector=undefined}}if(fn===false){fn=returnFalse}else if(!fn){return elem}if(one===1){origFn=fn;fn=function(event){jQuery().off(event);return origFn.apply(this,arguments)};fn.guid=origFn.guid||(origFn.guid=jQuery.guid++)}return elem.each(function(){jQuery.event.add(this,types,fn,data,selector)})}jQuery.event={global:{},add:function(elem,types,handler,data,selector){var handleObjIn,eventHandle,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=dataPriv.get(elem);if(!elemData){return}if(handler.handler){handleObjIn=handler;handler=handleObjIn.handler;selector=handleObjIn.selector}if(!handler.guid){handler.guid=jQuery.guid++}if(!(events=elemData.events)){events=elemData.events={}}if(!(eventHandle=elemData.handle)){eventHandle=elemData.handle=function(e){return typeof jQuery!=="undefined"&&jQuery.event.triggered!==e.type?jQuery.event.dispatch.apply(elem,arguments):undefined}}types=(types||"").match(rnotwhite)||[""];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(!type){continue}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;special=jQuery.event.special[type]||{};handleObj=jQuery.extend({type:type,origType:origType,data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(".")},handleObjIn);if(!(handlers=events[type])){handlers=events[type]=[];handlers.delegateCount=0;if(!special.setup||special.setup.call(elem,data,namespaces,eventHandle)===false){if(elem.addEventListener){elem.addEventListener(type,eventHandle)}}}if(special.add){special.add.call(elem,handleObj);if(!handleObj.handler.guid){handleObj.handler.guid=handler.guid}}if(selector){handlers.splice(handlers.delegateCount++,0,handleObj)}else{handlers.push(handleObj)}jQuery.event.global[type]=true}},remove:function(elem,types,handler,selector,mappedTypes){var j,origCount,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=dataPriv.hasData(elem)&&dataPriv.get(elem);if(!elemData||!(events=elemData.events)){return}types=(types||"").match(rnotwhite)||[""];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(!type){for(type in events){jQuery.event.remove(elem,type+types[t],handler,selector,true)}continue}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;handlers=events[type]||[];tmp=tmp[2]&&new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)");origCount=j=handlers.length;while(j--){handleObj=handlers[j];if((mappedTypes||origType===handleObj.origType)&&(!handler||handler.guid===handleObj.guid)&&(!tmp||tmp.test(handleObj.namespace))&&(!selector||selector===handleObj.selector||selector==="**"&&handleObj.selector)){handlers.splice(j,1);if(handleObj.selector){handlers.delegateCount--}if(special.remove){special.remove.call(elem,handleObj)}}}if(origCount&&!handlers.length){if(!special.teardown||special.teardown.call(elem,namespaces,elemData.handle)===false){jQuery.removeEvent(elem,type,elemData.handle)}delete events[type]}}if(jQuery.isEmptyObject(events)){dataPriv.remove(elem,"handle events")}},dispatch:function(event){event=jQuery.event.fix(event);var i,j,ret,matched,handleObj,handlerQueue=[],args=slice.call(arguments),handlers=(dataPriv.get(this,"events")||{})[event.type]||[],special=jQuery.event.special[event.type]||{};args[0]=event;event.delegateTarget=this;if(special.preDispatch&&special.preDispatch.call(this,event)===false){return}handlerQueue=jQuery.event.handlers.call(this,event,handlers);i=0;while((matched=handlerQueue[i++])&&!event.isPropagationStopped()){event.currentTarget=matched.elem;j=0;while((handleObj=matched.handlers[j++])&&!event.isImmediatePropagationStopped()){if(!event.rnamespace||event.rnamespace.test(handleObj.namespace)){event.handleObj=handleObj;event.data=handleObj.data;ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args);if(ret!==undefined){if((event.result=ret)===false){event.preventDefault();event.stopPropagation()}}}}}if(special.postDispatch){special.postDispatch.call(this,event)}return event.result},handlers:function(event,handlers){var i,matches,sel,handleObj,handlerQueue=[],delegateCount=handlers.delegateCount,cur=event.target;if(delegateCount&&cur.nodeType&&(event.type!=="click"||isNaN(event.button)||event.button<1)){for(;cur!==this;cur=cur.parentNode||this){if(cur.nodeType===1&&(cur.disabled!==true||event.type!=="click")){matches=[];for(i=0;i<delegateCount;i++){handleObj=handlers[i];sel=handleObj.selector+" ";if(matches[sel]===undefined){matches[sel]=handleObj.needsContext?jQuery(sel,this).index(cur)>-1:jQuery.find(sel,this,null,[cur]).length}if(matches[sel]){matches.push(handleObj)}}if(matches.length){handlerQueue.push({elem:cur,handlers:matches})}}}}if(delegateCount<handlers.length){handlerQueue.push({elem:this,handlers:handlers.slice(delegateCount)})}return handlerQueue},props:("altKey bubbles cancelable ctrlKey currentTarget detail eventPhase "+"metaKey relatedTarget shiftKey target timeStamp view which").split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(event,original){if(event.which==null){event.which=original.charCode!=null?original.charCode:original.keyCode}return event}},mouseHooks:{props:("button buttons clientX clientY offsetX offsetY pageX pageY "+"screenX screenY toElement").split(" "),filter:function(event,original){var eventDoc,doc,body,button=original.button;if(event.pageX==null&&original.clientX!=null){eventDoc=event.target.ownerDocument||document;doc=eventDoc.documentElement;body=eventDoc.body;event.pageX=original.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0);event.pageY=original.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)}if(!event.which&&button!==undefined){event.which=button&1?1:button&2?3:button&4?2:0}return event}},fix:function(event){if(event[jQuery.expando]){return event}var i,prop,copy,type=event.type,originalEvent=event,fixHook=this.fixHooks[type];if(!fixHook){this.fixHooks[type]=fixHook=rmouseEvent.test(type)?this.mouseHooks:rkeyEvent.test(type)?this.keyHooks:{}}copy=fixHook.props?this.props.concat(fixHook.props):this.props;event=new jQuery.Event(originalEvent);i=copy.length;while(i--){prop=copy[i];event[prop]=originalEvent[prop]}if(!event.target){event.target=document}if(event.target.nodeType===3){event.target=event.target.parentNode}return fixHook.filter?fixHook.filter(event,originalEvent):event},special:{load:{noBubble:true},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus){this.focus();return false}},delegateType:"focusin"},blur:{trigger:function(){if(this===safeActiveElement()&&this.blur){this.blur();return false}},delegateType:"focusout"},click:{trigger:function(){if(this.type==="checkbox"&&this.click&&jQuery.nodeName(this,"input")){this.click();return false}},_default:function(event){return jQuery.nodeName(event.target,"a")}},beforeunload:{postDispatch:function(event){if(event.result!==undefined&&event.originalEvent){event.originalEvent.returnValue=event.result}}}}};jQuery.removeEvent=function(elem,type,handle){if(elem.removeEventListener){elem.removeEventListener(type,handle)}};jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event)){return new jQuery.Event(src,props)}if(src&&src.type){this.originalEvent=src;this.type=src.type;this.isDefaultPrevented=src.defaultPrevented||src.defaultPrevented===undefined&&src.returnValue===false?returnTrue:returnFalse}else{this.type=src}if(props){jQuery.extend(this,props)}this.timeStamp=src&&src.timeStamp||jQuery.now();this[jQuery.expando]=true};jQuery.Event.prototype={constructor:jQuery.Event,isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,isSimulated:false,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue;if(e&&!this.isSimulated){e.preventDefault()}},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue;if(e&&!this.isSimulated){e.stopPropagation()}},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=returnTrue;if(e&&!this.isSimulated){e.stopImmediatePropagation()}this.stopPropagation()}};jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,target=this,related=event.relatedTarget,handleObj=event.handleObj;if(!related||related!==target&&!jQuery.contains(target,related)){event.type=handleObj.origType;ret=handleObj.handler.apply(this,arguments);event.type=fix}return ret}}});jQuery.fn.extend({on:function(types,selector,data,fn){return on(this,types,selector,data,fn)},one:function(types,selector,data,fn){return on(this,types,selector,data,fn,1)},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj){handleObj=types.handleObj;jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler);return this}if(typeof types==="object"){for(type in types){this.off(type,selector,types[type])}return this}if(selector===false||typeof selector==="function"){fn=selector;selector=undefined}if(fn===false){fn=returnFalse}return this.each(function(){jQuery.event.remove(this,types,fn,selector)})}});var rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,rnoInnerhtml=/<script|<style|<link/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptTypeMasked=/^true\/(.*)/,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function manipulationTarget(elem,content){return jQuery.nodeName(elem,"table")&&jQuery.nodeName(content.nodeType!==11?content:content.firstChild,"tr")?elem.getElementsByTagName("tbody")[0]||elem.appendChild(elem.ownerDocument.createElement("tbody")):elem}function disableScript(elem){elem.type=(elem.getAttribute("type")!==null)+"/"+elem.type;return elem}function restoreScript(elem){var match=rscriptTypeMasked.exec(elem.type);if(match){elem.type=match[1]}else{elem.removeAttribute("type")}return elem}function cloneCopyEvent(src,dest){var i,l,type,pdataOld,pdataCur,udataOld,udataCur,events;if(dest.nodeType!==1){return}if(dataPriv.hasData(src)){pdataOld=dataPriv.access(src);pdataCur=dataPriv.set(dest,pdataOld);events=pdataOld.events;if(events){delete pdataCur.handle;pdataCur.events={};for(type in events){for(i=0,l=events[type].length;i<l;i++){jQuery.event.add(dest,type,events[type][i])}}}}if(dataUser.hasData(src)){udataOld=dataUser.access(src);udataCur=jQuery.extend({},udataOld);dataUser.set(dest,udataCur)}}function fixInput(src,dest){var nodeName=dest.nodeName.toLowerCase();if(nodeName==="input"&&rcheckableType.test(src.type)){dest.checked=src.checked}else if(nodeName==="input"||nodeName==="textarea"){dest.defaultValue=src.defaultValue}}function domManip(collection,args,callback,ignored){args=concat.apply([],args);var fragment,first,scripts,hasScripts,node,doc,i=0,l=collection.length,iNoClone=l-1,value=args[0],isFunction=jQuery.isFunction(value);if(isFunction||l>1&&typeof value==="string"&&!support.checkClone&&rchecked.test(value)){return collection.each(function(index){var self=collection.eq(index);if(isFunction){args[0]=value.call(this,index,self.html())}domManip(self,args,callback,ignored)})}if(l){fragment=buildFragment(args,collection[0].ownerDocument,false,collection,ignored);first=fragment.firstChild;if(fragment.childNodes.length===1){fragment=first}if(first||ignored){scripts=jQuery.map(getAll(fragment,"script"),disableScript);hasScripts=scripts.length;for(;i<l;i++){node=fragment;if(i!==iNoClone){node=jQuery.clone(node,true,true);if(hasScripts){jQuery.merge(scripts,getAll(node,"script"))}}callback.call(collection[i],node,i)}if(hasScripts){doc=scripts[scripts.length-1].ownerDocument;jQuery.map(scripts,restoreScript);for(i=0;i<hasScripts;i++){node=scripts[i];if(rscriptType.test(node.type||"")&&!dataPriv.access(node,"globalEval")&&jQuery.contains(doc,node)){if(node.src){if(jQuery._evalUrl){jQuery._evalUrl(node.src)}}else{jQuery.globalEval(node.textContent.replace(rcleanScript,""))}}}}}}return collection}function remove(elem,selector,keepData){var node,nodes=selector?jQuery.filter(selector,elem):elem,i=0;for(;(node=nodes[i])!=null;i++){if(!keepData&&node.nodeType===1){jQuery.cleanData(getAll(node))}if(node.parentNode){if(keepData&&jQuery.contains(node.ownerDocument,node)){setGlobalEval(getAll(node,"script"))}node.parentNode.removeChild(node)}}return elem}jQuery.extend({htmlPrefilter:function(html){return html.replace(rxhtmlTag,"<$1></$2>")},clone:function(elem,dataAndEvents,deepDataAndEvents){var i,l,srcElements,destElements,clone=elem.cloneNode(true),inPage=jQuery.contains(elem.ownerDocument,elem);if(!support.noCloneChecked&&(elem.nodeType===1||elem.nodeType===11)&&!jQuery.isXMLDoc(elem)){destElements=getAll(clone);srcElements=getAll(elem);for(i=0,l=srcElements.length;i<l;i++){fixInput(srcElements[i],destElements[i])}}if(dataAndEvents){if(deepDataAndEvents){srcElements=srcElements||getAll(elem);destElements=destElements||getAll(clone);for(i=0,l=srcElements.length;i<l;i++){cloneCopyEvent(srcElements[i],destElements[i])}}else{cloneCopyEvent(elem,clone)}}destElements=getAll(clone,"script");if(destElements.length>0){setGlobalEval(destElements,!inPage&&getAll(elem,"script"))}return clone},cleanData:function(elems){var data,elem,type,special=jQuery.event.special,i=0;for(;(elem=elems[i])!==undefined;i++){if(acceptData(elem)){if(data=elem[dataPriv.expando]){if(data.events){for(type in data.events){if(special[type]){jQuery.event.remove(elem,type)}else{jQuery.removeEvent(elem,type,data.handle)}}}elem[dataPriv.expando]=undefined}if(elem[dataUser.expando]){elem[dataUser.expando]=undefined}}}}});jQuery.fn.extend({domManip:domManip,detach:function(selector){return remove(this,selector,true)},remove:function(selector){return remove(this,selector)},text:function(value){return access(this,function(value){return value===undefined?jQuery.text(this):this.empty().each(function(){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){this.textContent=value}})},null,value,arguments.length)},append:function(){return domManip(this,arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.appendChild(elem)}})},prepend:function(){return domManip(this,arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.insertBefore(elem,target.firstChild)}})},before:function(){return domManip(this,arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this)}})},after:function(){return domManip(this,arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this.nextSibling)}})},empty:function(){var elem,i=0;for(;(elem=this[i])!=null;i++){if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false));elem.textContent=""}}return this},clone:function(dataAndEvents,deepDataAndEvents){dataAndEvents=dataAndEvents==null?false:dataAndEvents;deepDataAndEvents=deepDataAndEvents==null?dataAndEvents:deepDataAndEvents;return this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents)})},html:function(value){return access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(value===undefined&&elem.nodeType===1){return elem.innerHTML}if(typeof value==="string"&&!rnoInnerhtml.test(value)&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=jQuery.htmlPrefilter(value);try{for(;i<l;i++){elem=this[i]||{};if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false));elem.innerHTML=value}}elem=0}catch(e){}}if(elem){this.empty().append(value)}},null,value,arguments.length)},replaceWith:function(){var ignored=[];return domManip(this,arguments,function(elem){var parent=this.parentNode;if(jQuery.inArray(this,ignored)<0){jQuery.cleanData(getAll(this));if(parent){parent.replaceChild(elem,this)}}},ignored)}});jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){var elems,ret=[],insert=jQuery(selector),last=insert.length-1,i=0;for(;i<=last;i++){elems=i===last?this:this.clone(true);jQuery(insert[i])[original](elems);push.apply(ret,elems.get())}return this.pushStack(ret)}});var iframe,elemdisplay={HTML:"block",BODY:"block"};function actualDisplay(name,doc){var elem=jQuery(doc.createElement(name)).appendTo(doc.body),display=jQuery.css(elem[0],"display");elem.detach();return display}function defaultDisplay(nodeName){var doc=document,display=elemdisplay[nodeName];if(!display){display=actualDisplay(nodeName,doc);if(display==="none"||!display){iframe=(iframe||jQuery("<iframe frameborder='0' width='0' height='0'/>")).appendTo(doc.documentElement);doc=iframe[0].contentDocument;doc.write();doc.close();display=actualDisplay(nodeName,doc);iframe.detach()}elemdisplay[nodeName]=display}return display}var rmargin=/^margin/;var rnumnonpx=new RegExp("^("+pnum+")(?!px)[a-z%]+$","i");var getStyles=function(elem){var view=elem.ownerDocument.defaultView;if(!view||!view.opener){view=window}return view.getComputedStyle(elem)};var swap=function(elem,options,callback,args){var ret,name,old={};for(name in options){old[name]=elem.style[name];elem.style[name]=options[name]}ret=callback.apply(elem,args||[]);for(name in options){elem.style[name]=old[name]}return ret};var documentElement=document.documentElement;(function(){var pixelPositionVal,boxSizingReliableVal,pixelMarginRightVal,reliableMarginLeftVal,container=document.createElement("div"),div=document.createElement("div");if(!div.style){return}div.style.backgroundClip="content-box";div.cloneNode(true).style.backgroundClip="";support.clearCloneStyle=div.style.backgroundClip==="content-box";container.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;"+"padding:0;margin-top:1px;position:absolute";container.appendChild(div);function computeStyleTests(){div.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;"+"position:relative;display:block;"+"margin:auto;border:1px;padding:1px;"+"top:1%;width:50%";div.innerHTML="";documentElement.appendChild(container);var divStyle=window.getComputedStyle(div);pixelPositionVal=divStyle.top!=="1%";reliableMarginLeftVal=divStyle.marginLeft==="2px";boxSizingReliableVal=divStyle.width==="4px";div.style.marginRight="50%";pixelMarginRightVal=divStyle.marginRight==="4px";documentElement.removeChild(container)}jQuery.extend(support,{pixelPosition:function(){computeStyleTests();return pixelPositionVal},boxSizingReliable:function(){if(boxSizingReliableVal==null){computeStyleTests()}return boxSizingReliableVal},pixelMarginRight:function(){if(boxSizingReliableVal==null){computeStyleTests()}return pixelMarginRightVal},reliableMarginLeft:function(){if(boxSizingReliableVal==null){computeStyleTests()}return reliableMarginLeftVal},reliableMarginRight:function(){var ret,marginDiv=div.appendChild(document.createElement("div"));marginDiv.style.cssText=div.style.cssText="-webkit-box-sizing:content-box;box-sizing:content-box;"+"display:block;margin:0;border:0;padding:0";marginDiv.style.marginRight=marginDiv.style.width="0";div.style.width="1px";documentElement.appendChild(container);ret=!parseFloat(window.getComputedStyle(marginDiv).marginRight);documentElement.removeChild(container);div.removeChild(marginDiv);return ret}})})();function curCSS(elem,name,computed){var width,minWidth,maxWidth,ret,style=elem.style;computed=computed||getStyles(elem);ret=computed?computed.getPropertyValue(name)||computed[name]:undefined;if((ret===""||ret===undefined)&&!jQuery.contains(elem.ownerDocument,elem)){ret=jQuery.style(elem,name)}if(computed){if(!support.pixelMarginRight()&&rnumnonpx.test(ret)&&rmargin.test(name)){width=style.width;minWidth=style.minWidth;maxWidth=style.maxWidth;style.minWidth=style.maxWidth=style.width=ret;ret=computed.width;style.width=width;style.minWidth=minWidth;style.maxWidth=maxWidth}}return ret!==undefined?ret+"":ret}function addGetHookIf(conditionFn,hookFn){return{get:function(){if(conditionFn()){delete this.get;return}return(this.get=hookFn).apply(this,arguments)}}}var rdisplayswap=/^(none|table(?!-c[ea]).+)/,cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:"0",fontWeight:"400"},cssPrefixes=["Webkit","O","Moz","ms"],emptyStyle=document.createElement("div").style;function vendorPropName(name){if(name in emptyStyle){return name}var capName=name[0].toUpperCase()+name.slice(1),i=cssPrefixes.length;while(i--){name=cssPrefixes[i]+capName;if(name in emptyStyle){return name}}}function setPositiveNumber(elem,value,subtract){var matches=rcssNum.exec(value);return matches?Math.max(0,matches[2]-(subtract||0))+(matches[3]||"px"):value}function augmentWidthOrHeight(elem,name,extra,isBorderBox,styles){var i=extra===(isBorderBox?"border":"content")?4:name==="width"?1:0,val=0;for(;i<4;i+=2){if(extra==="margin"){val+=jQuery.css(elem,extra+cssExpand[i],true,styles)}if(isBorderBox){if(extra==="content"){val-=jQuery.css(elem,"padding"+cssExpand[i],true,styles)}if(extra!=="margin"){val-=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles)}}else{val+=jQuery.css(elem,"padding"+cssExpand[i],true,styles);if(extra!=="padding"){val+=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles)}}}return val}function getWidthOrHeight(elem,name,extra){var valueIsBorderBox=true,val=name==="width"?elem.offsetWidth:elem.offsetHeight,styles=getStyles(elem),isBorderBox=jQuery.css(elem,"boxSizing",false,styles)==="border-box";if(val<=0||val==null){val=curCSS(elem,name,styles);if(val<0||val==null){val=elem.style[name]}if(rnumnonpx.test(val)){return val}valueIsBorderBox=isBorderBox&&(support.boxSizingReliable()||val===elem.style[name]);val=parseFloat(val)||0}return val+augmentWidthOrHeight(elem,name,extra||(isBorderBox?"border":"content"),valueIsBorderBox,styles)+"px"}function showHide(elements,show){var display,elem,hidden,values=[],index=0,length=elements.length;for(;index<length;index++){elem=elements[index];if(!elem.style){continue}values[index]=dataPriv.get(elem,"olddisplay");display=elem.style.display;if(show){if(!values[index]&&display==="none"){elem.style.display=""}if(elem.style.display===""&&isHidden(elem)){values[index]=dataPriv.access(elem,"olddisplay",defaultDisplay(elem.nodeName))}}else{hidden=isHidden(elem);if(display!=="none"||!hidden){dataPriv.set(elem,"olddisplay",hidden?display:jQuery.css(elem,"display"))}}}for(index=0;index<length;index++){elem=elements[index];if(!elem.style){continue}if(!show||elem.style.display==="none"||elem.style.display===""){elem.style.display=show?values[index]||"":"none"}}return elements}jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return ret===""?"1":ret}}}},cssNumber:{animationIterationCount:true,columnCount:true,fillOpacity:true,flexGrow:true,flexShrink:true,fontWeight:true,lineHeight:true,opacity:true,order:true,orphans:true,widows:true,zIndex:true,zoom:true},cssProps:{float:"cssFloat"},style:function(elem,name,value,extra){if(!elem||elem.nodeType===3||elem.nodeType===8||!elem.style){return}var ret,type,hooks,origName=jQuery.camelCase(name),style=elem.style;name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(origName)||origName);hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(value!==undefined){type=typeof value;if(type==="string"&&(ret=rcssNum.exec(value))&&ret[1]){value=adjustCSS(elem,name,ret);type="number"}if(value==null||value!==value){return}if(type==="number"){value+=ret&&ret[3]||(jQuery.cssNumber[origName]?"":"px")}if(!support.clearCloneStyle&&value===""&&name.indexOf("background")===0){style[name]="inherit"}if(!hooks||!("set"in hooks)||(value=hooks.set(elem,value,extra))!==undefined){style[name]=value}}else{if(hooks&&"get"in hooks&&(ret=hooks.get(elem,false,extra))!==undefined){return ret}return style[name]}},css:function(elem,name,extra,styles){var val,num,hooks,origName=jQuery.camelCase(name);name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(origName)||origName);hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(hooks&&"get"in hooks){val=hooks.get(elem,true,extra)}if(val===undefined){val=curCSS(elem,name,styles)}if(val==="normal"&&name in cssNormalTransform){val=cssNormalTransform[name]}if(extra===""||extra){num=parseFloat(val);return extra===true||isFinite(num)?num||0:val}return val}});jQuery.each(["height","width"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){if(computed){return rdisplayswap.test(jQuery.css(elem,"display"))&&elem.offsetWidth===0?swap(elem,cssShow,function(){return getWidthOrHeight(elem,name,extra)}):getWidthOrHeight(elem,name,extra)}},set:function(elem,value,extra){var matches,styles=extra&&getStyles(elem),subtract=extra&&augmentWidthOrHeight(elem,name,extra,jQuery.css(elem,"boxSizing",false,styles)==="border-box",styles);if(subtract&&(matches=rcssNum.exec(value))&&(matches[3]||"px")!=="px"){elem.style[name]=value;value=jQuery.css(elem,name)}return setPositiveNumber(elem,value,subtract)}}});jQuery.cssHooks.marginLeft=addGetHookIf(support.reliableMarginLeft,function(elem,computed){if(computed){return(parseFloat(curCSS(elem,"marginLeft"))||elem.getBoundingClientRect().left-swap(elem,{marginLeft:0},function(){return elem.getBoundingClientRect().left}))+"px"}});jQuery.cssHooks.marginRight=addGetHookIf(support.reliableMarginRight,function(elem,computed){if(computed){return swap(elem,{display:"inline-block"},curCSS,[elem,"marginRight"])}});jQuery.each({margin:"",padding:"",border:"Width"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){var i=0,expanded={},parts=typeof value==="string"?value.split(" "):[value];for(;i<4;i++){expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0]}return expanded}};if(!rmargin.test(prefix)){jQuery.cssHooks[prefix+suffix].set=setPositiveNumber}});jQuery.fn.extend({css:function(name,value){return access(this,function(elem,name,value){var styles,len,map={},i=0;if(jQuery.isArray(name)){styles=getStyles(elem);len=name.length;for(;i<len;i++){map[name[i]]=jQuery.css(elem,name[i],false,styles)}return map}return value!==undefined?jQuery.style(elem,name,value):jQuery.css(elem,name)},name,value,arguments.length>1)},show:function(){return showHide(this,true)},hide:function(){return showHide(this)},toggle:function(state){if(typeof state==="boolean"){return state?this.show():this.hide()}return this.each(function(){if(isHidden(this)){jQuery(this).show()}else{jQuery(this).hide()}})}});function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing)}jQuery.Tween=Tween;Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem;this.prop=prop;this.easing=easing||jQuery.easing._default;this.options=options;this.start=this.now=this.cur();this.end=end;this.unit=unit||(jQuery.cssNumber[prop]?"":"px")},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this)},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];if(this.options.duration){this.pos=eased=jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration)}else{this.pos=eased=percent}this.now=(this.end-this.start)*eased+this.start;if(this.options.step){this.options.step.call(this.elem,this.now,this)}if(hooks&&hooks.set){hooks.set(this)}else{Tween.propHooks._default.set(this)}return this}};Tween.prototype.init.prototype=Tween.prototype;Tween.propHooks={_default:{get:function(tween){var result;if(tween.elem.nodeType!==1||tween.elem[tween.prop]!=null&&tween.elem.style[tween.prop]==null){return tween.elem[tween.prop]}result=jQuery.css(tween.elem,tween.prop,"");return!result||result==="auto"?0:result},set:function(tween){if(jQuery.fx.step[tween.prop]){jQuery.fx.step[tween.prop](tween)}else if(tween.elem.nodeType===1&&(tween.elem.style[jQuery.cssProps[tween.prop]]!=null||jQuery.cssHooks[tween.prop])){jQuery.style(tween.elem,tween.prop,tween.now+tween.unit)}else{tween.elem[tween.prop]=tween.now}}}};Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){if(tween.elem.nodeType&&tween.elem.parentNode){tween.elem[tween.prop]=tween.now}}};jQuery.easing={linear:function(p){return p},swing:function(p){return.5-Math.cos(p*Math.PI)/2},_default:"swing"};jQuery.fx=Tween.prototype.init;jQuery.fx.step={};var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rrun=/queueHooks$/;function createFxNow(){window.setTimeout(function(){fxNow=undefined});return fxNow=jQuery.now()}function genFx(type,includeWidth){var which,i=0,attrs={height:type};includeWidth=includeWidth?1:0;for(;i<4;i+=2-includeWidth){which=cssExpand[i];attrs["margin"+which]=attrs["padding"+which]=type}if(includeWidth){attrs.opacity=attrs.width=type}return attrs}function createTween(value,prop,animation){var tween,collection=(Animation.tweeners[prop]||[]).concat(Animation.tweeners["*"]),index=0,length=collection.length;for(;index<length;index++){if(tween=collection[index].call(animation,prop,value)){return tween}}}function defaultPrefilter(elem,props,opts){var prop,value,toggle,tween,hooks,oldfire,display,checkDisplay,anim=this,orig={},style=elem.style,hidden=elem.nodeType&&isHidden(elem),dataShow=dataPriv.get(elem,"fxshow");if(!opts.queue){hooks=jQuery._queueHooks(elem,"fx");if(hooks.unqueued==null){hooks.unqueued=0;oldfire=hooks.empty.fire;hooks.empty.fire=function(){if(!hooks.unqueued){oldfire()}}}hooks.unqueued++;anim.always(function(){anim.always(function(){hooks.unqueued--;if(!jQuery.queue(elem,"fx").length){hooks.empty.fire()}})})}if(elem.nodeType===1&&("height"in props||"width"in props)){opts.overflow=[style.overflow,style.overflowX,style.overflowY];display=jQuery.css(elem,"display");checkDisplay=display==="none"?dataPriv.get(elem,"olddisplay")||defaultDisplay(elem.nodeName):display;if(checkDisplay==="inline"&&jQuery.css(elem,"float")==="none"){style.display="inline-block"}}if(opts.overflow){style.overflow="hidden";anim.always(function(){style.overflow=opts.overflow[0];style.overflowX=opts.overflow[1];style.overflowY=opts.overflow[2]})}for(prop in props){value=props[prop];if(rfxtypes.exec(value)){delete props[prop];toggle=toggle||value==="toggle";if(value===(hidden?"hide":"show")){if(value==="show"&&dataShow&&dataShow[prop]!==undefined){hidden=true}else{continue}}orig[prop]=dataShow&&dataShow[prop]||jQuery.style(elem,prop)}else{display=undefined}}if(!jQuery.isEmptyObject(orig)){if(dataShow){if("hidden"in dataShow){hidden=dataShow.hidden}}else{dataShow=dataPriv.access(elem,"fxshow",{})}if(toggle){dataShow.hidden=!hidden}if(hidden){jQuery(elem).show()}else{anim.done(function(){jQuery(elem).hide()})}anim.done(function(){var prop;dataPriv.remove(elem,"fxshow");for(prop in orig){jQuery.style(elem,prop,orig[prop])}});for(prop in orig){tween=createTween(hidden?dataShow[prop]:0,prop,anim);if(!(prop in dataShow)){dataShow[prop]=tween.start;if(hidden){tween.end=tween.start;tween.start=prop==="width"||prop==="height"?1:0}}}}else if((display==="none"?defaultDisplay(elem.nodeName):display)==="inline"){style.display=display}}function propFilter(props,specialEasing){var index,name,easing,value,hooks;for(index in props){name=jQuery.camelCase(index);easing=specialEasing[name];value=props[index];if(jQuery.isArray(value)){easing=value[1];value=props[index]=value[0]}if(index!==name){props[name]=value;delete props[index]}hooks=jQuery.cssHooks[name];if(hooks&&"expand"in hooks){value=hooks.expand(value);delete props[name];for(index in value){if(!(index in props)){props[index]=value[index];specialEasing[index]=easing}}}else{specialEasing[name]=easing}}}function Animation(elem,properties,options){var result,stopped,index=0,length=Animation.prefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem}),tick=function(){if(stopped){return false}var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),temp=remaining/animation.duration||0,percent=1-temp,index=0,length=animation.tweens.length;for(;index<length;index++){animation.tweens[index].run(percent)}deferred.notifyWith(elem,[animation,percent,remaining]);if(percent<1&&length){return remaining}else{deferred.resolveWith(elem,[animation]);return false}},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(true,{specialEasing:{},easing:jQuery.easing._default},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);animation.tweens.push(tween);return tween},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;if(stopped){return this}stopped=true;for(;index<length;index++){animation.tweens[index].run(1)}if(gotoEnd){deferred.notifyWith(elem,[animation,1,0]);deferred.resolveWith(elem,[animation,gotoEnd])}else{deferred.rejectWith(elem,[animation,gotoEnd])}return this}}),props=animation.props;propFilter(props,animation.opts.specialEasing);for(;index<length;index++){result=Animation.prefilters[index].call(animation,elem,props,animation.opts);if(result){if(jQuery.isFunction(result.stop)){jQuery._queueHooks(animation.elem,animation.opts.queue).stop=jQuery.proxy(result.stop,result)}return result}}jQuery.map(props,createTween,animation);if(jQuery.isFunction(animation.opts.start)){animation.opts.start.call(elem,animation)}jQuery.fx.timer(jQuery.extend(tick,{elem:elem,anim:animation,queue:animation.opts.queue}));return animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always)}jQuery.Animation=jQuery.extend(Animation,{tweeners:{"*":[function(prop,value){var tween=this.createTween(prop,value);adjustCSS(tween.elem,prop,rcssNum.exec(value),tween);return tween}]},tweener:function(props,callback){if(jQuery.isFunction(props)){callback=props;props=["*"]}else{props=props.match(rnotwhite)}var prop,index=0,length=props.length;for(;index<length;index++){prop=props[index];Animation.tweeners[prop]=Animation.tweeners[prop]||[];Animation.tweeners[prop].unshift(callback)}},prefilters:[defaultPrefilter],prefilter:function(callback,prepend){if(prepend){Animation.prefilters.unshift(callback)}else{Animation.prefilters.push(callback)}}});jQuery.speed=function(speed,easing,fn){var opt=speed&&typeof speed==="object"?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};opt.duration=jQuery.fx.off?0:typeof opt.duration==="number"?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default;if(opt.queue==null||opt.queue===true){opt.queue="fx"}opt.old=opt.complete;opt.complete=function(){if(jQuery.isFunction(opt.old)){opt.old.call(this)}if(opt.queue){jQuery.dequeue(this,opt.queue)}};return opt};jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback)},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);if(empty||dataPriv.get(this,"finish")){anim.stop(true)}};doAnimation.finish=doAnimation;return empty||optall.queue===false?this.each(doAnimation):this.queue(optall.queue,doAnimation)},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop;stop(gotoEnd)};if(typeof type!=="string"){gotoEnd=clearQueue;clearQueue=type;type=undefined}if(clearQueue&&type!==false){this.queue(type||"fx",[])}return this.each(function(){var dequeue=true,index=type!=null&&type+"queueHooks",timers=jQuery.timers,data=dataPriv.get(this);if(index){if(data[index]&&data[index].stop){stopQueue(data[index])}}else{for(index in data){if(data[index]&&data[index].stop&&rrun.test(index)){stopQueue(data[index])}}}for(index=timers.length;index--;){if(timers[index].elem===this&&(type==null||timers[index].queue===type)){timers[index].anim.stop(gotoEnd);dequeue=false;timers.splice(index,1)}}if(dequeue||!gotoEnd){jQuery.dequeue(this,type)}})},finish:function(type){if(type!==false){type=type||"fx"}return this.each(function(){var index,data=dataPriv.get(this),queue=data[type+"queue"],hooks=data[type+"queueHooks"],timers=jQuery.timers,length=queue?queue.length:0;data.finish=true;jQuery.queue(this,type,[]);if(hooks&&hooks.stop){hooks.stop.call(this,true)}for(index=timers.length;index--;){if(timers[index].elem===this&&timers[index].queue===type){timers[index].anim.stop(true);timers.splice(index,1)}}for(index=0;index<length;index++){if(queue[index]&&queue[index].finish){queue[index].finish.call(this)}}delete data.finish})}});jQuery.each(["toggle","show","hide"],function(i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return speed==null||typeof speed==="boolean"?cssFn.apply(this,arguments):this.animate(genFx(name,true),speed,easing,callback)}});jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback)}});jQuery.timers=[];jQuery.fx.tick=function(){var timer,i=0,timers=jQuery.timers;fxNow=jQuery.now();for(;i<timers.length;i++){timer=timers[i];if(!timer()&&timers[i]===timer){timers.splice(i--,1)}}if(!timers.length){jQuery.fx.stop()}fxNow=undefined};jQuery.fx.timer=function(timer){jQuery.timers.push(timer);if(timer()){jQuery.fx.start()}else{jQuery.timers.pop()}};jQuery.fx.interval=13;jQuery.fx.start=function(){if(!timerId){timerId=window.setInterval(jQuery.fx.tick,jQuery.fx.interval)}};jQuery.fx.stop=function(){window.clearInterval(timerId);timerId=null};jQuery.fx.speeds={slow:600,fast:200,_default:400};jQuery.fn.delay=function(time,type){time=jQuery.fx?jQuery.fx.speeds[time]||time:time;type=type||"fx";return this.queue(type,function(next,hooks){var timeout=window.setTimeout(next,time);hooks.stop=function(){window.clearTimeout(timeout)}})};(function(){var input=document.createElement("input"),select=document.createElement("select"),opt=select.appendChild(document.createElement("option"));input.type="checkbox";support.checkOn=input.value!=="";support.optSelected=opt.selected;select.disabled=true;support.optDisabled=!opt.disabled;input=document.createElement("input");input.value="t";input.type="radio";support.radioValue=input.value==="t"})();var boolHook,attrHandle=jQuery.expr.attrHandle;jQuery.fn.extend({attr:function(name,value){return access(this,jQuery.attr,name,value,arguments.length>1)},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name)})}});jQuery.extend({attr:function(elem,name,value){var ret,hooks,nType=elem.nodeType;if(nType===3||nType===8||nType===2){return}if(typeof elem.getAttribute==="undefined"){return jQuery.prop(elem,name,value)}if(nType!==1||!jQuery.isXMLDoc(elem)){name=name.toLowerCase();hooks=jQuery.attrHooks[name]||(jQuery.expr.match.bool.test(name)?boolHook:undefined)}if(value!==undefined){if(value===null){jQuery.removeAttr(elem,name);return}if(hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined){return ret}elem.setAttribute(name,value+"");return value}if(hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null){return ret}ret=jQuery.find.attr(elem,name);return ret==null?undefined:ret},attrHooks:{type:{set:function(elem,value){if(!support.radioValue&&value==="radio"&&jQuery.nodeName(elem,"input")){var val=elem.value;elem.setAttribute("type",value);if(val){elem.value=val}return value}}}},removeAttr:function(elem,value){var name,propName,i=0,attrNames=value&&value.match(rnotwhite);if(attrNames&&elem.nodeType===1){while(name=attrNames[i++]){propName=jQuery.propFix[name]||name;if(jQuery.expr.match.bool.test(name)){elem[propName]=false}elem.removeAttribute(name)}}}});boolHook={set:function(elem,value,name){if(value===false){jQuery.removeAttr(elem,name)}else{elem.setAttribute(name,name)}return name}};jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),function(i,name){var getter=attrHandle[name]||jQuery.find.attr;attrHandle[name]=function(elem,name,isXML){var ret,handle;if(!isXML){handle=attrHandle[name];attrHandle[name]=ret;ret=getter(elem,name,isXML)!=null?name.toLowerCase():null;attrHandle[name]=handle}return ret}});var rfocusable=/^(?:input|select|textarea|button)$/i,rclickable=/^(?:a|area)$/i;jQuery.fn.extend({prop:function(name,value){return access(this,jQuery.prop,name,value,arguments.length>1)},removeProp:function(name){return this.each(function(){delete this[jQuery.propFix[name]||name]})}});jQuery.extend({prop:function(elem,name,value){var ret,hooks,nType=elem.nodeType;if(nType===3||nType===8||nType===2){return}if(nType!==1||!jQuery.isXMLDoc(elem)){name=jQuery.propFix[name]||name;hooks=jQuery.propHooks[name]}if(value!==undefined){if(hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined){return ret}return elem[name]=value}if(hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null){return ret}return elem[name]},propHooks:{tabIndex:{get:function(elem){var tabindex=jQuery.find.attr(elem,"tabindex");return tabindex?parseInt(tabindex,10):rfocusable.test(elem.nodeName)||rclickable.test(elem.nodeName)&&elem.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}});if(!support.optSelected){jQuery.propHooks.selected={get:function(elem){var parent=elem.parentNode;if(parent&&parent.parentNode){parent.parentNode.selectedIndex}return null},set:function(elem){var parent=elem.parentNode;if(parent){parent.selectedIndex;if(parent.parentNode){parent.parentNode.selectedIndex}}}}}jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this});var rclass=/[\t\r\n\f]/g;function getClass(elem){return elem.getAttribute&&elem.getAttribute("class")||""}jQuery.fn.extend({addClass:function(value){var classes,elem,cur,curValue,clazz,j,finalValue,i=0;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).addClass(value.call(this,j,getClass(this)))})}if(typeof value==="string"&&value){classes=value.match(rnotwhite)||[];while(elem=this[i++]){curValue=getClass(elem);cur=elem.nodeType===1&&(" "+curValue+" ").replace(rclass," ");if(cur){j=0;while(clazz=classes[j++]){if(cur.indexOf(" "+clazz+" ")<0){cur+=clazz+" "}}finalValue=jQuery.trim(cur);if(curValue!==finalValue){elem.setAttribute("class",finalValue)}}}}return this},removeClass:function(value){var classes,elem,cur,curValue,clazz,j,finalValue,i=0;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).removeClass(value.call(this,j,getClass(this)))})}if(!arguments.length){return this.attr("class","")}if(typeof value==="string"&&value){classes=value.match(rnotwhite)||[];while(elem=this[i++]){curValue=getClass(elem);cur=elem.nodeType===1&&(" "+curValue+" ").replace(rclass," ");if(cur){j=0;while(clazz=classes[j++]){while(cur.indexOf(" "+clazz+" ")>-1){cur=cur.replace(" "+clazz+" "," ")}}finalValue=jQuery.trim(cur);if(curValue!==finalValue){elem.setAttribute("class",finalValue)}}}}return this},toggleClass:function(value,stateVal){var type=typeof value;if(typeof stateVal==="boolean"&&type==="string"){return stateVal?this.addClass(value):this.removeClass(value)}if(jQuery.isFunction(value)){return this.each(function(i){jQuery(this).toggleClass(value.call(this,i,getClass(this),stateVal),stateVal)})}return this.each(function(){var className,i,self,classNames;if(type==="string"){i=0;self=jQuery(this);classNames=value.match(rnotwhite)||[];while(className=classNames[i++]){if(self.hasClass(className)){self.removeClass(className)}else{self.addClass(className)}}}else if(value===undefined||type==="boolean"){className=getClass(this);if(className){dataPriv.set(this,"__className__",className)}if(this.setAttribute){this.setAttribute("class",className||value===false?"":dataPriv.get(this,"__className__")||"")}}})},hasClass:function(selector){var className,elem,i=0;className=" "+selector+" ";while(elem=this[i++]){if(elem.nodeType===1&&(" "+getClass(elem)+" ").replace(rclass," ").indexOf(className)>-1){return true}}return false}});var rreturn=/\r/g,rspaces=/[\x20\t\r\n\f]+/g;jQuery.fn.extend({val:function(value){var hooks,ret,isFunction,elem=this[0];if(!arguments.length){if(elem){hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()];if(hooks&&"get"in hooks&&(ret=hooks.get(elem,"value"))!==undefined){return ret}ret=elem.value;return typeof ret==="string"?ret.replace(rreturn,""):ret==null?"":ret}return}isFunction=jQuery.isFunction(value);return this.each(function(i){var val;if(this.nodeType!==1){return}if(isFunction){val=value.call(this,i,jQuery(this).val())}else{val=value}if(val==null){val=""}else if(typeof val==="number"){val+=""}else if(jQuery.isArray(val)){val=jQuery.map(val,function(value){return value==null?"":value+""})}hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];if(!hooks||!("set"in hooks)||hooks.set(this,val,"value")===undefined){this.value=val}})}});jQuery.extend({valHooks:{option:{get:function(elem){var val=jQuery.find.attr(elem,"value");return val!=null?val:jQuery.trim(jQuery.text(elem)).replace(rspaces," ")}},select:{get:function(elem){var value,option,options=elem.options,index=elem.selectedIndex,one=elem.type==="select-one"||index<0,values=one?null:[],max=one?index+1:options.length,i=index<0?max:one?index:0;for(;i<max;i++){option=options[i];if((option.selected||i===index)&&(support.optDisabled?!option.disabled:option.getAttribute("disabled")===null)&&(!option.parentNode.disabled||!jQuery.nodeName(option.parentNode,"optgroup"))){value=jQuery(option).val();if(one){return value}values.push(value)}}return values},set:function(elem,value){var optionSet,option,options=elem.options,values=jQuery.makeArray(value),i=options.length;while(i--){option=options[i];if(option.selected=jQuery.inArray(jQuery.valHooks.option.get(option),values)>-1){optionSet=true}}if(!optionSet){elem.selectedIndex=-1}return values}}}});jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(elem,value){if(jQuery.isArray(value)){return elem.checked=jQuery.inArray(jQuery(elem).val(),value)>-1}}};if(!support.checkOn){jQuery.valHooks[this].get=function(elem){return elem.getAttribute("value")===null?"on":elem.value}}});var rfocusMorph=/^(?:focusinfocus|focusoutblur)$/;jQuery.extend(jQuery.event,{trigger:function(event,data,elem,onlyHandlers){var i,cur,tmp,bubbleType,ontype,handle,special,eventPath=[elem||document],type=hasOwn.call(event,"type")?event.type:event,namespaces=hasOwn.call(event,"namespace")?event.namespace.split("."):[];cur=tmp=elem=elem||document;if(elem.nodeType===3||elem.nodeType===8){return}if(rfocusMorph.test(type+jQuery.event.triggered)){return}if(type.indexOf(".")>-1){namespaces=type.split(".");type=namespaces.shift();namespaces.sort()}ontype=type.indexOf(":")<0&&"on"+type;event=event[jQuery.expando]?event:new jQuery.Event(type,typeof event==="object"&&event);event.isTrigger=onlyHandlers?2:3;event.namespace=namespaces.join(".");event.rnamespace=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;event.result=undefined;if(!event.target){event.target=elem}data=data==null?[event]:jQuery.makeArray(data,[event]);special=jQuery.event.special[type]||{};if(!onlyHandlers&&special.trigger&&special.trigger.apply(elem,data)===false){return}if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){bubbleType=special.delegateType||type;if(!rfocusMorph.test(bubbleType+type)){cur=cur.parentNode}for(;cur;cur=cur.parentNode){eventPath.push(cur);tmp=cur}if(tmp===(elem.ownerDocument||document)){eventPath.push(tmp.defaultView||tmp.parentWindow||window)}}i=0;while((cur=eventPath[i++])&&!event.isPropagationStopped()){event.type=i>1?bubbleType:special.bindType||type;handle=(dataPriv.get(cur,"events")||{})[event.type]&&dataPriv.get(cur,"handle");if(handle){handle.apply(cur,data)}handle=ontype&&cur[ontype];if(handle&&handle.apply&&acceptData(cur)){event.result=handle.apply(cur,data);if(event.result===false){event.preventDefault()}}}event.type=type;if(!onlyHandlers&&!event.isDefaultPrevented()){if((!special._default||special._default.apply(eventPath.pop(),data)===false)&&acceptData(elem)){if(ontype&&jQuery.isFunction(elem[type])&&!jQuery.isWindow(elem)){tmp=elem[ontype];if(tmp){elem[ontype]=null}jQuery.event.triggered=type;elem[type]();jQuery.event.triggered=undefined;if(tmp){elem[ontype]=tmp}}}}return event.result},simulate:function(type,elem,event){var e=jQuery.extend(new jQuery.Event,event,{type:type,isSimulated:true});jQuery.event.trigger(e,null,elem)}});jQuery.fn.extend({trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this)})},triggerHandler:function(type,data){var elem=this[0];if(elem){return jQuery.event.trigger(type,data,elem,true)}}});jQuery.each(("blur focus focusin focusout load resize scroll unload click dblclick "+"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave "+"change select submit keydown keypress keyup error contextmenu").split(" "),function(i,name){jQuery.fn[name]=function(data,fn){return arguments.length>0?this.on(name,null,data,fn):this.trigger(name)}});jQuery.fn.extend({hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver)}});support.focusin="onfocusin"in window;if(!support.focusin){jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event))};jQuery.event.special[fix]={setup:function(){var doc=this.ownerDocument||this,attaches=dataPriv.access(doc,fix);if(!attaches){doc.addEventListener(orig,handler,true)}dataPriv.access(doc,fix,(attaches||0)+1)},teardown:function(){var doc=this.ownerDocument||this,attaches=dataPriv.access(doc,fix)-1;if(!attaches){doc.removeEventListener(orig,handler,true);dataPriv.remove(doc,fix)}else{dataPriv.access(doc,fix,attaches)}}}})}var location=window.location;var nonce=jQuery.now();var rquery=/\?/;jQuery.parseJSON=function(data){return JSON.parse(data+"")};jQuery.parseXML=function(data){var xml;if(!data||typeof data!=="string"){return null}try{xml=(new window.DOMParser).parseFromString(data,"text/xml")}catch(e){xml=undefined}if(!xml||xml.getElementsByTagName("parsererror").length){jQuery.error("Invalid XML: "+data)}return xml};var rhash=/#.*$/,rts=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)$/gm,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,prefilters={},transports={},allTypes="*/".concat("*"),originAnchor=document.createElement("a");originAnchor.href=location.href;function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){if(typeof dataTypeExpression!=="string"){func=dataTypeExpression;dataTypeExpression="*"}var dataType,i=0,dataTypes=dataTypeExpression.toLowerCase().match(rnotwhite)||[];if(jQuery.isFunction(func)){while(dataType=dataTypes[i++]){if(dataType[0]==="+"){dataType=dataType.slice(1)||"*";(structure[dataType]=structure[dataType]||[]).unshift(func)}else{(structure[dataType]=structure[dataType]||[]).push(func)}}}}}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR){var inspected={},seekingTransport=structure===transports;function inspect(dataType){var selected;inspected[dataType]=true;jQuery.each(structure[dataType]||[],function(_,prefilterOrFactory){var dataTypeOrTransport=prefilterOrFactory(options,originalOptions,jqXHR);if(typeof dataTypeOrTransport==="string"&&!seekingTransport&&!inspected[dataTypeOrTransport]){options.dataTypes.unshift(dataTypeOrTransport);inspect(dataTypeOrTransport);return false}else if(seekingTransport){return!(selected=dataTypeOrTransport)}});return selected}return inspect(options.dataTypes[0])||!inspected["*"]&&inspect("*")}function ajaxExtend(target,src){var key,deep,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src){if(src[key]!==undefined){(flatOptions[key]?target:deep||(deep={}))[key]=src[key]}}if(deep){jQuery.extend(true,target,deep)}return target}function ajaxHandleResponses(s,jqXHR,responses){var ct,type,finalDataType,firstDataType,contents=s.contents,dataTypes=s.dataTypes;while(dataTypes[0]==="*"){dataTypes.shift();if(ct===undefined){ct=s.mimeType||jqXHR.getResponseHeader("Content-Type")}}if(ct){for(type in contents){if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break}}}if(dataTypes[0]in responses){finalDataType=dataTypes[0]}else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break}if(!firstDataType){firstDataType=type}}finalDataType=finalDataType||firstDataType}if(finalDataType){if(finalDataType!==dataTypes[0]){dataTypes.unshift(finalDataType)}return responses[finalDataType]}}function ajaxConvert(s,response,jqXHR,isSuccess){var conv2,current,conv,tmp,prev,converters={},dataTypes=s.dataTypes.slice();if(dataTypes[1]){for(conv in s.converters){converters[conv.toLowerCase()]=s.converters[conv]}}current=dataTypes.shift();while(current){if(s.responseFields[current]){jqXHR[s.responseFields[current]]=response}if(!prev&&isSuccess&&s.dataFilter){response=s.dataFilter(response,s.dataType)}prev=current;current=dataTypes.shift();if(current){if(current==="*"){current=prev}else if(prev!=="*"&&prev!==current){conv=converters[prev+" "+current]||converters["* "+current];if(!conv){for(conv2 in converters){tmp=conv2.split(" ");if(tmp[1]===current){conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]];if(conv){if(conv===true){conv=converters[conv2]}else if(converters[conv2]!==true){current=tmp[0];dataTypes.unshift(tmp[1])}break}}}}if(conv!==true){if(conv&&s.throws){response=conv(response)}else{try{response=conv(response)}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current}}}}}}}return{state:"success",data:response}}jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:location.href,type:"GET",isLocal:rlocalProtocol.test(location.protocol),global:true,processData:true,async:true,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":true,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{url:true,context:true}},ajaxSetup:function(target,settings){return settings?ajaxExtend(ajaxExtend(target,jQuery.ajaxSettings),settings):ajaxExtend(jQuery.ajaxSettings,target)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){if(typeof url==="object"){options=url;url=undefined}options=options||{};var transport,cacheURL,responseHeadersString,responseHeaders,timeoutTimer,urlAnchor,fireGlobals,i,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=s.context&&(callbackContext.nodeType||callbackContext.jquery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},state=0,strAbort="canceled",jqXHR={readyState:0,getResponseHeader:function(key){var match;if(state===2){if(!responseHeaders){responseHeaders={};while(match=rheaders.exec(responseHeadersString)){responseHeaders[match[1].toLowerCase()]=match[2]}}match=responseHeaders[key.toLowerCase()]}return match==null?null:match},getAllResponseHeaders:function(){return state===2?responseHeadersString:null},setRequestHeader:function(name,value){var lname=name.toLowerCase();if(!state){name=requestHeadersNames[lname]=requestHeadersNames[lname]||name;requestHeaders[name]=value}return this},overrideMimeType:function(type){if(!state){s.mimeType=type}return this},statusCode:function(map){var code;if(map){if(state<2){for(code in map){statusCode[code]=[statusCode[code],map[code]]}}else{jqXHR.always(map[jqXHR.status])}}return this},abort:function(statusText){var finalText=statusText||strAbort;if(transport){transport.abort(finalText)}done(0,finalText);return this}};deferred.promise(jqXHR).complete=completeDeferred.add;jqXHR.success=jqXHR.done;jqXHR.error=jqXHR.fail;s.url=((url||s.url||location.href)+"").replace(rhash,"").replace(rprotocol,location.protocol+"//");s.type=options.method||options.type||s.method||s.type;s.dataTypes=jQuery.trim(s.dataType||"*").toLowerCase().match(rnotwhite)||[""];if(s.crossDomain==null){urlAnchor=document.createElement("a");try{urlAnchor.href=s.url;urlAnchor.href=urlAnchor.href;s.crossDomain=originAnchor.protocol+"//"+originAnchor.host!==urlAnchor.protocol+"//"+urlAnchor.host}catch(e){s.crossDomain=true}}if(s.data&&s.processData&&typeof s.data!=="string"){s.data=jQuery.param(s.data,s.traditional)}inspectPrefiltersOrTransports(prefilters,s,options,jqXHR);if(state===2){return jqXHR}fireGlobals=jQuery.event&&s.global;if(fireGlobals&&jQuery.active++===0){jQuery.event.trigger("ajaxStart")}s.type=s.type.toUpperCase();s.hasContent=!rnoContent.test(s.type);cacheURL=s.url;if(!s.hasContent){if(s.data){cacheURL=s.url+=(rquery.test(cacheURL)?"&":"?")+s.data;delete s.data}if(s.cache===false){s.url=rts.test(cacheURL)?cacheURL.replace(rts,"$1_="+nonce++):cacheURL+(rquery.test(cacheURL)?"&":"?")+"_="+nonce++}}if(s.ifModified){if(jQuery.lastModified[cacheURL]){jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[cacheURL])}if(jQuery.etag[cacheURL]){jqXHR.setRequestHeader("If-None-Match",jQuery.etag[cacheURL])}}if(s.data&&s.hasContent&&s.contentType!==false||options.contentType){jqXHR.setRequestHeader("Content-Type",s.contentType)}jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+(s.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):s.accepts["*"]);for(i in s.headers){jqXHR.setRequestHeader(i,s.headers[i])}if(s.beforeSend&&(s.beforeSend.call(callbackContext,jqXHR,s)===false||state===2)){return jqXHR.abort()}strAbort="abort";for(i in{success:1,error:1,complete:1}){jqXHR[i](s[i])}transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR);if(!transport){done(-1,"No Transport")}else{jqXHR.readyState=1;if(fireGlobals){globalEventContext.trigger("ajaxSend",[jqXHR,s])}if(state===2){return jqXHR}if(s.async&&s.timeout>0){timeoutTimer=window.setTimeout(function(){jqXHR.abort("timeout")},s.timeout)}try{state=1;transport.send(requestHeaders,done)}catch(e){if(state<2){done(-1,e)}else{throw e}}}function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;if(state===2){return}state=2;if(timeoutTimer){window.clearTimeout(timeoutTimer)}transport=undefined;responseHeadersString=headers||"";jqXHR.readyState=status>0?4:0;isSuccess=status>=200&&status<300||status===304;if(responses){response=ajaxHandleResponses(s,jqXHR,responses)}response=ajaxConvert(s,response,jqXHR,isSuccess);if(isSuccess){if(s.ifModified){modified=jqXHR.getResponseHeader("Last-Modified");if(modified){jQuery.lastModified[cacheURL]=modified}modified=jqXHR.getResponseHeader("etag");if(modified){jQuery.etag[cacheURL]=modified}}if(status===204||s.type==="HEAD"){statusText="nocontent"}else if(status===304){statusText="notmodified"}else{statusText=response.state;success=response.data;error=response.error;isSuccess=!error}}else{error=statusText;if(status||!statusText){statusText="error";if(status<0){status=0}}}jqXHR.status=status;jqXHR.statusText=(nativeStatusText||statusText)+"";if(isSuccess){deferred.resolveWith(callbackContext,[success,statusText,jqXHR])}else{deferred.rejectWith(callbackContext,[jqXHR,statusText,error])}jqXHR.statusCode(statusCode);statusCode=undefined;if(fireGlobals){globalEventContext.trigger(isSuccess?"ajaxSuccess":"ajaxError",[jqXHR,s,isSuccess?success:error])}completeDeferred.fireWith(callbackContext,[jqXHR,statusText]);if(fireGlobals){globalEventContext.trigger("ajaxComplete",[jqXHR,s]);if(!--jQuery.active){jQuery.event.trigger("ajaxStop")}}}return jqXHR},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json")},getScript:function(url,callback){return jQuery.get(url,undefined,callback,"script")}});jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){if(jQuery.isFunction(data)){type=type||callback;callback=data;data=undefined}return jQuery.ajax(jQuery.extend({url:url,type:method,dataType:type,data:data,success:callback},jQuery.isPlainObject(url)&&url))}});jQuery._evalUrl=function(url){return jQuery.ajax({url:url,type:"GET",dataType:"script",async:false,global:false,throws:true})};jQuery.fn.extend({wrapAll:function(html){var wrap;if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapAll(html.call(this,i))})}if(this[0]){wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){wrap.insertBefore(this[0])}wrap.map(function(){var elem=this;while(elem.firstElementChild){elem=elem.firstElementChild}return elem}).append(this)}return this},wrapInner:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapInner(html.call(this,i))})}return this.each(function(){var self=jQuery(this),contents=self.contents();if(contents.length){contents.wrapAll(html)}else{self.append(html)}})},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this,i):html)})},unwrap:function(){return this.parent().each(function(){if(!jQuery.nodeName(this,"body")){jQuery(this).replaceWith(this.childNodes)}}).end()}});jQuery.expr.filters.hidden=function(elem){return!jQuery.expr.filters.visible(elem)};jQuery.expr.filters.visible=function(elem){return elem.offsetWidth>0||elem.offsetHeight>0||elem.getClientRects().length>0};var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;function buildParams(prefix,obj,traditional,add){var name;if(jQuery.isArray(obj)){jQuery.each(obj,function(i,v){if(traditional||rbracket.test(prefix)){add(prefix,v)}else{buildParams(prefix+"["+(typeof v==="object"&&v!=null?i:"")+"]",v,traditional,add)}})}else if(!traditional&&jQuery.type(obj)==="object"){for(name in obj){buildParams(prefix+"["+name+"]",obj[name],traditional,add)}}else{add(prefix,obj)}}jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,value){value=jQuery.isFunction(value)?value():value==null?"":value;s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value)};if(traditional===undefined){traditional=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional}if(jQuery.isArray(a)||a.jquery&&!jQuery.isPlainObject(a)){jQuery.each(a,function(){add(this.name,this.value)})}else{for(prefix in a){buildParams(prefix,a[prefix],traditional,add)}}return s.join("&").replace(r20,"+")};jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var elements=jQuery.prop(this,"elements");return elements?jQuery.makeArray(elements):this}).filter(function(){var type=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(type)&&(this.checked||!rcheckableType.test(type))}).map(function(i,elem){var val=jQuery(this).val();return val==null?null:jQuery.isArray(val)?jQuery.map(val,function(val){return{name:elem.name,value:val.replace(rCRLF,"\r\n")}}):{name:elem.name,value:val.replace(rCRLF,"\r\n")}}).get()}});jQuery.ajaxSettings.xhr=function(){try{return new window.XMLHttpRequest}catch(e){}};var xhrSuccessStatus={0:200,1223:204},xhrSupported=jQuery.ajaxSettings.xhr();support.cors=!!xhrSupported&&"withCredentials"in xhrSupported;support.ajax=xhrSupported=!!xhrSupported;jQuery.ajaxTransport(function(options){var callback,errorCallback;if(support.cors||xhrSupported&&!options.crossDomain){return{send:function(headers,complete){var i,xhr=options.xhr();xhr.open(options.type,options.url,options.async,options.username,options.password);if(options.xhrFields){for(i in options.xhrFields){xhr[i]=options.xhrFields[i]}}if(options.mimeType&&xhr.overrideMimeType){xhr.overrideMimeType(options.mimeType)}if(!options.crossDomain&&!headers["X-Requested-With"]){headers["X-Requested-With"]="XMLHttpRequest"}for(i in headers){xhr.setRequestHeader(i,headers[i])}callback=function(type){return function(){if(callback){callback=errorCallback=xhr.onload=xhr.onerror=xhr.onabort=xhr.onreadystatechange=null;if(type==="abort"){xhr.abort()}else if(type==="error"){if(typeof xhr.status!=="number"){complete(0,"error")}else{complete(xhr.status,xhr.statusText)}}else{complete(xhrSuccessStatus[xhr.status]||xhr.status,xhr.statusText,(xhr.responseType||"text")!=="text"||typeof xhr.responseText!=="string"?{binary:xhr.response}:{text:xhr.responseText},xhr.getAllResponseHeaders())}}}};xhr.onload=callback();errorCallback=xhr.onerror=callback("error");if(xhr.onabort!==undefined){xhr.onabort=errorCallback}else{xhr.onreadystatechange=function(){if(xhr.readyState===4){window.setTimeout(function(){if(callback){errorCallback()}})}}}callback=callback("abort");try{xhr.send(options.hasContent&&options.data||null)}catch(e){if(callback){throw e}}},abort:function(){if(callback){callback()}}}}});jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, "+"application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(text){jQuery.globalEval(text);return text}}});jQuery.ajaxPrefilter("script",function(s){if(s.cache===undefined){s.cache=false}if(s.crossDomain){s.type="GET"}});jQuery.ajaxTransport("script",function(s){if(s.crossDomain){var script,callback;return{send:function(_,complete){script=jQuery("<script>").prop({charset:s.scriptCharset,src:s.url}).on("load error",callback=function(evt){script.remove();callback=null;if(evt){complete(evt.type==="error"?404:200,evt.type)}});document.head.appendChild(script[0])},abort:function(){if(callback){callback()}}}}});var oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||jQuery.expando+"_"+nonce++;this[callback]=true;return callback}});jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,jsonProp=s.jsonp!==false&&(rjsonp.test(s.url)?"url":typeof s.data==="string"&&(s.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&rjsonp.test(s.data)&&"data");if(jsonProp||s.dataTypes[0]==="jsonp"){callbackName=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback;if(jsonProp){s[jsonProp]=s[jsonProp].replace(rjsonp,"$1"+callbackName)}else if(s.jsonp!==false){s.url+=(rquery.test(s.url)?"&":"?")+s.jsonp+"="+callbackName}s.converters["script json"]=function(){if(!responseContainer){jQuery.error(callbackName+" was not called")}return responseContainer[0]};s.dataTypes[0]="json";overwritten=window[callbackName];window[callbackName]=function(){responseContainer=arguments};jqXHR.always(function(){if(overwritten===undefined){jQuery(window).removeProp(callbackName)}else{window[callbackName]=overwritten}if(s[callbackName]){s.jsonpCallback=originalSettings.jsonpCallback;oldCallbacks.push(callbackName)}if(responseContainer&&jQuery.isFunction(overwritten)){overwritten(responseContainer[0])}responseContainer=overwritten=undefined});return"script"}});jQuery.parseHTML=function(data,context,keepScripts){if(!data||typeof data!=="string"){return null}if(typeof context==="boolean"){keepScripts=context;context=false}context=context||document;var parsed=rsingleTag.exec(data),scripts=!keepScripts&&[];if(parsed){return[context.createElement(parsed[1])]}parsed=buildFragment([data],context,scripts);if(scripts&&scripts.length){jQuery(scripts).remove()}return jQuery.merge([],parsed.childNodes)};var _load=jQuery.fn.load;jQuery.fn.load=function(url,params,callback){if(typeof url!=="string"&&_load){return _load.apply(this,arguments)}var selector,type,response,self=this,off=url.indexOf(" ");if(off>-1){selector=jQuery.trim(url.slice(off));url=url.slice(0,off)}if(jQuery.isFunction(params)){callback=params;params=undefined}else if(params&&typeof params==="object"){type="POST"}if(self.length>0){jQuery.ajax({url:url,type:type||"GET",dataType:"html",data:params}).done(function(responseText){response=arguments;self.html(selector?jQuery("<div>").append(jQuery.parseHTML(responseText)).find(selector):responseText)}).always(callback&&function(jqXHR,status){self.each(function(){callback.apply(this,response||[jqXHR.responseText,status,jqXHR])})})}return this};jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(i,type){jQuery.fn[type]=function(fn){return this.on(type,fn)}});jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem}).length};function getWindow(elem){return jQuery.isWindow(elem)?elem:elem.nodeType===9&&elem.defaultView}jQuery.offset={setOffset:function(elem,options,i){var curPosition,curLeft,curCSSTop,curTop,curOffset,curCSSLeft,calculatePosition,position=jQuery.css(elem,"position"),curElem=jQuery(elem),props={};if(position==="static"){elem.style.position="relative"}curOffset=curElem.offset();curCSSTop=jQuery.css(elem,"top");curCSSLeft=jQuery.css(elem,"left");calculatePosition=(position==="absolute"||position==="fixed")&&(curCSSTop+curCSSLeft).indexOf("auto")>-1;if(calculatePosition){curPosition=curElem.position();curTop=curPosition.top;curLeft=curPosition.left}else{curTop=parseFloat(curCSSTop)||0;curLeft=parseFloat(curCSSLeft)||0}if(jQuery.isFunction(options)){options=options.call(elem,i,jQuery.extend({},curOffset))}if(options.top!=null){props.top=options.top-curOffset.top+curTop}if(options.left!=null){props.left=options.left-curOffset.left+curLeft}if("using"in options){options.using.call(elem,props)}else{curElem.css(props)}}};jQuery.fn.extend({offset:function(options){if(arguments.length){return options===undefined?this:this.each(function(i){jQuery.offset.setOffset(this,options,i)})}var docElem,win,elem=this[0],box={top:0,left:0},doc=elem&&elem.ownerDocument;if(!doc){return}docElem=doc.documentElement;if(!jQuery.contains(docElem,elem)){return box}box=elem.getBoundingClientRect();win=getWindow(doc);return{top:box.top+win.pageYOffset-docElem.clientTop,left:box.left+win.pageXOffset-docElem.clientLeft}},position:function(){if(!this[0]){return}var offsetParent,offset,elem=this[0],parentOffset={top:0,left:0};if(jQuery.css(elem,"position")==="fixed"){offset=elem.getBoundingClientRect()}else{offsetParent=this.offsetParent();offset=this.offset();if(!jQuery.nodeName(offsetParent[0],"html")){parentOffset=offsetParent.offset()}parentOffset.top+=jQuery.css(offsetParent[0],"borderTopWidth",true);parentOffset.left+=jQuery.css(offsetParent[0],"borderLeftWidth",true)}return{top:offset.top-parentOffset.top-jQuery.css(elem,"marginTop",true),left:offset.left-parentOffset.left-jQuery.css(elem,"marginLeft",true)}},offsetParent:function(){return this.map(function(){var offsetParent=this.offsetParent;while(offsetParent&&jQuery.css(offsetParent,"position")==="static"){offsetParent=offsetParent.offsetParent}return offsetParent||documentElement})}});jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){var top="pageYOffset"===prop;jQuery.fn[method]=function(val){return access(this,function(elem,method,val){var win=getWindow(elem);if(val===undefined){return win?win[prop]:elem[method]}if(win){win.scrollTo(!top?val:win.pageXOffset,top?val:win.pageYOffset)}else{elem[method]=val}},method,val,arguments.length)}});jQuery.each(["top","left"],function(i,prop){jQuery.cssHooks[prop]=addGetHookIf(support.pixelPosition,function(elem,computed){if(computed){computed=curCSS(elem,prop);return rnumnonpx.test(computed)?jQuery(elem).position()[prop]+"px":computed}})});jQuery.each({Height:"height",Width:"width"},function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||typeof margin!=="boolean"),extra=defaultExtra||(margin===true||value===true?"margin":"border");return access(this,function(elem,type,value){var doc;if(jQuery.isWindow(elem)){return elem.document.documentElement["client"+name]}if(elem.nodeType===9){doc=elem.documentElement;return Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name])}return value===undefined?jQuery.css(elem,type,extra):jQuery.style(elem,type,value,extra)},type,chainable?margin:undefined,chainable,null)}})});jQuery.fn.extend({bind:function(types,data,fn){return this.on(types,null,data,fn)},unbind:function(types,fn){return this.off(types,null,fn)},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn)},undelegate:function(selector,types,fn){return arguments.length===1?this.off(selector,"**"):this.off(types,selector||"**",fn)},size:function(){return this.length}});jQuery.fn.andSelf=jQuery.fn.addBack;if(typeof define==="function"&&define.amd){define("jquery",[],function(){return jQuery})}var _jQuery=window.jQuery,_$=window.$;jQuery.noConflict=function(deep){if(window.$===jQuery){window.$=_$}if(deep&&window.jQuery===jQuery){window.jQuery=_jQuery}return jQuery};if(!noGlobal){window.jQuery=window.$=jQuery}return jQuery})},{}],143:[function(require,module,exports){(function(window,document,undefined){if(!window){return}var _MAP={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"};var _KEYCODE_MAP={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"};var _SHIFT_MAP={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"};var _SPECIAL_ALIASES={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"};var _REVERSE_MAP;for(var i=1;i<20;++i){_MAP[111+i]="f"+i}for(i=0;i<=9;++i){_MAP[i+96]=i.toString()}function _addEvent(object,type,callback){if(object.addEventListener){object.addEventListener(type,callback,false);return}object.attachEvent("on"+type,callback)}function _characterFromEvent(e){if(e.type=="keypress"){var character=String.fromCharCode(e.which);if(!e.shiftKey){character=character.toLowerCase()}return character}if(_MAP[e.which]){return _MAP[e.which]}if(_KEYCODE_MAP[e.which]){return _KEYCODE_MAP[e.which]}return String.fromCharCode(e.which).toLowerCase()}function _modifiersMatch(modifiers1,modifiers2){return modifiers1.sort().join(",")===modifiers2.sort().join(",")}function _eventModifiers(e){var modifiers=[];if(e.shiftKey){modifiers.push("shift")}if(e.altKey){modifiers.push("alt")}if(e.ctrlKey){modifiers.push("ctrl")}if(e.metaKey){modifiers.push("meta")}return modifiers}function _preventDefault(e){if(e.preventDefault){e.preventDefault();return}e.returnValue=false}function _stopPropagation(e){if(e.stopPropagation){e.stopPropagation();return}e.cancelBubble=true}function _isModifier(key){return key=="shift"||key=="ctrl"||key=="alt"||key=="meta"}function _getReverseMap(){if(!_REVERSE_MAP){_REVERSE_MAP={};for(var key in _MAP){if(key>95&&key<112){continue}if(_MAP.hasOwnProperty(key)){_REVERSE_MAP[_MAP[key]]=key}}}return _REVERSE_MAP}function _pickBestAction(key,modifiers,action){if(!action){action=_getReverseMap()[key]?"keydown":"keypress"}if(action=="keypress"&&modifiers.length){action="keydown"}return action}function _keysFromString(combination){if(combination==="+"){return["+"]}combination=combination.replace(/\+{2}/g,"+plus");return combination.split("+")}function _getKeyInfo(combination,action){var keys;var key;var i;var modifiers=[];keys=_keysFromString(combination);for(i=0;i<keys.length;++i){key=keys[i];if(_SPECIAL_ALIASES[key]){key=_SPECIAL_ALIASES[key]}if(action&&action!="keypress"&&_SHIFT_MAP[key]){key=_SHIFT_MAP[key];modifiers.push("shift")}if(_isModifier(key)){modifiers.push(key)}}action=_pickBestAction(key,modifiers,action);return{key:key,modifiers:modifiers,action:action}}function _belongsTo(element,ancestor){if(element===null||element===document){return false}if(element===ancestor){return true}return _belongsTo(element.parentNode,ancestor)}function Mousetrap(targetElement){var self=this;targetElement=targetElement||document;if(!(self instanceof Mousetrap)){return new Mousetrap(targetElement)}self.target=targetElement;self._callbacks={};self._directMap={};var _sequenceLevels={};var _resetTimer;var _ignoreNextKeyup=false;var _ignoreNextKeypress=false;var _nextExpectedAction=false;function _resetSequences(doNotReset){doNotReset=doNotReset||{};var activeSequences=false,key;for(key in _sequenceLevels){if(doNotReset[key]){activeSequences=true;continue}_sequenceLevels[key]=0}if(!activeSequences){_nextExpectedAction=false}}function _getMatches(character,modifiers,e,sequenceName,combination,level){var i;var callback;var matches=[];var action=e.type;if(!self._callbacks[character]){return[]}if(action=="keyup"&&_isModifier(character)){modifiers=[character]}for(i=0;i<self._callbacks[character].length;++i){callback=self._callbacks[character][i];if(!sequenceName&&callback.seq&&_sequenceLevels[callback.seq]!=callback.level){continue}if(action!=callback.action){continue}if(action=="keypress"&&!e.metaKey&&!e.ctrlKey||_modifiersMatch(modifiers,callback.modifiers)){var deleteCombo=!sequenceName&&callback.combo==combination;var deleteSequence=sequenceName&&callback.seq==sequenceName&&callback.level==level;if(deleteCombo||deleteSequence){self._callbacks[character].splice(i,1)}matches.push(callback)}}return matches}function _fireCallback(callback,e,combo,sequence){if(self.stopCallback(e,e.target||e.srcElement,combo,sequence)){return}if(callback(e,combo)===false){_preventDefault(e);_stopPropagation(e)}}self._handleKey=function(character,modifiers,e){var callbacks=_getMatches(character,modifiers,e);var i;var doNotReset={};var maxLevel=0;var processedSequenceCallback=false;for(i=0;i<callbacks.length;++i){if(callbacks[i].seq){maxLevel=Math.max(maxLevel,callbacks[i].level)}}for(i=0;i<callbacks.length;++i){if(callbacks[i].seq){if(callbacks[i].level!=maxLevel){continue}processedSequenceCallback=true;doNotReset[callbacks[i].seq]=1;_fireCallback(callbacks[i].callback,e,callbacks[i].combo,callbacks[i].seq);continue}if(!processedSequenceCallback){_fireCallback(callbacks[i].callback,e,callbacks[i].combo)}}var ignoreThisKeypress=e.type=="keypress"&&_ignoreNextKeypress;if(e.type==_nextExpectedAction&&!_isModifier(character)&&!ignoreThisKeypress){_resetSequences(doNotReset)}_ignoreNextKeypress=processedSequenceCallback&&e.type=="keydown"};function _handleKeyEvent(e){if(typeof e.which!=="number"){e.which=e.keyCode}var character=_characterFromEvent(e);if(!character){return}if(e.type=="keyup"&&_ignoreNextKeyup===character){_ignoreNextKeyup=false;return}self.handleKey(character,_eventModifiers(e),e)}function _resetSequenceTimer(){clearTimeout(_resetTimer);_resetTimer=setTimeout(_resetSequences,1e3)}function _bindSequence(combo,keys,callback,action){_sequenceLevels[combo]=0;function _increaseSequence(nextAction){return function(){_nextExpectedAction=nextAction;++_sequenceLevels[combo];_resetSequenceTimer()}}function _callbackAndReset(e){_fireCallback(callback,e,combo);if(action!=="keyup"){_ignoreNextKeyup=_characterFromEvent(e)}setTimeout(_resetSequences,10)}for(var i=0;i<keys.length;++i){var isFinal=i+1===keys.length;var wrappedCallback=isFinal?_callbackAndReset:_increaseSequence(action||_getKeyInfo(keys[i+1]).action);_bindSingle(keys[i],wrappedCallback,action,combo,i)}}function _bindSingle(combination,callback,action,sequenceName,level){self._directMap[combination+":"+action]=callback;combination=combination.replace(/\s+/g," ");var sequence=combination.split(" ");var info;if(sequence.length>1){_bindSequence(combination,sequence,callback,action);return}info=_getKeyInfo(combination,action);self._callbacks[info.key]=self._callbacks[info.key]||[];_getMatches(info.key,info.modifiers,{type:info.action},sequenceName,combination,level);self._callbacks[info.key][sequenceName?"unshift":"push"]({callback:callback,modifiers:info.modifiers,action:info.action,seq:sequenceName,level:level,combo:combination})}self._bindMultiple=function(combinations,callback,action){for(var i=0;i<combinations.length;++i){_bindSingle(combinations[i],callback,action)}};_addEvent(targetElement,"keypress",_handleKeyEvent);_addEvent(targetElement,"keydown",_handleKeyEvent);_addEvent(targetElement,"keyup",_handleKeyEvent)}Mousetrap.prototype.bind=function(keys,callback,action){var self=this;keys=keys instanceof Array?keys:[keys];self._bindMultiple.call(self,keys,callback,action);return self};Mousetrap.prototype.unbind=function(keys,action){var self=this;return self.bind.call(self,keys,function(){},action)};Mousetrap.prototype.trigger=function(keys,action){var self=this;if(self._directMap[keys+":"+action]){self._directMap[keys+":"+action]({},keys)}return self};Mousetrap.prototype.reset=function(){var self=this;self._callbacks={};self._directMap={};return self};Mousetrap.prototype.stopCallback=function(e,element){var self=this;if((" "+element.className+" ").indexOf(" mousetrap ")>-1){return false}if(_belongsTo(element,self.target)){return false}return element.tagName=="INPUT"||element.tagName=="SELECT"||element.tagName=="TEXTAREA"||element.isContentEditable};Mousetrap.prototype.handleKey=function(){var self=this;return self._handleKey.apply(self,arguments)};Mousetrap.addKeycodes=function(object){for(var key in object){if(object.hasOwnProperty(key)){_MAP[key]=object[key]}}_REVERSE_MAP=null};Mousetrap.init=function(){var documentMousetrap=Mousetrap(document);for(var method in documentMousetrap){if(method.charAt(0)!=="_"){Mousetrap[method]=function(method){return function(){return documentMousetrap[method].apply(documentMousetrap,arguments)}}(method)}}};Mousetrap.init();window.Mousetrap=Mousetrap;if(typeof module!=="undefined"&&module.exports){module.exports=Mousetrap}if(typeof define==="function"&&define.amd){define(function(){return Mousetrap})}})(typeof window!=="undefined"?window:null,typeof window!=="undefined"?document:null)},{}],144:[function(require,module,exports){(function(){var root=this;var previousUnderscore=root._;var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var push=ArrayProto.push,slice=ArrayProto.slice,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind,nativeCreate=Object.create;var Ctor=function(){};var _=function(obj){if(obj instanceof _)return obj;if(!(this instanceof _))return new _(obj);this._wrapped=obj};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=_}exports._=_}else{root._=_}_.VERSION="1.8.3";var optimizeCb=function(func,context,argCount){if(context===void 0)return func;switch(argCount==null?3:argCount){case 1:return function(value){return func.call(context,value)};case 2:return function(value,other){return func.call(context,value,other)};case 3:return function(value,index,collection){return func.call(context,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(context,accumulator,value,index,collection)}}return function(){return func.apply(context,arguments)}};var cb=function(value,context,argCount){if(value==null)return _.identity;if(_.isFunction(value))return optimizeCb(value,context,argCount);if(_.isObject(value))return _.matcher(value);return _.property(value)};_.iteratee=function(value,context){return cb(value,context,Infinity)};var createAssigner=function(keysFunc,undefinedOnly){return function(obj){var length=arguments.length;if(length<2||obj==null)return obj;for(var index=1;index<length;index++){var source=arguments[index],keys=keysFunc(source),l=keys.length;for(var i=0;i<l;i++){var key=keys[i];if(!undefinedOnly||obj[key]===void 0)obj[key]=source[key]}}return obj}};var baseCreate=function(prototype){if(!_.isObject(prototype))return{};if(nativeCreate)return nativeCreate(prototype);Ctor.prototype=prototype;var result=new Ctor;Ctor.prototype=null;return result};var property=function(key){return function(obj){return obj==null?void 0:obj[key]}};var MAX_ARRAY_INDEX=Math.pow(2,53)-1;var getLength=property("length");var isArrayLike=function(collection){var length=getLength(collection);return typeof length=="number"&&length>=0&&length<=MAX_ARRAY_INDEX};_.each=_.forEach=function(obj,iteratee,context){iteratee=optimizeCb(iteratee,context);var i,length;if(isArrayLike(obj)){for(i=0,length=obj.length;i<length;i++){iteratee(obj[i],i,obj)}}else{var keys=_.keys(obj);for(i=0,length=keys.length;i<length;i++){iteratee(obj[keys[i]],keys[i],obj)}}return obj};_.map=_.collect=function(obj,iteratee,context){iteratee=cb(iteratee,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,results=Array(length);for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;results[index]=iteratee(obj[currentKey],currentKey,obj)}return results};function createReduce(dir){function iterator(obj,iteratee,memo,keys,index,length){for(;index>=0&&index<length;index+=dir){var currentKey=keys?keys[index]:index;memo=iteratee(memo,obj[currentKey],currentKey,obj)}return memo}return function(obj,iteratee,memo,context){iteratee=optimizeCb(iteratee,context,4);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=dir>0?0:length-1;if(arguments.length<3){memo=obj[keys?keys[index]:index];index+=dir}return iterator(obj,iteratee,memo,keys,index,length)}}_.reduce=_.foldl=_.inject=createReduce(1);_.reduceRight=_.foldr=createReduce(-1);_.find=_.detect=function(obj,predicate,context){var key;if(isArrayLike(obj)){key=_.findIndex(obj,predicate,context)}else{key=_.findKey(obj,predicate,context)}if(key!==void 0&&key!==-1)return obj[key]};_.filter=_.select=function(obj,predicate,context){var results=[];predicate=cb(predicate,context);_.each(obj,function(value,index,list){if(predicate(value,index,list))results.push(value)});return results};_.reject=function(obj,predicate,context){return _.filter(obj,_.negate(cb(predicate)),context)};_.every=_.all=function(obj,predicate,context){predicate=cb(predicate,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length;for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(!predicate(obj[currentKey],currentKey,obj))return false}return true};_.some=_.any=function(obj,predicate,context){predicate=cb(predicate,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length;for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(predicate(obj[currentKey],currentKey,obj))return true}return false};_.contains=_.includes=_.include=function(obj,item,fromIndex,guard){if(!isArrayLike(obj))obj=_.values(obj);if(typeof fromIndex!="number"||guard)fromIndex=0;return _.indexOf(obj,item,fromIndex)>=0};_.invoke=function(obj,method){var args=slice.call(arguments,2);var isFunc=_.isFunction(method);return _.map(obj,function(value){var func=isFunc?method:value[method];return func==null?func:func.apply(value,args)})};_.pluck=function(obj,key){return _.map(obj,_.property(key))};_.where=function(obj,attrs){return _.filter(obj,_.matcher(attrs))};_.findWhere=function(obj,attrs){return _.find(obj,_.matcher(attrs))};_.max=function(obj,iteratee,context){var result=-Infinity,lastComputed=-Infinity,value,computed;if(iteratee==null&&obj!=null){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++){value=obj[i];if(value>result){result=value}}}else{iteratee=cb(iteratee,context);_.each(obj,function(value,index,list){computed=iteratee(value,index,list);if(computed>lastComputed||computed===-Infinity&&result===-Infinity){result=value;lastComputed=computed}})}return result};_.min=function(obj,iteratee,context){var result=Infinity,lastComputed=Infinity,value,computed;if(iteratee==null&&obj!=null){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++){value=obj[i];if(value<result){result=value}}}else{iteratee=cb(iteratee,context);_.each(obj,function(value,index,list){computed=iteratee(value,index,list);if(computed<lastComputed||computed===Infinity&&result===Infinity){result=value;lastComputed=computed}})}return result};_.shuffle=function(obj){var set=isArrayLike(obj)?obj:_.values(obj);var length=set.length;var shuffled=Array(length);for(var index=0,rand;index<length;index++){rand=_.random(0,index);if(rand!==index)shuffled[index]=shuffled[rand];shuffled[rand]=set[index]}return shuffled};_.sample=function(obj,n,guard){if(n==null||guard){if(!isArrayLike(obj))obj=_.values(obj);return obj[_.random(obj.length-1)]}return _.shuffle(obj).slice(0,Math.max(0,n))};_.sortBy=function(obj,iteratee,context){iteratee=cb(iteratee,context);return _.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iteratee(value,index,list)}}).sort(function(left,right){var a=left.criteria;var b=right.criteria;if(a!==b){if(a>b||a===void 0)return 1;if(a<b||b===void 0)return-1}return left.index-right.index}),"value")};var group=function(behavior){return function(obj,iteratee,context){var result={};iteratee=cb(iteratee,context);_.each(obj,function(value,index){var key=iteratee(value,index,obj);behavior(result,value,key)});return result}};_.groupBy=group(function(result,value,key){if(_.has(result,key))result[key].push(value);else result[key]=[value]});_.indexBy=group(function(result,value,key){result[key]=value});_.countBy=group(function(result,value,key){if(_.has(result,key))result[key]++;else result[key]=1});_.toArray=function(obj){if(!obj)return[];if(_.isArray(obj))return slice.call(obj);if(isArrayLike(obj))return _.map(obj,_.identity);return _.values(obj)};_.size=function(obj){if(obj==null)return 0;return isArrayLike(obj)?obj.length:_.keys(obj).length};_.partition=function(obj,predicate,context){predicate=cb(predicate,context);var pass=[],fail=[];_.each(obj,function(value,key,obj){(predicate(value,key,obj)?pass:fail).push(value)});return[pass,fail]};_.first=_.head=_.take=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[0];return _.initial(array,array.length-n)};_.initial=function(array,n,guard){return slice.call(array,0,Math.max(0,array.length-(n==null||guard?1:n)))};_.last=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[array.length-1];return _.rest(array,Math.max(0,array.length-n))};_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,n==null||guard?1:n)};_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,strict,startIndex){var output=[],idx=0;for(var i=startIndex||0,length=getLength(input);i<length;i++){var value=input[i];if(isArrayLike(value)&&(_.isArray(value)||_.isArguments(value))){if(!shallow)value=flatten(value,shallow,strict);var j=0,len=value.length;output.length+=len;while(j<len){output[idx++]=value[j++]}}else if(!strict){output[idx++]=value}}return output};_.flatten=function(array,shallow){return flatten(array,shallow,false)};_.without=function(array){return _.difference(array,slice.call(arguments,1))};_.uniq=_.unique=function(array,isSorted,iteratee,context){if(!_.isBoolean(isSorted)){context=iteratee;iteratee=isSorted;isSorted=false}if(iteratee!=null)iteratee=cb(iteratee,context);var result=[];var seen=[];for(var i=0,length=getLength(array);i<length;i++){var value=array[i],computed=iteratee?iteratee(value,i,array):value;if(isSorted){if(!i||seen!==computed)result.push(value);seen=computed}else if(iteratee){if(!_.contains(seen,computed)){seen.push(computed);result.push(value)}}else if(!_.contains(result,value)){result.push(value)}}return result};_.union=function(){return _.uniq(flatten(arguments,true,true))};_.intersection=function(array){var result=[];var argsLength=arguments.length;for(var i=0,length=getLength(array);i<length;i++){var item=array[i];if(_.contains(result,item))continue;for(var j=1;j<argsLength;j++){if(!_.contains(arguments[j],item))break}if(j===argsLength)result.push(item)}return result};_.difference=function(array){var rest=flatten(arguments,true,true,1);return _.filter(array,function(value){return!_.contains(rest,value)})};_.zip=function(){return _.unzip(arguments)};_.unzip=function(array){var length=array&&_.max(array,getLength).length||0;var result=Array(length);for(var index=0;index<length;index++){result[index]=_.pluck(array,index)}return result};_.object=function(list,values){var result={};for(var i=0,length=getLength(list);i<length;i++){if(values){result[list[i]]=values[i]}else{result[list[i][0]]=list[i][1]}}return result};function createPredicateIndexFinder(dir){return function(array,predicate,context){predicate=cb(predicate,context);var length=getLength(array);var index=dir>0?0:length-1;for(;index>=0&&index<length;index+=dir){if(predicate(array[index],index,array))return index}return-1}}_.findIndex=createPredicateIndexFinder(1);_.findLastIndex=createPredicateIndexFinder(-1);_.sortedIndex=function(array,obj,iteratee,context){iteratee=cb(iteratee,context,1);var value=iteratee(obj);var low=0,high=getLength(array);while(low<high){var mid=Math.floor((low+high)/2);if(iteratee(array[mid])<value)low=mid+1;else high=mid}return low};function createIndexFinder(dir,predicateFind,sortedIndex){return function(array,item,idx){var i=0,length=getLength(array);if(typeof idx=="number"){if(dir>0){i=idx>=0?idx:Math.max(idx+length,i)}else{length=idx>=0?Math.min(idx+1,length):idx+length+1}}else if(sortedIndex&&idx&&length){idx=sortedIndex(array,item);return array[idx]===item?idx:-1}if(item!==item){idx=predicateFind(slice.call(array,i,length),_.isNaN);return idx>=0?idx+i:-1}for(idx=dir>0?i:length-1;idx>=0&&idx<length;idx+=dir){if(array[idx]===item)return idx}return-1}}_.indexOf=createIndexFinder(1,_.findIndex,_.sortedIndex);_.lastIndexOf=createIndexFinder(-1,_.findLastIndex);_.range=function(start,stop,step){if(stop==null){stop=start||0;start=0}step=step||1;var length=Math.max(Math.ceil((stop-start)/step),0);var range=Array(length);for(var idx=0;idx<length;idx++,start+=step){range[idx]=start}return range};var executeBound=function(sourceFunc,boundFunc,context,callingContext,args){if(!(callingContext instanceof boundFunc))return sourceFunc.apply(context,args);var self=baseCreate(sourceFunc.prototype);var result=sourceFunc.apply(self,args);if(_.isObject(result))return result;return self};_.bind=function(func,context){if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError("Bind must be called on a function");var args=slice.call(arguments,2);var bound=function(){return executeBound(func,bound,context,this,args.concat(slice.call(arguments)))};return bound};_.partial=function(func){var boundArgs=slice.call(arguments,1);var bound=function(){var position=0,length=boundArgs.length;var args=Array(length);for(var i=0;i<length;i++){args[i]=boundArgs[i]===_?arguments[position++]:boundArgs[i]}while(position<arguments.length)args.push(arguments[position++]);return executeBound(func,bound,this,this,args)};return bound};_.bindAll=function(obj){var i,length=arguments.length,key;if(length<=1)throw new Error("bindAll must be passed function names");for(i=1;i<length;i++){key=arguments[i];obj[key]=_.bind(obj[key],obj)}return obj};_.memoize=function(func,hasher){var memoize=function(key){var cache=memoize.cache;var address=""+(hasher?hasher.apply(this,arguments):key);if(!_.has(cache,address))cache[address]=func.apply(this,arguments);return cache[address]};memoize.cache={};return memoize};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)};_.defer=_.partial(_.delay,_,1);_.throttle=function(func,wait,options){var context,args,result;var timeout=null;var previous=0;if(!options)options={};var later=function(){previous=options.leading===false?0:_.now();timeout=null;result=func.apply(context,args);if(!timeout)context=args=null};return function(){var now=_.now();if(!previous&&options.leading===false)previous=now;var remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0||remaining>wait){if(timeout){clearTimeout(timeout);timeout=null}previous=now;result=func.apply(context,args);if(!timeout)context=args=null}else if(!timeout&&options.trailing!==false){timeout=setTimeout(later,remaining)}return result}};_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result;var later=function(){var last=_.now()-timestamp;if(last<wait&&last>=0){timeout=setTimeout(later,wait-last)}else{timeout=null;if(!immediate){result=func.apply(context,args);if(!timeout)context=args=null}}};return function(){context=this;args=arguments;timestamp=_.now();var callNow=immediate&&!timeout;if(!timeout)timeout=setTimeout(later,wait);if(callNow){result=func.apply(context,args);context=args=null}return result}};_.wrap=function(func,wrapper){return _.partial(wrapper,func)};_.negate=function(predicate){return function(){return!predicate.apply(this,arguments)}};_.compose=function(){var args=arguments;var start=args.length-1;return function(){var i=start;var result=args[start].apply(this,arguments);while(i--)result=args[i].call(this,result);return result}};_.after=function(times,func){return function(){if(--times<1){return func.apply(this,arguments)}}};_.before=function(times,func){var memo;return function(){if(--times>0){memo=func.apply(this,arguments)}if(times<=1)func=null;return memo}};_.once=_.partial(_.before,2);var hasEnumBug=!{toString:null}.propertyIsEnumerable("toString");var nonEnumerableProps=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];function collectNonEnumProps(obj,keys){var nonEnumIdx=nonEnumerableProps.length;var constructor=obj.constructor;var proto=_.isFunction(constructor)&&constructor.prototype||ObjProto;var prop="constructor";if(_.has(obj,prop)&&!_.contains(keys,prop))keys.push(prop);while(nonEnumIdx--){prop=nonEnumerableProps[nonEnumIdx];if(prop in obj&&obj[prop]!==proto[prop]&&!_.contains(keys,prop)){keys.push(prop)}}}_.keys=function(obj){if(!_.isObject(obj))return[];if(nativeKeys)return nativeKeys(obj);var keys=[];for(var key in obj)if(_.has(obj,key))keys.push(key);if(hasEnumBug)collectNonEnumProps(obj,keys);return keys};_.allKeys=function(obj){if(!_.isObject(obj))return[];var keys=[];for(var key in obj)keys.push(key);if(hasEnumBug)collectNonEnumProps(obj,keys);return keys};_.values=function(obj){var keys=_.keys(obj);var length=keys.length;var values=Array(length);for(var i=0;i<length;i++){values[i]=obj[keys[i]]}return values};_.mapObject=function(obj,iteratee,context){iteratee=cb(iteratee,context);var keys=_.keys(obj),length=keys.length,results={},currentKey;for(var index=0;index<length;index++){currentKey=keys[index];results[currentKey]=iteratee(obj[currentKey],currentKey,obj)}return results};_.pairs=function(obj){var keys=_.keys(obj);var length=keys.length;var pairs=Array(length);for(var i=0;i<length;i++){pairs[i]=[keys[i],obj[keys[i]]]}return pairs};_.invert=function(obj){var result={};var keys=_.keys(obj);for(var i=0,length=keys.length;i<length;i++){result[obj[keys[i]]]=keys[i]}return result};_.functions=_.methods=function(obj){var names=[];for(var key in obj){if(_.isFunction(obj[key]))names.push(key)}return names.sort()};_.extend=createAssigner(_.allKeys);_.extendOwn=_.assign=createAssigner(_.keys);_.findKey=function(obj,predicate,context){predicate=cb(predicate,context);var keys=_.keys(obj),key;for(var i=0,length=keys.length;i<length;i++){key=keys[i];if(predicate(obj[key],key,obj))return key}};_.pick=function(object,oiteratee,context){var result={},obj=object,iteratee,keys;if(obj==null)return result;if(_.isFunction(oiteratee)){keys=_.allKeys(obj);iteratee=optimizeCb(oiteratee,context)}else{keys=flatten(arguments,false,false,1);iteratee=function(value,key,obj){return key in obj};obj=Object(obj)}for(var i=0,length=keys.length;i<length;i++){var key=keys[i];var value=obj[key];if(iteratee(value,key,obj))result[key]=value}return result};_.omit=function(obj,iteratee,context){if(_.isFunction(iteratee)){iteratee=_.negate(iteratee)}else{var keys=_.map(flatten(arguments,false,false,1),String);iteratee=function(value,key){return!_.contains(keys,key)}}return _.pick(obj,iteratee,context)};_.defaults=createAssigner(_.allKeys,true);_.create=function(prototype,props){var result=baseCreate(prototype);if(props)_.extendOwn(result,props);return result};_.clone=function(obj){if(!_.isObject(obj))return obj;return _.isArray(obj)?obj.slice():_.extend({},obj)};_.tap=function(obj,interceptor){interceptor(obj);return obj};_.isMatch=function(object,attrs){var keys=_.keys(attrs),length=keys.length;if(object==null)return!length;var obj=Object(object);for(var i=0;i<length;i++){var key=keys[i];if(attrs[key]!==obj[key]||!(key in obj))return false}return true};var eq=function(a,b,aStack,bStack){if(a===b)return a!==0||1/a===1/b;if(a==null||b==null)return a===b;if(a instanceof _)a=a._wrapped;if(b instanceof _)b=b._wrapped;var className=toString.call(a);if(className!==toString.call(b))return false;switch(className){case"[object RegExp]":case"[object String]":return""+a===""+b;case"[object Number]":if(+a!==+a)return+b!==+b;return+a===0?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}var areArrays=className==="[object Array]";if(!areArrays){if(typeof a!="object"||typeof b!="object")return false;var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)&&("constructor"in a&&"constructor"in b)){return false}}aStack=aStack||[];bStack=bStack||[];var length=aStack.length;while(length--){if(aStack[length]===a)return bStack[length]===b}aStack.push(a);bStack.push(b);if(areArrays){length=a.length;if(length!==b.length)return false;while(length--){if(!eq(a[length],b[length],aStack,bStack))return false}}else{var keys=_.keys(a),key;length=keys.length;if(_.keys(b).length!==length)return false;while(length--){key=keys[length];if(!(_.has(b,key)&&eq(a[key],b[key],aStack,bStack)))return false}}aStack.pop();bStack.pop();return true};_.isEqual=function(a,b){return eq(a,b)};_.isEmpty=function(obj){if(obj==null)return true;if(isArrayLike(obj)&&(_.isArray(obj)||_.isString(obj)||_.isArguments(obj)))return obj.length===0;return _.keys(obj).length===0};_.isElement=function(obj){return!!(obj&&obj.nodeType===1)};_.isArray=nativeIsArray||function(obj){return toString.call(obj)==="[object Array]"};_.isObject=function(obj){var type=typeof obj;return type==="function"||type==="object"&&!!obj};_.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(name){_["is"+name]=function(obj){return toString.call(obj)==="[object "+name+"]"}});if(!_.isArguments(arguments)){_.isArguments=function(obj){return _.has(obj,"callee")}}if(typeof/./!="function"&&typeof Int8Array!="object"){_.isFunction=function(obj){return typeof obj=="function"||false}}_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))};_.isNaN=function(obj){return _.isNumber(obj)&&obj!==+obj};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)==="[object Boolean]"};_.isNull=function(obj){return obj===null};_.isUndefined=function(obj){return obj===void 0};_.has=function(obj,key){return obj!=null&&hasOwnProperty.call(obj,key)};_.noConflict=function(){root._=previousUnderscore;return this};_.identity=function(value){return value};_.constant=function(value){return function(){return value}};_.noop=function(){};_.property=property;_.propertyOf=function(obj){return obj==null?function(){}:function(key){return obj[key]}};_.matcher=_.matches=function(attrs){attrs=_.extendOwn({},attrs);return function(obj){return _.isMatch(obj,attrs)}};_.times=function(n,iteratee,context){var accum=Array(Math.max(0,n));iteratee=optimizeCb(iteratee,context,1);for(var i=0;i<n;i++)accum[i]=iteratee(i);return accum};_.random=function(min,max){if(max==null){max=min;min=0}return min+Math.floor(Math.random()*(max-min+1))};_.now=Date.now||function(){return(new Date).getTime()};var escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var unescapeMap=_.invert(escapeMap);var createEscaper=function(map){var escaper=function(match){return map[match]};var source="(?:"+_.keys(map).join("|")+")";var testRegexp=RegExp(source);var replaceRegexp=RegExp(source,"g");return function(string){string=string==null?"":""+string;return testRegexp.test(string)?string.replace(replaceRegexp,escaper):string}};_.escape=createEscaper(escapeMap);_.unescape=createEscaper(unescapeMap);_.result=function(object,property,fallback){var value=object==null?void 0:object[property];if(value===void 0){value=fallback}return _.isFunction(value)?value.call(object):value};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/;var escapes={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"};var escaper=/\\|'|\r|\n|\u2028|\u2029/g;var escapeChar=function(match){return"\\"+escapes[match]};_.template=function(text,settings,oldSettings){if(!settings&&oldSettings)settings=oldSettings;settings=_.defaults({},settings,_.templateSettings);var matcher=RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g");var index=0;var source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,escapeChar);index=offset+match.length;if(escape){source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'"}else if(interpolate){source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'"}else if(evaluate){source+="';\n"+evaluate+"\n__p+='"}return match});source+="';\n";if(!settings.variable)source="with(obj||{}){\n"+source+"}\n";source="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{var render=new Function(settings.variable||"obj","_",source)}catch(e){e.source=source;throw e}var template=function(data){return render.call(this,data,_)};var argument=settings.variable||"obj";template.source="function("+argument+"){\n"+source+"}";return template};_.chain=function(obj){var instance=_(obj);instance._chain=true;return instance};var result=function(instance,obj){return instance._chain?_(obj).chain():obj};_.mixin=function(obj){_.each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];push.apply(args,arguments);return result(this,func.apply(_,args))}})};_.mixin(_);_.each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;method.apply(obj,arguments);if((name==="shift"||name==="splice")&&obj.length===0)delete obj[0];return result(this,obj)}});_.each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result(this,method.apply(this._wrapped,arguments))}});_.prototype.value=function(){return this._wrapped};_.prototype.valueOf=_.prototype.toJSON=_.prototype.value;_.prototype.toString=function(){return""+this._wrapped};if(typeof define==="function"&&define.amd){define("underscore",[],function(){return _})}}).call(this)},{}],145:[function(require,module,exports){var FDLayoutConstants=require("./FDLayoutConstants");function CoSEConstants(){}for(var prop in FDLayoutConstants){CoSEConstants[prop]=FDLayoutConstants[prop]}CoSEConstants.DEFAULT_USE_MULTI_LEVEL_SCALING=false;CoSEConstants.DEFAULT_RADIAL_SEPARATION=FDLayoutConstants.DEFAULT_EDGE_LENGTH;CoSEConstants.DEFAULT_COMPONENT_SEPERATION=60;module.exports=CoSEConstants},{"./FDLayoutConstants":153}],146:[function(require,module,exports){var FDLayoutEdge=require("./FDLayoutEdge");function CoSEEdge(source,target,vEdge){FDLayoutEdge.call(this,source,target,vEdge)}CoSEEdge.prototype=Object.create(FDLayoutEdge.prototype);for(var prop in FDLayoutEdge){CoSEEdge[prop]=FDLayoutEdge[prop]}module.exports=CoSEEdge},{"./FDLayoutEdge":154}],147:[function(require,module,exports){var LGraph=require("./LGraph");function CoSEGraph(parent,graphMgr,vGraph){LGraph.call(this,parent,graphMgr,vGraph)}CoSEGraph.prototype=Object.create(LGraph.prototype);for(var prop in LGraph){CoSEGraph[prop]=LGraph[prop]}module.exports=CoSEGraph},{"./LGraph":162}],148:[function(require,module,exports){var LGraphManager=require("./LGraphManager");function CoSEGraphManager(layout){LGraphManager.call(this,layout)}CoSEGraphManager.prototype=Object.create(LGraphManager.prototype);for(var prop in LGraphManager){CoSEGraphManager[prop]=LGraphManager[prop]}module.exports=CoSEGraphManager},{"./LGraphManager":163}],149:[function(require,module,exports){var FDLayout=require("./FDLayout");var CoSEGraphManager=require("./CoSEGraphManager");var CoSEGraph=require("./CoSEGraph");var CoSENode=require("./CoSENode");var CoSEEdge=require("./CoSEEdge");function CoSELayout(){FDLayout.call(this)}CoSELayout.prototype=Object.create(FDLayout.prototype);for(var prop in FDLayout){CoSELayout[prop]=FDLayout[prop]}CoSELayout.prototype.newGraphManager=function(){var gm=new CoSEGraphManager(this);this.graphManager=gm;return gm};CoSELayout.prototype.newGraph=function(vGraph){return new CoSEGraph(null,this.graphManager,vGraph)};CoSELayout.prototype.newNode=function(vNode){return new CoSENode(this.graphManager,vNode)};CoSELayout.prototype.newEdge=function(vEdge){return new CoSEEdge(null,null,vEdge)};CoSELayout.prototype.initParameters=function(){FDLayout.prototype.initParameters.call(this,arguments);if(!this.isSubLayout){if(CoSEConstants.DEFAULT_EDGE_LENGTH<10){this.idealEdgeLength=10}else{this.idealEdgeLength=CoSEConstants.DEFAULT_EDGE_LENGTH}this.useSmartIdealEdgeLengthCalculation=CoSEConstants.DEFAULT_USE_SMART_IDEAL_EDGE_LENGTH_CALCULATION;this.springConstant=FDLayoutConstants.DEFAULT_SPRING_STRENGTH;this.repulsionConstant=FDLayoutConstants.DEFAULT_REPULSION_STRENGTH;this.gravityConstant=FDLayoutConstants.DEFAULT_GRAVITY_STRENGTH;this.compoundGravityConstant=FDLayoutConstants.DEFAULT_COMPOUND_GRAVITY_STRENGTH;this.gravityRangeFactor=FDLayoutConstants.DEFAULT_GRAVITY_RANGE_FACTOR;this.compoundGravityRangeFactor=FDLayoutConstants.DEFAULT_COMPOUND_GRAVITY_RANGE_FACTOR}};CoSELayout.prototype.layout=function(){var createBendsAsNeeded=LayoutConstants.DEFAULT_CREATE_BENDS_AS_NEEDED;if(createBendsAsNeeded){this.createBendpoints();this.graphManager.resetAllEdges()}this.level=0;return this.classicLayout()};CoSELayout.prototype.classicLayout=function(){this.calculateNodesToApplyGravitationTo();this.graphManager.calcLowestCommonAncestors();this.graphManager.calcInclusionTreeDepths();this.graphManager.getRoot().calcEstimatedSize();this.calcIdealEdgeLengths();if(!this.incremental){var forest=this.getFlatForest();if(forest.length>0){this.positionNodesRadially(forest)}else{this.positionNodesRandomly()}}this.initSpringEmbedder();this.runSpringEmbedder();console.log("Classic CoSE layout finished after "+this.totalIterations+" iterations");return true};CoSELayout.prototype.runSpringEmbedder=function(){var lastFrame=(new Date).getTime();var initialAnimationPeriod=25;var animationPeriod=initialAnimationPeriod;do{this.totalIterations++;if(this.totalIterations%FDLayoutConstants.CONVERGENCE_CHECK_PERIOD==0){if(this.isConverged()){break}this.coolingFactor=this.initialCoolingFactor*((this.maxIterations-this.totalIterations)/this.maxIterations);animationPeriod=Math.ceil(initialAnimationPeriod*Math.sqrt(this.coolingFactor))}this.totalDisplacement=0;this.graphManager.updateBounds();this.calcSpringForces();this.calcRepulsionForces();this.calcGravitationalForces();this.moveNodes();this.animate();if(FDLayoutConstants.ANIMATE==="during"&&this.totalIterations%animationPeriod==0){for(var i=0;i<1e7;i++){if((new Date).getTime()-lastFrame>25){break}}lastFrame=(new Date).getTime();var allNodes=this.graphManager.getAllNodes();var pData={};for(var i=0;i<allNodes.length;i++){var rect=allNodes[i].rect;var id=allNodes[i].id;pData[id]={id:id,x:rect.getCenterX(),y:rect.getCenterY(),w:rect.width,h:rect.height}}broadcast({pData:pData})}}while(this.totalIterations<this.maxIterations);this.graphManager.updateBounds()};CoSELayout.prototype.calculateNodesToApplyGravitationTo=function(){var nodeList=[];var graph;var graphs=this.graphManager.getGraphs();var size=graphs.length;var i;for(i=0;i<size;i++){graph=graphs[i];graph.updateConnected();if(!graph.isConnected){nodeList=nodeList.concat(graph.getNodes())}}this.graphManager.setAllNodesToApplyGravitation(nodeList)};CoSELayout.prototype.createBendpoints=function(){var edges=[];edges=edges.concat(this.graphManager.getAllEdges());var visited=new HashSet;var i;for(i=0;i<edges.length;i++){var edge=edges[i];if(!visited.contains(edge)){var source=edge.getSource();var target=edge.getTarget();if(source==target){edge.getBendpoints().push(new PointD);edge.getBendpoints().push(new PointD);this.createDummyNodesForBendpoints(edge);visited.add(edge)}else{var edgeList=[];edgeList=edgeList.concat(source.getEdgeListToNode(target));edgeList=edgeList.concat(target.getEdgeListToNode(source));if(!visited.contains(edgeList[0])){if(edgeList.length>1){var k;for(k=0;k<edgeList.length;k++){var multiEdge=edgeList[k];multiEdge.getBendpoints().push(new PointD);this.createDummyNodesForBendpoints(multiEdge)}}visited.addAll(list)}}}if(visited.size()==edges.length){break}}};CoSELayout.prototype.positionNodesRadially=function(forest){var currentStartingPoint=new Point(0,0);var numberOfColumns=Math.ceil(Math.sqrt(forest.length));var height=0;var currentY=0;var currentX=0;var point=new PointD(0,0);for(var i=0;i<forest.length;i++){if(i%numberOfColumns==0){currentX=0;currentY=height;if(i!=0){currentY+=CoSEConstants.DEFAULT_COMPONENT_SEPERATION}height=0}var tree=forest[i];var centerNode=Layout.findCenterOfTree(tree);currentStartingPoint.x=currentX;currentStartingPoint.y=currentY;point=CoSELayout.radialLayout(tree,centerNode,currentStartingPoint);if(point.y>height){height=Math.floor(point.y)}currentX=Math.floor(point.x+CoSEConstants.DEFAULT_COMPONENT_SEPERATION)}this.transform(new PointD(LayoutConstants.WORLD_CENTER_X-point.x/2,LayoutConstants.WORLD_CENTER_Y-point.y/2))};CoSELayout.radialLayout=function(tree,centerNode,startingPoint){var radialSep=Math.max(this.maxDiagonalInTree(tree),CoSEConstants.DEFAULT_RADIAL_SEPARATION);CoSELayout.branchRadialLayout(centerNode,null,0,359,0,radialSep);var bounds=LGraph.calculateBounds(tree);var transform=new Transform;transform.setDeviceOrgX(bounds.getMinX());transform.setDeviceOrgY(bounds.getMinY());transform.setWorldOrgX(startingPoint.x);transform.setWorldOrgY(startingPoint.y);for(var i=0;i<tree.length;i++){var node=tree[i];node.transform(transform)}var bottomRight=new PointD(bounds.getMaxX(),bounds.getMaxY());return transform.inverseTransformPoint(bottomRight)};CoSELayout.branchRadialLayout=function(node,parentOfNode,startAngle,endAngle,distance,radialSeparation){var halfInterval=(endAngle-startAngle+1)/2;if(halfInterval<0){halfInterval+=180}var nodeAngle=(halfInterval+startAngle)%360;var teta=nodeAngle*IGeometry.TWO_PI/360;var cos_teta=Math.cos(teta);var x_=distance*Math.cos(teta);var y_=distance*Math.sin(teta);node.setCenter(x_,y_);var neighborEdges=[];neighborEdges=neighborEdges.concat(node.getEdges());var childCount=neighborEdges.length;if(parentOfNode!=null){childCount--}var branchCount=0;var incEdgesCount=neighborEdges.length;var startIndex;var edges=node.getEdgesBetween(parentOfNode);while(edges.length>1){var temp=edges[0];edges.splice(0,1);var index=neighborEdges.indexOf(temp);if(index>=0){neighborEdges.splice(index,1)}incEdgesCount--;childCount--}if(parentOfNode!=null){startIndex=(neighborEdges.indexOf(edges[0])+1)%incEdgesCount}else{startIndex=0}var stepAngle=Math.abs(endAngle-startAngle)/childCount;for(var i=startIndex;branchCount!=childCount;i=++i%incEdgesCount){var currentNeighbor=neighborEdges[i].getOtherEnd(node);if(currentNeighbor==parentOfNode){continue}var childStartAngle=(startAngle+branchCount*stepAngle)%360;var childEndAngle=(childStartAngle+stepAngle)%360;CoSELayout.branchRadialLayout(currentNeighbor,node,childStartAngle,childEndAngle,distance+radialSeparation,radialSeparation);branchCount++}};CoSELayout.maxDiagonalInTree=function(tree){var maxDiagonal=Integer.MIN_VALUE;for(var i=0;i<tree.length;i++){var node=tree[i];var diagonal=node.getDiagonal();if(diagonal>maxDiagonal){maxDiagonal=diagonal}}return maxDiagonal};CoSELayout.prototype.calcRepulsionRange=function(){return 2*(this.level+1)*this.idealEdgeLength};module.exports=CoSELayout},{"./CoSEEdge":146,"./CoSEGraph":147,"./CoSEGraphManager":148,"./CoSENode":150,"./FDLayout":152}],150:[function(require,module,exports){var FDLayoutNode=require("./FDLayoutNode");function CoSENode(gm,loc,size,vNode){FDLayoutNode.call(this,gm,loc,size,vNode)}CoSENode.prototype=Object.create(FDLayoutNode.prototype);for(var prop in FDLayoutNode){CoSENode[prop]=FDLayoutNode[prop]}CoSENode.prototype.move=function(){var layout=this.graphManager.getLayout();this.displacementX=layout.coolingFactor*(this.springForceX+this.repulsionForceX+this.gravitationForceX);this.displacementY=layout.coolingFactor*(this.springForceY+this.repulsionForceY+this.gravitationForceY);if(Math.abs(this.displacementX)>layout.coolingFactor*layout.maxNodeDisplacement){this.displacementX=layout.coolingFactor*layout.maxNodeDisplacement*IMath.sign(this.displacementX)}if(Math.abs(this.displacementY)>layout.coolingFactor*layout.maxNodeDisplacement){this.displacementY=layout.coolingFactor*layout.maxNodeDisplacement*IMath.sign(this.displacementY)}if(this.child==null){this.moveBy(this.displacementX,this.displacementY)}else if(this.child.getNodes().length==0){this.moveBy(this.displacementX,this.displacementY)}else{this.propogateDisplacementToChildren(this.displacementX,this.displacementY)}layout.totalDisplacement+=Math.abs(this.displacementX)+Math.abs(this.displacementY);this.springForceX=0;this.springForceY=0;this.repulsionForceX=0;this.repulsionForceY=0;this.gravitationForceX=0;this.gravitationForceY=0;this.displacementX=0;this.displacementY=0};CoSENode.prototype.propogateDisplacementToChildren=function(dX,dY){var nodes=this.getChild().getNodes();var node;for(var i=0;i<nodes.length;i++){node=nodes[i];if(node.getChild()==null){node.moveBy(dX,dY);node.displacementX+=dX;node.displacementY+=dY}else{node.propogateDisplacementToChildren(dX,dY)}}};CoSENode.prototype.setPred1=function(pred1){this.pred1=pred1};CoSENode.prototype.getPred1=function(){return pred1};CoSENode.prototype.getPred2=function(){return pred2};CoSENode.prototype.setNext=function(next){this.next=next};CoSENode.prototype.getNext=function(){return next};CoSENode.prototype.setProcessed=function(processed){this.processed=processed};CoSENode.prototype.isProcessed=function(){return processed};module.exports=CoSENode},{"./FDLayoutNode":155}],151:[function(require,module,exports){function DimensionD(width,height){this.width=0;this.height=0;if(width!==null&&height!==null){this.height=height;this.width=width}}DimensionD.prototype.getWidth=function(){return this.width};DimensionD.prototype.setWidth=function(width){this.width=width};DimensionD.prototype.getHeight=function(){return this.height};DimensionD.prototype.setHeight=function(height){this.height=height};module.exports=DimensionD},{}],152:[function(require,module,exports){var Layout=require("./Layout");var FDLayoutConstants=require("./FDLayoutConstants");function FDLayout(){Layout.call(this);this.useSmartIdealEdgeLengthCalculation=FDLayoutConstants.DEFAULT_USE_SMART_IDEAL_EDGE_LENGTH_CALCULATION;this.idealEdgeLength=FDLayoutConstants.DEFAULT_EDGE_LENGTH;this.springConstant=FDLayoutConstants.DEFAULT_SPRING_STRENGTH;this.repulsionConstant=FDLayoutConstants.DEFAULT_REPULSION_STRENGTH;this.gravityConstant=FDLayoutConstants.DEFAULT_GRAVITY_STRENGTH;this.compoundGravityConstant=FDLayoutConstants.DEFAULT_COMPOUND_GRAVITY_STRENGTH;this.gravityRangeFactor=FDLayoutConstants.DEFAULT_GRAVITY_RANGE_FACTOR;this.compoundGravityRangeFactor=FDLayoutConstants.DEFAULT_COMPOUND_GRAVITY_RANGE_FACTOR;this.displacementThresholdPerNode=3*FDLayoutConstants.DEFAULT_EDGE_LENGTH/100;this.coolingFactor=1;this.initialCoolingFactor=1;this.totalDisplacement=0;this.oldTotalDisplacement=0;this.maxIterations=FDLayoutConstants.MAX_ITERATIONS}FDLayout.prototype=Object.create(Layout.prototype);for(var prop in Layout){FDLayout[prop]=Layout[prop]}FDLayout.prototype.initParameters=function(){Layout.prototype.initParameters.call(this,arguments);if(this.layoutQuality==LayoutConstants.DRAFT_QUALITY){this.displacementThresholdPerNode+=.3;this.maxIterations*=.8}else if(this.layoutQuality==LayoutConstants.PROOF_QUALITY){this.displacementThresholdPerNode-=.3;this.maxIterations*=1.2}this.totalIterations=0;this.notAnimatedIterations=0};FDLayout.prototype.calcIdealEdgeLengths=function(){var edge;var lcaDepth;var source;var target;var sizeOfSourceInLca;var sizeOfTargetInLca;var allEdges=this.getGraphManager().getAllEdges();for(var i=0;i<allEdges.length;i++){edge=allEdges[i];edge.idealLength=this.idealEdgeLength;if(edge.isInterGraph){source=edge.getSource();target=edge.getTarget();sizeOfSourceInLca=edge.getSourceInLca().getEstimatedSize();sizeOfTargetInLca=edge.getTargetInLca().getEstimatedSize();if(this.useSmartIdealEdgeLengthCalculation){edge.idealLength+=sizeOfSourceInLca+sizeOfTargetInLca-2*LayoutConstants.SIMPLE_NODE_SIZE}lcaDepth=edge.getLca().getInclusionTreeDepth();edge.idealLength+=FDLayoutConstants.DEFAULT_EDGE_LENGTH*FDLayoutConstants.PER_LEVEL_IDEAL_EDGE_LENGTH_FACTOR*(source.getInclusionTreeDepth()+target.getInclusionTreeDepth()-2*lcaDepth)}}};FDLayout.prototype.initSpringEmbedder=function(){if(this.incremental){this.coolingFactor=.8;this.initialCoolingFactor=.8;this.maxNodeDisplacement=FDLayoutConstants.MAX_NODE_DISPLACEMENT_INCREMENTAL}else{this.coolingFactor=1;this.initialCoolingFactor=1;this.maxNodeDisplacement=FDLayoutConstants.MAX_NODE_DISPLACEMENT}this.maxIterations=Math.max(this.getAllNodes().length*5,this.maxIterations);this.totalDisplacementThreshold=this.displacementThresholdPerNode*this.getAllNodes().length;this.repulsionRange=this.calcRepulsionRange()};FDLayout.prototype.calcSpringForces=function(){var lEdges=this.getAllEdges();var edge;for(var i=0;i<lEdges.length;i++){edge=lEdges[i];this.calcSpringForce(edge,edge.idealLength)}};FDLayout.prototype.calcRepulsionForces=function(){var i,j;var nodeA,nodeB;var lNodes=this.getAllNodes();for(i=0;i<lNodes.length;i++){nodeA=lNodes[i];for(j=i+1;j<lNodes.length;j++){nodeB=lNodes[j];if(nodeA.getOwner()!=nodeB.getOwner()){continue}this.calcRepulsionForce(nodeA,nodeB)}}};FDLayout.prototype.calcGravitationalForces=function(){var node;var lNodes=this.getAllNodesToApplyGravitation();for(var i=0;i<lNodes.length;i++){node=lNodes[i];this.calcGravitationalForce(node)}};FDLayout.prototype.moveNodes=function(){var lNodes=this.getAllNodes();var node;for(var i=0;i<lNodes.length;i++){node=lNodes[i];node.move()}};FDLayout.prototype.calcSpringForce=function(edge,idealLength){var sourceNode=edge.getSource();var targetNode=edge.getTarget();var length;var springForce;var springForceX;var springForceY;if(this.uniformLeafNodeSizes&&sourceNode.getChild()==null&&targetNode.getChild()==null){edge.updateLengthSimple()}else{edge.updateLength();if(edge.isOverlapingSourceAndTarget){return}}length=edge.getLength();springForce=this.springConstant*(length-idealLength);springForceX=springForce*(edge.lengthX/length);springForceY=springForce*(edge.lengthY/length);sourceNode.springForceX+=springForceX;sourceNode.springForceY+=springForceY;targetNode.springForceX-=springForceX;targetNode.springForceY-=springForceY};FDLayout.prototype.calcRepulsionForce=function(nodeA,nodeB){var rectA=nodeA.getRect();var rectB=nodeB.getRect();var overlapAmount=new Array(2);var clipPoints=new Array(4);var distanceX;var distanceY;var distanceSquared;var distance;var repulsionForce;var repulsionForceX;var repulsionForceY;if(rectA.intersects(rectB)){IGeometry.calcSeparationAmount(rectA,rectB,overlapAmount,FDLayoutConstants.DEFAULT_EDGE_LENGTH/2);repulsionForceX=overlapAmount[0];repulsionForceY=overlapAmount[1]}else{if(this.uniformLeafNodeSizes&&nodeA.getChild()==null&&nodeB.getChild()==null){distanceX=rectB.getCenterX()-rectA.getCenterX();distanceY=rectB.getCenterY()-rectA.getCenterY()}else{IGeometry.getIntersection(rectA,rectB,clipPoints);distanceX=clipPoints[2]-clipPoints[0];distanceY=clipPoints[3]-clipPoints[1]}if(Math.abs(distanceX)<FDLayoutConstants.MIN_REPULSION_DIST){distanceX=IMath.sign(distanceX)*FDLayoutConstants.MIN_REPULSION_DIST}if(Math.abs(distanceY)<FDLayoutConstants.MIN_REPULSION_DIST){distanceY=IMath.sign(distanceY)*FDLayoutConstants.MIN_REPULSION_DIST}distanceSquared=distanceX*distanceX+distanceY*distanceY;distance=Math.sqrt(distanceSquared);repulsionForce=this.repulsionConstant/distanceSquared;repulsionForceX=repulsionForce*distanceX/distance;repulsionForceY=repulsionForce*distanceY/distance}nodeA.repulsionForceX-=repulsionForceX;nodeA.repulsionForceY-=repulsionForceY;nodeB.repulsionForceX+=repulsionForceX;nodeB.repulsionForceY+=repulsionForceY};FDLayout.prototype.calcGravitationalForce=function(node){var ownerGraph;var ownerCenterX;var ownerCenterY;var distanceX;var distanceY;var absDistanceX;var absDistanceY;var estimatedSize;ownerGraph=node.getOwner();ownerCenterX=(ownerGraph.getRight()+ownerGraph.getLeft())/2;ownerCenterY=(ownerGraph.getTop()+ownerGraph.getBottom())/2;distanceX=node.getCenterX()-ownerCenterX;distanceY=node.getCenterY()-ownerCenterY;absDistanceX=Math.abs(distanceX);absDistanceY=Math.abs(distanceY);if(node.getOwner()==this.graphManager.getRoot()){Math.floor(80);estimatedSize=Math.floor(ownerGraph.getEstimatedSize()*this.gravityRangeFactor);if(absDistanceX>estimatedSize||absDistanceY>estimatedSize){node.gravitationForceX=-this.gravityConstant*distanceX;node.gravitationForceY=-this.gravityConstant*distanceY}}else{estimatedSize=Math.floor(ownerGraph.getEstimatedSize()*this.compoundGravityRangeFactor);if(absDistanceX>estimatedSize||absDistanceY>estimatedSize){node.gravitationForceX=-this.gravityConstant*distanceX*this.compoundGravityConstant;node.gravitationForceY=-this.gravityConstant*distanceY*this.compoundGravityConstant}}};FDLayout.prototype.isConverged=function(){var converged;var oscilating=false;if(this.totalIterations>this.maxIterations/3){oscilating=Math.abs(this.totalDisplacement-this.oldTotalDisplacement)<2}converged=this.totalDisplacement<this.totalDisplacementThreshold;this.oldTotalDisplacement=this.totalDisplacement;return converged||oscilating};FDLayout.prototype.animate=function(){if(this.animationDuringLayout&&!this.isSubLayout){if(this.notAnimatedIterations==this.animationPeriod){this.update();this.notAnimatedIterations=0}else{this.notAnimatedIterations++}}};FDLayout.prototype.calcRepulsionRange=function(){return 0};module.exports=FDLayout},{"./FDLayoutConstants":153,"./Layout":166}],153:[function(require,module,exports){var LayoutConstants=require("./LayoutConstants");function FDLayoutConstants(){}for(var prop in LayoutConstants){FDLayoutConstants[prop]=LayoutConstants[prop]}FDLayoutConstants.MAX_ITERATIONS=2500;FDLayoutConstants.DEFAULT_EDGE_LENGTH=50;FDLayoutConstants.DEFAULT_SPRING_STRENGTH=.45;FDLayoutConstants.DEFAULT_REPULSION_STRENGTH=4500;FDLayoutConstants.DEFAULT_GRAVITY_STRENGTH=.4;FDLayoutConstants.DEFAULT_COMPOUND_GRAVITY_STRENGTH=1;FDLayoutConstants.DEFAULT_GRAVITY_RANGE_FACTOR=3.8;FDLayoutConstants.DEFAULT_COMPOUND_GRAVITY_RANGE_FACTOR=1.5;FDLayoutConstants.DEFAULT_USE_SMART_IDEAL_EDGE_LENGTH_CALCULATION=true;FDLayoutConstants.DEFAULT_USE_SMART_REPULSION_RANGE_CALCULATION=true;FDLayoutConstants.MAX_NODE_DISPLACEMENT_INCREMENTAL=100;FDLayoutConstants.MAX_NODE_DISPLACEMENT=FDLayoutConstants.MAX_NODE_DISPLACEMENT_INCREMENTAL*3;FDLayoutConstants.MIN_REPULSION_DIST=FDLayoutConstants.DEFAULT_EDGE_LENGTH/10;FDLayoutConstants.CONVERGENCE_CHECK_PERIOD=100;FDLayoutConstants.PER_LEVEL_IDEAL_EDGE_LENGTH_FACTOR=.1;FDLayoutConstants.MIN_EDGE_LENGTH=1;FDLayoutConstants.GRID_CALCULATION_CHECK_PERIOD=10;module.exports=FDLayoutConstants},{"./LayoutConstants":167}],154:[function(require,module,exports){var LEdge=require("./LEdge");var FDLayoutConstants=require("./FDLayoutConstants");function FDLayoutEdge(source,target,vEdge){LEdge.call(this,source,target,vEdge);this.idealLength=FDLayoutConstants.DEFAULT_EDGE_LENGTH}FDLayoutEdge.prototype=Object.create(LEdge.prototype);for(var prop in LEdge){FDLayoutEdge[prop]=LEdge[prop]}module.exports=FDLayoutEdge},{"./FDLayoutConstants":153,"./LEdge":161}],155:[function(require,module,exports){var LNode=require("./LNode");function FDLayoutNode(gm,loc,size,vNode){LNode.call(this,gm,loc,size,vNode);this.springForceX=0;this.springForceY=0;this.repulsionForceX=0;this.repulsionForceY=0;this.gravitationForceX=0;this.gravitationForceY=0;this.displacementX=0;this.displacementY=0;this.startX=0;this.finishX=0;this.startY=0;this.finishY=0;this.surrounding=[]}FDLayoutNode.prototype=Object.create(LNode.prototype);for(var prop in LNode){FDLayoutNode[prop]=LNode[prop]}FDLayoutNode.prototype.setGridCoordinates=function(_startX,_finishX,_startY,_finishY){this.startX=_startX;this.finishX=_finishX;this.startY=_startY;this.finishY=_finishY};module.exports=FDLayoutNode},{"./LNode":165}],156:[function(require,module,exports){var UniqueIDGeneretor=require("./UniqueIDGeneretor");function HashMap(){this.map={};this.keys=[]}HashMap.prototype.put=function(key,value){var theId=UniqueIDGeneretor.createID(key);if(!this.contains(theId)){this.map[theId]=value;this.keys.push(key)}};HashMap.prototype.contains=function(key){var theId=UniqueIDGeneretor.createID(key);return this.map[key]!=null};HashMap.prototype.get=function(key){var theId=UniqueIDGeneretor.createID(key);return this.map[theId]};HashMap.prototype.keySet=function(){return this.keys};module.exports=HashMap},{"./UniqueIDGeneretor":173}],157:[function(require,module,exports){var UniqueIDGeneretor=require("./UniqueIDGeneretor");function HashSet(){this.set={}}HashSet.prototype.add=function(obj){var theId=UniqueIDGeneretor.createID(obj);if(!this.contains(theId))this.set[theId]=obj};HashSet.prototype.remove=function(obj){delete this.set[UniqueIDGeneretor.createID(obj)]};HashSet.prototype.clear=function(){this.set={}};HashSet.prototype.contains=function(obj){return this.set[UniqueIDGeneretor.createID(obj)]==obj};HashSet.prototype.isEmpty=function(){return this.size()===0};HashSet.prototype.size=function(){return Object.keys(this.set).length};HashSet.prototype.addAllTo=function(list){var keys=Object.keys(this.set);var length=keys.length;for(var i=0;i<length;i++){list.push(this.set[keys[i]])}};HashSet.prototype.size=function(){return Object.keys(this.set).length};HashSet.prototype.addAll=function(list){var s=list.length;for(var i=0;i<s;i++){var v=list[i];this.add(v)}};module.exports=HashSet},{"./UniqueIDGeneretor":173}],158:[function(require,module,exports){function IGeometry(){}IGeometry.calcSeparationAmount=function(rectA,rectB,overlapAmount,separationBuffer){if(!rectA.intersects(rectB)){throw"assert failed"}var directions=new Array(2);IGeometry.decideDirectionsForOverlappingNodes(rectA,rectB,directions);overlapAmount[0]=Math.min(rectA.getRight(),rectB.getRight())-Math.max(rectA.x,rectB.x);overlapAmount[1]=Math.min(rectA.getBottom(),rectB.getBottom())-Math.max(rectA.y,rectB.y);if(rectA.getX()<=rectB.getX()&&rectA.getRight()>=rectB.getRight()){overlapAmount[0]+=Math.min(rectB.getX()-rectA.getX(),rectA.getRight()-rectB.getRight())}else if(rectB.getX()<=rectA.getX()&&rectB.getRight()>=rectA.getRight()){overlapAmount[0]+=Math.min(rectA.getX()-rectB.getX(),rectB.getRight()-rectA.getRight())}if(rectA.getY()<=rectB.getY()&&rectA.getBottom()>=rectB.getBottom()){overlapAmount[1]+=Math.min(rectB.getY()-rectA.getY(),rectA.getBottom()-rectB.getBottom())}else if(rectB.getY()<=rectA.getY()&&rectB.getBottom()>=rectA.getBottom()){overlapAmount[1]+=Math.min(rectA.getY()-rectB.getY(),rectB.getBottom()-rectA.getBottom())}var slope=Math.abs((rectB.getCenterY()-rectA.getCenterY())/(rectB.getCenterX()-rectA.getCenterX()));if(rectB.getCenterY()==rectA.getCenterY()&&rectB.getCenterX()==rectA.getCenterX()){slope=1}var moveByY=slope*overlapAmount[0];var moveByX=overlapAmount[1]/slope;if(overlapAmount[0]<moveByX){moveByX=overlapAmount[0]}else{moveByY=overlapAmount[1]}overlapAmount[0]=-1*directions[0]*(moveByX/2+separationBuffer);overlapAmount[1]=-1*directions[1]*(moveByY/2+separationBuffer)};IGeometry.decideDirectionsForOverlappingNodes=function(rectA,rectB,directions){if(rectA.getCenterX()<rectB.getCenterX()){directions[0]=-1}else{directions[0]=1}if(rectA.getCenterY()<rectB.getCenterY()){directions[1]=-1}else{directions[1]=1}};IGeometry.getIntersection2=function(rectA,rectB,result){var p1x=rectA.getCenterX();var p1y=rectA.getCenterY();var p2x=rectB.getCenterX();var p2y=rectB.getCenterY();if(rectA.intersects(rectB)){result[0]=p1x;result[1]=p1y;result[2]=p2x;result[3]=p2y;return true}var topLeftAx=rectA.getX();var topLeftAy=rectA.getY();var topRightAx=rectA.getRight();var bottomLeftAx=rectA.getX();var bottomLeftAy=rectA.getBottom();var bottomRightAx=rectA.getRight();var halfWidthA=rectA.getWidthHalf();var halfHeightA=rectA.getHeightHalf();var topLeftBx=rectB.getX();var topLeftBy=rectB.getY();var topRightBx=rectB.getRight();var bottomLeftBx=rectB.getX();var bottomLeftBy=rectB.getBottom();var bottomRightBx=rectB.getRight();var halfWidthB=rectB.getWidthHalf();var halfHeightB=rectB.getHeightHalf();var clipPointAFound=false;var clipPointBFound=false;if(p1x==p2x){if(p1y>p2y){result[0]=p1x;result[1]=topLeftAy;result[2]=p2x;result[3]=bottomLeftBy;return false}else if(p1y<p2y){result[0]=p1x;result[1]=bottomLeftAy;result[2]=p2x;result[3]=topLeftBy;return false}else{}}else if(p1y==p2y){if(p1x>p2x){result[0]=topLeftAx;result[1]=p1y;result[2]=topRightBx;result[3]=p2y;return false}else if(p1x<p2x){result[0]=topRightAx;result[1]=p1y;result[2]=topLeftBx;result[3]=p2y;return false}else{}}else{var slopeA=rectA.height/rectA.width;var slopeB=rectB.height/rectB.width;var slopePrime=(p2y-p1y)/(p2x-p1x);var cardinalDirectionA;var cardinalDirectionB;var tempPointAx;var tempPointAy;var tempPointBx;var tempPointBy;if(-slopeA==slopePrime){if(p1x>p2x){result[0]=bottomLeftAx;result[1]=bottomLeftAy;clipPointAFound=true}else{result[0]=topRightAx;result[1]=topLeftAy;clipPointAFound=true}}else if(slopeA==slopePrime){if(p1x>p2x){result[0]=topLeftAx;result[1]=topLeftAy;clipPointAFound=true}else{result[0]=bottomRightAx;result[1]=bottomLeftAy;clipPointAFound=true}}if(-slopeB==slopePrime){if(p2x>p1x){result[2]=bottomLeftBx;result[3]=bottomLeftBy;clipPointBFound=true}else{result[2]=topRightBx;result[3]=topLeftBy;clipPointBFound=true}}else if(slopeB==slopePrime){if(p2x>p1x){result[2]=topLeftBx;result[3]=topLeftBy;clipPointBFound=true}else{result[2]=bottomRightBx;result[3]=bottomLeftBy;clipPointBFound=true}}if(clipPointAFound&&clipPointBFound){return false}if(p1x>p2x){if(p1y>p2y){cardinalDirectionA=IGeometry.getCardinalDirection(slopeA,slopePrime,4);cardinalDirectionB=IGeometry.getCardinalDirection(slopeB,slopePrime,2)}else{cardinalDirectionA=IGeometry.getCardinalDirection(-slopeA,slopePrime,3);cardinalDirectionB=IGeometry.getCardinalDirection(-slopeB,slopePrime,1)}}else{if(p1y>p2y){cardinalDirectionA=IGeometry.getCardinalDirection(-slopeA,slopePrime,1);cardinalDirectionB=IGeometry.getCardinalDirection(-slopeB,slopePrime,3)}else{cardinalDirectionA=IGeometry.getCardinalDirection(slopeA,slopePrime,2);cardinalDirectionB=IGeometry.getCardinalDirection(slopeB,slopePrime,4)}}if(!clipPointAFound){switch(cardinalDirectionA){case 1:tempPointAy=topLeftAy;tempPointAx=p1x+-halfHeightA/slopePrime;result[0]=tempPointAx;result[1]=tempPointAy;break;case 2:tempPointAx=bottomRightAx;tempPointAy=p1y+halfWidthA*slopePrime;result[0]=tempPointAx;result[1]=tempPointAy;break;case 3:tempPointAy=bottomLeftAy;tempPointAx=p1x+halfHeightA/slopePrime;result[0]=tempPointAx;result[1]=tempPointAy;break;case 4:tempPointAx=bottomLeftAx;tempPointAy=p1y+-halfWidthA*slopePrime;result[0]=tempPointAx;result[1]=tempPointAy;break}}if(!clipPointBFound){switch(cardinalDirectionB){case 1:tempPointBy=topLeftBy;tempPointBx=p2x+-halfHeightB/slopePrime;result[2]=tempPointBx;result[3]=tempPointBy;break;case 2:tempPointBx=bottomRightBx;tempPointBy=p2y+halfWidthB*slopePrime;result[2]=tempPointBx;result[3]=tempPointBy;break;case 3:tempPointBy=bottomLeftBy;tempPointBx=p2x+halfHeightB/slopePrime;result[2]=tempPointBx;result[3]=tempPointBy;break;case 4:tempPointBx=bottomLeftBx;tempPointBy=p2y+-halfWidthB*slopePrime;result[2]=tempPointBx;result[3]=tempPointBy;break}}}return false};IGeometry.getCardinalDirection=function(slope,slopePrime,line){if(slope>slopePrime){return line}else{return 1+line%4}};IGeometry.getIntersection=function(s1,s2,f1,f2){if(f2==null){return IGeometry.getIntersection2(s1,s2,f1)}var x1=s1.x;var y1=s1.y;var x2=s2.x;var y2=s2.y;var x3=f1.x;var y3=f1.y;var x4=f2.x;var y4=f2.y;var x,y;var a1,a2,b1,b2,c1,c2;var denom;a1=y2-y1;b1=x1-x2;c1=x2*y1-x1*y2;a2=y4-y3;b2=x3-x4;c2=x4*y3-x3*y4;denom=a1*b2-a2*b1;if(denom==0){return null}x=(b1*c2-b2*c1)/denom;y=(a2*c1-a1*c2)/denom;return new Point(x,y)};IGeometry.HALF_PI=.5*Math.PI;IGeometry.ONE_AND_HALF_PI=1.5*Math.PI;IGeometry.TWO_PI=2*Math.PI;IGeometry.THREE_PI=3*Math.PI;module.exports=IGeometry},{}],159:[function(require,module,exports){function IMath(){}IMath.sign=function(value){if(value>0){return 1}else if(value<0){return-1}else{return 0}};IMath.floor=function(value){return value<0?Math.ceil(value):Math.floor(value)};IMath.ceil=function(value){return value<0?Math.floor(value):Math.ceil(value)};module.exports=IMath},{}],160:[function(require,module,exports){function Integer(){}Integer.MAX_VALUE=2147483647;Integer.MIN_VALUE=-2147483648;module.exports=Integer},{}],161:[function(require,module,exports){var LGraphObject=require("./LGraphObject");function LEdge(source,target,vEdge){LGraphObject.call(this,vEdge);this.isOverlapingSourceAndTarget=false;this.vGraphObject=vEdge;this.bendpoints=[];this.source=source;this.target=target}LEdge.prototype=Object.create(LGraphObject.prototype);for(var prop in LGraphObject){LEdge[prop]=LGraphObject[prop]}LEdge.prototype.getSource=function(){return this.source};LEdge.prototype.getTarget=function(){return this.target};LEdge.prototype.isInterGraph=function(){return this.isInterGraph};LEdge.prototype.getLength=function(){return this.length};LEdge.prototype.isOverlapingSourceAndTarget=function(){return this.isOverlapingSourceAndTarget};LEdge.prototype.getBendpoints=function(){return this.bendpoints};LEdge.prototype.getLca=function(){return this.lca};LEdge.prototype.getSourceInLca=function(){return this.sourceInLca};LEdge.prototype.getTargetInLca=function(){return this.targetInLca};LEdge.prototype.getOtherEnd=function(node){if(this.source===node){return this.target}else if(this.target===node){return this.source}else{throw"Node is not incident with this edge"}};LEdge.prototype.getOtherEndInGraph=function(node,graph){var otherEnd=this.getOtherEnd(node);var root=graph.getGraphManager().getRoot();while(true){if(otherEnd.getOwner()==graph){return otherEnd}if(otherEnd.getOwner()==root){break}otherEnd=otherEnd.getOwner().getParent()}return null};LEdge.prototype.updateLength=function(){var clipPointCoordinates=new Array(4);this.isOverlapingSourceAndTarget=IGeometry.getIntersection(this.target.getRect(),this.source.getRect(),clipPointCoordinates);if(!this.isOverlapingSourceAndTarget){this.lengthX=clipPointCoordinates[0]-clipPointCoordinates[2];this.lengthY=clipPointCoordinates[1]-clipPointCoordinates[3];if(Math.abs(this.lengthX)<1){this.lengthX=IMath.sign(this.lengthX)}if(Math.abs(this.lengthY)<1){this.lengthY=IMath.sign(this.lengthY)}this.length=Math.sqrt(this.lengthX*this.lengthX+this.lengthY*this.lengthY)}};LEdge.prototype.updateLengthSimple=function(){this.lengthX=this.target.getCenterX()-this.source.getCenterX();this.lengthY=this.target.getCenterY()-this.source.getCenterY();if(Math.abs(this.lengthX)<1){this.lengthX=IMath.sign(this.lengthX)}if(Math.abs(this.lengthY)<1){this.lengthY=IMath.sign(this.lengthY)}this.length=Math.sqrt(this.lengthX*this.lengthX+this.lengthY*this.lengthY)};module.exports=LEdge},{"./LGraphObject":164}],162:[function(require,module,exports){var LGraphObject=require("./LGraphObject");var Integer=require("./Integer");var LayoutConstants=require("./LayoutConstants");var LGraphManager=require("./LGraphManager");var LNode=require("./LNode");function LGraph(parent,obj2,vGraph){LGraphObject.call(this,vGraph);this.estimatedSize=Integer.MIN_VALUE;this.margin=LayoutConstants.DEFAULT_GRAPH_MARGIN;this.edges=[];this.nodes=[];this.isConnected=false;this.parent=parent;if(obj2!=null&&obj2 instanceof LGraphManager){this.graphManager=obj2}else if(obj2!=null&&obj2 instanceof Layout){this.graphManager=obj2.graphManager}}LGraph.prototype=Object.create(LGraphObject.prototype);for(var prop in LGraphObject){LGraph[prop]=LGraphObject[prop]}LGraph.prototype.getNodes=function(){return this.nodes};LGraph.prototype.getEdges=function(){return this.edges};LGraph.prototype.getGraphManager=function(){return this.graphManager};LGraph.prototype.getParent=function(){return this.parent};LGraph.prototype.getLeft=function(){return this.left};LGraph.prototype.getRight=function(){return this.right};LGraph.prototype.getTop=function(){return this.top};LGraph.prototype.getBottom=function(){return this.bottom};LGraph.prototype.isConnected=function(){return this.isConnected};LGraph.prototype.add=function(obj1,sourceNode,targetNode){if(sourceNode==null&&targetNode==null){var newNode=obj1;if(this.graphManager==null){throw"Graph has no graph mgr!"}if(this.getNodes().indexOf(newNode)>-1){throw"Node already in graph!"}newNode.owner=this;this.getNodes().push(newNode);return newNode}else{var newEdge=obj1;if(!(this.getNodes().indexOf(sourceNode)>-1&&this.getNodes().indexOf(targetNode)>-1)){throw"Source or target not in graph!"}if(!(sourceNode.owner==targetNode.owner&&sourceNode.owner==this)){throw"Both owners must be this graph!"}if(sourceNode.owner!=targetNode.owner){return null}newEdge.source=sourceNode;newEdge.target=targetNode;newEdge.isInterGraph=false;this.getEdges().push(newEdge);sourceNode.edges.push(newEdge);if(targetNode!=sourceNode){targetNode.edges.push(newEdge)}return newEdge}};LGraph.prototype.remove=function(obj){var node=obj;if(obj instanceof LNode){if(node==null){throw"Node is null!"}if(!(node.owner!=null&&node.owner==this)){throw"Owner graph is invalid!"}if(this.graphManager==null){throw"Owner graph manager is invalid!"}var edgesToBeRemoved=node.edges.slice();var edge;var s=edgesToBeRemoved.length;for(var i=0;i<s;i++){edge=edgesToBeRemoved[i];if(edge.isInterGraph){this.graphManager.remove(edge)}else{edge.source.owner.remove(edge)}}var index=this.nodes.indexOf(node);if(index==-1){throw"Node not in owner node list!"}this.nodes.splice(index,1)}else if(obj instanceof LEdge){var edge=obj;if(edge==null){throw"Edge is null!"}if(!(edge.source!=null&&edge.target!=null)){throw"Source and/or target is null!"}if(!(edge.source.owner!=null&&edge.target.owner!=null&&edge.source.owner==this&&edge.target.owner==this)){throw"Source and/or target owner is invalid!"}var sourceIndex=edge.source.edges.indexOf(edge);var targetIndex=edge.target.edges.indexOf(edge);if(!(sourceIndex>-1&&targetIndex>-1)){throw"Source and/or target doesn't know this edge!"}edge.source.edges.splice(sourceIndex,1);if(edge.target!=edge.source){edge.target.edges.splice(targetIndex,1)}var index=edge.source.owner.getEdges().indexOf(edge);if(index==-1){throw"Not in owner's edge list!"}edge.source.owner.getEdges().splice(index,1)}};LGraph.prototype.updateLeftTop=function(){var top=Integer.MAX_VALUE;var left=Integer.MAX_VALUE;var nodeTop;var nodeLeft;var nodes=this.getNodes();var s=nodes.length;for(var i=0;i<s;i++){var lNode=nodes[i];nodeTop=Math.floor(lNode.getTop());nodeLeft=Math.floor(lNode.getLeft());if(top>nodeTop){top=nodeTop}if(left>nodeLeft){left=nodeLeft}}if(top==Integer.MAX_VALUE){return null}this.left=left-this.margin;this.top=top-this.margin;return new Point(this.left,this.top)};LGraph.prototype.updateBounds=function(recursive){var left=Integer.MAX_VALUE;var right=-Integer.MAX_VALUE;var top=Integer.MAX_VALUE;var bottom=-Integer.MAX_VALUE;var nodeLeft;var nodeRight;var nodeTop;var nodeBottom;var nodes=this.nodes;var s=nodes.length;for(var i=0;i<s;i++){var lNode=nodes[i];if(recursive&&lNode.child!=null){lNode.updateBounds()}nodeLeft=Math.floor(lNode.getLeft());nodeRight=Math.floor(lNode.getRight());nodeTop=Math.floor(lNode.getTop());nodeBottom=Math.floor(lNode.getBottom());if(left>nodeLeft){left=nodeLeft}if(right<nodeRight){right=nodeRight}if(top>nodeTop){top=nodeTop}if(bottom<nodeBottom){bottom=nodeBottom}}var boundingRect=new RectangleD(left,top,right-left,bottom-top);if(left==Integer.MAX_VALUE){this.left=Math.floor(this.parent.getLeft());this.right=Math.floor(this.parent.getRight());this.top=Math.floor(this.parent.getTop());this.bottom=Math.floor(this.parent.getBottom())}this.left=boundingRect.x-this.margin;this.right=boundingRect.x+boundingRect.width+this.margin;this.top=boundingRect.y-this.margin;this.bottom=boundingRect.y+boundingRect.height+this.margin};LGraph.calculateBounds=function(nodes){var left=Integer.MAX_VALUE;var right=-Integer.MAX_VALUE;var top=Integer.MAX_VALUE;var bottom=-Integer.MAX_VALUE;var nodeLeft;var nodeRight;var nodeTop;var nodeBottom;var s=nodes.length;for(var i=0;i<s;i++){var lNode=nodes[i];nodeLeft=Math.floor(lNode.getLeft());nodeRight=Math.floor(lNode.getRight());nodeTop=Math.floor(lNode.getTop());nodeBottom=Math.floor(lNode.getBottom());if(left>nodeLeft){left=nodeLeft}if(right<nodeRight){right=nodeRight}if(top>nodeTop){top=nodeTop}if(bottom<nodeBottom){bottom=nodeBottom}}var boundingRect=new RectangleD(left,top,right-left,bottom-top);return boundingRect};LGraph.prototype.getInclusionTreeDepth=function(){if(this==this.graphManager.getRoot()){return 1}else{return this.parent.getInclusionTreeDepth()}};LGraph.prototype.getEstimatedSize=function(){if(this.estimatedSize==Integer.MIN_VALUE){throw"assert failed"}return this.estimatedSize};LGraph.prototype.calcEstimatedSize=function(){var size=0;var nodes=this.nodes;var s=nodes.length;for(var i=0;i<s;i++){var lNode=nodes[i];size+=lNode.calcEstimatedSize()}if(size==0){this.estimatedSize=LayoutConstants.EMPTY_COMPOUND_NODE_SIZE}else{this.estimatedSize=Math.floor(size/Math.sqrt(this.nodes.length))}return Math.floor(this.estimatedSize)};LGraph.prototype.updateConnected=function(){if(this.nodes.length==0){this.isConnected=true;return}var toBeVisited=[];var visited=new HashSet;var currentNode=this.nodes[0];var neighborEdges;var currentNeighbor;toBeVisited=toBeVisited.concat(currentNode.withChildren());while(toBeVisited.length>0){currentNode=toBeVisited.shift();visited.add(currentNode);neighborEdges=currentNode.getEdges();var s=neighborEdges.length;for(var i=0;i<s;i++){var neighborEdge=neighborEdges[i];currentNeighbor=neighborEdge.getOtherEndInGraph(currentNode,this);if(currentNeighbor!=null&&!visited.contains(currentNeighbor)){toBeVisited=toBeVisited.concat(currentNeighbor.withChildren())}}}this.isConnected=false;if(visited.size()>=this.nodes.length){var noOfVisitedInThisGraph=0;var s=visited.size();for(var visitedId in visited.set){var visitedNode=visited.set[visitedId];if(visitedNode.owner==this){noOfVisitedInThisGraph++}}if(noOfVisitedInThisGraph==this.nodes.length){this.isConnected=true}}};module.exports=LGraph},{"./Integer":160,"./LGraphManager":163,"./LGraphObject":164,"./LNode":165,"./LayoutConstants":167}],163:[function(require,module,exports){function LGraphManager(layout){this.layout=layout;this.graphs=[];this.edges=[]}LGraphManager.prototype.addRoot=function(){var ngraph=this.layout.newGraph();var nnode=this.layout.newNode(null);var root=this.add(ngraph,nnode);this.setRootGraph(root);return this.rootGraph};LGraphManager.prototype.add=function(newGraph,parentNode,newEdge,sourceNode,targetNode){if(newEdge==null&&sourceNode==null&&targetNode==null){if(newGraph==null){throw"Graph is null!"}if(parentNode==null){throw"Parent node is null!"}if(this.graphs.indexOf(newGraph)>-1){throw"Graph already in this graph mgr!"}this.graphs.push(newGraph);if(newGraph.parent!=null){throw"Already has a parent!"}if(parentNode.child!=null){throw"Already has a child!"}newGraph.parent=parentNode;parentNode.child=newGraph;return newGraph}else{targetNode=newEdge;sourceNode=parentNode;newEdge=newGraph;var sourceGraph=sourceNode.getOwner();var targetGraph=targetNode.getOwner();if(!(sourceGraph!=null&&sourceGraph.getGraphManager()==this)){throw"Source not in this graph mgr!"}if(!(targetGraph!=null&&targetGraph.getGraphManager()==this)){throw"Target not in this graph mgr!"}if(sourceGraph==targetGraph){newEdge.isInterGraph=false;return sourceGraph.add(newEdge,sourceNode,targetNode)}else{newEdge.isInterGraph=true;newEdge.source=sourceNode;newEdge.target=targetNode;if(this.edges.indexOf(newEdge)>-1){throw"Edge already in inter-graph edge list!"}this.edges.push(newEdge);if(!(newEdge.source!=null&&newEdge.target!=null)){throw"Edge source and/or target is null!"}if(!(newEdge.source.edges.indexOf(newEdge)==-1&&newEdge.target.edges.indexOf(newEdge)==-1)){throw"Edge already in source and/or target incidency list!"}newEdge.source.edges.push(newEdge);newEdge.target.edges.push(newEdge);return newEdge}}};LGraphManager.prototype.remove=function(lObj){if(lObj instanceof LGraph){var graph=lObj;if(graph.getGraphManager()!=this){throw"Graph not in this graph mgr"}if(!(graph==this.rootGraph||graph.parent!=null&&graph.parent.graphManager==this)){throw"Invalid parent node!"}var edgesToBeRemoved=[];edgesToBeRemoved=edgesToBeRemoved.concat(graph.getEdges());var edge;var s=edgesToBeRemoved.length;for(var i=0;i<s;i++){edge=edgesToBeRemoved[i];graph.remove(edge)}var nodesToBeRemoved=[];nodesToBeRemoved=nodesToBeRemoved.concat(graph.getNodes());var node;s=nodesToBeRemoved.length;for(var i=0;i<s;i++){node=nodesToBeRemoved[i];graph.remove(node)}if(graph==this.rootGraph){this.setRootGraph(null)}var index=this.graphs.indexOf(graph);this.graphs.splice(index,1);graph.parent=null}else if(lObj instanceof LEdge){edge=lObj;if(edge==null){throw"Edge is null!"}if(!edge.isInterGraph){throw"Not an inter-graph edge!"}if(!(edge.source!=null&&edge.target!=null)){throw"Source and/or target is null!"}if(!(edge.source.edges.indexOf(edge)!=-1&&edge.target.edges.indexOf(edge)!=-1)){throw"Source and/or target doesn't know this edge!"}var index=edge.source.edges.indexOf(edge);edge.source.edges.splice(index,1);index=edge.target.edges.indexOf(edge);edge.target.edges.splice(index,1);if(!(edge.source.owner!=null&&edge.source.owner.getGraphManager()!=null)){throw"Edge owner graph or owner graph manager is null!"}if(edge.source.owner.getGraphManager().edges.indexOf(edge)==-1){throw"Not in owner graph manager's edge list!"}var index=edge.source.owner.getGraphManager().edges.indexOf(edge);edge.source.owner.getGraphManager().edges.splice(index,1)}};LGraphManager.prototype.updateBounds=function(){this.rootGraph.updateBounds(true)};LGraphManager.prototype.getGraphs=function(){return this.graphs};LGraphManager.prototype.getAllNodes=function(){if(this.allNodes==null){var nodeList=[];var graphs=this.getGraphs();var s=graphs.length;for(var i=0;i<s;i++){nodeList=nodeList.concat(graphs[i].getNodes())}this.allNodes=nodeList}return this.allNodes};LGraphManager.prototype.resetAllNodes=function(){this.allNodes=null};LGraphManager.prototype.resetAllEdges=function(){this.allEdges=null};LGraphManager.prototype.resetAllNodesToApplyGravitation=function(){this.allNodesToApplyGravitation=null};LGraphManager.prototype.getAllEdges=function(){if(this.allEdges==null){var edgeList=[];var graphs=this.getGraphs();var s=graphs.length;for(var i=0;i<graphs.length;i++){edgeList=edgeList.concat(graphs[i].getEdges())}edgeList=edgeList.concat(this.edges);this.allEdges=edgeList}return this.allEdges};LGraphManager.prototype.getAllNodesToApplyGravitation=function(){return this.allNodesToApplyGravitation};LGraphManager.prototype.setAllNodesToApplyGravitation=function(nodeList){if(this.allNodesToApplyGravitation!=null){throw"assert failed"}this.allNodesToApplyGravitation=nodeList};LGraphManager.prototype.getRoot=function(){return this.rootGraph};LGraphManager.prototype.setRootGraph=function(graph){if(graph.getGraphManager()!=this){throw"Root not in this graph mgr!"}this.rootGraph=graph;if(graph.parent==null){graph.parent=this.layout.newNode("Root node")}};LGraphManager.prototype.getLayout=function(){return this.layout};LGraphManager.prototype.isOneAncestorOfOther=function(firstNode,secondNode){if(!(firstNode!=null&&secondNode!=null)){throw"assert failed"}if(firstNode==secondNode){return true}var ownerGraph=firstNode.getOwner();var parentNode;do{parentNode=ownerGraph.getParent();if(parentNode==null){break}if(parentNode==secondNode){return true}ownerGraph=parentNode.getOwner();if(ownerGraph==null){break}}while(true);ownerGraph=secondNode.getOwner();do{parentNode=ownerGraph.getParent();if(parentNode==null){break}if(parentNode==firstNode){return true}ownerGraph=parentNode.getOwner();if(ownerGraph==null){break}}while(true);return false};LGraphManager.prototype.calcLowestCommonAncestors=function(){var edge;var sourceNode;var targetNode;var sourceAncestorGraph;var targetAncestorGraph;var edges=this.getAllEdges();var s=edges.length;for(var i=0;i<s;i++){edge=edges[i];sourceNode=edge.source;targetNode=edge.target;edge.lca=null;edge.sourceInLca=sourceNode;edge.targetInLca=targetNode;if(sourceNode==targetNode){edge.lca=sourceNode.getOwner();continue}sourceAncestorGraph=sourceNode.getOwner();while(edge.lca==null){targetAncestorGraph=targetNode.getOwner();while(edge.lca==null){if(targetAncestorGraph==sourceAncestorGraph){edge.lca=targetAncestorGraph;break}if(targetAncestorGraph==this.rootGraph){break}if(edge.lca!=null){throw"assert failed"}edge.targetInLca=targetAncestorGraph.getParent();targetAncestorGraph=edge.targetInLca.getOwner()}if(sourceAncestorGraph==this.rootGraph){break}if(edge.lca==null){edge.sourceInLca=sourceAncestorGraph.getParent();sourceAncestorGraph=edge.sourceInLca.getOwner()}}if(edge.lca==null){throw"assert failed"}}};LGraphManager.prototype.calcLowestCommonAncestor=function(firstNode,secondNode){if(firstNode==secondNode){return firstNode.getOwner()}var firstOwnerGraph=firstNode.getOwner();do{if(firstOwnerGraph==null){break}var secondOwnerGraph=secondNode.getOwner();do{if(secondOwnerGraph==null){break}if(secondOwnerGraph==firstOwnerGraph){return secondOwnerGraph}secondOwnerGraph=secondOwnerGraph.getParent().getOwner()}while(true);firstOwnerGraph=firstOwnerGraph.getParent().getOwner()}while(true);return firstOwnerGraph};LGraphManager.prototype.calcInclusionTreeDepths=function(graph,depth){if(graph==null&&depth==null){graph=this.rootGraph;depth=1}var node;var nodes=graph.getNodes();var s=nodes.length;for(var i=0;i<s;i++){node=nodes[i];node.inclusionTreeDepth=depth;if(node.child!=null){this.calcInclusionTreeDepths(node.child,depth+1)}}};LGraphManager.prototype.includesInvalidEdge=function(){var edge;var s=this.edges.length;for(var i=0;i<s;i++){edge=this.edges[i];if(this.isOneAncestorOfOther(edge.source,edge.target)){return true}}return false};module.exports=LGraphManager},{}],164:[function(require,module,exports){function LGraphObject(vGraphObject){this.vGraphObject=vGraphObject}module.exports=LGraphObject},{}],165:[function(require,module,exports){var LGraphObject=require("./LGraphObject");var Integer=require("./Integer");var RectangleD=require("./RectangleD");function LNode(gm,loc,size,vNode){if(size==null&&vNode==null){vNode=loc}LGraphObject.call(this,vNode);if(gm.graphManager!=null)gm=gm.graphManager;this.estimatedSize=Integer.MIN_VALUE;this.inclusionTreeDepth=Integer.MAX_VALUE;this.vGraphObject=vNode;this.edges=[];this.graphManager=gm;if(size!=null&&loc!=null)this.rect=new RectangleD(loc.x,loc.y,size.width,size.height);else this.rect=new RectangleD}LNode.prototype=Object.create(LGraphObject.prototype);for(var prop in LGraphObject){LNode[prop]=LGraphObject[prop]}LNode.prototype.getEdges=function(){return this.edges};LNode.prototype.getChild=function(){return this.child};LNode.prototype.getOwner=function(){if(this.owner!=null){if(!(this.owner==null||this.owner.getNodes().indexOf(this)>-1)){throw"assert failed"}}return this.owner};LNode.prototype.getWidth=function(){return this.rect.width};LNode.prototype.setWidth=function(width){this.rect.width=width};LNode.prototype.getHeight=function(){return this.rect.height};LNode.prototype.setHeight=function(height){this.rect.height=height};LNode.prototype.getCenterX=function(){return this.rect.x+this.rect.width/2};LNode.prototype.getCenterY=function(){return this.rect.y+this.rect.height/2};LNode.prototype.getCenter=function(){return new PointD(this.rect.x+this.rect.width/2,this.rect.y+this.rect.height/2)};LNode.prototype.getLocation=function(){return new PointD(this.rect.x,this.rect.y)};LNode.prototype.getRect=function(){return this.rect};LNode.prototype.getDiagonal=function(){return Math.sqrt(this.rect.width*this.rect.width+this.rect.height*this.rect.height)};LNode.prototype.setRect=function(upperLeft,dimension){this.rect.x=upperLeft.x;this.rect.y=upperLeft.y;this.rect.width=dimension.width;this.rect.height=dimension.height};LNode.prototype.setCenter=function(cx,cy){this.rect.x=cx-this.rect.width/2;this.rect.y=cy-this.rect.height/2};LNode.prototype.setLocation=function(x,y){this.rect.x=x;this.rect.y=y};LNode.prototype.moveBy=function(dx,dy){this.rect.x+=dx;this.rect.y+=dy};LNode.prototype.getEdgeListToNode=function(to){var edgeList=[];var edge;for(var obj in this.edges){edge=obj;if(edge.target==to){if(edge.source!=this)throw"Incorrect edge source!";edgeList.push(edge)}}return edgeList};LNode.prototype.getEdgesBetween=function(other){var edgeList=[];var edge;for(var obj in this.edges){edge=this.edges[obj];if(!(edge.source==this||edge.target==this))throw"Incorrect edge source and/or target";if(edge.target==other||edge.source==other){edgeList.push(edge)}}return edgeList};LNode.prototype.getNeighborsList=function(){var neighbors=new HashSet;var edge;for(var obj in this.edges){edge=this.edges[obj];if(edge.source==this){neighbors.add(edge.target)}else{if(!edge.target==this)throw"Incorrect incidency!";neighbors.add(edge.source)}}return neighbors};LNode.prototype.withChildren=function(){var withNeighborsList=[];var childNode;withNeighborsList.push(this);if(this.child!=null){var nodes=this.child.getNodes();for(var i=0;i<nodes.length;i++){childNode=nodes[i];withNeighborsList=withNeighborsList.concat(childNode.withChildren())}}return withNeighborsList};LNode.prototype.getEstimatedSize=function(){if(this.estimatedSize==Integer.MIN_VALUE){throw"assert failed"}return this.estimatedSize};LNode.prototype.calcEstimatedSize=function(){if(this.child==null){return this.estimatedSize=Math.floor((this.rect.width+this.rect.height)/2)}else{this.estimatedSize=this.child.calcEstimatedSize();this.rect.width=this.estimatedSize;this.rect.height=this.estimatedSize;return this.estimatedSize}};LNode.prototype.scatter=function(){var randomCenterX;var randomCenterY;var minX=-LayoutConstants.INITIAL_WORLD_BOUNDARY;var maxX=LayoutConstants.INITIAL_WORLD_BOUNDARY;randomCenterX=LayoutConstants.WORLD_CENTER_X+RandomSeed.nextDouble()*(maxX-minX)+minX;var minY=-LayoutConstants.INITIAL_WORLD_BOUNDARY;var maxY=LayoutConstants.INITIAL_WORLD_BOUNDARY;randomCenterY=LayoutConstants.WORLD_CENTER_Y+RandomSeed.nextDouble()*(maxY-minY)+minY;this.rect.x=randomCenterX;this.rect.y=randomCenterY};LNode.prototype.updateBounds=function(){if(this.getChild()==null){throw"assert failed"}if(this.getChild().getNodes().length!=0){var childGraph=this.getChild();childGraph.updateBounds(true);this.rect.x=childGraph.getLeft();this.rect.y=childGraph.getTop();this.setWidth(childGraph.getRight()-childGraph.getLeft()+2*LayoutConstants.COMPOUND_NODE_MARGIN);this.setHeight(childGraph.getBottom()-childGraph.getTop()+2*LayoutConstants.COMPOUND_NODE_MARGIN+LayoutConstants.LABEL_HEIGHT)}};LNode.prototype.getInclusionTreeDepth=function(){if(this.inclusionTreeDepth==Integer.MAX_VALUE){throw"assert failed"}return this.inclusionTreeDepth};LNode.prototype.transform=function(trans){var left=this.rect.x;if(left>LayoutConstants.WORLD_BOUNDARY){left=LayoutConstants.WORLD_BOUNDARY}else if(left<-LayoutConstants.WORLD_BOUNDARY){left=-LayoutConstants.WORLD_BOUNDARY}var top=this.rect.y;if(top>LayoutConstants.WORLD_BOUNDARY){top=LayoutConstants.WORLD_BOUNDARY}else if(top<-LayoutConstants.WORLD_BOUNDARY){top=-LayoutConstants.WORLD_BOUNDARY}var leftTop=new PointD(left,top);var vLeftTop=trans.inverseTransformPoint(leftTop);this.setLocation(vLeftTop.x,vLeftTop.y)};LNode.prototype.getLeft=function(){return this.rect.x};LNode.prototype.getRight=function(){return this.rect.x+this.rect.width};LNode.prototype.getTop=function(){return this.rect.y};LNode.prototype.getBottom=function(){return this.rect.y+this.rect.height};LNode.prototype.getParent=function(){if(this.owner==null){return null}return this.owner.getParent()};module.exports=LNode},{"./Integer":160,"./LGraphObject":164,"./RectangleD":171}],166:[function(require,module,exports){var LayoutConstants=require("./LayoutConstants");var HashMap=require("./HashMap");var LGraphManager=require("./LGraphManager");function Layout(isRemoteUse){this.layoutQuality=LayoutConstants.DEFAULT_QUALITY;this.createBendsAsNeeded=LayoutConstants.DEFAULT_CREATE_BENDS_AS_NEEDED;this.incremental=LayoutConstants.DEFAULT_INCREMENTAL;this.animationOnLayout=LayoutConstants.DEFAULT_ANIMATION_ON_LAYOUT;this.animationDuringLayout=LayoutConstants.DEFAULT_ANIMATION_DURING_LAYOUT;this.animationPeriod=LayoutConstants.DEFAULT_ANIMATION_PERIOD;this.uniformLeafNodeSizes=LayoutConstants.DEFAULT_UNIFORM_LEAF_NODE_SIZES;this.edgeToDummyNodes=new HashMap;this.graphManager=new LGraphManager(this);this.isLayoutFinished=false;this.isSubLayout=false;this.isRemoteUse=false;if(isRemoteUse!=null){this.isRemoteUse=isRemoteUse}}Layout.RANDOM_SEED=1;Layout.prototype.getGraphManager=function(){return this.graphManager};Layout.prototype.getAllNodes=function(){return this.graphManager.getAllNodes()};Layout.prototype.getAllEdges=function(){return this.graphManager.getAllEdges()};Layout.prototype.getAllNodesToApplyGravitation=function(){return this.graphManager.getAllNodesToApplyGravitation()};Layout.prototype.newGraphManager=function(){var gm=new LGraphManager(this);this.graphManager=gm;return gm};Layout.prototype.newGraph=function(vGraph){return new LGraph(null,this.graphManager,vGraph)};Layout.prototype.newNode=function(vNode){return new LNode(this.graphManager,vNode)};Layout.prototype.newEdge=function(vEdge){return new LEdge(null,null,vEdge)};Layout.prototype.runLayout=function(){this.isLayoutFinished=false;this.initParameters();var isLayoutSuccessfull;if(this.graphManager.getRoot()==null||this.graphManager.getRoot().getNodes().length==0||this.graphManager.includesInvalidEdge()){isLayoutSuccessfull=false}else{var startTime=0;if(!this.isSubLayout){startTime=(new Date).getTime()}isLayoutSuccessfull=this.layout();if(!this.isSubLayout){var endTime=(new Date).getTime();var excTime=endTime-startTime;console.log("Total execution time: "+excTime+" miliseconds.")}}if(isLayoutSuccessfull){if(!this.isSubLayout){this.doPostLayout()}}this.isLayoutFinished=true;return isLayoutSuccessfull};Layout.prototype.doPostLayout=function(){this.transform();this.update()};Layout.prototype.update2=function(){if(this.createBendsAsNeeded){this.createBendpointsFromDummyNodes();this.graphManager.resetAllEdges()}if(!this.isRemoteUse){var edge;var allEdges=this.graphManager.getAllEdges();for(var i=0;i<allEdges.length;i++){edge=allEdges[i]}var node;var nodes=this.graphManager.getRoot().getNodes();for(var i=0;i<nodes.length;i++){node=nodes[i]}this.update(this.graphManager.getRoot())}};Layout.prototype.update=function(obj){if(obj==null){this.update2()}else if(obj instanceof LNode){var node=obj;if(node.getChild()!=null){var nodes=node.getChild().getNodes();for(var i=0;i<nodes.length;i++){update(nodes[i])}}if(node.vGraphObject!=null){var vNode=node.vGraphObject;vNode.update(node)}}else if(obj instanceof LEdge){var edge=obj;if(edge.vGraphObject!=null){var vEdge=edge.vGraphObject;vEdge.update(edge)}}else if(obj instanceof LGraph){var graph=obj;if(graph.vGraphObject!=null){var vGraph=graph.vGraphObject;vGraph.update(graph)}}};Layout.prototype.initParameters=function(){if(!this.isSubLayout){this.layoutQuality=LayoutConstants.DEFAULT_QUALITY;this.animationDuringLayout=LayoutConstants.DEFAULT_ANIMATION_ON_LAYOUT;this.animationPeriod=LayoutConstants.DEFAULT_ANIMATION_PERIOD;this.animationOnLayout=LayoutConstants.DEFAULT_ANIMATION_DURING_LAYOUT;this.incremental=LayoutConstants.DEFAULT_INCREMENTAL;this.createBendsAsNeeded=LayoutConstants.DEFAULT_CREATE_BENDS_AS_NEEDED;this.uniformLeafNodeSizes=LayoutConstants.DEFAULT_UNIFORM_LEAF_NODE_SIZES}if(this.animationDuringLayout){animationOnLayout=false}};Layout.prototype.transform=function(newLeftTop){if(newLeftTop==undefined){this.transform(new PointD(0,0))}else{var trans=new Transform;var leftTop=this.graphManager.getRoot().updateLeftTop();if(leftTop!=null){trans.setWorldOrgX(newLeftTop.x);trans.setWorldOrgY(newLeftTop.y);trans.setDeviceOrgX(leftTop.x);trans.setDeviceOrgY(leftTop.y);var nodes=this.getAllNodes();var node;for(var i=0;i<nodes.length;i++){node=nodes[i];node.transform(trans)}}}};Layout.prototype.positionNodesRandomly=function(graph){if(graph==undefined){this.positionNodesRandomly(this.getGraphManager().getRoot());this.getGraphManager().getRoot().updateBounds(true)}else{var lNode;var childGraph;var nodes=graph.getNodes();for(var i=0;i<nodes.length;i++){lNode=nodes[i];childGraph=lNode.getChild();if(childGraph==null){lNode.scatter()}else if(childGraph.getNodes().length==0){lNode.scatter()}else{this.positionNodesRandomly(childGraph);lNode.updateBounds()}}}};Layout.prototype.getFlatForest=function(){var flatForest=[];var isForest=true;var allNodes=this.graphManager.getRoot().getNodes();var isFlat=true;for(var i=0;i<allNodes.length;i++){if(allNodes[i].getChild()!=null){isFlat=false}}if(!isFlat){return flatForest}var visited=new HashSet;var toBeVisited=[];var parents=new HashMap;var unProcessedNodes=[];unProcessedNodes=unProcessedNodes.concat(allNodes);while(unProcessedNodes.length>0&&isForest){toBeVisited.push(unProcessedNodes[0]);while(toBeVisited.length>0&&isForest){var currentNode=toBeVisited[0];toBeVisited.splice(0,1);visited.add(currentNode);var neighborEdges=currentNode.getEdges();for(var i=0;i<neighborEdges.length;i++){var currentNeighbor=neighborEdges[i].getOtherEnd(currentNode);if(parents.get(currentNode)!=currentNeighbor){if(!visited.contains(currentNeighbor)){toBeVisited.push(currentNeighbor);parents.put(currentNeighbor,currentNode)}else{isForest=false;break}}}}if(!isForest){flatForest=[]}else{var temp=[];visited.addAllTo(temp);flatForest.push(temp);for(var i=0;i<temp.length;i++){var value=temp[i];var index=unProcessedNodes.indexOf(value);if(index>-1){unProcessedNodes.splice(index,1)}}visited=new HashSet;parents=new HashMap}}return flatForest};Layout.prototype.createDummyNodesForBendpoints=function(edge){var dummyNodes=[];var prev=edge.source;var graph=this.graphManager.calcLowestCommonAncestor(edge.source,edge.target);for(var i=0;i<edge.bendpoints.length;i++){var dummyNode=this.newNode(null);dummyNode.setRect(new Point(0,0),new Dimension(1,1));graph.add(dummyNode);var dummyEdge=this.newEdge(null);this.graphManager.add(dummyEdge,prev,dummyNode);dummyNodes.add(dummyNode);prev=dummyNode}var dummyEdge=this.newEdge(null);this.graphManager.add(dummyEdge,prev,edge.target);this.edgeToDummyNodes.put(edge,dummyNodes);if(edge.isInterGraph()){this.graphManager.remove(edge)}else{graph.remove(edge)}return dummyNodes};Layout.prototype.createBendpointsFromDummyNodes=function(){var edges=[];edges=edges.concat(this.graphManager.getAllEdges());edges=this.edgeToDummyNodes.keySet().concat(edges);for(var k=0;k<edges.length;k++){var lEdge=edges[k];if(lEdge.bendpoints.length>0){var path=this.edgeToDummyNodes.get(lEdge);for(var i=0;i<path.length;i++){var dummyNode=path[i];var p=new PointD(dummyNode.getCenterX(),dummyNode.getCenterY());var ebp=lEdge.bendpoints.get(i);ebp.x=p.x;ebp.y=p.y;dummyNode.getOwner().remove(dummyNode)}this.graphManager.add(lEdge,lEdge.source,lEdge.target)}}};Layout.transform=function(sliderValue,defaultValue,minDiv,maxMul){if(minDiv!=undefined&&maxMul!=undefined){var value=defaultValue;if(sliderValue<=50){var minValue=defaultValue/minDiv;value-=(defaultValue-minValue)/50*(50-sliderValue)}else{var maxValue=defaultValue*maxMul;value+=(maxValue-defaultValue)/50*(sliderValue-50)}return value}else{var a,b;if(sliderValue<=50){a=9*defaultValue/500;b=defaultValue/10}else{a=9*defaultValue/50;b=-8*defaultValue}return a*sliderValue+b}};Layout.findCenterOfTree=function(nodes){var list=[];list=list.concat(nodes);var removedNodes=[];var remainingDegrees=new HashMap;var foundCenter=false;var centerNode=null;if(list.length==1||list.length==2){foundCenter=true;centerNode=list[0]}for(var i=0;i<list.length;i++){var node=list[i];var degree=node.getNeighborsList().size();remainingDegrees.put(node,node.getNeighborsList().size());if(degree==1){removedNodes.push(node)}}var tempList=[];tempList=tempList.concat(removedNodes);while(!foundCenter){var tempList2=[];tempList2=tempList2.concat(tempList);tempList=[];for(var i=0;i<list.length;i++){var node=list[i];var index=list.indexOf(node);if(index>=0){list.splice(index,1)}var neighbours=node.getNeighborsList();for(var j in neighbours.set){var neighbour=neighbours.set[j];if(removedNodes.indexOf(neighbour)<0){var otherDegree=remainingDegrees.get(neighbour);var newDegree=otherDegree-1;if(newDegree==1){tempList.push(neighbour)}remainingDegrees.put(neighbour,newDegree)}}}removedNodes=removedNodes.concat(tempList);if(list.length==1||list.length==2){foundCenter=true;centerNode=list[0]}}return centerNode};Layout.prototype.setGraphManager=function(gm){this.graphManager=gm};module.exports=Layout},{"./HashMap":156,"./LGraphManager":163,"./LayoutConstants":167}],167:[function(require,module,exports){function LayoutConstants(){}LayoutConstants.PROOF_QUALITY=0;LayoutConstants.DEFAULT_QUALITY=1;LayoutConstants.DRAFT_QUALITY=2;LayoutConstants.DEFAULT_CREATE_BENDS_AS_NEEDED=false;LayoutConstants.DEFAULT_INCREMENTAL=false;LayoutConstants.DEFAULT_ANIMATION_ON_LAYOUT=true;LayoutConstants.DEFAULT_ANIMATION_DURING_LAYOUT=false;LayoutConstants.DEFAULT_ANIMATION_PERIOD=50;LayoutConstants.DEFAULT_UNIFORM_LEAF_NODE_SIZES=false;LayoutConstants.DEFAULT_GRAPH_MARGIN=10;LayoutConstants.LABEL_HEIGHT=20;LayoutConstants.COMPOUND_NODE_MARGIN=5;LayoutConstants.SIMPLE_NODE_SIZE=40;LayoutConstants.SIMPLE_NODE_HALF_SIZE=LayoutConstants.SIMPLE_NODE_SIZE/2;LayoutConstants.EMPTY_COMPOUND_NODE_SIZE=40;LayoutConstants.MIN_EDGE_LENGTH=1;LayoutConstants.WORLD_BOUNDARY=1e6;LayoutConstants.INITIAL_WORLD_BOUNDARY=LayoutConstants.WORLD_BOUNDARY/1e3;LayoutConstants.WORLD_CENTER_X=1200;LayoutConstants.WORLD_CENTER_Y=900;module.exports=LayoutConstants},{}],168:[function(require,module,exports){function Point(x,y,p){this.x=null;this.y=null;if(x==null&&y==null&&p==null){this.x=0;this.y=0}else if(typeof x=="number"&&typeof y=="number"&&p==null){this.x=x;this.y=y}else if(x.constructor.name=="Point"&&y==null&&p==null){p=x;this.x=p.x;this.y=p.y}}Point.prototype.getX=function(){return this.x};Point.prototype.getY=function(){return this.y};Point.prototype.getLocation=function(){return new Point(this.x,this.y)};Point.prototype.setLocation=function(x,y,p){if(x.constructor.name=="Point"&&y==null&&p==null){p=x;this.setLocation(p.x,p.y)}else if(typeof x=="number"&&typeof y=="number"&&p==null){if(parseInt(x)==x&&parseInt(y)==y){this.move(x,y)}else{this.x=Math.floor(x+.5);this.y=Math.floor(y+.5)}}};Point.prototype.move=function(x,y){this.x=x;this.y=y};Point.prototype.translate=function(dx,dy){this.x+=dx;this.y+=dy};Point.prototype.equals=function(obj){if(obj.constructor.name=="Point"){var pt=obj;return this.x==pt.x&&this.y==pt.y}return this==obj};Point.prototype.toString=function(){return(new Point).constructor.name+"[x="+this.x+",y="+this.y+"]"};module.exports=Point},{}],169:[function(require,module,exports){function PointD(x,y){if(x==null&&y==null){this.x=0;this.y=0}else{this.x=x;this.y=y}}PointD.prototype.getX=function(){return this.x};PointD.prototype.getY=function(){return this.y};PointD.prototype.setX=function(x){this.x=x};PointD.prototype.setY=function(y){this.y=y};PointD.prototype.getDifference=function(pt){return new DimensionD(this.x-pt.x,this.y-pt.y)};PointD.prototype.getCopy=function(){return new PointD(this.x,this.y)};PointD.prototype.translate=function(dim){this.x+=dim.width;this.y+=dim.height;return this};module.exports=PointD},{}],170:[function(require,module,exports){function RandomSeed(){}RandomSeed.seed=1;RandomSeed.x=0;RandomSeed.nextDouble=function(){RandomSeed.x=Math.sin(RandomSeed.seed++)*1e4;return RandomSeed.x-Math.floor(RandomSeed.x)};module.exports=RandomSeed},{}],171:[function(require,module,exports){function RectangleD(x,y,width,height){this.x=0;this.y=0;this.width=0;this.height=0;if(x!=null&&y!=null&&width!=null&&height!=null){this.x=x;this.y=y;this.width=width;this.height=height}}RectangleD.prototype.getX=function(){return this.x};RectangleD.prototype.setX=function(x){this.x=x};RectangleD.prototype.getY=function(){return this.y};RectangleD.prototype.setY=function(y){this.y=y};RectangleD.prototype.getWidth=function(){return this.width};RectangleD.prototype.setWidth=function(width){this.width=width};RectangleD.prototype.getHeight=function(){return this.height};RectangleD.prototype.setHeight=function(height){this.height=height};RectangleD.prototype.getRight=function(){return this.x+this.width};RectangleD.prototype.getBottom=function(){return this.y+this.height};RectangleD.prototype.intersects=function(a){if(this.getRight()<a.x){return false}if(this.getBottom()<a.y){return false}if(a.getRight()<this.x){return false}if(a.getBottom()<this.y){return false}return true};RectangleD.prototype.getCenterX=function(){return this.x+this.width/2};RectangleD.prototype.getMinX=function(){return this.getX()};RectangleD.prototype.getMaxX=function(){return this.getX()+this.width};RectangleD.prototype.getCenterY=function(){return this.y+this.height/2};RectangleD.prototype.getMinY=function(){return this.getY()};RectangleD.prototype.getMaxY=function(){return this.getY()+this.height};RectangleD.prototype.getWidthHalf=function(){return this.width/2};RectangleD.prototype.getHeightHalf=function(){return this.height/2};module.exports=RectangleD},{}],172:[function(require,module,exports){function Transform(x,y){this.lworldOrgX=0;this.lworldOrgY=0;this.ldeviceOrgX=0;this.ldeviceOrgY=0;this.lworldExtX=1;this.lworldExtY=1;this.ldeviceExtX=1;this.ldeviceExtY=1}Transform.prototype.getWorldOrgX=function(){return this.lworldOrgX};Transform.prototype.setWorldOrgX=function(wox){this.lworldOrgX=wox};Transform.prototype.getWorldOrgY=function(){return this.lworldOrgY};Transform.prototype.setWorldOrgY=function(woy){this.lworldOrgY=woy};Transform.prototype.getWorldExtX=function(){return this.lworldExtX};Transform.prototype.setWorldExtX=function(wex){this.lworldExtX=wex};Transform.prototype.getWorldExtY=function(){return this.lworldExtY};Transform.prototype.setWorldExtY=function(wey){this.lworldExtY=wey};Transform.prototype.getDeviceOrgX=function(){return this.ldeviceOrgX};Transform.prototype.setDeviceOrgX=function(dox){this.ldeviceOrgX=dox};Transform.prototype.getDeviceOrgY=function(){return this.ldeviceOrgY};Transform.prototype.setDeviceOrgY=function(doy){this.ldeviceOrgY=doy};Transform.prototype.getDeviceExtX=function(){return this.ldeviceExtX};Transform.prototype.setDeviceExtX=function(dex){this.ldeviceExtX=dex};Transform.prototype.getDeviceExtY=function(){return this.ldeviceExtY};Transform.prototype.setDeviceExtY=function(dey){this.ldeviceExtY=dey};Transform.prototype.transformX=function(x){var xDevice=0;var worldExtX=this.lworldExtX;if(worldExtX!=0){xDevice=this.ldeviceOrgX+(x-this.lworldOrgX)*this.ldeviceExtX/worldExtX}return xDevice};Transform.prototype.transformY=function(y){var yDevice=0;var worldExtY=this.lworldExtY;if(worldExtY!=0){yDevice=this.ldeviceOrgY+(y-this.lworldOrgY)*this.ldeviceExtY/worldExtY}return yDevice};Transform.prototype.inverseTransformX=function(x){var xWorld=0;var deviceExtX=this.ldeviceExtX;if(deviceExtX!=0){xWorld=this.lworldOrgX+(x-this.ldeviceOrgX)*this.lworldExtX/deviceExtX}return xWorld};Transform.prototype.inverseTransformY=function(y){var yWorld=0;var deviceExtY=this.ldeviceExtY;if(deviceExtY!=0){yWorld=this.lworldOrgY+(y-this.ldeviceOrgY)*this.lworldExtY/deviceExtY}return yWorld};Transform.prototype.inverseTransformPoint=function(inPoint){var outPoint=new PointD(this.inverseTransformX(inPoint.x),this.inverseTransformY(inPoint.y));return outPoint};module.exports=Transform},{}],173:[function(require,module,exports){function UniqueIDGeneretor(){}UniqueIDGeneretor.lastID=0;UniqueIDGeneretor.createID=function(obj){if(UniqueIDGeneretor.isPrimitive(obj)){return obj}if(obj.uniqueID!=null){return obj.uniqueID}obj.uniqueID=UniqueIDGeneretor.getString();UniqueIDGeneretor.lastID++;return obj.uniqueID};UniqueIDGeneretor.getString=function(id){if(id==null)id=UniqueIDGeneretor.lastID;return"Object#"+id+""};UniqueIDGeneretor.isPrimitive=function(arg){var type=typeof arg;return arg==null||type!="object"&&type!="function"};module.exports=UniqueIDGeneretor},{}],174:[function(require,module,exports){"use strict";var Thread;var DimensionD=require("./DimensionD");var HashMap=require("./HashMap");var HashSet=require("./HashSet");var IGeometry=require("./IGeometry");var IMath=require("./IMath");var Integer=require("./Integer");var Point=require("./Point");var PointD=require("./PointD");var RandomSeed=require("./RandomSeed");var RectangleD=require("./RectangleD");var Transform=require("./Transform");var UniqueIDGeneretor=require("./UniqueIDGeneretor");var LGraphObject=require("./LGraphObject");var LGraph=require("./LGraph");var LEdge=require("./LEdge");var LGraphManager=require("./LGraphManager");var LNode=require("./LNode");var Layout=require("./Layout");var LayoutConstants=require("./LayoutConstants");var FDLayout=require("./FDLayout");var FDLayoutConstants=require("./FDLayoutConstants");var FDLayoutEdge=require("./FDLayoutEdge");var FDLayoutNode=require("./FDLayoutNode");var CoSEConstants=require("./CoSEConstants");var CoSEEdge=require("./CoSEEdge");var CoSEGraph=require("./CoSEGraph");var CoSEGraphManager=require("./CoSEGraphManager");var CoSELayout=require("./CoSELayout");var CoSENode=require("./CoSENode");_CoSELayout.idToLNode={};_CoSELayout.toBeTiled={};var defaults={ready:function(){},stop:function(){},fit:true,padding:10,randomize:true,nodeRepulsion:4500,idealEdgeLength:50,edgeElasticity:.45,nestingFactor:.1,gravity:.25,numIter:2500,tile:true,animate:"end",tilingPaddingVertical:10,tilingPaddingHorizontal:10,gravityRangeCompound:1.5,gravityCompound:1,gravityRange:3.8};function extend(defaults,options){var obj={};for(var i in defaults){obj[i]=defaults[i]}for(var i in options){obj[i]=options[i]}return obj}_CoSELayout.layout=new CoSELayout;function _CoSELayout(options){this.options=extend(defaults,options);_CoSELayout.getUserOptions(this.options)}_CoSELayout.getUserOptions=function(options){if(options.nodeRepulsion!=null)CoSEConstants.DEFAULT_REPULSION_STRENGTH=FDLayoutConstants.DEFAULT_REPULSION_STRENGTH=options.nodeRepulsion;if(options.idealEdgeLength!=null)CoSEConstants.DEFAULT_EDGE_LENGTH=FDLayoutConstants.DEFAULT_EDGE_LENGTH=options.idealEdgeLength;if(options.edgeElasticity!=null)CoSEConstants.DEFAULT_SPRING_STRENGTH=FDLayoutConstants.DEFAULT_SPRING_STRENGTH=options.edgeElasticity;if(options.nestingFactor!=null)CoSEConstants.PER_LEVEL_IDEAL_EDGE_LENGTH_FACTOR=FDLayoutConstants.PER_LEVEL_IDEAL_EDGE_LENGTH_FACTOR=options.nestingFactor;if(options.gravity!=null)CoSEConstants.DEFAULT_GRAVITY_STRENGTH=FDLayoutConstants.DEFAULT_GRAVITY_STRENGTH=options.gravity;if(options.numIter!=null)CoSEConstants.MAX_ITERATIONS=FDLayoutConstants.MAX_ITERATIONS=options.numIter;if(options.gravityRange!=null)CoSEConstants.DEFAULT_GRAVITY_RANGE_FACTOR=FDLayoutConstants.DEFAULT_GRAVITY_RANGE_FACTOR=options.gravityRange;if(options.gravityCompound!=null)CoSEConstants.DEFAULT_COMPOUND_GRAVITY_STRENGTH=FDLayoutConstants.DEFAULT_COMPOUND_GRAVITY_STRENGTH=options.gravityCompound;if(options.gravityRangeCompound!=null)CoSEConstants.DEFAULT_COMPOUND_GRAVITY_RANGE_FACTOR=FDLayoutConstants.DEFAULT_COMPOUND_GRAVITY_RANGE_FACTOR=options.gravityRangeCompound;CoSEConstants.DEFAULT_INCREMENTAL=FDLayoutConstants.DEFAULT_INCREMENTAL=LayoutConstants.DEFAULT_INCREMENTAL=!options.randomize;CoSEConstants.ANIMATE=FDLayoutConstants.ANIMATE=options.animate};_CoSELayout.prototype.run=function(){var layout=this;_CoSELayout.idToLNode={};_CoSELayout.toBeTiled={};_CoSELayout.layout=new CoSELayout;this.cy=this.options.cy;var after=this;this.cy.trigger("layoutstart");var gm=_CoSELayout.layout.newGraphManager();this.gm=gm;var nodes=this.options.eles.nodes();var edges=this.options.eles.edges();this.root=gm.addRoot();if(!this.options.tile){this.processChildrenList(this.root,_CoSELayout.getTopMostNodes(nodes))}else{var memberGroups=this.groupZeroDegreeMembers();var tiledMemberPack=this.clearCompounds(this.options);var tiledZeroDegreeNodes=this.clearZeroDegreeMembers(memberGroups)}for(var i=0;i<edges.length;i++){var edge=edges[i];var sourceNode=_CoSELayout.idToLNode[edge.data("source")];var targetNode=_CoSELayout.idToLNode[edge.data("target")];var e1=gm.add(_CoSELayout.layout.newEdge(),sourceNode,targetNode);e1.id=edge.id()}var t1=layout.thread;if(!t1||t1.stopped()){t1=layout.thread=Thread();t1.require(DimensionD,"DimensionD");t1.require(HashMap,"HashMap");t1.require(HashSet,"HashSet");t1.require(IGeometry,"IGeometry");t1.require(IMath,"IMath");t1.require(Integer,"Integer");t1.require(Point,"Point");t1.require(PointD,"PointD");t1.require(RandomSeed,"RandomSeed");t1.require(RectangleD,"RectangleD");t1.require(Transform,"Transform");t1.require(UniqueIDGeneretor,"UniqueIDGeneretor");t1.require(LGraphObject,"LGraphObject");t1.require(LGraph,"LGraph");t1.require(LEdge,"LEdge");t1.require(LGraphManager,"LGraphManager");t1.require(LNode,"LNode");t1.require(Layout,"Layout");t1.require(LayoutConstants,"LayoutConstants");t1.require(FDLayout,"FDLayout");t1.require(FDLayoutConstants,"FDLayoutConstants");t1.require(FDLayoutEdge,"FDLayoutEdge");t1.require(FDLayoutNode,"FDLayoutNode");t1.require(CoSEConstants,"CoSEConstants");t1.require(CoSEEdge,"CoSEEdge");t1.require(CoSEGraph,"CoSEGraph");t1.require(CoSEGraphManager,"CoSEGraphManager");t1.require(CoSELayout,"CoSELayout");t1.require(CoSENode,"CoSENode")}var nodes=this.options.eles.nodes();var edges=this.options.eles.edges();var pData={nodes:[],edges:[]};var nodeIdMap={};for(var i=0;i<nodes.length;i++){nodeIdMap[nodes[i].id()]=true}var lnodes=gm.getAllNodes();for(var i=0;i<lnodes.length;i++){var lnode=lnodes[i];var nodeId=lnode.id;var cyNode=this.options.cy.getElementById(nodeId);var parentId=cyNode.data("parent");parentId=nodeIdMap[parentId]?parentId:undefined;var w=lnode.rect.width;var posX=lnode.rect.x;var posY=lnode.rect.y;var h=lnode.rect.height;var dummy_parent_id=null;if(cyNode.scratch("coseBilkent")&&cyNode.scratch("coseBilkent").dummy_parent_id)dummy_parent_id=cyNode.scratch("coseBilkent").dummy_parent_id;pData["nodes"].push({id:nodeId,pid:parentId,x:posX,y:posY,width:w,height:h,dummy_parent_id:dummy_parent_id})}var ledges=gm.getAllEdges();for(var i=0;i<ledges.length;i++){var ledge=ledges[i];var edgeId=ledge.id;var cyEdge=this.options.cy.getElementById(edgeId);var srcNodeId=cyEdge.source().id();var tgtNodeId=cyEdge.target().id();pData["edges"].push({id:edgeId,source:srcNodeId,target:tgtNodeId})}var ready=false;t1.pass(pData).run(function(pData){var log=function(msg){broadcast({log:msg})};log("start thread");var layout_t=new CoSELayout;var gm_t=layout_t.newGraphManager();var ngraph=gm_t.layout.newGraph();var nnode=gm_t.layout.newNode(null);var root=gm_t.add(ngraph,nnode);root.graphManager=gm_t;gm_t.setRootGraph(root);var root_t=gm_t.rootGraph;var orphans_t=[];var idToLNode_t={};var childrenMap={};var result={};var processNodes=function(parent,children){var size=children.length;for(var i=0;i<size;i++){var theChild=children[i];var children_of_children=childrenMap[theChild.id];var theNode;if(theChild.width!=null&&theChild.height!=null){theNode=parent.add(new CoSENode(gm_t,new PointD(theChild.x,theChild.y),new DimensionD(parseFloat(theChild.width),parseFloat(theChild.height))))}else{theNode=parent.add(new CoSENode(gm_t))}theNode.id=theChild.id;idToLNode_t[theChild.id]=theNode;if(isNaN(theNode.rect.x)){theNode.rect.x=0}if(isNaN(theNode.rect.y)){theNode.rect.y=0}if(children_of_children!=null&&children_of_children.length>0){var theNewGraph;theNewGraph=layout_t.getGraphManager().add(layout_t.newGraph(),theNode);theNewGraph.graphManager=gm_t;processNodes(theNewGraph,children_of_children)}}};var nodes=pData.nodes;for(var i=0;i<nodes.length;i++){var theNode=nodes[i];var p_id=theNode.pid;if(p_id!=null){if(childrenMap[p_id]==null){childrenMap[p_id]=[]}childrenMap[p_id].push(theNode)}else{orphans_t.push(theNode)}}processNodes(root_t,orphans_t);var edges=pData.edges;for(var i=0;i<edges.length;i++){var edge=edges[i];var sourceNode=idToLNode_t[edge.source];var targetNode=idToLNode_t[edge.target];var e1=gm_t.add(layout_t.newEdge(),sourceNode,targetNode)}var graphs=gm_t.getGraphs();var size=graphs.length;var i;var dummyNodes=[];var dummyEdges=[];var graph;for(i=0;i<size;i++){graph=graphs[i];if(graph.getEdges().length>0){continue}graph.updateBounds(true);var centerX=(graph.getLeft()+graph.getRight())/2;var centerY=(graph.getTop()+graph.getBottom())/2;var children=graph.getNodes();var dummyNode=new CoSENode(gm_t,new PointD(centerX,centerY),new DimensionD(1,1));dummyNode.id=i+"_dummy";dummyNodes.push(dummyNode);graph.add(dummyNode);for(var k=0;k<children.length;k++){if(children[k].id==dummyNode.id)continue;var newEdge=layout_t.newEdge();newEdge.id=children[k].id+"_"+dummyNode.id;dummyEdges.push({dummyEdge:newEdge,parentGraph:graph});graph.add(newEdge,children[k],dummyNode)}}layout_t.runLayout();for(var id in idToLNode_t){var lNode=idToLNode_t[id];var rect=lNode.rect;result[id]={id:id,x:rect.x,y:rect.y,w:rect.width,h:rect.height}}for(var i=0;i<dummyNodes.length;i++){var nodeInst=dummyNodes[i];nodeInst.getOwner().remove(nodeInst)}for(var i=0;i<dummyEdges.length;i++){var edgeInst=dummyEdges[i];edgeInst.parentGraph.remove(edgeInst.dummyEdge)}var seeds={};seeds.rsSeed=RandomSeed.seed;seeds.rsX=RandomSeed.x;var pass={result:result,seeds:seeds};return pass}).then(function(pass){var result=pass.result;var seeds=pass.seeds;RandomSeed.seed=seeds.rsSeed;RandomSeed.x=seeds.rsX;for(var id in result){var lNode=_CoSELayout.idToLNode[id];var node=result[id];lNode.rect.x=node.x;lNode.rect.y=node.y;lNode.rect.width=node.w;lNode.rect.height=node.h}if(after.options.tile){after.repopulateZeroDegreeMembers(tiledZeroDegreeNodes);after.repopulateCompounds(tiledMemberPack);after.options.eles.nodes().updateCompoundBounds()}var getPositions=function(i,ele){var theId=ele.data("id");var lNode=_CoSELayout.idToLNode[theId];return{x:lNode.getRect().getCenterX(),y:lNode.getRect().getCenterY()}};if(after.options.animate!=="during"){after.options.eles.nodes().layoutPositions(after,after.options,getPositions)}else{after.options.eles.nodes().positions(getPositions);if(after.options.fit)after.options.cy.fit(after.options.eles.nodes(),after.options.padding);if(!ready){after.cy.one("layoutready",after.options.ready);after.cy.trigger("layoutready")}after.cy.one("layoutstop",after.options.stop);after.cy.trigger("layoutstop")}t1.stop();after.options.eles.nodes().removeScratch("coseBilkent")});t1.on("message",function(e){var logMsg=e.message.log;if(logMsg!=null){console.log("Thread log: "+logMsg);return}var pData=e.message.pData;if(pData!=null){after.options.eles.nodes().positions(function(i,ele){if(ele.scratch("coseBilkent")&&ele.scratch("coseBilkent").dummy_parent_id){var dummyParent=ele.scratch("coseBilkent").dummy_parent_id;return{x:dummyParent.x,y:dummyParent.y}}var theId=ele.data("id");var pNode=pData[theId];var temp=this;while(pNode==null){temp=temp.parent()[0];pNode=pData[temp.id()];pData[theId]=pNode}return{x:pNode.x,y:pNode.y}});if(after.options.fit)after.options.cy.fit(after.options.eles.nodes(),after.options.padding);if(!ready){ready=true;after.one("layoutready",after.options.ready);after.trigger({type:"layoutready",layout:after})}return}});return this};_CoSELayout.getTopMostNodes=function(nodes){var nodesMap={};for(var i=0;i<nodes.length;i++){nodesMap[nodes[i].id()]=true}var roots=nodes.filter(function(i,ele){var parent=ele.parent()[0];while(parent!=null){if(nodesMap[parent.id()]){return false}parent=parent.parent()[0]}return true});return roots};_CoSELayout.prototype.getToBeTiled=function(node){var id=node.data("id");if(_CoSELayout.toBeTiled[id]!=null){return _CoSELayout.toBeTiled[id]}var children=node.children();if(children==null||children.length==0){_CoSELayout.toBeTiled[id]=false;return false}for(var i=0;i<children.length;i++){var theChild=children[i];if(this.getNodeDegree(theChild)>0){_CoSELayout.toBeTiled[id]=false;return false}if(theChild.children()==null||theChild.children().length==0){_CoSELayout.toBeTiled[theChild.data("id")]=false;continue}if(!this.getToBeTiled(theChild)){_CoSELayout.toBeTiled[id]=false;return false}}_CoSELayout.toBeTiled[id]=true;return true};_CoSELayout.prototype.getNodeDegree=function(node){var id=node.id();var edges=this.options.eles.edges().filter(function(i,ele){var source=ele.data("source");var target=ele.data("target");if(source!=target&&(source==id||target==id)){return true}});return edges.length};_CoSELayout.prototype.getNodeDegreeWithChildren=function(node){var degree=this.getNodeDegree(node);var children=node.children();for(var i=0;i<children.length;i++){var child=children[i];degree+=this.getNodeDegreeWithChildren(child)}return degree};_CoSELayout.prototype.groupZeroDegreeMembers=function(){var tempMemberGroups=[];var memberGroups=[];var self=this;var parentMap={};for(var i=0;i<this.options.eles.nodes().length;i++){parentMap[this.options.eles.nodes()[i].id()]=true}var zeroDegree=this.options.eles.nodes().filter(function(i,ele){var pid=ele.data("parent");if(pid!=undefined&&!parentMap[pid]){pid=undefined}if(self.getNodeDegreeWithChildren(ele)==0&&(pid==undefined||pid!=undefined&&!self.getToBeTiled(ele.parent()[0])))return true;else return false});for(var i=0;i<zeroDegree.length;i++){var node=zeroDegree[i];var p_id=node.parent().id();if(p_id!=undefined&&!parentMap[p_id]){p_id=undefined}if(typeof tempMemberGroups[p_id]==="undefined")tempMemberGroups[p_id]=[];tempMemberGroups[p_id]=tempMemberGroups[p_id].concat(node)}for(var p_id in tempMemberGroups){if(tempMemberGroups[p_id].length>1){var dummyCompoundId="DummyCompound_"+p_id;memberGroups[dummyCompoundId]=tempMemberGroups[p_id];if(this.options.cy.getElementById(dummyCompoundId).empty()){this.options.cy.add({group:"nodes",data:{id:dummyCompoundId,parent:p_id}});var dummy=this.options.cy.nodes()[this.options.cy.nodes().length-1];this.options.eles=this.options.eles.union(dummy);dummy.hide();for(var i=0;i<tempMemberGroups[p_id].length;i++){if(i==0){dummy.scratch("coseBilkent",{tempchildren:[]})}var node=tempMemberGroups[p_id][i];var scratchObj=node.scratch("coseBilkent");if(!scratchObj){scratchObj={};node.scratch("coseBilkent",scratchObj)}scratchObj["dummy_parent_id"]=dummyCompoundId;this.options.cy.add({group:"nodes",data:{parent:dummyCompoundId,width:node.width(),height:node.height()}});var tempchild=this.options.cy.nodes()[this.options.cy.nodes().length-1];tempchild.hide();tempchild.css("width",tempchild.data("width"));tempchild.css("height",tempchild.data("height"));tempchild.width();dummy.scratch("coseBilkent").tempchildren.push(tempchild)}}}}return memberGroups};_CoSELayout.prototype.performDFSOnCompounds=function(options){var compoundOrder=[];var roots=_CoSELayout.getTopMostNodes(this.options.eles.nodes());this.fillCompexOrderByDFS(compoundOrder,roots);return compoundOrder};_CoSELayout.prototype.fillCompexOrderByDFS=function(compoundOrder,children){for(var i=0;i<children.length;i++){var child=children[i];this.fillCompexOrderByDFS(compoundOrder,child.children());if(this.getToBeTiled(child)){compoundOrder.push(child)}}};_CoSELayout.prototype.clearCompounds=function(options){var childGraphMap=[];var compoundOrder=this.performDFSOnCompounds(options);_CoSELayout.compoundOrder=compoundOrder;this.processChildrenList(this.root,_CoSELayout.getTopMostNodes(this.options.eles.nodes()));for(var i=0;i<compoundOrder.length;i++){var lCompoundNode=_CoSELayout.idToLNode[compoundOrder[i].id()];childGraphMap[compoundOrder[i].id()]=compoundOrder[i].children();lCompoundNode.child=null}var tiledMemberPack=this.tileCompoundMembers(childGraphMap);return tiledMemberPack};_CoSELayout.prototype.clearZeroDegreeMembers=function(memberGroups){var tiledZeroDegreePack=[];for(var id in memberGroups){var compoundNode=_CoSELayout.idToLNode[id];tiledZeroDegreePack[id]=this.tileNodes(memberGroups[id]);compoundNode.rect.width=tiledZeroDegreePack[id].width;compoundNode.rect.height=tiledZeroDegreePack[id].height}return tiledZeroDegreePack};_CoSELayout.prototype.repopulateCompounds=function(tiledMemberPack){for(var i=_CoSELayout.compoundOrder.length-1;i>=0;i--){var id=_CoSELayout.compoundOrder[i].id();var lCompoundNode=_CoSELayout.idToLNode[id];var horizontalMargin=parseInt(_CoSELayout.compoundOrder[i].css("padding-left"));var verticalMargin=parseInt(_CoSELayout.compoundOrder[i].css("padding-top"));this.adjustLocations(tiledMemberPack[id],lCompoundNode.rect.x,lCompoundNode.rect.y,horizontalMargin,verticalMargin)}};_CoSELayout.prototype.repopulateZeroDegreeMembers=function(tiledPack){for(var i in tiledPack){var compound=this.cy.getElementById(i);var compoundNode=_CoSELayout.idToLNode[i];var horizontalMargin=parseInt(compound.css("padding-left"));var verticalMargin=parseInt(compound.css("padding-top"));this.adjustLocations(tiledPack[i],compoundNode.rect.x,compoundNode.rect.y,horizontalMargin,verticalMargin);var tempchildren=compound.scratch("coseBilkent").tempchildren;for(var i=0;i<tempchildren.length;i++){tempchildren[i].remove()}compound.remove()}};_CoSELayout.prototype.adjustLocations=function(organization,x,y,compoundHorizontalMargin,compoundVerticalMargin){x+=compoundHorizontalMargin;y+=compoundVerticalMargin;var left=x;for(var i=0;i<organization.rows.length;i++){var row=organization.rows[i];x=left;var maxHeight=0;for(var j=0;j<row.length;j++){var lnode=row[j];var node=this.cy.getElementById(lnode.id);lnode.rect.x=x;lnode.rect.y=y;x+=lnode.rect.width+organization.horizontalPadding;if(lnode.rect.height>maxHeight)maxHeight=lnode.rect.height}y+=maxHeight+organization.verticalPadding}};_CoSELayout.prototype.tileCompoundMembers=function(childGraphMap){var tiledMemberPack=[];for(var id in childGraphMap){var compoundNode=_CoSELayout.idToLNode[id];tiledMemberPack[id]=this.tileNodes(childGraphMap[id]);compoundNode.rect.width=tiledMemberPack[id].width+20;compoundNode.rect.height=tiledMemberPack[id].height+20}return tiledMemberPack};_CoSELayout.prototype.tileNodes=function(nodes){var self=this;var verticalPadding=typeof self.options.tilingPaddingVertical==="function"?self.options.tilingPaddingVertical.call():self.options.tilingPaddingVertical;var horizontalPadding=typeof self.options.tilingPaddingHorizontal==="function"?self.options.tilingPaddingHorizontal.call():self.options.tilingPaddingHorizontal;var organization={rows:[],rowWidth:[],rowHeight:[],width:20,height:20,verticalPadding:verticalPadding,horizontalPadding:horizontalPadding};var layoutNodes=[];for(var i=0;i<nodes.length;i++){var node=nodes[i];var lNode=_CoSELayout.idToLNode[node.id()];if(!node.scratch("coseBilkent")||!node.scratch("coseBilkent").dummy_parent_id){var owner=lNode.owner;owner.remove(lNode);this.gm.resetAllNodes();this.gm.getAllNodes()}layoutNodes.push(lNode)}layoutNodes.sort(function(n1,n2){if(n1.rect.width*n1.rect.height>n2.rect.width*n2.rect.height)return-1;if(n1.rect.width*n1.rect.height<n2.rect.width*n2.rect.height)return 1;return 0});for(var i=0;i<layoutNodes.length;i++){var lNode=layoutNodes[i];var cyNode=this.cy.getElementById(lNode.id).parent()[0];var minWidth=0;if(cyNode){minWidth=parseInt(cyNode.css("padding-left"))+parseInt(cyNode.css("padding-right"))}if(organization.rows.length==0){this.insertNodeToRow(organization,lNode,0,minWidth)}else if(this.canAddHorizontal(organization,lNode.rect.width,lNode.rect.height)){this.insertNodeToRow(organization,lNode,this.getShortestRowIndex(organization),minWidth)}else{this.insertNodeToRow(organization,lNode,organization.rows.length,minWidth)}this.shiftToLastRow(organization)}return organization};_CoSELayout.prototype.insertNodeToRow=function(organization,node,rowIndex,minWidth){var minCompoundSize=minWidth;if(rowIndex==organization.rows.length){var secondDimension=[];organization.rows.push(secondDimension);organization.rowWidth.push(minCompoundSize);organization.rowHeight.push(0)}var w=organization.rowWidth[rowIndex]+node.rect.width;if(organization.rows[rowIndex].length>0){w+=organization.horizontalPadding}organization.rowWidth[rowIndex]=w;if(organization.width<w){organization.width=w}var h=node.rect.height;if(rowIndex>0)h+=organization.verticalPadding;var extraHeight=0;if(h>organization.rowHeight[rowIndex]){extraHeight=organization.rowHeight[rowIndex];organization.rowHeight[rowIndex]=h;extraHeight=organization.rowHeight[rowIndex]-extraHeight}organization.height+=extraHeight;organization.rows[rowIndex].push(node)};_CoSELayout.prototype.getShortestRowIndex=function(organization){var r=-1;var min=Number.MAX_VALUE;for(var i=0;i<organization.rows.length;i++){if(organization.rowWidth[i]<min){r=i;min=organization.rowWidth[i]}}return r};_CoSELayout.prototype.getLongestRowIndex=function(organization){var r=-1;var max=Number.MIN_VALUE;for(var i=0;i<organization.rows.length;i++){if(organization.rowWidth[i]>max){r=i;max=organization.rowWidth[i]}}return r};_CoSELayout.prototype.canAddHorizontal=function(organization,extraWidth,extraHeight){var sri=this.getShortestRowIndex(organization);if(sri<0){return true}var min=organization.rowWidth[sri];if(min+organization.horizontalPadding+extraWidth<=organization.width)return true;var hDiff=0;if(organization.rowHeight[sri]<extraHeight){if(sri>0)hDiff=extraHeight+organization.verticalPadding-organization.rowHeight[sri]}var add_to_row_ratio;if(organization.width-min>=extraWidth+organization.horizontalPadding){add_to_row_ratio=(organization.height+hDiff)/(min+extraWidth+organization.horizontalPadding)}else{add_to_row_ratio=(organization.height+hDiff)/organization.width}hDiff=extraHeight+organization.verticalPadding;var add_new_row_ratio;if(organization.width<extraWidth){add_new_row_ratio=(organization.height+hDiff)/extraWidth}else{add_new_row_ratio=(organization.height+hDiff)/organization.width}if(add_new_row_ratio<1)add_new_row_ratio=1/add_new_row_ratio;if(add_to_row_ratio<1)add_to_row_ratio=1/add_to_row_ratio;return add_to_row_ratio<add_new_row_ratio};_CoSELayout.prototype.shiftToLastRow=function(organization){var longest=this.getLongestRowIndex(organization);var last=organization.rowWidth.length-1;var row=organization.rows[longest];var node=row[row.length-1];var diff=node.width+organization.horizontalPadding;if(organization.width-organization.rowWidth[last]>diff&&longest!=last){row.splice(-1,1);organization.rows[last].push(node);organization.rowWidth[longest]=organization.rowWidth[longest]-diff;organization.rowWidth[last]=organization.rowWidth[last]+diff;organization.width=organization.rowWidth[this.getLongestRowIndex(organization)];var maxHeight=Number.MIN_VALUE;for(var i=0;i<row.length;i++){if(row[i].height>maxHeight)maxHeight=row[i].height}if(longest>0)maxHeight+=organization.verticalPadding;var prevTotal=organization.rowHeight[longest]+organization.rowHeight[last];organization.rowHeight[longest]=maxHeight;if(organization.rowHeight[last]<node.height+organization.verticalPadding)organization.rowHeight[last]=node.height+organization.verticalPadding;var finalTotal=organization.rowHeight[longest]+organization.rowHeight[last];organization.height+=finalTotal-prevTotal;this.shiftToLastRow(organization)}};_CoSELayout.prototype.stop=function(){this.stopped=true;if(this.thread){this.thread.stop()}this.trigger("layoutstop");return this};_CoSELayout.prototype.processChildrenList=function(parent,children){var size=children.length;for(var i=0;i<size;i++){var theChild=children[i];this.options.eles.nodes().length;var children_of_children=theChild.children();var theNode;if(theChild.width()!=null&&theChild.height()!=null){theNode=parent.add(new CoSENode(_CoSELayout.layout.graphManager,new PointD(theChild.position("x"),theChild.position("y")),new DimensionD(parseFloat(theChild.width()),parseFloat(theChild.height()))))}else{theNode=parent.add(new CoSENode(this.graphManager))}theNode.id=theChild.data("id");_CoSELayout.idToLNode[theChild.data("id")]=theNode;if(isNaN(theNode.rect.x)){theNode.rect.x=0}if(isNaN(theNode.rect.y)){theNode.rect.y=0}if(children_of_children!=null&&children_of_children.length>0){var theNewGraph;theNewGraph=_CoSELayout.layout.getGraphManager().add(_CoSELayout.layout.newGraph(),theNode);this.processChildrenList(theNewGraph,children_of_children)}}};module.exports=function get(cytoscape){Thread=cytoscape.Thread;return _CoSELayout}},{"./CoSEConstants":145,"./CoSEEdge":146,"./CoSEGraph":147,"./CoSEGraphManager":148,"./CoSELayout":149,"./CoSENode":150,"./DimensionD":151,"./FDLayout":152,"./FDLayoutConstants":153,"./FDLayoutEdge":154,"./FDLayoutNode":155,"./HashMap":156,"./HashSet":157,"./IGeometry":158,"./IMath":159,"./Integer":160,"./LEdge":161,"./LGraph":162,"./LGraphManager":163,"./LGraphObject":164,"./LNode":165,"./Layout":166,"./LayoutConstants":167,"./Point":168,"./PointD":169,"./RandomSeed":170,"./RectangleD":171,"./Transform":172,"./UniqueIDGeneretor":173}],175:[function(require,module,exports){"use strict";var getLayout=require("./Layout");var register=function(cytoscape){var Layout=getLayout(cytoscape);cytoscape("layout","cose-bilkent",Layout)};if(typeof cytoscape!=="undefined"){register(cytoscape)}module.exports=register},{"./Layout":174}],176:[function(require,module,exports){var cytoscape=window.cytoscape=require("cytoscape");var panzoom=require("cytoscape-panzoom");var navigator=require("cytoscape-navigator");var cyqtip=require("cytoscape-qtip");var regCose=require("../../lib/js/cose-bilkent/src/index.js");var grid_guide=require("cytoscape-grid-guide");var undoRedo=require("cytoscape-undo-redo");var contextMenus=require("cytoscape-context-menus");var viewUtilities=require("cytoscape-view-utilities");require("bootstrap-select");var panzoomOpts=require("./PanzoomOptions.js");var styleSheet=require("./GraphStyleSheet.js");var edgeHandleOpts=require("./EdgeHandlesOptions.js");var LayoutProperties=require("./BackboneViews/LayoutPropertiesView.js");var GenomicDataExplorerView=require("./BackboneViews/GenomicDataExplorerView.js");var PathwayDetailsView=require("./BackboneViews/PathwayDetailsView.js");var GridOptionsView=require("./BackboneViews/GridOptionsView.js");var CBioPortalAccessView=require("./BackboneViews/CbioPortalAccessView.js");require("./FileOperationsManager.js");require("./OtherMenuOperations.js");require("./GenomicMenuOperations.js");require("./ViewOperationsManager.js");require("./GraphUtilities.js");var QtipManager=require("./QtipManager.js");var ContextMenuManager=require("./ContextMenuManager.js");var DragDropNodeAddPlugin=require("./DragDropNodeAddPlugin.js");var EditorActionsManager=require("./EditorActionsManager.js");var SaveLoadUtilities=require("./SaveLoadUtility.js");var CBioPortalAccessor=require("./cBioPortalAccessor.js");var notify=require("bootstrap-notify");window.notificationManager=require("./NotificationFactory");module.exports=function(){function AppManager(isCollaborative,realTimeManager){this.isCollaborative=isCollaborative;this.realTimeManager=realTimeManager;this.init();this.createSampleMenu();this.createCBioPortalAccessModal()}AppManager.prototype.init=function(){this.initCyJS();this.initCyHandlers();console.log("updated");var that=this;window.onresize=function(){that.placePanzoomAndOverlay()};if(!this.isCollaborative){$(document).keydown(function(e){if(e.which===89&&(e.ctrlKey||event.metaKey)){window.undoRedoManager.redo()}else if(e.which===90&&(e.ctrlKey||event.metaKey)){window.undoRedoManager.undo()}})}else{$('a[role="redo"]').hide();$('a[role="undo"]').hide()}window.portalAccessor=new CBioPortalAccessor;window.appManager=this};AppManager.prototype.placePanzoomAndOverlay=function(){var offset=5;var topCy=$(".cyContainer").offset().top;var leftCy=$(".cyContainer").offset().left;var heightCy=$(".cyContainer").outerHeight();var widthCy=$(".cyContainer").outerWidth();var heightNavigator=$(".cytoscape-navigator-wrapper").outerHeight();var widthNavigator=$(".cytoscape-navigator-wrapper").outerWidth();var heightPanzoom=$(".cy-panzoom").outerHeight();var widthPanzoom=$(".cy-panzoom").outerWidth();$(".cytoscape-navigator-wrapper").css("top",heightCy+topCy-heightNavigator-offset);$(".cytoscape-navigator-wrapper").css("left",widthCy+leftCy-widthNavigator-offset);$(".cy-panzoom").css("top",topCy+5);$(".cy-panzoom").css("left",widthCy+leftCy-55)};AppManager.prototype.createSampleMenu=function(){var request=new XMLHttpRequest;request.onreadystatechange=function(){if(request.readyState===XMLHttpRequest.DONE&&request.status===200){var templateData=JSON.parse(request.responseText);for(var key in templateData){if(templateData.hasOwnProperty(key)){var newTCGAMenu=$('<li class="dropdown-submenu" id="'+key+'">'+'<a href="#">'+key+"</a>"+"</li>");var newTCGAPathway=$('<ul class="dropdown-menu"></ul>');for(var i in templateData[key]){var newPath=templateData[key][i];var pName=newPath.replace(/-/gi," ").substring(0,newPath.length-4);var sampleLink=$('<li><a  path="'+newPath+'" href="#">'+pName+"</a></li>");sampleLink.on("click",sampleMenuClickHandler);if(key.includes("PanCancer")){$("#panCancerSubMenu").append(sampleLink)}else{newTCGAPathway.append(sampleLink);newTCGAMenu.append(newTCGAPathway)}}if(!key.includes("PanCancer")&&!key.includes("Creighton")){$("#sampleSubMenu").append(newTCGAMenu)}}}}};function sampleMenuClickHandler(event){var request=new XMLHttpRequest;request.onreadystatechange=function(){if(request.readyState===XMLHttpRequest.DONE&&request.status===200){var allEles=SaveLoadUtilities.parseGraph(request.responseText);window.editorActionsManager.loadFile(allEles.nodes,allEles.edges);window.undoRedoManager.reset();window.appManager.pathwayDetailsView.updatePathwayProperties({fileName:allEles.title+".txt",pathwayTitle:allEles.title,pathwayDescription:allEles.description})}};var pathwayName=event.target.attributes[0].value;request.open("GET","/pathway?filename="+pathwayName);request.send()}request.open("GET","/getTemplateFileData");request.send()};AppManager.prototype.createCBioPortalAccessModal=function(){var self=this;this.portalAccessView=new CBioPortalAccessView({el:$("#cbioPortalAccessDiv")});window.portalAccessor.fetchCancerStudies(function(cancerStudies){self.portalAccessView.updateCancerStudies(cancerStudies)})};AppManager.prototype.initCyJS=function(){panzoom(cytoscape,$);cyqtip(cytoscape,$);regCose(cytoscape);navigator(cytoscape);grid_guide(cytoscape,$);undoRedo(cytoscape);contextMenus(cytoscape,$);viewUtilities(cytoscape,$);window.edgeAddingMode=0;cy=window.cy=cytoscape({container:document.querySelector("#cy"),boxSelectionEnabled:true,autounselectify:false,wheelSensitivity:.1,style:styleSheet,ready:function(){},textureOnViewport:false,motionBlur:true,layout:{name:"preset"}});window.editorActionsManager=this.editorActionsManager=new EditorActionsManager(this.isCollaborative,this.realTimeManager,window.cy);this.qtipManager=new QtipManager(window.cy),this.editorActionsManager;this.cxtMenuManager=new ContextMenuManager(window.cy,this.editorActionsManager);this.dragDropNodeAddManager=new DragDropNodeAddPlugin(this.editorActionsManager);this.layoutPropertiesView=new LayoutProperties({el:$("#layoutPropertiesDiv"),editorActionsManager:this.editorActionsManager}).render();this.gridOptionsView=new GridOptionsView({el:$("#gridOptionsDiv")}).render();this.genomicDataExplorerView=new GenomicDataExplorerView({el:$("#genomicDataExplorerDiv"),editorActionsManager:this.editorActionsManager}).render();this.pathwayDetailsView=new PathwayDetailsView({el:$("#pathwayDetailsDiv")}).render();cy.panzoom(panzoomOpts);cy.nodeadd({components:[{container:$("#simpleNodeDiv"),nodeType:"Gene"},{container:$("#familyNodeDiv"),nodeType:"Family"},{container:$("#complexNodeDiv"),nodeType:"Complex",icon:"fa fa-square-o"},{container:$("#compartmentNodeDiv"),nodeType:"Compartment",icon:"fa fa-square-o"},{container:$("#processNodeDiv"),nodeType:"Process"}]});cy.edgehandles(edgeHandleOpts);var navDefaults={container:".cytoscape-navigator-wrapper",viewLiveFramerate:0,thumbnailEventFramerate:10,thumbnailLiveFramerate:false,dblClickDelay:200,removeCustomContainer:true,rerenderDelay:100};var nav=cy.navigator(navDefaults);var viewUtilitiesOpts={node:{highlighted:{"border-width":2,"border-color":"#bc1142"},unhighlighted:{opacity:function(ele){return ele.css("opacity")}}},edge:{highlighted:{},unhighlighted:{opacity:function(ele){return ele.css("opacity")}}},setVisibilityOnHide:false,setDisplayOnHide:true,neighbor:function(node){return false},neighborSelectTime:500};window.viewUtilities=cy.viewUtilities(viewUtilitiesOpts);this.placePanzoomAndOverlay()};AppManager.prototype.initCyHandlers=function(){var that=this;var tappedBefore;var tappedTimeout;cy.on("tap",function(event){var tappedNow=event.cyTarget;if(tappedTimeout&&tappedBefore){clearTimeout(tappedTimeout)}if(tappedBefore===tappedNow){tappedNow.trigger("doubleTap");tappedBefore=null}else{tappedTimeout=setTimeout(function(){tappedBefore=null},300);tappedBefore=tappedNow}});cy.on("doubleTap","node",function(e){var eventIsDirect=e.cyTarget===this;if(eventIsDirect){$(".qtip").remove();that.qtipManager.addQtipToElements(e.cyTarget);var api=this.qtip("api");if(api){api.show()}}});cy.on("select","node",function(e){window.editorActionsManager.pushSelectedNodeStack(e.cyTarget)});cy.on("select","edge",function(e){var eventIsDirect=e.cyTarget===this;$(".qtip").remove();if(eventIsDirect){that.qtipManager.addQtipToElements(e.cyTarget)}});cy.on("unselect","node",function(e){window.editorActionsManager.removeElementFromSelectedNodeStack(e.cyTarget)});cy.on("free","node",function(e){var selectedNodes=cy.nodes(":selected");var nodes=e.cyTarget;nodes=nodes.union(nodes.descendants());nodes=nodes.union(selectedNodes);that.editorActionsManager.moveElements(nodes)});cy.on("layoutstop",function(event){that.editorActionsManager.postLayout()});cy.on("add","node",function(event){cy.style().update();cy.forceRender()})};return AppManager}()},{"../../lib/js/cose-bilkent/src/index.js":175,"./BackboneViews/CbioPortalAccessView.js":178,"./BackboneViews/GenomicDataExplorerView.js":179,"./BackboneViews/GridOptionsView.js":180,"./BackboneViews/LayoutPropertiesView.js":181,"./BackboneViews/PathwayDetailsView.js":182,"./ContextMenuManager.js":184,"./DragDropNodeAddPlugin.js":185,"./EdgeHandlesOptions.js":186,"./EditorActionsManager.js":187,"./FileOperationsManager.js":188,"./GenomicMenuOperations.js":190,"./GraphStyleSheet.js":191,"./GraphUtilities.js":192,"./NotificationFactory":193,"./OtherMenuOperations.js":194,"./PanzoomOptions.js":195,"./QtipManager.js":196,"./SaveLoadUtility.js":200,"./ViewOperationsManager.js":201,"./cBioPortalAccessor.js":202,"bootstrap-notify":2,"bootstrap-select":3,cytoscape:116,"cytoscape-context-menus":17,"cytoscape-grid-guide":24,"cytoscape-navigator":28,"cytoscape-panzoom":29,"cytoscape-qtip":30,"cytoscape-undo-redo":31,"cytoscape-view-utilities":32}],177:[function(require,module,exports){var BioGeneView=Backbone.View.extend({render:function(){var variables={geneDescription:this.model.geneDescription,geneAliases:this.parseDelimitedInfo(this.model.geneAliases,":",",",null),geneDesignations:this.parseDelimitedInfo(this.model.geneDesignations,":",",",null),geneLocation:this.model.geneLocation,geneMim:this.model.geneMim,geneId:this.model.geneId,geneUniprotId:this.extractFirstUniprotId(this.model.geneUniprotMapping),geneUniprotLinks:this.generateUniprotLinks(this.model.geneUniprotMapping),geneSummary:this.model.geneSummary};var template=_.template($("#biogene-template").html());template=template(variables);this.$el.html(template);this.format(this.model);return this.$el},format:function(){if(this.model.geneDescription==undefined)this.$el.find(".biogene-description").hide();if(this.model.geneAliases==undefined)this.$el.find(".biogene-aliases").hide();if(this.model.geneDesignations==undefined)this.$el.find(".biogene-designations").hide();if(this.model.geneChromosome==undefined)this.$el.find(".biogene-chromosome").hide();if(this.model.geneLocation==undefined)this.$el.find(".biogene-location").hide();if(this.model.geneMim==undefined)this.$el.find(".biogene-mim").hide();if(this.model.geneId==undefined)this.$el.find(".biogene-id").hide();if(this.model.geneUniprotMapping==undefined)this.$el.find(".biogene-uniprot-links").hide();if(this.model.geneSummary==undefined)this.$el.find(".node-details-summary").hide();var expanderOpts={slicePoint:100,expandPrefix:" ",expandText:" (...)",userCollapseText:" (show less)",moreClass:"expander-read-more",lessClass:"expander-read-less",detailClass:"expander-details",expandEffect:"fadeIn",collapseEffect:"fadeOut"};expanderOpts.slicePoint=2;expanderOpts.widow=0},generateUniprotLinks:function(mapping){var formatter=function(id){var tpl=_.template($("#uniprot-link-template").html());tpl=tpl({id:id});return tpl};if(mapping==undefined||mapping==null){return""}if(mapping.indexOf(":")<0){return""}else{mapping=mapping.substring(mapping.indexOf(":")+1);return", "+this.parseDelimitedInfo(mapping,":",",",formatter)}},extractFirstUniprotId:function(mapping){if(mapping==undefined||mapping==null){return""}var parts=mapping.split(":");if(parts.length>0){return parts[0]}return""},parseDelimitedInfo:function(info,delimiter,separator,formatter){if(info==undefined||info==null){return info}var text="";var parts=info.split(delimiter);if(parts.length>0){if(formatter){text=formatter(parts[0])}else{text=parts[0]}}for(var i=1;i<parts.length;i++){text+=separator+" ";if(formatter){text+=formatter(parts[i])}else{text+=parts[i]}}return text}});module.exports=BioGeneView},{}],178:[function(require,module,exports){var CBioPortalAccessor=require("../cBioPortalAccessor.js");var cbioPortalAccessView=Backbone.View.extend({cachedLoadingTemplate:_.template($("#loading-small-template").html())(),events:{"click #getProfileData":"fetchProfileData"},initialize:function(options){this.portalAccessor=new CBioPortalAccessor;this.$el.find("#cancerDropDown").append("<h4>Please Wait Loading Cancer Studies</h4>");this.$el.find("#cancerDropDown").append(this.cachedLoadingTemplate)},updateCancerStudies:function(cancerStudies){this.cancerStudies=cancerStudies;this.updateView()},updateView:function(){var self=this;this.$el.find("#cancerDropDown").empty();this.$el.find("#dataTypeSelection").empty();this.$el.find("#cancerDropDown").append("<h4>Select Cancer Study</h4>");var cancerStudiesDropDown=$('<select  id="cancerSelectBox" class="selectpicker" title="Select a Cancer Study"></select>');for(var cancerName in this.cancerStudies){cancerStudiesDropDown.append("<option key="+cancerName+">"+this.cancerStudies[cancerName][1]+"</option>")}$("#cancerDropDown").append(cancerStudiesDropDown);cancerStudiesDropDown.selectpicker({liveSearch:true,container:"body",liveSearchPlaceholder:"Search Cancer Study"});$("#cancerSelectBox").change(function(){self.$el.find("#dataTypeSelection").empty();self.$el.find("#dataTypeSelection").append(self.cachedLoadingTemplate);var key=$(this).find("option:selected").attr("key");self.currenCancerStudy=self.cancerStudies[key];var createDataTypeSelectionCallback=function(cancerData){self.$el.find("#dataTypeSelection").empty();var dataTypes={};for(var obj in cancerData){var dataType=self.portalAccessor.getDataType(obj);dataTypes[dataType]=cancerData[obj]}self.$el.find("#dataTypeSelection").append("<h4>Data Types</h4>");for(var obj in dataTypes){var newCheckbox=$('<div class="checkbox">'+"<label>"+'<input type="checkbox" cancerKey="'+dataTypes[obj][0]+'" value="">'+obj+"</label>"+"</div>");newCheckbox.find('input[type="checkbox"]').on("click",function(evt){var checkedNum=self.$el.find('input[type="checkbox"]:checked').length;if(checkedNum>=1)self.showSubmitButton();else if(checkedNum==0)self.hideSubmitButton()});self.$el.find("#dataTypeSelection").append(newCheckbox)}};self.portalAccessor.getSupportedGeneticProfiles(key,createDataTypeSelectionCallback)})},render:function(){this.hideSubmitButton();if(!this.cancerStudies){this.$el.modal("show");return}this.updateView();this.$el.modal("show")},hideSubmitButton:function(){$("#getProfileData").hide()},showSubmitButton:function(){$("#getProfileData").show()},fetchProfileData:function(){var checkedDataTypes=this.$el.find('input[type="checkbox"]:checked');var geneSymbols=window.editorActionsManager.getGeneSymbols();var self=this;for(var i=0;i<checkedDataTypes.length;i++){self.portalAccessor.getProfileData({caseSetId:self.currenCancerStudy[0],geneticProfileId:$(checkedDataTypes[i]).attr("cancerkey"),genes:geneSymbols},function(data){window.editorActionsManager.addPortalGenomicData(data)})}this.$el.modal("toggle")}});module.exports=cbioPortalAccessView},{"../cBioPortalAccessor.js":202}],179:[function(require,module,exports){var genomicDataExplorer=Backbone.View.extend({cachedTpl:_.template($("#genomicDataExplorerTemplate").html()),events:{"click #save-genomic":"saveHandler"},initialize:function(options){this.$el.append(this.cachedTpl());this.editorActionsManagerRef=options.editorActionsManager;this.editorActionsManagerRef.registerGenomicDataObserver(this);this.renderEmptyView()},render:function(){},renderEmptyView:function(){this.$el.find(".genomicDataContentDiv").append('<h4 class="modal-title">There is currently no data to show</h4>');this.$el.find("#save-genomic").hide()},saveHandler:function(event){var dataMap={};this.$el.find(".genomicDataContentDiv label").each(function(){var jqEl=$(this);var cancerType=jqEl.text();var isChecked=jqEl.find("input").is(":checked");dataMap[cancerType]=isChecked});this.editorActionsManagerRef.updateGenomicDataVisibility(dataMap);this.$el.modal("toggle")},notify:function(data){this.$el.find(".genomicDataContentDiv").empty();var cancerTypes=this.editorActionsManagerRef.genomicDataOverlayManager.visibleGenomicDataMapByType;var sortedKeys=_.keys(this.editorActionsManagerRef.genomicDataOverlayManager.visibleGenomicDataMapByType).sort();if(cancerTypes&&Object.keys(cancerTypes).length===0){this.renderEmptyView()}else{this.$el.find(".genomicDataContentDiv").append('<h4 class="modal-title">Data Set To Show:</h4>');var checkboxDiv=$('<div class="genomicChecboxDiv"></div>');for(var sortedIndex in sortedKeys){var checkboxContent=$('<label class="checkbox"><input type="checkbox" value="">'+sortedKeys[sortedIndex]+"</label>");checkboxContent.find("input").attr("checked",sortedKeys[sortedIndex]);checkboxDiv.append(checkboxContent)}this.$el.find(".genomicDataContentDiv").append(checkboxDiv);this.$el.find("#save-genomic").show()}}});module.exports=genomicDataExplorer},{}],180:[function(require,module,exports){var gridOptionsView=Backbone.View.extend({currentProperties:null,events:{"click #applyGridOptions":"saveProperties"},initialize:function(options){this.defaultGridGuideOptions={snapToGrid:false,discreteDrag:false,guidelines:true,resize:false,gridSpacing:20,parentPadding:false,drawGrid:false,guidelinesStackOrder:4,guidelinesTolerance:2,guidelinesStyle:{lineWidth:2,strokeStyle:"#000000",lineDash:[7,15]}};this.copyProperties(this.defaultGridGuideOptions);cy.gridGuide(this.currentProperties)},copyProperties:function(params){this.currentProperties=_.clone(params)},render:function(){var templateProperties=_.clone(this.currentProperties);this.template=_.template($("#gridOptionsTemplate").html());var tplContent=this.template(templateProperties);this.$el.empty();this.$el.append(tplContent);this.delegateEvents()},saveProperties:function(event){this.currentProperties.gridSpacing=Number(this.$el.find("#gridSize").val());this.currentProperties.drawGrid=this.$el.find("#showGrid").is(":checked");this.currentProperties.guidelines=this.$el.find("#showGuides").is(":checked");this.currentProperties.snapToGrid=this.$el.find("#snapToGrid").is(":checked");this.currentProperties.guidelinesStyle.strokeStyle=this.$el.find('input[type="color"]').val();cy.gridGuide(this.currentProperties);this.$el.modal("toggle")},changeParameters:function(){this.$el.find("#gridSize").val(this.currentProperties.gridSize);this.$el.find("#showGrid")[0].checked=this.currentProperties.showGrid;this.$el.find("#showGuides")[0].checked=this.currentProperties.showGuides;this.$el.find('input[type="color"]').val(this.currentProperties.guidelinesStyle.strokeStyle)},defaultLayoutHandler:function(event){},notify:function(){}});module.exports=gridOptionsView},{}],181:[function(require,module,exports){var layoutProps=Backbone.View.extend({currentLayoutProperties:null,events:{"click #save-layout":"saveLayoutHandler","click #default-layout":"defaultLayoutHandler"},initialize:function(options){this.editorActionsManagerRef=options.editorActionsManager;this.copyProperties(this.editorActionsManagerRef.layoutProperties);this.editorActionsManagerRef.registerObserver(this)},copyProperties:function(params){this.currentLayoutProperties=_.clone(params)},render:function(){var templateProperties=_.clone(this.currentLayoutProperties);this.template=_.template($("#layoutPropertiesTemplate").html());var tplContent=this.template(templateProperties);this.$el.empty();this.$el.append(tplContent);this.delegateEvents()},saveLayoutHandler:function(event){this.currentLayoutProperties.nodeRepulsion=Number(this.$el.find("#node-repulsion").val());this.currentLayoutProperties.nodeOverlap=Number(this.$el.find("#node-overlap").val());this.currentLayoutProperties.idealEdgeLength=Number(this.$el.find("#ideal-edge-length").val());this.currentLayoutProperties.edgeElasticity=Number(this.$el.find("#edge-elasticity").val());this.currentLayoutProperties.nestingFactor=Number(this.$el.find("#nesting-factor").val());this.currentLayoutProperties.gravity=Number(this.$el.find("#gravity").val());this.currentLayoutProperties.numIter=Number(this.$el.find("#num-iter").val());this.currentLayoutProperties.gravityRangeCompound=Number(this.$el.find("#comp-gravRange").val());this.currentLayoutProperties.gravityCompound=Number(this.$el.find("#comp-grav").val());this.currentLayoutProperties.gravityRange=Number(this.$el.find("#grav-range").val());this.currentLayoutProperties.tile=this.$el.find("#tile").is(":checked");this.currentLayoutProperties.animate=this.$el.find("#animate").is(":checked");this.currentLayoutProperties.randomize=!this.$el.find("#randomize").is(":checked");this.editorActionsManagerRef.saveLayoutProperties(this.currentLayoutProperties);this.$el.modal("toggle")},changeParameters:function(){this.$el.find("#node-repulsion").val(this.currentLayoutProperties.nodeRepulsion);this.$el.find("#node-overlap").val(this.currentLayoutProperties.nodeOverlap);this.$el.find("#ideal-edge-length").val(this.currentLayoutProperties.idealEdgeLength);this.$el.find("#edge-elasticity").val(this.currentLayoutProperties.edgeElasticity);this.$el.find("#nesting-factor").val(this.currentLayoutProperties.nestingFactor);this.$el.find("#gravity").val(this.currentLayoutProperties.gravity);this.$el.find("#comp-gravRange").val(this.currentLayoutProperties.gravityRangeCompound);this.$el.find("#comp-grav").val(this.currentLayoutProperties.gravityCompound);this.$el.find("#grav-range").val(this.currentLayoutProperties.gravityRange);this.$el.find("#num-iter").val(this.currentLayoutProperties.numIter);this.$el.find("#tile")[0].checked=this.currentLayoutProperties.tile;this.$el.find("#animate")[0].checked=this.currentLayoutProperties.animate;this.$el.find("#randomize")[0].checked=!this.currentLayoutProperties.randomize},defaultLayoutHandler:function(event){this.copyProperties(this.editorActionsManagerRef.defaultLayoutProperties);this.changeParameters()},notify:function(){this.copyProperties(this.editorActionsManagerRef.layoutProperties);this.changeParameters()}});module.exports=layoutProps},{}],182:[function(require,module,exports){var pathwayDetails=Backbone.View.extend({currentLayoutProperties:null,events:{"click #savePathwayDetails":"saveHandler"},initialize:function(options){this.properties={pathwayName:"pathway.txt",pathwayTitle:"New Pathway",pathwayDescription:""}},saveHandler:function(event){this.properties.pathwayName=this.$el.find("#pName").val();this.properties.pathwayTitle=this.$el.find("#pTitle").val();this.properties.pathwayDescription=this.$el.find("#pDesc").val();this.$el.modal("toggle")},updatePathwayProperties:function(data){this.properties.pathwayName=data.fileName;this.properties.pathwayTitle=data.pathwayTitle;this.properties.pathwayDescription=data.pathwayDescription},copyProperties:function(params){this.currentLayoutProperties=_.clone(params)},render:function(){this.template=_.template($("#pathwayDetailsTemplate").html());var tplContent=this.template(this.properties);this.$el.empty();this.$el.append(tplContent);this.delegateEvents();this.$el.find("input").on("keypress",function(e){if(e.keyCode==13){e.preventDefault()}});return this}});module.exports=pathwayDetails},{}],183:[function(require,module,exports){var WelcomePageView=Backbone.View.extend({cachedTpl:_.template($("#welcomePageTemplate").html()),events:{"click #localUsage":"localUsageHandler","click #collaborativeUsage":"collaborativeUsageHandler","click .continueButton":"continueButtonHandler"},initialize:function(options){this.localUsageCallback=options.localUsageCallback;this.collaborativeUsageCallback=options.collaborativeUsageCallback;this.modelSelectionMap={NONE:-1,LOCAL:0,COLLAB:1};this.modelSelection=this.modelSelectionMap.NONE},render:function(){this.$el.empty();this.$el.append(this.cachedTpl());this.$el.find("#localUsage").popover({container:"body",content:"Create a pathway individually",placement:"left",delay:100,trigger:"manual"});this.$el.find("#collaborativeUsage").popover({container:"body",html:true,content:function(){return $("#collaborativePopoverContent").html()},placement:"right",delay:200,trigger:"manual"})},localUsageHandler:function(event){if(this.modelSelection==this.modelSelectionMap.LOCAL)return;$(".popover").popover("hide");this.$el.find(".welcomePageCheckable").removeClass("active");$(event.currentTarget).addClass("active");this.$el.find("#localUsage").popover("show");this.$el.find(".continueRow").css("visibility","visible");this.modelSelection=this.modelSelectionMap.LOCAL},collaborativeUsageHandler:function(event){if(this.modelSelection==this.modelSelectionMap.COLLAB)return;$(".popover").popover("hide");this.$el.find(".welcomePageCheckable").removeClass("active");$(event.currentTarget).addClass("active");this.$el.find("#collaborativeUsage").popover("show");this.$el.find(".continueRow").css("visibility","visible");this.modelSelection=this.modelSelectionMap.COLLAB},continueButtonHandler:function(event){$(".popover").hide();var self=this;this.$el.find(".welcomePageLoading").show();function postHandler(){self.postSuccess()}if(this.modelSelection!=this.modelSelectionMap.NONE){if(this.modelSelection==this.modelSelectionMap.LOCAL){this.localUsageCallback(postHandler)}else if(this.modelSelection==this.modelSelectionMap.COLLAB){this.collaborativeUsageCallback(postHandler)}}},postSuccess:function(){this.$el.empty();this.$el.fadeOut(800)}});module.exports=WelcomePageView},{}],184:[function(require,module,exports){module.exports=function(){"use strict";var CxtMenu=function(cy,editorActionsManager){this.cy=cy;this.editorActionsManager=editorActionsManager;this.init()};CxtMenu.prototype.init=function(){var classRef=this;var options={menuItems:[{id:"remove",title:"Delete",selector:"node, edge",onClickFunction:function(event){var ele=event.cyTarget;var selectedElements=cy.nodes(":selected").union(ele);classRef.editorActionsManager.removeElement(selectedElements)},disabled:false,hasTrailingDivider:true,coreAsWell:false},{id:"addSelected",title:"Add selected into this",selector:"node",onClickFunction:function(event){var ele=event.cyTarget;var selectedNodes=cy.nodes(":selected");var containerType=ele.data("type");var validNodes=cy.collection();if(ele._private.data["type"]==="GENE"||selectedNodes.size()<1){return}else{var notValid=false;selectedNodes.forEach(function(tmpNode,i){if(ele.id()==tmpNode.id()){notValid=true;return false}if(tmpNode.isParent()){notValid=isChildren(tmpNode,ele);if(notValid){return false}}});if(notValid){return}}selectedNodes.forEach(function(tmpNode,i){if(containerType=="FAMILY"||containerType=="COMPLEX"){if(tmpNode.data("type")!="COMPARTMENT"&&tmpNode.data("type")!="PROCESS"){validNodes=validNodes.add(tmpNode)}}else{validNodes=validNodes.add(tmpNode)}});var compId=ele.id();classRef.editorActionsManager.changeParents(validNodes,compId)},disabled:false,hasTrailingDivider:true,coreAsWell:false},{id:"removeSelected",title:"Remove selected from parent",selector:"node",onClickFunction:function(event){var ele=event.cyTarget;var selectedNodes=cy.nodes(":selected").union(ele);var notValid=false;selectedNodes.forEach(function(tmpNode,i){if(tmpNode.isParent()){notValid=isChildren(tmpNode,ele);if(notValid){return false}}});if(notValid){return}classRef.editorActionsManager.changeParents(selectedNodes,null)},disabled:false,hasTrailingDivider:true,coreAsWell:false},{id:"performLayout",title:"Perform Layout",coreAsWell:true,onClickFunction:function(event){classRef.editorActionsManager.performLayout()},disabled:false,hasTrailingDivider:true}],menuItemClasses:[],contextMenuClasses:[]};this.cy.contextMenus(options)};window.edgeAddingMode=false;function isChildren(node,queryNode){var parent=queryNode.parent()[0];while(parent){if(parent.id()==node.id()){return true}parent=parent.parent()[0]}return false}return CxtMenu}()},{}],185:[function(require,module,exports){module.exports=function($,$$){"use strict";var NodeAdd=function(editorActionsManager){this.editorActionsManager=editorActionsManager;this.initNodeAdd()};NodeAdd.prototype.initNodeAdd=function(){var nodeAddClass=this;var defaults={height:30,width:30,padding:5,backgroundColorDiv:"#fbfbfb",borderColorDiv:"#fff",borderWidthDiv:"0px",borderRadiusDiv:"5px",icon:"",nodeParams:function(){return{}}};$.fn.cytoscapeNodeadd=function(params){var options=$.extend(true,{},defaults,params);var fn=params;var functions={destroy:function(){var $this=$(this);$this.find(".ui-cytoscape-nodeadd").remove()},init:function(){return $(this).each(function(){var components=options.components;for(var index in components){var component=components[index];var dragContainer=component.container;var explanationText=component.explanationText;var $nodeadd=$('<div class="ui-cytoscape-nodeadd"></div>');dragContainer.append($nodeadd);var $nodeDragHandle=$('<div class="ui-cytoscape-nodeadd-nodediv">                                                 <span id="ui-cytoscape-nodeadd-icon" class="draggable" nodeType="'+component.nodeType+'">                                                  <img style="width:110px;" src="./assets/'+component.nodeType+'.png" alt="" />                                                </span>                                              </div>');$nodeadd.append($nodeDragHandle);$nodeDragHandle.bind("mousedown",function(e){e.stopPropagation();e.preventDefault()});dragContainer.find(".ui-cytoscape-nodeadd-nodediv").css({background:options.backgroundColorDiv,border:options.borderWidthDiv+" solid "+options.borderColorDiv,"border-radius":options.borderRadiusDiv});dragContainer.find("#ui-cytoscape-nodeadd-icon").draggable({helper:"clone",cursor:"pointer"})}var $container=$(this);$container.droppable({activeClass:"ui-state-highlight",drop:function(event,ui){$container.removeClass("ui-state-highlight");var currentOffset=$container.offset();var relX=event.pageX-currentOffset.left;var relY=event.pageY-currentOffset.top;var nodeType=$(ui.helper).attr("nodeType").toUpperCase();var cy=$container.cytoscape("get");var nodeMap={};var parentMap={};cy.nodes().forEach(function(node,i){var nodeBbox=node.renderedBoundingBox();if(relX<=nodeBbox.x2&&relX>=nodeBbox.x1&&(relY<=nodeBbox.y2&&relY>=nodeBbox.y1)&&node.data().type!="GENE"){if(node.children().length>0){parentMap[node.id()]=true}if(parentMap[node._private.data.parent]){delete nodeMap[node._private.data.parent]}nodeMap[node.id()]=node}});var parent=nodeMap[Object.keys(nodeMap)[0]];var nodeData={type:nodeType,name:"New "+$(ui.helper).attr("nodeType")};if(parent){if(parent.data().type=="FAMILY"||parent.data().type=="COMPLEX"){if(nodeType!="COMPARTMENT"&&nodeType!="PROCESS"){nodeData.parent=parent.id()}}else{nodeData.parent=parent.id()}}relX=relX/cy.zoom()+cy.extent().x1;relY=relY/cy.zoom()+cy.extent().y1;nodeAddClass.editorActionsManager.addNode(nodeData,{x:relX,y:relY})}})})}};if(functions[fn]){return functions[fn].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof fn=="object"||!fn){return functions.init.apply(this,arguments)}else{$.error("No such function `"+fn+"` for jquery.cytoscapenodeadd")}return $(this)};$.fn.cynodeadd=$.fn.cytoscapeNodeadd;$$("core","nodeadd",function(options){var cy=this;$(cy.container()).cytoscapeNodeadd(options)})};return NodeAdd}(window.$,window.cytoscape)},{}],186:[function(require,module,exports){var edgeHandleDefaults={preview:true,stackOrder:4,handleSize:10,handleColor:"#1abc9c",handleLineType:"ghost",handleLineWidth:1,handleNodes:"node",hoverDelay:1,cxt:false,enabled:false,toggleOffOnLeave:true,edgeType:function(sourceNode,targetNode){return"flat"},loopAllowed:function(node){return false},nodeLoopOffset:-50,nodeParams:function(sourceNode,targetNode){return{}},edgeParams:function(sourceNode,targetNode,i){return{}},start:function(sourceNode){var type=this.getGlobalEdgeType();cy.edgehandles("option","ghostEdgeType",type)},complete:function(sourceNode,targetNodes,addedEntities){cy.remove(addedEntities);window.editorActionsManager.addEdge({source:sourceNode.id(),target:targetNodes[0].id(),type:this.getGlobalEdgeType(),pubmedIDs:[]})},stop:function(sourceNode){$(".edge-palette a").blur().removeClass("active");window.edgeAddingMode==-1;cy.edgehandles("disable")},getGlobalEdgeType:function(){var type="NONE";if(window.edgeAddingMode==1){type="ACTIVATES"}else if(window.edgeAddingMode==2){type="INHIBITS"}else if(window.edgeAddingMode==3){type="INDUCES"}else if(window.edgeAddingMode==4){type="REPRESSES"}else if(window.edgeAddingMode==5){type="BINDS"}return type}};module.exports=edgeHandleDefaults},{}],187:[function(require,module,exports){var GenomicDataOverlayManager=require("./GenomicDataOverlayManager.js");var SVGExporter=require("./SVGExporter.js");module.exports=function(){"use strict";var EditorActionsManager=function(isCollaborative,realtimeManager,cyInst){this.cy=cyInst;this.isCollaborative=isCollaborative;if(this.isCollaborative&&realtimeManager)this.realTimeManager=realtimeManager;this.defaultLayoutProperties={name:"cose-bilkent",nodeRepulsion:4500,nodeOverlap:10,idealEdgeLength:50,edgeElasticity:.45,nestingFactor:.1,gravity:.15,numIter:2500,tile:true,animate:"end",randomize:false,gravityRangeCompound:1.5,gravityCompound:1,gravityRange:1.5};this.FIT_CONSTANT=50;this.layoutProperties=_.clone(this.defaultLayoutProperties);this.observers=[];this.genomicDataOverlayManager=new GenomicDataOverlayManager;this.svgExporter=new SVGExporter;this.selecteNodeStack={};window.undoRedoManager=cy.undoRedo();window.undoRedoManager.action("changePositions",this.doChangePosition,this.undoChangePosition);window.undoRedoManager.action("changeName",this.doChangename,this.undoChangeName);window.undoRedoManager.action("highlightInvalidGenes",this.doHighlightInvalidGenes,this.undoHighlightInvalidGenes);window.undoRedoManager.action("removeHighlightInvalidGenes",this.undoHighlightInvalidGenes,this.doHighlightInvalidGenes)};EditorActionsManager.prototype.highlightInvalidGenesInitially=function(invalidGenesIDs){for(var i in invalidGenesIDs){cy.$("#"+invalidGenesIDs[i]).addClass("invalidGeneHighlight")}};EditorActionsManager.prototype.doHighlightInvalidGenes=function(args){args.addClass("invalidGeneHighlight");return args};EditorActionsManager.prototype.undoHighlightInvalidGenes=function(args){args.removeClass("invalidGeneHighlight");return args};EditorActionsManager.prototype.doChangename=function(args){var currentName=args.node.data("name");var newArgs={node:args.node,newName:args.newName,oldName:currentName};args.node.data("name",args.newName);args.node.css("content",args.newName);return newArgs};EditorActionsManager.prototype.undoChangeName=function(args){var currentName=args.node.data("name");var newArgs={node:args.node,newName:args.oldName,oldName:currentName};args.node.data("name",args.oldName);args.node.css("content",args.oldName);return newArgs};EditorActionsManager.prototype.doChangePosition=function(movedNodes){var newMovedNodes=[];for(var i=0;i<movedNodes.length;i++){var currentNodePosition={x:movedNodes[i].node.position().x,y:movedNodes[i].node.position().y};newMovedNodes.push({node:movedNodes[i].node,oldPosition:currentNodePosition,nextPosition:movedNodes[i].nextPosition});movedNodes[i].node.position(movedNodes[i].nextPosition)}return newMovedNodes};EditorActionsManager.prototype.undoChangePosition=function(movedNodes){var newMovedNodes=[];for(var i=0;i<movedNodes.length;i++){var currentNodePosition={x:movedNodes[i].node.position().x,y:movedNodes[i].node.position().y};newMovedNodes.push({node:movedNodes[i].node,oldPosition:movedNodes[i].oldPosition,nextPosition:currentNodePosition});movedNodes[i].node.position(movedNodes[i].oldPosition)}return newMovedNodes};EditorActionsManager.prototype.postLayout=function(){if(this.isCollaborative){this.moveElements(cy.nodes());var newState={zoomLevel:cy.zoom(),panLevel:cy.pan()};this.updateGlobalOptions(newState)}};EditorActionsManager.prototype.addPubmedIDs=function(edge,pubmedIDs){if(this.isCollaborative){this.realTimeManager.addPubmedIDs(edge.id(),pubmedIDs)}else{var pubmedArray=edge.data("pubmedIDs");var validPubmedIDs=_.filter(pubmedIDs,function(id){return!isNaN(id)});pubmedArray.push.apply(pubmedArray,validPubmedIDs);pubmedArray=edge.data("pubmedIDs");edge.data("pubmedIDs",_.uniq(pubmedArray))}};EditorActionsManager.prototype.removePubmedID=function(edge,pubmedIDs){if(this.isCollaborative){this.realTimeManager.removePubmedID(edge.id(),pubmedIDs)}else{var pubmedArray=edge.data("pubmedIDs");edge.data("pubmedIDs",_.difference(pubmedArray,pubmedIDs))}};EditorActionsManager.prototype.getGeneSymbols=function(){var geneSymbols=[];this.cy.nodes().forEach(function(gene){if(gene.data().type==="GENE")geneSymbols.push(gene.data().name)});return geneSymbols};EditorActionsManager.prototype.validateGenes=function(){var geneSymbols=this.getGeneSymbols();window.portalAccessor.validateGenes(geneSymbols)};EditorActionsManager.prototype.removeInvalidGeneHighlights=function(){if(this.isCollaborative){var geneIDs=[];this.cy.nodes().forEach(function(gene){if(gene.data().type==="GENE"){if(gene.hasClass("invalidGeneHighlight"))geneIDs.push(gene.id())}});this.realTimeManager.changeHighlight(geneIDs,false)}else{window.undoRedoManager.do("removeHighlightInvalidGenes",cy.nodes())}};EditorActionsManager.prototype.highlightInvalidGenes=function(validGeneSymbols){if(this.isCollaborative){var invalidGenes=[];this.cy.nodes().forEach(function(gene){if(gene.data().type==="GENE"){var geneName=gene.data().name;if(validGeneSymbols.indexOf(geneName)<0)invalidGenes.push(gene.id())}});this.realTimeManager.changeHighlight(invalidGenes,true);if(invalidGenes.length>0)window.notificationManager.createNotification("Invalid genes are highlighted","fail");else window.notificationManager.createNotification("All gene symbols are valid","success")}else{var highlightedGenes=cy.collection();this.cy.nodes().forEach(function(gene){if(gene.data().type==="GENE"){var geneName=gene.data().name;if(validGeneSymbols.indexOf(geneName)<0)highlightedGenes=highlightedGenes.add(gene)}});if(highlightedGenes.size()>0)window.notificationManager.createNotification("Invalid genes are highlighted","fail");else window.notificationManager.createNotification("All gene symbols are valid","success");window.undoRedoManager.do("highlightInvalidGenes",highlightedGenes)}};EditorActionsManager.prototype.pushSelectedNodeStack=function(ele){this.selecteNodeStack[ele.id()]=ele};EditorActionsManager.prototype.removeElementFromSelectedNodeStack=function(ele){var nodeID=ele.id();if(nodeID in this.selecteNodeStack)delete this.selecteNodeStack[ele.id()]};EditorActionsManager.prototype.clearSelectedNodeStack=function(){this.selecteNodeStack={}};EditorActionsManager.prototype.exportSVG=function(){return this.svgExporter.exportGraph(this.cy.nodes(),this.cy.edges())};EditorActionsManager.prototype.registerObserver=function(observer){this.observers.push(observer)};EditorActionsManager.prototype.notifyObservers=function(){for(var i in this.observers){var observer=this.observers[i];observer.notify()}};EditorActionsManager.prototype.registerGenomicDataObserver=function(observer){this.genomicDataOverlayManager.registerObserver(observer)};EditorActionsManager.prototype.updateGenomicDataVisibility=function(dataMap){if(this.isCollaborative){this.realTimeManager.addGenomicVisibilityData(dataMap)}else{for(var _key in dataMap){this.genomicDataOverlayManager.updateGenomicDataVisibility(_key,dataMap[_key])}this.genomicDataOverlayManager.showGenomicData()}};EditorActionsManager.prototype.getGlobalOptions=function(){return{zoomLevel:cy.zoom(),panLevel:cy.pan()}};EditorActionsManager.prototype.changeGlobalOptions=function(globalOptions){cy.zoom(globalOptions.zoomLevel);cy.pan(globalOptions.panLevel)};EditorActionsManager.prototype.updateGlobalOptions=function(newOptions){if(this.isCollaborative)this.realTimeManager.updateGlobalOptions(newOptions)};EditorActionsManager.prototype.saveLayoutProperties=function(newLayoutProps){if(this.isCollaborative){this.realTimeManager.updateLayoutProperties(newLayoutProps)}else{this.layoutProperties=_.clone(newLayoutProps)}};EditorActionsManager.prototype.updateLayoutPropertiesCallback=function(newLayoutProps){this.layoutProperties=_.clone(newLayoutProps);this.notifyObservers()};EditorActionsManager.prototype.performLayout=function(){window.undoRedoManager.do("layout",{options:this.layoutProperties,eles:null,zoom:cy.zoom(),pan:cy.pan()})};EditorActionsManager.prototype.addNode=function(nodeData,posData){if(this.isCollaborative){this.addNewNodeToRealTime(nodeData,posData)}else{this.addNodetoCy(nodeData,posData)}};EditorActionsManager.prototype.addNodes=function(nodes){for(var i in nodes){this.addNode(nodes[i].data,nodes[i].position)}};EditorActionsManager.prototype.addNodesCy=function(nodes){var nodeArr=[];for(var i in nodes){var nodeData=nodes[i].data;var posData=nodes[i].position;var newNode={group:"nodes",data:nodeData};if(nodeData.parent===undefined){delete newNode.data.parent}if(posData){newNode.position={x:posData.x,y:posData.y}}nodeArr[i]=newNode}this.cy.add(nodeArr);this.cy.nodes().updateCompoundBounds()};EditorActionsManager.prototype.addNodetoCy=function(nodeData,posData){var newNode={group:"nodes",data:nodeData};if(nodeData.parent===undefined){delete newNode.data.parent}if(posData){newNode.position={x:posData.x,y:posData.y}}this.cy.nodes().updateCompoundBounds();window.undoRedoManager.do("add",newNode)};EditorActionsManager.prototype.realTimeNodeAddRemoveEventCallBack=function(event){var node=event.newValue;var nodeID=event.property;if(node===null){var cyEle=this.cy.$("#"+nodeID);this.removeElementCy(cyEle);this.cy.nodes().updateCompoundBounds()}else{this.addNewNodeLocally(node)}};EditorActionsManager.prototype.addNewNodeLocally=function(realtimeNode){var nodeID=this.realTimeManager.getCustomObjId(realtimeNode);var nodeData={id:nodeID,type:realtimeNode.type,name:realtimeNode.name,parent:realtimeNode.parent};if(realtimeNode.x!="undefined"&&realtimeNode.y!="undefined"){this.addNodetoCy(nodeData,{x:realtimeNode.x,y:realtimeNode.y})}else{this.addNodetoCy(nodeData)}this.cy.nodes().updateCompoundBounds()};EditorActionsManager.prototype.addNewNodeToRealTime=function(nodeData,posData){this.realTimeManager.addNewNode(nodeData,posData)};EditorActionsManager.prototype.addEdge=function(edgeData){if(this.isCollaborative){this.addNewEdgeRealTime(edgeData)}else{this.addNewEdgetoCy(edgeData)}};EditorActionsManager.prototype.addEdges=function(edges){for(var i in edges){this.addEdge(edges[i].data)}};EditorActionsManager.prototype.addEdgesCy=function(edges){var newEdges=[];for(var i in edges){var newEdge={group:"edges",data:edges[i].data};newEdges.push(newEdge)}cy.add(newEdges)};EditorActionsManager.prototype.addNewEdgeRealTime=function(edgeData){this.realTimeManager.addNewEdge(edgeData)};EditorActionsManager.prototype.addNewEdgetoCy=function(edgeData){var newEdge={group:"edges",data:edgeData};window.undoRedoManager.do("add",newEdge)};EditorActionsManager.prototype.realTimeEdgeAddRemoveEventCallBack=function(event){var edge=event.newValue;var edgeID=event.property;if(edge===null){var cyEle=this.cy.$("#"+edgeID);this.removeElementCy(cyEle)}else{this.addNewEdgeLocally(edge)}};EditorActionsManager.prototype.addNewElementsLocally=function(realTimeNodeArray,realTimeEdgeArray){var nodeList=[];var nodeMap={};for(var i in realTimeNodeArray){var realTimeNode=realTimeNodeArray[i];var nodeID=this.realTimeManager.getCustomObjId(realTimeNode);var nodeData={group:"nodes",data:{id:nodeID,type:realTimeNode.type,name:realTimeNode.name,parent:realTimeNode.parent}};if(nodeData.data.parent===undefined){delete nodeData.data.parent}if(realTimeNode.x&&realTimeNode.y){nodeData.position={x:realTimeNode.x,y:realTimeNode.y}}nodeMap[nodeID]=nodeData;nodeList.push(nodeData)}var edgeList=[];for(var i in realTimeEdgeArray){var edge=realTimeEdgeArray[i];var edgeID=this.realTimeManager.getCustomObjId(edge);if(!(edge.source in nodeMap&&edge.target in nodeMap))continue;var edgeData={group:"edges",data:{id:edgeID,type:edge.type,source:edge.source,target:edge.target,pubmedIDs:edge.pubmedIDs.asArray()}};edgeList.push(edgeData)}this.cy.add(nodeList);this.cy.add(edgeList);this.cy.nodes().updateCompoundBounds()};EditorActionsManager.prototype.addNewEdgeLocally=function(edge){var edgeID=this.realTimeManager.getCustomObjId(edge);var edgeData={id:edgeID,type:edge.type,source:edge.source,target:edge.target,pubmedIDs:edge.pubmedIDs.asArray()};this.addNewEdgetoCy(edgeData)};EditorActionsManager.prototype.removeElement=function(ele){if(this.isCollaborative){this.removeElementsFromRealTime(ele)}else{this.removeElementsCy(ele)}};EditorActionsManager.prototype.removeElementCy=function(ele){window.undoRedoManager.do("remove",ele)};EditorActionsManager.prototype.removeElementsCy=function(ele){window.undoRedoManager.do("remove",ele)};EditorActionsManager.prototype.removeElementsFromRealTime=function(eles){var self=this;eles.forEach(function(ele,i){self.realTimeManager.removeElement(ele.id())})};EditorActionsManager.prototype.removeElementFromRealTime=function(ele){this.realTimeManager.removeElement(ele.id())};EditorActionsManager.prototype.changeParents=function(eles,newParentId){if(this.isCollaborative){this.changeParentRealTime(eles,newParentId)}else{var parentData=newParentId?newParentId:null;var param={firstTime:true,parentData:parentData,nodes:eles,posDiffX:0,posDiffY:0};window.undoRedoManager.do("changeParent",param)}};EditorActionsManager.prototype.changeParentCy=function(eles,newParentId){var lockedNodes={};var self=this;function removeNodes(nodes){var removedEles=nodes.connectedEdges().remove();var children=nodes.children();if(children!=null&&children.length>0){children.forEach(function(childNode,i){lockedNodes[childNode.id()]=true});removedEles=removedEles.union(removeNodes(children))}removedEles=removedEles.union(nodes.remove());self.cy.nodes().updateCompoundBounds();return removedEles}var removedEles=removeNodes(eles);window.undoRedoManager.do("remove",removedEles);for(var i=0;i<removedEles.length;i++){var removedNode=removedEles[i];if(removedNode.isEdge()||lockedNodes[removedNode.id()]){continue}removedNode._private.data.parent=newParentId;if(removedNode._private.parent){delete removedNode._private.parent}}self.cy.add(removedEles);window.undoRedoManager.do("add",removedEles);self.cy.nodes().updateCompoundBounds()};EditorActionsManager.prototype.changeParentRealTime=function(eles,newParentId){var classRef=this;function getTopLevelParents(eles){var tpMostNodes=classRef.cy.collection();var parentMap={};eles.forEach(function(node,index){if(node.isParent())parentMap[node.id()]=node});eles.forEach(function(node,index){var nodeParent=node.parent();if(parentMap[nodeParent.id()]===undefined)tpMostNodes=tpMostNodes.union(node)});return tpMostNodes}var NodeObj=function(nodeObj){this.nodeRef=nodeObj;this.children=[]};var connectedEdges=eles.connectedEdges();function traverseNodes(eles,rootNodeObj){eles.forEach(function(ele,index){connectedEdges=connectedEdges.union(ele.connectedEdges());if(ele.isParent()){rootNodeObj.children.push(new NodeObj(ele));var lengthOfChildrenArray=rootNodeObj.children.length;traverseNodes(ele.children(),rootNodeObj.children[lengthOfChildrenArray-1])}else{rootNodeObj.children.push(new NodeObj(ele))}})}var topMostNodes=getTopLevelParents(eles);var rootNodeR=new NodeObj(null);traverseNodes(topMostNodes,rootNodeR);this.realTimeManager.changeParent(rootNodeR,newParentId,connectedEdges)};EditorActionsManager.prototype.moveElements=function(ele,position){var classRef=this;if(this.isCollaborative){ele.forEach(function(ele,index){classRef.realTimeManager.moveElement(ele)})}};EditorActionsManager.prototype.handleChangePositionByAlignment=function(movedNodeArr){window.undoRedoManager.do("changePositions",movedNodeArr)};EditorActionsManager.prototype.mergeGraph=function(nodes,edges){if(this.isCollaborative){this.realTimeManager.mergeGraph(nodes,edges)}else{this.mergeGraphCy(nodes,edges)}this.fitGraph()};EditorActionsManager.prototype.mergeGraphCy=function(nodes,edges){var nodesToBeAdded=[];var edgesToBeAdded=[];var nodeMap={};for(var index in nodes){var ele=nodes[index];nodeMap[ele.data.id]=ele;if(cy.filter('node[name = "'+ele.data.name+'"]').length<=0){delete ele.data.id;nodesToBeAdded.push(ele)}}cy.add(nodesToBeAdded);for(var index in edges){var ele=edges[index];var sourceNode=nodeMap[ele.data.source];var targetNode=nodeMap[ele.data.target];var cySourceNode=cy.nodes('[name="'+sourceNode.data.name+'"]');var cyTargetNode=cy.nodes('[name="'+targetNode.data.name+'"]');if(cySourceNode.length>0){ele.data.source=cySourceNode.id()}if(cyTargetNode.length>0){ele.data.target=cyTargetNode.id()}if(cyTargetNode.length<0&&cySourceNode.length<0){continue}var edgesBtw=cy.filter('edge[source = "'+cySourceNode.id()+'"][target = "'+cyTargetNode.id()+'"]');var isFound=false;edgesBtw.forEach(function(edge,i){if(edge.data().type==ele.data.type){isFound=true;return false}});if(!isFound){delete ele.data.id;edgesToBeAdded.push(ele)}}cy.add(edgesToBeAdded)};EditorActionsManager.prototype.fitGraph=function(){if(this.isCollaborative){cy.fit(this.FIT_CONSTANT);var newState={zoomLevel:cy.zoom(),panLevel:cy.pan()};this.updateGlobalOptions(newState)}else{cy.fit(this.FIT_CONSTANT)}};EditorActionsManager.prototype.loadFile=function(nodes,edges){if(this.isCollaborative){this.loadfileRealTime(nodes,edges)}else{this.loadFileCy(nodes,edges)}this.fitGraph()};EditorActionsManager.prototype.loadFileCy=function(nodes,edges){this.removeElementCy(cy.elements());this.addNodesCy(nodes);this.addEdgesCy(edges)};EditorActionsManager.prototype.loadfileRealTime=function(nodes,edges){this.realTimeManager.loadGraph(nodes,edges)};EditorActionsManager.prototype.removeAllElements=function(){if(this.isCollaborative){this.realTimeManager.removeAllElements()}else{cy.remove(cy.elements())}};EditorActionsManager.prototype.changeName=function(ele,newName){if(this.isCollaborative){this.realTimeManager.changeName(ele,newName)}else{this.changeNameCy(ele,newName)}};EditorActionsManager.prototype.changeNameCy=function(ele,newName){var currentName=ele.data("name");var args={node:ele,oldName:currentName,newName:newName};window.undoRedoManager.do("changeName",args)};EditorActionsManager.prototype.updateElementCallback=function(ele,id){var eleID=id;var cyEle=this.cy.$("#"+eleID);if(cyEle.isNode()){cyEle.position({x:ele.x,y:ele.y});this.changeNameCy(cyEle,ele.name);if(ele.isInvalidGene){window.undoRedoManager.do("highlightInvalidGenes",cyEle)}else{window.undoRedoManager.do("removeHighlightInvalidGenes",cyEle)}}else if(cyEle.isEdge()){var pubmedArray=ele.pubmedIDs.asArray();console.log(pubmedArray);cyEle.data("pubmedIDs",pubmedArray)}};EditorActionsManager.prototype.getGenomicDataSVG=function(node){return this.genomicDataOverlayManager.generateSVGForNode(node)};EditorActionsManager.prototype.removeGenomicData=function(){if(this.isCollaborative){this.realTimeManager.clearGenomicData();this.realTimeManager.clearGenomicVisData()}else{this.genomicDataOverlayManager.removeGenomicData();this.genomicDataOverlayManager.removeGenomicVisData();this.genomicDataOverlayManager.hideGenomicData();this.genomicDataOverlayManager.notifyObservers()}};EditorActionsManager.prototype.addGenomicData=function(genomicData){if(this.isCollaborative){var parsedGenomicData=this.genomicDataOverlayManager.prepareGenomicDataRealTime(genomicData);this.realTimeManager.addGenomicData(parsedGenomicData.genomicDataMap);this.realTimeManager.addGenomicVisibilityData(parsedGenomicData.visibilityMap)}else{this.genomicDataOverlayManager.addGenomicDataLocally(genomicData)}};EditorActionsManager.prototype.addPortalGenomicData=function(genomicData){if(this.isCollaborative){var parsedGenomicData=this.genomicDataOverlayManager.preparePortalGenomicDataRealTime(genomicData);this.realTimeManager.addGenomicData(parsedGenomicData.genomicDataMap);this.realTimeManager.addGenomicVisibilityData(parsedGenomicData.visibilityMap)}else{this.genomicDataOverlayManager.addPortalGenomicData(genomicData)}};EditorActionsManager.prototype.realTimeGenomicDataHandler=function(event){var newData=event.newValue;var geneSymbol=event.property;if(newData){this.genomicDataOverlayManager.addGenomicData(geneSymbol,newData)}else{this.genomicDataOverlayManager.removeGenomicData(geneSymbol)}};EditorActionsManager.prototype.realTimeGenomicDataVsibilityHandler=function(event){var data=event.newValue;var key=event.property;if(data!=undefined){this.genomicDataOverlayManager.addGenomicVisData(key,data)}else{this.genomicDataOverlayManager.removeGenomicVisData(data)}this.genomicDataOverlayManager.showGenomicData();this.genomicDataOverlayManager.notifyObservers()};return EditorActionsManager}()},{"./GenomicDataOverlayManager.js":189,"./SVGExporter.js":199}],188:[function(require,module,exports){var SaveLoadUtilities=require("./SaveLoadUtility.js");module.exports=function($){"use strict";function b64toBlob(b64Data,contentType,sliceSize){contentType=contentType||"";sliceSize=sliceSize||512;var byteCharacters=atob(b64Data);var byteArrays=[];for(var offset=0;offset<byteCharacters.length;offset+=sliceSize){var slice=byteCharacters.slice(offset,offset+sliceSize);var byteNumbers=new Array(slice.length);for(var i=0;i<slice.length;i++){byteNumbers[i]=slice.charCodeAt(i)}var byteArray=new Uint8Array(byteNumbers);byteArrays.push(byteArray)}var blob=new Blob(byteArrays,{type:contentType});return blob}function saveAsJPEG(){var graphData=cy.jpeg();var b64data=graphData.substr(graphData.indexOf(",")+1);var imageData=b64toBlob(b64data,"image/jpeg");var blob=new Blob([imageData]);saveAs(blob,"pathway.jpg")}function saveAsPNG(){var graphData=cy.png();var b64data=graphData.substr(graphData.indexOf(",")+1);var imageData=b64toBlob(b64data,"image/png");var blob=new Blob([imageData]);saveAs(blob,"pathway.png")}function saveGraph(isSIFNX){var pathwayData=getPathwayData();pathwayData.graphJSON=cy.json();var returnString=isSIFNX?SaveLoadUtilities.exportAsSIFNX(pathwayData):SaveLoadUtilities.exportGraph(pathwayData);var blob=new Blob([returnString],{type:"text/plain;charset=utf-8"});saveAs(blob,pathwayData.fileName)}function getPathwayData(){var pathwayData={fileName:$("#pName").val(),pathwayTitle:$("#pTitle").val(),pathwayDescription:$("#pDesc").val()};return pathwayData}function changePathwayDetails(pathwayData){window.appManager.pathwayDetailsView.updatePathwayProperties(pathwayData)}function sampleFileRequestHandler(){var request=new XMLHttpRequest;request.onreadystatechange=function(){if(request.readyState===XMLHttpRequest.DONE&&request.status===200){var graphData=SaveLoadUtilities.parseGraph(request.responseText);window.editorActionsManager.loadFile(graphData.nodes,graphData.edges);changePathwayDetails({fileName:graphData.name,pathwayTitle:graphData.title,pathwayDescription:graphData.description});resetUndoStack()}};request.open("GET","/sampleGraph");request.send()}$("#saveGraphBtn").on("click",function(evt){saveGraph()});$("#loadGraphBtn").on("click",function(evt){$("#fileinput").attr("value","");$("#fileinput").trigger("click")});$("#fileinput").on("change",function(){var file=this.files[0];var formData=new FormData;formData.append("graphFile",file);var request=new XMLHttpRequest;request.onreadystatechange=function(){if(request.readyState===XMLHttpRequest.DONE&&request.status===200){var graphData=SaveLoadUtilities.parseGraph(request.responseText);window.editorActionsManager.loadFile(graphData.nodes,graphData.edges);changePathwayDetails({fileName:file.name,pathwayTitle:graphData.title,pathwayDescription:graphData.description});resetUndoStack()}};request.open("POST","/loadGraph");request.send(formData);$("#fileinput").val(null)});$("#mergeInput").on("change",function(){var file=this.files[0];var formData=new FormData;formData.append("graphFile",file);var request=new XMLHttpRequest;request.onreadystatechange=function(){if(request.readyState===XMLHttpRequest.DONE&&request.status===200){var graphData=SaveLoadUtilities.parseGraph(request.responseText);window.editorActionsManager.mergeGraph(graphData.nodes,graphData.edges);resetUndoStack()}};request.open("POST","/loadGraph");request.send(formData);$("#mergeInput").val(null)});$("#pathwayDetailsBtn").on("click",function(evt){window.appManager.pathwayDetailsView.render();$("#pathwayDetailsDiv").modal("show")});$(".fileDropDown li a").click(function(event){event.preventDefault();var dropdownLinkRole=$(event.target).attr("role");if(dropdownLinkRole=="save"){saveGraph(false)}else if(dropdownLinkRole=="sifnx"){saveGraph(true)}else if(dropdownLinkRole=="load"){$("#fileinput").trigger("click")}else if(dropdownLinkRole=="details"){$("#pathwayDetailsBtn").trigger("click")}else if(dropdownLinkRole=="sample"){sampleFileRequestHandler()}else if(dropdownLinkRole=="new"){window.editorActionsManager.removeAllElements();resetUndoStack()}else if(dropdownLinkRole=="merge"){$("#mergeInput").trigger("click")}else if(dropdownLinkRole=="jpeg"){saveAsJPEG()}else if(dropdownLinkRole=="png"){saveAsPNG()}else if(dropdownLinkRole=="svg"){var returnString=window.editorActionsManager.exportSVG();var fileName="pathway.svg";var blob=new Blob([returnString],{type:"text/plain;charset=utf-8"});saveAs(blob,fileName)}});$("#fileinput").on("change",function(){var file=this.files[0];var formData=new FormData;formData.append("graphFile",file);var request=new XMLHttpRequest;request.onreadystatechange=function(){if(request.readyState===XMLHttpRequest.DONE&&request.status===200){var graphData=SaveLoadUtilities.parseGraph(request.responseText);window.editorActionsManager.loadFile(graphData.nodes,graphData.edges);changePathwayDetails({fileName:file.name,pathwayTitle:graphData.title,pathwayDescription:graphData.description})}};request.open("POST","/loadGraph");request.send(formData);$("#fileinput").val(null)});function resetUndoStack(){window.undoRedoManager.reset()}}(window.$)},{"./SaveLoadUtility.js":200}],189:[function(require,module,exports){module.exports=function(){var GenomicDataOverlayManager=function(){this.cancerTypes=[];this.genomicDataMap={};this.visibleGenomicDataMapByType={};this.DEFAULT_VISIBLE_GENOMIC_DATA_COUNT=3;this.observers=[]};GenomicDataOverlayManager.prototype.addGenomicDataLocally=function(genomicData){this.parseGenomicData(genomicData);this.showGenomicData();this.notifyObservers()};GenomicDataOverlayManager.prototype.preparePortalGenomicDataRealTime=function(genomicData){console.log(genomicData);var geneMap={};var visMap={};for(var cancerKey in genomicData){for(var geneSymbol in genomicData[cancerKey]){geneMap[geneSymbol]={};geneMap[geneSymbol][cancerKey]=genomicData[cancerKey][geneSymbol]}visMap[cancerKey]=true}return{genomicDataMap:geneMap,visibilityMap:visMap}};GenomicDataOverlayManager.prototype.removeGenomicData=function(){this.genomicDataMap={}};GenomicDataOverlayManager.prototype.addGenomicData=function(data){this.genomicDataMap=data};GenomicDataOverlayManager.prototype.removeGenomicVisData=function(){this.visibleGenomicDataMapByType={}};GenomicDataOverlayManager.prototype.addGenomicData=function(geneSymbol,data){this.genomicDataMap[geneSymbol]=data};GenomicDataOverlayManager.prototype.addPortalGenomicData=function(data){for(var cancerStudy in data){this.visibleGenomicDataMapByType[cancerStudy]=true;var cancerData=data[cancerStudy];for(var geneSymbol in cancerData){if(this.genomicDataMap[geneSymbol]==undefined)this.genomicDataMap[geneSymbol]={};this.genomicDataMap[geneSymbol][cancerStudy]=data[cancerStudy][geneSymbol].toFixed(2)}}this.showGenomicData();this.notifyObservers()};GenomicDataOverlayManager.prototype.removeGenomicData=function(geneSymbol){this.genomicDataMap[geneSymbol]={}};GenomicDataOverlayManager.prototype.addGenomicVisData=function(key,data){this.visibleGenomicDataMapByType[key]=data};GenomicDataOverlayManager.prototype.prepareGenomicDataRealTime=function(genomicData){var genomicDataMap={};var cancerTypes=[];var visibleGenomicDataMapByType={};var lines=genomicData.split("\n");var metaLineColumns=lines[0].split("\t");for(var i=1;i<metaLineColumns.length;i++){cancerTypes.push(metaLineColumns[i]);if(i-1<this.DEFAULT_VISIBLE_GENOMIC_DATA_COUNT)visibleGenomicDataMapByType[cancerTypes[i-1]]=true;else visibleGenomicDataMapByType[cancerTypes[i-1]]=false}for(var i=1;i<lines.length;i++){if(lines[i].length==0)break;var lineContent=lines[i].split("\t");var geneSymbol=lineContent[0];if(!(geneSymbol in genomicDataMap))genomicDataMap[geneSymbol]={};for(var j=1;j<lineContent.length;j++){genomicDataMap[geneSymbol][cancerTypes[j-1]]=lineContent[j]}}var returnObj={genomicDataMap:genomicDataMap,visibilityMap:visibleGenomicDataMapByType};return returnObj};GenomicDataOverlayManager.prototype.updateGenomicDataVisibility=function(_key,isVisible){if(_key in this.visibleGenomicDataMapByType)this.visibleGenomicDataMapByType[_key]=isVisible};GenomicDataOverlayManager.prototype.hideGenomicData=function(){cy.style().selector('node[type="GENE"]').style("text-margin-y",0).style("width",function(ele){return 150}).style("background-image",function(ele){var dataURI="data:image/svg+xml,";return dataURI}).update()};GenomicDataOverlayManager.prototype.countVisibleGenomicDataByType=function(){var genomicDataBoxCount=0;for(var cancerType in this.visibleGenomicDataMapByType){if(this.visibleGenomicDataMapByType[cancerType])genomicDataBoxCount++}return genomicDataBoxCount};GenomicDataOverlayManager.prototype.generateSVGForNode=function(ele){var genomicDataBoxCount=this.countVisibleGenomicDataByType();var dataURI="data:image/svg+xml,";var svgNameSpace="http://www.w3.org/2000/svg";var nodeLabel=ele.data("name");if(!(nodeLabel in this.genomicDataMap))return dataURI;var eleBBox=ele.boundingBox();var reqWidth=getRequiredWidthForGenomicData(genomicDataBoxCount);var overlayRecBoxW=reqWidth-10;var overlayRecBoxH=25;var svg=document.createElementNS(svgNameSpace,"svg");svg.setAttribute("width",reqWidth);svg.setAttribute("height",eleBBox.h);svg.setAttribute("xmlns",svgNameSpace);var overLayRectBBox={w:overlayRecBoxW,h:overlayRecBoxH,x:reqWidth/2-overlayRecBoxW/2,y:eleBBox.h/2+overlayRecBoxH/2-18};var genomicFrequencyData=this.genomicDataMap[nodeLabel];var maxGenomicDataBoxCount=genomicDataBoxCount;var genomicBoxCounter=0;var sortedKeys=_.keys(this.visibleGenomicDataMapByType).sort();for(var i in sortedKeys){var cancerType=sortedKeys[i];if(!this.visibleGenomicDataMapByType[cancerType])continue;if(genomicFrequencyData[cancerType]!=undefined){genomicDataRectangleGenerator(overLayRectBBox.x+genomicBoxCounter*overLayRectBBox.w/maxGenomicDataBoxCount,overLayRectBBox.y,overLayRectBBox.w/maxGenomicDataBoxCount,overLayRectBBox.h,genomicFrequencyData[cancerType],svg)}else{genomicDataRectangleGenerator(overLayRectBBox.x+genomicBoxCounter*overLayRectBBox.w/maxGenomicDataBoxCount,overLayRectBBox.y,overLayRectBBox.w/maxGenomicDataBoxCount,overLayRectBBox.h,null,svg)}genomicBoxCounter++}function genomicDataRectangleGenerator(x,y,w,h,percent,parentSVG){if(percent){var isNegativePercent=percent<0;var _percent=Math.abs(percent);_percent=_percent<.5?2:Math.round(_percent);_percent=_percent==1?2:_percent;var percentColor=255-(-7.118+53.9765*Math.log(_percent));var colorString="";if(percent==0){colorString="rgb(255,255,255)"}else if(isNegativePercent){colorString="rgb("+Math.round(percentColor)+","+Math.round(percentColor)+",255)";percent=percent.substring(1)}else colorString="rgb(255,"+Math.round(percentColor)+","+Math.round(percentColor)+")";var overlayRect=document.createElementNS(svgNameSpace,"rect");overlayRect.setAttribute("x",x);overlayRect.setAttribute("y",y);overlayRect.setAttribute("width",w);overlayRect.setAttribute("height",h);overlayRect.setAttribute("style","stroke-width:1;stroke:rgb(0,0,0);opacity:1;fill:"+colorString+";");var textPercent=percent<.5&&percent>0?"<0.5":Math.round(percent);var text=textPercent+"%";var fontSize=14;var textLength=text.length;var xOffset=w/2-textLength*4;var yOffset=fontSize/3;var svgText=document.createElementNS(svgNameSpace,"text");svgText.setAttribute("x",x+xOffset);svgText.setAttribute("y",y+h/2+yOffset);svgText.setAttribute("font-family","Arial");svgText.setAttribute("font-size",fontSize);svgText.innerHTML=text;parentSVG.appendChild(overlayRect);parentSVG.appendChild(svgText)}else{colorString="rgb(210,210,210)";var overlayRect=document.createElementNS(svgNameSpace,"rect");overlayRect.setAttribute("x",x);overlayRect.setAttribute("y",y);overlayRect.setAttribute("width",w);overlayRect.setAttribute("height",h);overlayRect.setAttribute("style","stroke-width:1;stroke:rgb(0,0,0);opacity:1;fill:"+colorString+";");parentSVG.appendChild(overlayRect)}}return svg};function getRequiredWidthForGenomicData(genomicDataBoxCount){var term=genomicDataBoxCount>3?genomicDataBoxCount-3:0;return 150+term*35}GenomicDataOverlayManager.prototype.showGenomicData=function(){var self=this;var genomicDataBoxCount=this.countVisibleGenomicDataByType();if(genomicDataBoxCount<1){this.hideGenomicData();return}cy.style().selector('node[type="GENE"]').style("width",function(ele){return getRequiredWidthForGenomicData(genomicDataBoxCount)}).style("text-margin-y",function(ele){var nodeLabel=ele.data("name");if(!(nodeLabel in self.genomicDataMap))return 0;return-15}).style("background-image",function(ele){var dataURI="data:image/svg+xml,";return dataURI+self.generateSVGForNode(ele).outerHTML}).update()};GenomicDataOverlayManager.prototype.parseGenomicData=function(genomicData){this.genomicDataMap=this.genomicDataMap||{};this.cancerTypes=this.cancerTypes||[];this.visibleGenomicDataMapByType=this.visibleGenomicDataMapByType||{};var lines=genomicData.split("\n");var metaLineColumns=lines[0].split("\t");for(var i=1;i<metaLineColumns.length;i++){this.cancerTypes.push(metaLineColumns[i]);if(i-1<this.DEFAULT_VISIBLE_GENOMIC_DATA_COUNT)this.visibleGenomicDataMapByType[this.cancerTypes[i-1]]=true;else this.visibleGenomicDataMapByType[this.cancerTypes[i-1]]=false}for(var i=1;i<lines.length;i++){if(lines[i].length==0)break;var lineContent=lines[i].split("\t");var geneSymbol=lineContent[0];if(!(geneSymbol in this.genomicDataMap))this.genomicDataMap[geneSymbol]={};for(var j=1;j<lineContent.length;j++){this.genomicDataMap[geneSymbol][this.cancerTypes[j-1]]=lineContent[j]}}};GenomicDataOverlayManager.prototype.registerObserver=function(observer){this.observers.push(observer)};GenomicDataOverlayManager.prototype.notifyObservers=function(){for(var i in this.observers){var observer=this.observers[i];observer.notify()}};return GenomicDataOverlayManager}()},{}],190:[function(require,module,exports){module.exports=function($){$("#genomicDataInput").on("change",function(){var file=this.files[0];var formData=new FormData;formData.append("graphFile",file);var request=new XMLHttpRequest;request.onreadystatechange=function(){if(request.readyState===XMLHttpRequest.DONE&&request.status===200){window.editorActionsManager.addGenomicData(request.responseText)}};request.open("POST","/loadGraph");request.send(formData);$("#genomicDataInput").val(null)});$(".dataDropdown li a").click(function(event){event.preventDefault();var dropdownLinkRole=$(event.target).attr("role");if(dropdownLinkRole=="loadGenomic"){$("#genomicDataInput").trigger("click")}else if(dropdownLinkRole=="loadPortal"){window.appManager.portalAccessView.render()}else if(dropdownLinkRole=="dataViewSettings"){$("#genomicDataExplorerDiv").modal("show")}else if(dropdownLinkRole=="loadSampleGenomicData"){var request=new XMLHttpRequest;request.onreadystatechange=function(){if(request.readyState===XMLHttpRequest.DONE&&request.status===200){window.editorActionsManager.addGenomicData(request.responseText)}};request.open("GET","/sampleGenomicData");request.send()}else if(dropdownLinkRole=="removeGenomicData"){window.editorActionsManager.removeGenomicData()}})}(window.$)},{}],191:[function(require,module,exports){module.exports=function(){var styleSheet=[{selector:"node",style:{label:"data(name)","text-valign":"center","text-halign":"center",color:"#1e2829",width:150,height:52,"background-color":"#fff","background-opacity":.5,shape:function(ele){return parentNodeShapeFunc(ele)},"border-width":function(ele){return borderWidthFunction(ele)},"border-color":function(ele){return nodeBorderColorFunction(ele)},"font-size":14}},{selector:"node:parent",style:{shape:function(ele){return parentNodeShapeFunc(ele)},"text-valign":function(ele){return"bottom"},"text-margin-y":2,"padding-left":function(ele){return compoundPaddingFunction(ele)},"padding-right":function(ele){return compoundPaddingFunction(ele)},"padding-bottom":function(ele){return compoundPaddingFunction(ele)},"padding-top":function(ele){return compoundPaddingFunction(ele)},"background-opacity":.5,"border-width":function(ele){return parentBorderWidthFunction(ele)},"border-color":function(ele){return nodeBorderColorFunction(ele)},"background-color":function(ele){return nodeBackgroundColorFunction(ele)}}},{selector:"edge",style:{"curve-style":"bezier","target-arrow-shape":function(ele){return edgeTargetArrowTypeHandler(ele)},width:1,"line-color":function(ele){return edgeColorHandler(ele)},"target-arrow-color":function(ele){return edgeColorHandler(ele)},"line-style":function(ele){return edgeLineTypeHandler(ele)},opacity:1}},{selector:":selected",style:{"shadow-color":"#f1c40f","shadow-opacity":1}},{selector:".edgehandles-hover",css:{"background-color":"#1abc9c"}},{selector:".edgehandles-source",css:{"border-width":2,"border-color":"#1abc9c"}},{selector:".edgehandles-target",css:{"border-width":2,"border-color":"#1abc9c"}},{selector:".edgehandles-preview, .edgehandles-ghost-edge",css:{"line-color":"#1abc9c","target-arrow-color":"#1abc9c","source-arrow-color":"#1abc9c"}},{selector:".invalidGeneHighlight",style:{"border-width":2,"border-color":"#e94332",color:"#e94332"}}];var compoundPaddingFunction=function(ele){switch(ele._private.data["type"]){case"FAMILY":return 5;break;case"COMPLEX":return"5";break;case"COMPARTMENT":return 10;break;case"PROCESS":return 10;break;default:return 5;break}};var contentFunction=function(ele){if(ele._private.data.name){return ele._private.data.name}return"newNode"};var vTextPositionFunction=function(ele){switch(ele._private.data["type"]){case"GENE":return"center";break;case"FAMILY":return"top";break;case"COMPLEX":return"top";break;case"COMPARTMENT":return"top";break;default:return"center";break}};var borderWidthFunction=function(ele){switch(ele._private.data["type"]){case"GENE":return.5;break;case"PROCESS":return 0;break;case"FAMILY":return 1;break;case"COMPARTMENT":return 2;break;default:return.5;break}};var parentBorderWidthFunction=function(ele){switch(ele._private.data["type"]){case"GENE":return.5;break;case"PROCESS":return 0;break;case"FAMILY":return 1;break;case"COMPLEX":return.5;break;case"COMPARTMENT":return 2;break;default:return.5;break}};var parentNodeShapeFunc=function(ele){switch(ele._private.data["type"]){case"GENE":return"roundrectangle";break;case"PROCESS":return"roundrectangle";break;case"FAMILY":return"rectangle";break;case"COMPARTMENT":return"roundrectangle";break;case"COMPLEX":return"rectangle";break;default:return"roundrectangle";break}};var nodeBackgroundColorFunction=function(ele){return"#fff"};var nodeBorderColorFunction=function(ele){switch(ele._private.data["type"]){case"GENE":return"#000000";break;case"FAMILY":return"#CCCCCC";break;case"COMPLEX":return"#000000";break;case"COMPARTMENT":return"#000000";break;default:return"#000000";break}};var edgeColorHandler=function(ele){return"#1b1b1b"};var edgeTargetArrowTypeHandler=function(ele){switch(ele._private.data["type"]){case"ACTIVATES":return"triangle";break;case"INHIBITS":return"tee";break;case"INDUCES":return"triangle";break;case"REPRESSES":return"tee";break;case"BINDS":return"none";break;default:return"none";break}};var edgeLineTypeHandler=function(ele){switch(ele._private.data["type"]){case"ACTIVATES":return"solid";break;case"INHIBITS":return"solid";break;case"INDUCES":return"dashed";break;case"REPRESSES":return"dashed";break;case"BINDS":return"solid";break;default:return"solid";break}};return styleSheet}()},{}],192:[function(require,module,exports){module.exports=function(){var GraphUtilities=function(){};GraphUtilities.prototype.createGraphHierarchy=function(nodes){var tree=[];var mappedArr={};for(var i=0,len=nodes.length;i<len;i++){var arrElem=nodes[i];mappedArr[arrElem.id()]=arrElem;mappedArr[arrElem.id()].childNodes=[]}for(var id in mappedArr){var mappedElem=mappedArr[id];if(mappedElem.parent().length>0){mappedArr[mappedElem.parent().id()].childNodes.push(mappedElem)}else{tree.push(mappedElem)}}return tree};GraphUtilities.prototype.createGraphHierarchyRealTime=function(nodes){var tree=[];var mappedArr={};for(var i=0,len=nodes.length;i<len;i++){var arrElem=nodes[i];mappedArr[arrElem.data.id]=arrElem;mappedArr[arrElem.data.id].children=[]}for(var id in mappedArr){var mappedElem=mappedArr[id];if(mappedElem.data.parent){mappedArr[mappedElem.data.parent].children.push(mappedElem)}else{tree.push(mappedElem)}}return tree};window.GraphUtilities=new GraphUtilities}()},{}],193:[function(require,module,exports){module.exports=function($){function NotificationFactory(){}function mapTypeToCSSStyle(type){if(type==="success")return"pathwayMapper-success";else if(type==="fail")return"pathwayMapper-fail"}NotificationFactory.prototype.createNotification=function(message,type){var mappedCSSClass=mapTypeToCSSStyle(type);$.notify({icon:type=="success"?"glyphicon glyphicon-ok":"glyphicon glyphicon-info-sign",message:message},{element:"body",position:null,type:mappedCSSClass,allow_dismiss:true,newest_on_top:false,showProgressbar:false,placement:{from:"bottom",align:"right"},delay:5e3,offset:20,spacing:10,z_index:1031,mouse_over:null,animate:{enter:"animated fadeInUp",exit:"animated fadeOut"}})};return new NotificationFactory}(window.$)},{}],194:[function(require,module,exports){module.exports=function(){"use strict";$(".edge-palette a").click(function(event){event.preventDefault();if($(event.target).hasClass("active")){cy.edgehandles("disable");cy.edgehandles("drawoff");$(".edge-palette a").blur().removeClass("active")}else{$(".edge-palette a").blur().removeClass("active");$(event.target).toggleClass("active");window.edgeAddingMode=$(event.target).attr("edgeTypeIndex");cy.edgehandles("enable")}});$(".editDropDown li a").click(function(event){event.preventDefault();var dropdownLinkRole=$(event.target).attr("role");if(dropdownLinkRole=="addGene"){var clickedNodeType=$(event.target).text();var nodeData={type:clickedNodeType.toUpperCase(),name:"New "+clickedNodeType};var posData={x:cy.width()/2,y:cy.height()/2};window.editorActionsManager.addNode(nodeData,posData)}else if(dropdownLinkRole=="addEdge"){var edgeTypeIndex=$(event.target).attr("edgeTypeIndex");$(".edge-palette a").blur().removeClass("active");$('.edge-palette a[edgeTypeIndex="'+edgeTypeIndex+'"]').addClass("active");window.edgeAddingMode=edgeTypeIndex;cy.edgehandles("enable")}else if(dropdownLinkRole=="deleteSelected"){var selectedEles=cy.elements(":selected");window.editorActionsManager.removeElement(selectedEles)}else if(dropdownLinkRole=="undo"){window.undoRedoManager.undo()}else if(dropdownLinkRole=="redo"){window.undoRedoManager.redo()}});$(".layoutDropDown li a").click(function(event){event.preventDefault();var dropdownLinkRole=$(event.target).attr("role");if(dropdownLinkRole=="perform_layout"){window.editorActionsManager.performLayout()}else if(dropdownLinkRole=="layout_properties"){$("#layoutPropertiesDiv").modal("show")}});$(".aboutDropDown li a").click(function(event){event.preventDefault();var dropdownLinkRole=$(event.target).attr("role");if(dropdownLinkRole=="about"){$("#aboutModal").modal("show")}else if(dropdownLinkRole=="edge_legend"){$("#edge_legend_modal").modal("show")}else if(dropdownLinkRole=="node_legend"){$("#node_legend_modal").modal("show")}else if(dropdownLinkRole=="help"){$("#quickHelpModal").modal("show")}else if(dropdownLinkRole=="howToUse"){window.open("https://github.com/iVis-at-Bilkent/pathway-mapper/blob/master/README.md","_blank")}})}()},{}],195:[function(require,module,exports){var panzoomOptions={zoomFactor:.05,zoomDelay:45,minZoom:.1,maxZoom:10,fitPadding:50,panSpeed:10,panDistance:10,panDragAreaSize:75,panMinPercentSpeed:.25,panInactiveArea:8,panIndicatorMinOpacity:.5,zoomOnly:false,sliderHandleIcon:"fa fa-minus",zoomInIcon:"fa fa-plus",zoomOutIcon:"fa fa-minus",resetIcon:"fa fa-expand"};module.exports=panzoomOptions},{}],196:[function(require,module,exports){var BackboneView=require("./BackboneViews/BioGeneView.js");module.exports=function($){"use strict";var QtipManager=function(cy){this.cy=cy};QtipManager.prototype.generateEdgeQtipContentHTML=function(edge){var self=this;var edgeData=edge.data();var textInput=$('<div class="col-xs-6 inputCol"><input type="text" class="form-control" edgeid="'+edge.id()+'"value=""></div>');var pubmedIDList=$('<div class="pubmedIDList"></div>');var pubmedURL="https://www.ncbi.nlm.nih.gov/pubmed/";var pubmedData=edge.data("pubmedIDs");function generatePubmedLinks(argData,isInitialDisplay){for(var key in argData){var pubmedID=argData[key];if(isNaN(pubmedID))continue;var pubmedIDRemoveButton=$("<i edgeID='"+edge.id()+"' class='fa fa-times qtipRemovePmedID' aria-hidden='true'></i>");pubmedIDRemoveButton.on("click",function(event){$(event.target).parent().remove();var edge=cy.$("#"+$(event.target).attr("edgeId"));var pubmedId=[$(event.target).parent().find("a").text()];window.editorActionsManager.removePubmedID(edge,pubmedId);if($(".pubmedIDList").children().length<3){$(".pubmedIDList").children().remove()}});var pubmedContent=$("<div>                                <label>                                  <a target='_blank' href="+pubmedURL+pubmedID+">"+ +pubmedID+"</a>"+"</label>                                </div>");pubmedContent.first().append(pubmedIDRemoveButton);pubmedIDList.append(pubmedContent)}}function generatePubmedLinksHeader(){pubmedIDList.append($("<hr/>"));pubmedIDList.append($('<label class="col-xs-12 pubmedIDLabel">Pubmed IDs</label>'))}if(pubmedData.length>0){generatePubmedLinksHeader();generatePubmedLinks(pubmedData,true)}textInput.change(function(){var edgeID=$(this).find("input").attr("edgeid");var pumbedIDs=$(this).find("input").val().split(";");$(this).find("input").val("");if($(".pubmedIDList").children().length==0){generatePubmedLinksHeader()}window.editorActionsManager.addPubmedIDs(edge,pumbedIDs);generatePubmedLinks(pumbedIDs,false)});var wrapper=$("<div></div>");var row=$('<div class="row">                 <div class="col-xs-6 qtipLabel">Add  PubmedID(s):</div>              </div>');row.append(textInput);wrapper.append(row);wrapper.append(pubmedIDList);return wrapper};QtipManager.prototype.generateNodeQtipContentHTML=function(ele){var self=this;var nodeData=ele.data();var textInput=$('<div class="col-xs-8 inputCol"><input type="text" class="form-control" nodeid="'+ele.id()+'" value="'+nodeData.name+'"></div>');textInput.change(function(){var nodeID=$(this).find("input").attr("nodeid");var cyNode=self.cy.$("#"+nodeID)[0];var newName=$(this).find("input").val();window.editorActionsManager.changeName(cyNode,newName)});var wrapper=$("<div></div>");var row=$('<div class="row">                 <div class="col-xs-4 qtipLabel">Name:</div>              </div>');row.append(textInput);wrapper.append(row);if(ele.data().type==="GENE"){var entrezGeneButton=$('<div class="row centerText geneDetails"><button nodeid="'+ele.id()+'" type="button" class="btn btn-default">Entrez Gene</button></div>');entrezGeneButton.find("button").on("click",function(event){event.preventDefault();var nodeID=$(this).attr("nodeid");var nodeSymbol=self.cy.$("#"+nodeID)[0]._private.data["name"];var parent=$(this).parent();parent.empty().append('<i class="fa fa-circle-o-notch fa-spin fa-3x fa-fw"></i>');var formData=new FormData;formData.append("query",nodeSymbol);var request=new XMLHttpRequest;request.onreadystatechange=function(){if(request.readyState===XMLHttpRequest.DONE){if(request.status===200){var jsonData=JSON.parse(request.responseText);if(jsonData.count>0){var backboneView=new BackboneView({model:jsonData.geneInfo[0]}).render().html();parent.empty().append(backboneView)}else{parent.empty().append("There is no extra information for this gene")}}else{parent.empty().append("An error occured while retrieving the data")}}};request.open("POST","/getBioGeneData");request.send(formData)});wrapper.append(entrezGeneButton)}return wrapper};QtipManager.prototype.addQtipToElements=function(eles){var self=this;eles.forEach(function(ele,i){var qTipOpts={};if(ele.isNode()){qTipOpts={content:{text:function(){return self.generateNodeQtipContentHTML(this)},title:function(){return ele.data().type.toUpperCase()+" DETAILS"}},position:{my:"top center",at:"bottom center"},style:{classes:"qtip-tipsy qtip-rounded",width:400}}}else if(ele.isEdge()){qTipOpts={content:{text:function(){return self.generateEdgeQtipContentHTML(this)},title:function(){return"INTERACTION DETAILS"}},position:{my:"top center",at:"bottom center"},style:{classes:"qtip-tipsy qtip-rounded",width:400}}}ele.qtip(qTipOpts)})};function capitalizeFirstLetter(string){return string.charAt(0).toUpperCase()+string.slice(1)}return QtipManager}(window.$)},{"./BackboneViews/BioGeneView.js":177}],197:[function(require,module,exports){module.exports=function(){"use strict";var RealTimeManager=function(postFileLoadCallback){this.clientId="122039910543-b7u74aijsqne9iv5rk2tgm3529ped4d0.apps.googleusercontent.com";this.NODEMAP_NAME="nodes";this.EDGEMAP_NAME="edges";this.LAYOUT_PROPS_NAME="layoutProperties";this.GLOBAL_OPTS_NAME="globalOptions";this.GENOMIC_DATA_MAP_NAME="genomicDataMap";this.VISIBLE_GENOMIC_DATA_MAP_NAME="visibleGenomicDataMapByType";this.realtimeUtils=new utils.RealtimeUtils({clientId:this.clientId});this.postFileLoad=postFileLoadCallback};RealTimeManager.prototype.authorize=function(callbackFunction,isModal){this.realtimeUtils.authorize(function(response){callbackFunction(response)},isModal)};RealTimeManager.prototype.initRealTimeAPI=function(){var id=this.realtimeUtils.getParam("id");this.registerTypes();var self=this;var initFileCallback=function(model){self.onFileInitialize(model)};var loadFileCallback=function(model){self.onFileLoaded(model)};if(id){this.realtimeUtils.load(id.replace("/",""),loadFileCallback,initFileCallback)}else{this.realtimeUtils.createAppFile("New Graph",function(createResponse){var result=createResponse.result;window.history.pushState(null,null,"?id="+result.id);self.realtimeUtils.load(result.id,loadFileCallback,initFileCallback)})}};RealTimeManager.prototype.onFileInitialize=function(model){var root=model.getRoot();var nodeMap=model.createMap();var edgeMap=model.createMap();var layoutProperties=model.create(LayoutPropertiesR,window.editorActionsManager.layoutProperties);var globalOptions=model.create(GlobalOptionsR,window.editorActionsManager.getGlobalOptions());var genomicDataMap=model.createMap();var genomicDataVisibilityMap=model.createMap();root.set(this.NODEMAP_NAME,nodeMap);root.set(this.EDGEMAP_NAME,edgeMap);root.set(this.LAYOUT_PROPS_NAME,layoutProperties);root.set(this.GLOBAL_OPTS_NAME,globalOptions);root.set(this.GENOMIC_DATA_MAP_NAME,genomicDataMap);root.set(this.VISIBLE_GENOMIC_DATA_MAP_NAME,genomicDataVisibilityMap)};RealTimeManager.prototype.onFileLoaded=function(doc){var model=doc.getModel();var root=model.getRoot();var nodeMap=root.get(this.NODEMAP_NAME);var edgeMap=root.get(this.EDGEMAP_NAME);var realTimeLayoutProperties=root.get(this.LAYOUT_PROPS_NAME);var globalOptions=root.get(this.GLOBAL_OPTS_NAME);var genomicDataMap=root.get(this.GENOMIC_DATA_MAP_NAME);var visDataMap=root.get(this.VISIBLE_GENOMIC_DATA_MAP_NAME);var nodeMapEntries=nodeMap.values();var edgeMapEntries=edgeMap.values();for(var i=0;i<edgeMapEntries.length;i++){var tmpEdge=edgeMapEntries[i];if(tmpEdge.pubmedIDs==undefined){var newEdge=model.create(EdgeR,{type:tmpEdge.type,source:tmpEdge.source,target:tmpEdge.target,pubmedID:model.createList()});var tmpEdgeID=this.getCustomObjId(tmpEdge);var newID=this.getCustomObjId(newEdge);edgeMap.delete(tmpEdgeID);edgeMap.set(newID,newEdge)}}edgeMapEntries=edgeMap.values();window.editorActionsManager.addNewElementsLocally(nodeMapEntries,edgeMapEntries);window.editorActionsManager.updateLayoutPropertiesCallback(realTimeLayoutProperties);window.editorActionsManager.changeGlobalOptions(globalOptions);var genomicDataMapKeys=genomicDataMap.keys();var visibilityMapKeys=visDataMap.keys();for(var key in genomicDataMapKeys){window.editorActionsManager.genomicDataOverlayManager.genomicDataMap[genomicDataMapKeys[key]]=genomicDataMap.get(genomicDataMapKeys[key])}for(var key in visibilityMapKeys){window.editorActionsManager.genomicDataOverlayManager.visibleGenomicDataMapByType[visibilityMapKeys[key]]=visDataMap.get(visibilityMapKeys[key])}window.editorActionsManager.genomicDataOverlayManager.showGenomicData();window.editorActionsManager.genomicDataOverlayManager.notifyObservers();cy.fit(50);var invalidGenes=[];for(var i=0;i<nodeMapEntries.length;i++){var tmpNode=nodeMapEntries[i];if(tmpNode.isInvalidGene){var tmpNodeId=this.getCustomObjId(tmpNode);invalidGenes.push(tmpNodeId)}}window.editorActionsManager.highlightInvalidGenesInitially(invalidGenes);this.realTimeDoc=doc;var nodeAddRemoveHandler=function(event){window.editorActionsManager.realTimeNodeAddRemoveEventCallBack(event)};var edgeAddRemoveHandler=function(event){window.editorActionsManager.realTimeEdgeAddRemoveEventCallBack(event)};var genomicDataAddRemoveHandler=function(event){window.editorActionsManager.realTimeGenomicDataHandler(event)};var genomicDataVisibilityChangeHandler=function(event){window.editorActionsManager.realTimeGenomicDataVsibilityHandler(event)};root.get(this.NODEMAP_NAME).addEventListener(gapi.drive.realtime.EventType.VALUE_CHANGED,nodeAddRemoveHandler);root.get(this.EDGEMAP_NAME).addEventListener(gapi.drive.realtime.EventType.VALUE_CHANGED,edgeAddRemoveHandler);root.get(this.GENOMIC_DATA_MAP_NAME).addEventListener(gapi.drive.realtime.EventType.VALUE_CHANGED,genomicDataAddRemoveHandler);root.get(this.VISIBLE_GENOMIC_DATA_MAP_NAME).addEventListener(gapi.drive.realtime.EventType.VALUE_CHANGED,genomicDataVisibilityChangeHandler);this.postFileLoad()};RealTimeManager.prototype.clearGenomicData=function(){var model=this.realTimeDoc.getModel();var root=model.getRoot();var genomicMap=root.get(this.GENOMIC_DATA_MAP_NAME);var genomicMapKeys=genomicMap.keys();model.beginCompoundOperation();for(var i in genomicMapKeys){genomicMap.delete(genomicMapKeys[i])}model.endCompoundOperation()};RealTimeManager.prototype.clearGenomicVisData=function(){var model=this.realTimeDoc.getModel();var root=model.getRoot();var map=root.get(this.VISIBLE_GENOMIC_DATA_MAP_NAME);var mapKeys=map.keys();model.beginCompoundOperation();for(var i in mapKeys){map.delete(mapKeys[i])}model.endCompoundOperation()};RealTimeManager.prototype.addGenomicData=function(geneData){var model=this.realTimeDoc.getModel();var root=model.getRoot();var genomicMap=root.get(this.GENOMIC_DATA_MAP_NAME);model.beginCompoundOperation();for(var geneSymbol in geneData){var genomicMapEntry={};if(genomicMap.has(geneSymbol))genomicMapEntry=_.clone(genomicMap.get(geneSymbol));for(var cancerType in geneData[geneSymbol]){if(!(cancerType in genomicMapEntry))genomicMapEntry[cancerType]=parseInt(geneData[geneSymbol][cancerType]).toFixed(2)}genomicMap.set(geneSymbol,genomicMapEntry)}model.endCompoundOperation()};RealTimeManager.prototype.addGenomicVisibilityData=function(visMap){var model=this.realTimeDoc.getModel();var root=model.getRoot();var map=root.get(this.VISIBLE_GENOMIC_DATA_MAP_NAME);model.beginCompoundOperation();for(var cancerStudy in visMap){map.set(cancerStudy,visMap[cancerStudy])}model.endCompoundOperation()};RealTimeManager.prototype.addNewNode=function(nodeData,posData){var model=this.realTimeDoc.getModel();var root=model.getRoot();var nodeMap=root.get(this.NODEMAP_NAME);var newNode=model.create(NodeR,{name:nodeData.name,type:nodeData.type,parent:nodeData.parent});if(posData){newNode.x=posData.x;newNode.y=posData.y}var realTimeGeneratedID=this.getCustomObjId(newNode);nodeMap.set(realTimeGeneratedID,newNode)};RealTimeManager.prototype.addNewEdge=function(edgeData){var model=this.realTimeDoc.getModel();var root=model.getRoot();var edgeMap=root.get(this.EDGEMAP_NAME);var newEdge=model.create(EdgeR,{type:edgeData.type,source:edgeData.source,target:edgeData.target,pubmedID:edgeData.pubmedID});var realTimeGeneratedID=this.getCustomObjId(newEdge);edgeMap.set(realTimeGeneratedID,newEdge)};RealTimeManager.prototype.removeElement=function(elementID){var model=this.realTimeDoc.getModel();var root=model.getRoot();var edgeMap=root.get(this.EDGEMAP_NAME);var nodeMap=root.get(this.NODEMAP_NAME);if(nodeMap.has(elementID)){nodeMap.delete(elementID)}else if(edgeMap.has(elementID)){edgeMap.delete(elementID)}else{throw new Error("Element does not exist in Real Time")}};RealTimeManager.prototype.moveElement=function(ele){var model=this.realTimeDoc.getModel();var root=model.getRoot();var nodeMap=root.get(this.NODEMAP_NAME);var elementID=ele.id();var newPos=ele.position();if(nodeMap.has(elementID)){var tmpNode=nodeMap.get(elementID);model.beginCompoundOperation();tmpNode.x=newPos.x;tmpNode.y=newPos.y;model.endCompoundOperation()}else{throw new Error("Element does not exist in nodes !!! ")}};RealTimeManager.prototype.changeHighlight=function(nodeIDs,isHiglighted){var model=this.realTimeDoc.getModel();var root=model.getRoot();var nodeMap=root.get(this.NODEMAP_NAME);model.beginCompoundOperation();for(var i in nodeIDs){var nodeID=nodeIDs[i];if(nodeMap.has(nodeID)){var collaborativeNode=nodeMap.get(nodeID);collaborativeNode.isInvalidGene=isHiglighted}}model.endCompoundOperation()};RealTimeManager.prototype.addPubmedIDs=function(edgeID,pubmedIDs){var model=this.realTimeDoc.getModel();var root=model.getRoot();var edgeMap=root.get(this.EDGEMAP_NAME);if(edgeMap.has(edgeID)){var tmpEdge=edgeMap.get(edgeID);var nonDuplicateArray=[];for(var i=0;i<pubmedIDs.length;i++){if(tmpEdge.pubmedIDs.indexOf(pubmedIDs[i])<0){nonDuplicateArray.push(pubmedIDs[i])}}model.beginCompoundOperation();tmpEdge.pubmedIDs.pushAll(nonDuplicateArray);model.endCompoundOperation()}else{throw new Error("Edge does not exist in real time !!! ")}};RealTimeManager.prototype.removePubmedID=function(edgeID,pubmedIDs){var model=this.realTimeDoc.getModel();var root=model.getRoot();var edgeMap=root.get(this.EDGEMAP_NAME);if(edgeMap.has(edgeID)){var tmpEdge=edgeMap.get(edgeID);var removedIndices=[];for(var i=0;i<pubmedIDs.length;i++){var tmpID=pubmedIDs[i];var index=tmpEdge.pubmedIDs.indexOf(tmpID);if(index>=0){removedIndices.push(index)}}model.beginCompoundOperation();for(var i=0;i<removedIndices.length;i++){tmpEdge.pubmedIDs.remove(removedIndices[i])}model.endCompoundOperation()}else{throw new Error("Edge does not exist in real time !!! ")}};RealTimeManager.prototype.changeName=function(ele,newName){var model=this.realTimeDoc.getModel();var root=model.getRoot();var nodeMap=root.get(this.NODEMAP_NAME);var elementID=ele.id();if(nodeMap.has(elementID)){var tmpNode=nodeMap.get(elementID);model.beginCompoundOperation();tmpNode.name=newName;model.endCompoundOperation()}else{throw new Error("Element does not exist in nodes !!! ")}};RealTimeManager.prototype.changeParent=function(rootNode,newParentId,connectedEdges){var model=this.realTimeDoc.getModel();var root=model.getRoot();var nodeMap=root.get(this.NODEMAP_NAME);var nodeLookupTable={};var self=this;function traverseFromRoot(rootNode,parId){var refNode=rootNode.nodeRef;var children=rootNode.children;var newParentId=parId;if(refNode){var refNodeId=refNode.id();var nodeData=refNode.data();var posData=refNode.position();var newNodeData={name:nodeData.name,type:nodeData.type,x:posData.x,y:posData.y};if(parId){newNodeData.parent=parId}self.removeElement(refNodeId);var newNode=model.create(NodeR,newNodeData);var newNodeId=self.getCustomObjId(newNode);nodeMap.set(newNodeId,newNode);newParentId=newNodeId;nodeLookupTable[refNodeId]=newNodeId}for(var i in children){var childNode=children[i];traverseFromRoot(childNode,newParentId)}}traverseFromRoot(rootNode,newParentId);connectedEdges.forEach(function(edge,index){var edgeData=edge.data();self.removeElement(edge.id());var newSource=nodeLookupTable[edgeData.source];var newTarget=nodeLookupTable[edgeData.target];if(newSource){edgeData.source=newSource}if(newTarget){edgeData.target=newTarget}self.addNewEdge(edgeData)})};RealTimeManager.prototype.removeAllElements=function(){var model=this.realTimeDoc.getModel();var root=model.getRoot();var nodeMap=root.get(this.NODEMAP_NAME);var edgeMap=root.get(this.EDGEMAP_NAME);var nodeMapKeys=nodeMap.keys();var edgeMapKeys=edgeMap.keys();for(var index in nodeMapKeys){this.removeElement(nodeMapKeys[index])}for(var index in edgeMapKeys){this.removeElement(edgeMapKeys[index])}};RealTimeManager.prototype.loadGraph=function(nodes,edges){var model=this.realTimeDoc.getModel();var root=model.getRoot();var nodeMap=root.get(this.NODEMAP_NAME);var edgeMap=root.get(this.EDGEMAP_NAME);this.removeAllElements();var that=this;var oldIdNewIdMap={};function traverseTree(node,newParentId){node.data.x=node.position.x;node.data.y=node.position.y;if(newParentId){var parent=node.data.parent;if(parent){node.data.parent=newParentId}}var newNode=model.create(NodeR,node.data);var newNodeId=that.getCustomObjId(newNode);oldIdNewIdMap[node.data.id]=newNodeId;nodeMap.set(newNodeId,newNode);if(node.children.length>0){for(var i in node.children){var tmpNode=node.children[i];traverseTree(tmpNode,newNodeId)}}}var tree=window.GraphUtilities.createGraphHierarchyRealTime(nodes);for(var i in tree){var rootLevelNode=tree[i];traverseTree(rootLevelNode)}for(var i in edges){var edge=edges[i];edge.data.source=oldIdNewIdMap[edge.data.source];edge.data.target=oldIdNewIdMap[edge.data.target];var newEdge=model.create(EdgeR,edge.data);var newEdgeID=this.getCustomObjId(newEdge);edgeMap.set(newEdgeID,newEdge)}};RealTimeManager.prototype.mergeGraph=function(nodes,edges){var model=this.realTimeDoc.getModel();var root=model.getRoot();var nodeMap=root.get(this.NODEMAP_NAME);var edgeMap=root.get(this.EDGEMAP_NAME);var realTimeNodeMap=nodeMap.items();var realTimeNodeLookupTable={};var realTimeNodeNameLookupTable={};var oldIdNewIdMap={};var that=this;for(var i in realTimeNodeMap){var nodeMapItem=realTimeNodeMap[i];realTimeNodeLookupTable[nodeMapItem[0]]=nodeMapItem[1];realTimeNodeNameLookupTable[nodeMapItem[1].name]=nodeMapItem[1]}function traverseTree(node,newParentId){if(!(node.data.name in realTimeNodeNameLookupTable)){node.data.x=node.position.x;node.data.y=node.position.y;if(newParentId){var parent=node.data.parent;if(parent){node.data.parent=newParentId}}var newNode=model.create(NodeR,node.data);var newNodeId=that.getCustomObjId(newNode);oldIdNewIdMap[node.data.id]=newNodeId;nodeMap.set(newNodeId,newNode);if(node.children.length>0){for(var i in node.children){var tmpNode=node.children[i];traverseTree(tmpNode,newNodeId)}}}else{var sameNameNode=realTimeNodeNameLookupTable[node.data.name];var sameNodeId=that.getCustomObjId(sameNameNode);oldIdNewIdMap[node.data.id]=sameNodeId;if(node.children.length>0){for(var i in node.children){var tmpNode=node.children[i];traverseTree(tmpNode,sameNodeId)}}}}var tree=window.GraphUtilities.createGraphHierarchyRealTime(nodes);for(var i in tree){var rootLevelNode=tree[i];traverseTree(rootLevelNode,rootLevelNode.data.id)}for(var i in edges){var edge=edges[i];edge.data.source=oldIdNewIdMap[edge.data.source];edge.data.target=oldIdNewIdMap[edge.data.target];var newEdge=model.create(EdgeR,edge.data);var newEdgeID=this.getCustomObjId(newEdge);edgeMap.set(newEdgeID,newEdge)}};RealTimeManager.prototype.updateLayoutProperties=function(newLayoutProperties){var model=this.realTimeDoc.getModel();var root=model.getRoot();var layoutPropertiesR=root.get(this.LAYOUT_PROPS_NAME);model.beginCompoundOperation();for(var property in newLayoutProperties){if(newLayoutProperties.hasOwnProperty(property)){layoutPropertiesR[property]=newLayoutProperties[property]}}model.endCompoundOperation()};RealTimeManager.prototype.updateGlobalOptions=function(newOptions){var model=this.realTimeDoc.getModel();var root=model.getRoot();var globalOptions=root.get(this.GLOBAL_OPTS_NAME);model.beginCompoundOperation();for(var property in globalOptions){if(newOptions.hasOwnProperty(property)){globalOptions[property]=newOptions[property]}}model.endCompoundOperation()};RealTimeManager.prototype.getCustomObjId=function(object){return gapi.drive.realtime.custom.getId(object)};RealTimeManager.prototype.registerTypes=function(){this.createRealTimeObjectDefinitions()};RealTimeManager.prototype.createGraphHierarchy=function(nodes){var tree=[];var mappedArr={};for(var i=0,len=nodes.length;i<len;i++){var arrElem=nodes[i];mappedArr[arrElem.data.id]=arrElem;mappedArr[arrElem.data.id].children=[]}for(var id in mappedArr){var mappedElem=mappedArr[id];if(mappedElem.data.parent){mappedArr[mappedElem.data.parent].children.push(mappedElem)}else{tree.push(mappedElem)}}return tree};RealTimeManager.prototype.createRealTimeObjectDefinitions=function(){gapi.drive.realtime.custom.registerType(EdgeR,"EdgeR");gapi.drive.realtime.custom.registerType(NodeR,"NodeR");gapi.drive.realtime.custom.registerType(LayoutPropertiesR,"LayoutPropertiesR");gapi.drive.realtime.custom.registerType(GlobalOptionsR,"GlobalOptionsR");gapi.drive.realtime.custom.setInitializer(NodeR,NodeRInitializer);gapi.drive.realtime.custom.setInitializer(EdgeR,EdgeRInitializer);gapi.drive.realtime.custom.setInitializer(LayoutPropertiesR,LayoutPropertiesRInitializer);gapi.drive.realtime.custom.setInitializer(GlobalOptionsR,GlobalOptionsRInitializer);NodeR.prototype.name=gapi.drive.realtime.custom.collaborativeField("name");NodeR.prototype.type=gapi.drive.realtime.custom.collaborativeField("type");NodeR.prototype.x=gapi.drive.realtime.custom.collaborativeField("x");NodeR.prototype.y=gapi.drive.realtime.custom.collaborativeField("y");NodeR.prototype.parent=gapi.drive.realtime.custom.collaborativeField("parent");NodeR.prototype.isInvalidGene=gapi.drive.realtime.custom.collaborativeField("isInvalidGene");EdgeR.prototype.source=gapi.drive.realtime.custom.collaborativeField("source");EdgeR.prototype.target=gapi.drive.realtime.custom.collaborativeField("target");EdgeR.prototype.type=gapi.drive.realtime.custom.collaborativeField("type");EdgeR.prototype.pubmedIDs=gapi.drive.realtime.custom.collaborativeField("pubmedIDs");LayoutPropertiesR.prototype.name=gapi.drive.realtime.custom.collaborativeField("name");LayoutPropertiesR.prototype.nodeRepulsion=gapi.drive.realtime.custom.collaborativeField("nodeRepulsion");LayoutPropertiesR.prototype.nodeOverlap=gapi.drive.realtime.custom.collaborativeField("nodeOverlap");LayoutPropertiesR.prototype.idealEdgeLength=gapi.drive.realtime.custom.collaborativeField("idealEdgeLength");LayoutPropertiesR.prototype.edgeElasticity=gapi.drive.realtime.custom.collaborativeField("edgeElasticity");LayoutPropertiesR.prototype.nestingFactor=gapi.drive.realtime.custom.collaborativeField("nestingFactor");LayoutPropertiesR.prototype.gravity=gapi.drive.realtime.custom.collaborativeField("gravity");LayoutPropertiesR.prototype.numIter=gapi.drive.realtime.custom.collaborativeField("numIter");LayoutPropertiesR.prototype.tile=gapi.drive.realtime.custom.collaborativeField("tile");LayoutPropertiesR.prototype.animate=gapi.drive.realtime.custom.collaborativeField("animate");LayoutPropertiesR.prototype.randomize=gapi.drive.realtime.custom.collaborativeField("randomize");LayoutPropertiesR.prototype.gravityRangeCompound=gapi.drive.realtime.custom.collaborativeField("gravityRangeCompound");LayoutPropertiesR.prototype.gravityCompound=gapi.drive.realtime.custom.collaborativeField("gravityCompound");LayoutPropertiesR.prototype.gravityRange=gapi.drive.realtime.custom.collaborativeField("gravityRange");GlobalOptionsR.prototype.zoomLevel=gapi.drive.realtime.custom.collaborativeField("zoomLevel");GlobalOptionsR.prototype.panLevel=gapi.drive.realtime.custom.collaborativeField("panLevel");var self=this;function registerAttributeChangeHandlersElements(){function updateElementHandler(event){var ele=event.currentTarget;window.editorActionsManager.updateElementCallback(ele,self.getCustomObjId(ele))}this.addEventListener(gapi.drive.realtime.EventType.OBJECT_CHANGED,updateElementHandler)}function registerAttributeChangeHandlersLayoutPropertiesR(){function updateLayoutPropsHandler(event){var layoutProps=event.currentTarget;window.editorActionsManager.updateLayoutPropertiesCallback(layoutProps)}this.addEventListener(gapi.drive.realtime.EventType.OBJECT_CHANGED,updateLayoutPropsHandler)}function registerAttributeChangeHandlersGlobalOptionsR(){function updateGlobalOptionsRHandler(event){var globalOptions=event.currentTarget;window.editorActionsManager.changeGlobalOptions(globalOptions)}this.addEventListener(gapi.drive.realtime.EventType.OBJECT_CHANGED,updateGlobalOptionsRHandler)}gapi.drive.realtime.custom.setOnLoaded(NodeR,registerAttributeChangeHandlersElements);gapi.drive.realtime.custom.setOnLoaded(EdgeR,registerAttributeChangeHandlersElements);gapi.drive.realtime.custom.setOnLoaded(LayoutPropertiesR,registerAttributeChangeHandlersLayoutPropertiesR);gapi.drive.realtime.custom.setOnLoaded(GlobalOptionsR,registerAttributeChangeHandlersGlobalOptionsR)};var NodeR=function(){};var EdgeR=function(){};var LayoutPropertiesR=function(){};var GlobalOptionsR=function(){};var NodeRInitializer=function(params){var model=gapi.drive.realtime.custom.getModel(this);model.beginCompoundOperation();this.name=params.name||"undefined";this.type=params.type||"undefined";this.parent=params.parent||"undefined";this.x=params.x||"undefined";this.y=params.y||"undefined";this.isInvalidGene=params.isInvalidGene||false;model.endCompoundOperation()};var EdgeRInitializer=function(params){var model=gapi.drive.realtime.custom.getModel(this);model.beginCompoundOperation();this.type=params.type||"undefined";this.source=params.source||"undefined";this.target=params.target||"undefined";if(params.pubmedIDs){if(this.pubmedIDs==undefined){this.pubmedIDs=model.createList()}this.pubmedIDs.pushAll(params.pubmedIDs)}else{this.pubmedIDs=model.createList()}model.endCompoundOperation()};var LayoutPropertiesRInitializer=function(params){var model=gapi.drive.realtime.custom.getModel(this);this.name=params.name||"undefined";this.nodeRepulsion=params.nodeRepulsion||"undefined";this.nodeOverlap=params.nodeOverlap||"undefined";this.idealEdgeLength=params.idealEdgeLength||"undefined";this.edgeElasticity=params.edgeElasticity||"undefined";this.nestingFactor=params.nestingFactor||"undefined";this.gravity=params.gravity||"undefined";this.numIter=params.numIter||"undefined";this.tile=params.tile||"undefined";this.animate=params.animate||"undefined";this.randomize=params.randomize||false;this.gravityRangeCompound=params.gravityRangeCompound||"undefined";this.gravityCompound=params.gravityCompound||"undefined";this.gravityRange=params.gravityRange||"undefined"};var GlobalOptionsRInitializer=function(params){var model=gapi.drive.realtime.custom.getModel(this);model.beginCompoundOperation();this.zoomLevel=params.zoomLevel||"undefined";this.panLevel=params.panLevel||"undefined";model.endCompoundOperation()};return RealTimeManager}()},{}],198:[function(require,module,exports){module.exports=function(){window.utils={};utils.RealtimeUtils=function(options){this.init(options)};utils.RealtimeUtils.prototype={clientId:null,mimeType:"application/vnd.google-apps.drive-sdk",refreshInterval:18e5,scopes:["https://www.googleapis.com/auth/drive.install","https://www.googleapis.com/auth/drive.file","https://www.googleapis.com/auth/drive.readonly"],TCGA_APP_FOLDER_NAME:"TCGA_Pathway_Curation_Tool_Files",init:function(options){this.mergeOptions(options);this.authorizer=new utils.RealtimeAuthorizer(this);this.createRealtimeFile=this.createRealtimeFile.bind(this)},authorize:function(onAuthComplete,usePopup){this.authorizer.start(onAuthComplete,usePopup)},mergeOptions:function(options){for(var option in options){this[option]=options[option]}},getParam:function(urlParam){var regExp=new RegExp(urlParam+"=(.*?)($|&)","g");var match=window.location.search.match(regExp);if(match&&match.length){match=match[0];match=match.replace(urlParam+"=","").replace("&","")}else{match=null}return match},createRealtimeFile:function(title,callback,parentFolder){var that=this;var insertHash={resource:{mimeType:that.mimeType,name:title}};if(parentFolder)insertHash.resource.parents=[parentFolder];if(window.gapi.client.drive){window.gapi.client.drive.files.create(insertHash).then(function(resp){var fileId=resp.result.id;that.shareRealTimeFile(fileId);callback(resp)},function(reason){alert("An Error happened: "+reason.result.error.message);window.location.href="/"})}else{window.gapi.client.load("drive","v3",function(){window.gapi.client.drive.files.create(insertHash).then(function(resp){var fileId=resp.result.id;that.shareRealTimeFile(fileId);callback(resp)},function(reason){alert("An Error happened: "+reason.result.error.message);window.location.href="/"})})}},createAppFile:function(title,callback){var that=this;this.createAppFolder(function(folderId){that.createRealtimeFile(title,callback,folderId)})},createAppFolder:function(successHandler,appfolderName){var appFName=appfolderName||this.TCGA_APP_FOLDER_NAME;var that=this;if(window.gapi.client.drive){searchFolder(appFName,successHandler)}else{window.gapi.client.load("drive","v3",function(){searchFolder(appFName,successHandler)})}function searchFolder(appFolderName){var driveAPI=window.gapi.client.drive;var fileResource={q:"name='"+appFolderName+"' and "+"mimeType = 'application/vnd.google-apps.folder' and "+"trashed = false",spaces:"drive"};driveAPI.files.list(fileResource).then(function(res){var files=res.result.files;if(files.length>0){var id=files[0].id;successHandler(id)}else{var createProps={resource:{name:appFName,mimeType:"application/vnd.google-apps.folder"}};driveAPI.files.create(createProps).then(function(resp){var newFolderId=resp.result.id;successHandler(newFolderId)},function(err){console.log(err)})}},function(err){console.log(err)})}},shareRealTimeFile:function(fileId){window.gapi.client.drive.permissions.create({resource:{type:"anyone",role:"writer",allowFileDiscovery:false},fileId:fileId}).then(function(resp){console.log("File shared succesfully !")},function(reason){console.log("An Error happened: "+reason.result.error.message)})},load:function(documentId,onFileLoaded,initializeModel){var that=this;window.gapi.drive.realtime.load(documentId,function(doc){onFileLoaded(doc)},initializeModel,this.onError.bind(this))},onError:function(error){if(error.type==window.gapi.drive.realtime.ErrorType.TOKEN_REFRESH_REQUIRED){this.authorizer.authorize(function(){console.log("Error, auth refreshed")},false)}else if(error.type==window.gapi.drive.realtime.ErrorType.CLIENT_ERROR){alert("An Error happened: "+error.message);window.location.href="/"}else if(error.type==window.gapi.drive.realtime.ErrorType.NOT_FOUND){alert("The file was not found. It does not exist or you do not have "+"read access to the file.");window.location.href="/"}else if(error.type==window.gapi.drive.realtime.ErrorType.FORBIDDEN){alert("You do not have access to this file. Try having the owner share"+"it with you from Google Drive.");window.location.href="/"}}};utils.RealtimeAuthorizer=function(realtimeUtil){this.util=realtimeUtil;this.handleAuthResult=this.handleAuthResult.bind(this);this.token=null};utils.RealtimeAuthorizer.prototype={start:function(onAuthComplete,usePopup){var that=this;window.gapi.load("auth:client,drive-realtime,drive-share",{callback:function(){that.authorize(onAuthComplete,usePopup)}});if(this.authTimer){window.clearTimeout(this.authTimer)}this.refreshAuth()},authorize:function(onAuthComplete,usePopup){this.onAuthComplete=onAuthComplete;window.gapi.auth.authorize({client_id:this.util.clientId,scope:this.util.scopes,immediate:!usePopup},this.handleAuthResult)},handleAuthResult:function(authResult){if(authResult&&!authResult.error){this.token=authResult.access_token}this.onAuthComplete(authResult)},refreshAuth:function(){var that=this;this.authTimer=setTimeout(function(){that.authorize(function(){console.log("Refreshed Auth Token")},false);that.refreshAuth()},this.util.refreshInterval)}}}()},{}],199:[function(require,module,exports){var SaveLoadUtilities=require("./SaveLoadUtility.js");module.exports=function(){var SVGExporter=function(){this.SVGNameSpace="http://www.w3.org/2000/svg";this.svg=document.createElementNS(this.SVGNameSpace,"svg");this.NODE_FILL_COLOR="rgb(255,255,255)";this.FAMILY_FILL_COLOR="rgb(255,255,255)";this.FAMILY_STROKE_COLOR="rgb(204,204,204)";this.NODE_STROKE_COLOR="rgb(0,0,0)";this.COMPARTMENT_STROKE_WIDTH=2;this.NODE_STROKE_WIDTH=1;this.NODE_OPACITY=.5;this.ROUNDING_FACTOR=6;this.GENOMICDATA_LABEL_Y_OFFSET=-15;this.EDGE_WIDTH=1;this.T_WIDTH=2;this.T_HEIGHT=8;this.T_ARROW_HEAD_OFFSET=2;this.TRIANGLE_ARROW_HEAD_HEIGHT=8;this.TRIANGLE_ARROW_HEAD_WIDTH=8;this.DASH_PARAMETERS="5, 3";this.COMPOUND_MARGIN=8;this.NODE_FONT_SIZE=14};SVGExporter.prototype.resetSVG=function(){this.svg=document.createElementNS(this.SVGNameSpace,"svg")};SVGExporter.prototype.exportGraph=function(nodes,edges){this.resetSVG();var cyBounds=cy.extent();this.svg.setAttribute("viewBox",cyBounds.x1+" "+cyBounds.y1+" "+cyBounds.w+" "+cyBounds.h);var that=this;var nodeMap={};var nodeTree=window.GraphUtilities.createGraphHierarchy(nodes);var traverseFunction=function(node){nodeMap[node.id()]=node;var genomicDataSVG=window.editorActionsManager.getGenomicDataSVG(node).children;that.svg.appendChild(that.createRect(node));var labelOffset=genomicDataSVG&&genomicDataSVG.length>0?that.GENOMICDATA_LABEL_Y_OFFSET:0;that.svg.appendChild(that.createText(node,labelOffset));if(genomicDataSVG){while(genomicDataSVG.length>0){var elemSVG=genomicDataSVG[0];var nodePosition=node.position();var svgX=elemSVG.getAttribute("x");var svgY=elemSVG.getAttribute("y");elemSVG.setAttribute("x",nodePosition.x-node.width()/2+parseFloat(svgX));elemSVG.setAttribute("y",nodePosition.y-node.height()/2+parseFloat(svgY));that.svg.appendChild(elemSVG)}}if(node.childNodes){for(var i in node.childNodes){traverseFunction(node.childNodes[i])}}};for(var i in nodeTree){var rootLevelNode=nodeTree[i];traverseFunction(rootLevelNode)}edges.forEach(function(edge){var source=nodeMap[edge.source().id()];var target=nodeMap[edge.target().id()];that.drawEdge(edge,source,target)});return this.svg.outerHTML};SVGExporter.prototype.drawEdge=function(edge,source,target){var edgeType=edge.data().type;var sourceRectangle={x:source.position().x,y:source.position().y,width:source.width(),height:source.height()};var targetRectangle={x:target.position().x,y:target.position().y,width:target.width(),height:target.height()};if(source.isParent()){sourceRectangle.width+=this.COMPOUND_MARGIN;sourceRectangle.height+=this.COMPOUND_MARGIN}if(target.isParent()){targetRectangle.width+=this.COMPOUND_MARGIN;targetRectangle.height+=this.COMPOUND_MARGIN}var clipPoints=this.findClippingPoints(sourceRectangle,targetRectangle);var unitV=unitVector({x:clipPoints.targetClipPoints.x-clipPoints.sourceClipPoints.x,y:clipPoints.targetClipPoints.y-clipPoints.sourceClipPoints.y});var inverseUnitV=scale(unitV,-1);var targetX=clipPoints.targetClipPoints.x;var targetY=clipPoints.targetClipPoints.y;if(edgeType=="ACTIVATES"||edgeType=="INDUCES"){targetX=clipPoints.targetClipPoints.x+this.TRIANGLE_ARROW_HEAD_HEIGHT*inverseUnitV.x;targetY=clipPoints.targetClipPoints.y+this.TRIANGLE_ARROW_HEAD_HEIGHT*inverseUnitV.y;var point1Vector=rotateVector(unitV,Math.PI/2);var point2Vector=rotateVector(unitV,-Math.PI/2);point1Vector=scale(point1Vector,this.TRIANGLE_ARROW_HEAD_WIDTH/2);point2Vector=scale(point2Vector,this.TRIANGLE_ARROW_HEAD_WIDTH/2);var point1X=targetX+point1Vector.x;var point1Y=targetY+point1Vector.y;var point2X=targetX+point2Vector.x;var point2Y=targetY+point2Vector.y;var polySVG=document.createElementNS(this.SVGNameSpace,"polygon");polySVG.setAttribute("points",point1X+","+point1Y+","+point2X+","+point2Y+","+clipPoints.targetClipPoints.x+","+clipPoints.targetClipPoints.y);this.svg.appendChild(polySVG)}else if(edgeType=="INHIBITS"||edgeType=="REPRESSES"){targetX=clipPoints.targetClipPoints.x+this.T_ARROW_HEAD_OFFSET*inverseUnitV.x;targetY=clipPoints.targetClipPoints.y+this.T_ARROW_HEAD_OFFSET*inverseUnitV.y;var point1Vector=rotateVector(unitV,Math.PI/2);var point2Vector=rotateVector(unitV,-Math.PI/2);point1Vector=scale(point1Vector,this.T_HEIGHT/2);point2Vector=scale(point2Vector,this.T_HEIGHT/2);var point1X=targetX+point1Vector.x;var point1Y=targetY+point1Vector.y;var point2X=targetX+point2Vector.x;var point2Y=targetY+point2Vector.y;var lineSVG=document.createElementNS(this.SVGNameSpace,"line");lineSVG.setAttribute("x1",point1X);lineSVG.setAttribute("y1",point1Y);lineSVG.setAttribute("x2",point2X);lineSVG.setAttribute("y2",point2Y);lineSVG.setAttribute("stroke-width",this.T_WIDTH);lineSVG.setAttribute("stroke","black");this.svg.appendChild(lineSVG)}var lineSVG=document.createElementNS(this.SVGNameSpace,"line");lineSVG.setAttribute("x1",clipPoints.sourceClipPoints.x);lineSVG.setAttribute("y1",clipPoints.sourceClipPoints.y);lineSVG.setAttribute("x2",targetX);lineSVG.setAttribute("y2",targetY);lineSVG.setAttribute("stroke-width",this.EDGE_WIDTH);lineSVG.setAttribute("stroke","black");if(edgeType=="INDUCES"||edgeType=="REPRESSES"){lineSVG.setAttribute("stroke-dasharray",this.DASH_PARAMETERS)}this.svg.appendChild(lineSVG)};SVGExporter.prototype.findClippingPoints=function(sourceRectangle,targetRectangle){var sourceAABB={xMin:sourceRectangle.x-sourceRectangle.width/2,xMax:sourceRectangle.x+sourceRectangle.width/2,yMin:sourceRectangle.y-sourceRectangle.height/2,yMax:sourceRectangle.y+sourceRectangle.height/2};var targetAABB={xMin:targetRectangle.x-targetRectangle.width/2,xMax:targetRectangle.x+targetRectangle.width/2,yMin:targetRectangle.y-targetRectangle.height/2,yMax:targetRectangle.y+targetRectangle.height/2};var line1={x1:sourceRectangle.x,y1:sourceRectangle.y,x2:targetRectangle.x,y2:targetRectangle.y};var line2={x1:targetRectangle.x,y1:targetRectangle.y,x2:sourceRectangle.x,y2:sourceRectangle.y};var returnObj={sourceClipPoints:clipLine(line1,sourceAABB),targetClipPoints:clipLine(line2,targetAABB)};return returnObj};SVGExporter.prototype.createRect=function(node){var nodeRectangle=document.createElementNS(this.SVGNameSpace,"rect");var nodePosition=node.position();if(node.isParent()){nodeRectangle.setAttribute("x",nodePosition.x-node.width()/2-this.COMPOUND_MARGIN/2);nodeRectangle.setAttribute("y",nodePosition.y-node.height()/2-this.COMPOUND_MARGIN/2);nodeRectangle.setAttribute("width",node.width()+this.COMPOUND_MARGIN);nodeRectangle.setAttribute("height",node.height()+this.COMPOUND_MARGIN)}else{nodeRectangle.setAttribute("x",nodePosition.x-node.width()/2);nodeRectangle.setAttribute("y",nodePosition.y-node.height()/2);nodeRectangle.setAttribute("width",node.width());nodeRectangle.setAttribute("height",node.height())}nodeRectangle=this.createStyleForNodes(node,nodeRectangle);return nodeRectangle};SVGExporter.prototype.createText=function(node,genomicDataOffset){var verticalTextOffset=5;var nodePosition=node.position();var svgText=document.createElementNS(this.SVGNameSpace,"text");if(node.isParent()){verticalTextOffset=20;svgText.setAttribute("x",nodePosition.x);svgText.setAttribute("y",nodePosition.y+node.height()/2+verticalTextOffset)}else{svgText.setAttribute("x",nodePosition.x);svgText.setAttribute("y",nodePosition.y+verticalTextOffset+genomicDataOffset)}svgText.setAttribute("font-family","Arial");svgText.setAttribute("text-anchor","middle");svgText.setAttribute("font-size",this.NODE_FONT_SIZE);svgText.innerHTML=node.data().name;return svgText};SVGExporter.prototype.createStyleForNodes=function(node,nodeRectangle){var nodeType=node.data().type;var strokeWidth=this.NODE_STROKE_WIDTH;var strokeColor=this.NODE_STROKE_COLOR;var fillColor=this.NODE_FILL_COLOR;var opacity=this.NODE_OPACITY;var strokeOpacity=1;if(nodeType=="GENE"||nodeType=="COMPARTMENT"){nodeRectangle.setAttribute("rx",this.ROUNDING_FACTOR);nodeRectangle.setAttribute("ry",this.ROUNDING_FACTOR);if(nodeType=="COMPARTMENT")strokeWidth=this.COMPARTMENT_STROKE_WIDTH}if(nodeType=="PROCESS"){opacity=0;strokeOpacity=0}if(nodeType=="FAMILY"){fillColor=this.FAMILY_FILL_COLOR;strokeColor=this.FAMILY_STROKE_COLOR}var styleString="stroke-width:"+strokeWidth+";"+"stroke:"+strokeColor+";"+"fill-opacity:"+opacity+";"+"fill:"+fillColor+";"+"stroke-opacity:"+strokeOpacity+";";nodeRectangle.setAttribute("style",styleString);return nodeRectangle};function clipLine(line,rectangle){var INSIDE=0;var LEFT=1;var RIGHT=2;var BOTTOM=4;var TOP=8;function getOutCode(point,rectangle){var outcode=INSIDE;if(point.x<rectangle.xMin)outcode=outcode|LEFT;else if(point.x>rectangle.xMax)outcode=outcode|RIGHT;if(point.y<rectangle.yMin)outcode=outcode|TOP;else if(point.y>rectangle.yMax)outcode=outcode|BOTTOM;return outcode}var outcode0=getOutCode({x:line.x1,y:line.y1},rectangle);var outcode1=getOutCode({x:line.x2,y:line.y2},rectangle);var slope=(line.y2-line.y1)/(line.x2-line.x1);var returnCoords={x:line.x1,y:line.y1,slope:slope};var accept=false;while(true){if(!(outcode0|outcode1)){accept=true;break}else if(outcode0&outcode1){break}else{var outCode=outcode0?outcode0:outcode1;if(outCode&TOP){returnCoords.x=line.x1+(rectangle.yMin-line.y1)/slope;returnCoords.y=rectangle.yMin}else if(outCode&BOTTOM){returnCoords.x=line.x1+(rectangle.yMax-line.y1)/slope;returnCoords.y=rectangle.yMax}else if(outCode&RIGHT){returnCoords.x=rectangle.xMax;returnCoords.y=line.y1+slope*(rectangle.xMax-line.x1)}else if(outCode&LEFT){returnCoords.x=rectangle.xMin;returnCoords.y=line.y1+slope*(rectangle.xMin-line.x1)}if(outCode==outcode0){outcode0=getOutCode({x:returnCoords.x,y:returnCoords.y},rectangle)}else{outcode1=getOutCode({x:returnCoords.x,y:returnCoords.y},rectangle)}}}return returnCoords}function dotProduct(v1,v2){var newX=v1.x*v2.x;var newY=v1.y*v2.y;return{x:newX,y:newY}}function unitVector(v){var inverseLength=1/Math.sqrt(v.x*v.x+v.y*v.y);return{x:v.x*inverseLength,y:v.y*inverseLength}}function rotateVector(v,radians){var newX=v.x*Math.cos(radians)-v.y*Math.sin(radians);var newY=v.x*Math.sin(radians)+v.y*Math.cos(radians);return{x:newX,y:newY}}function scale(v,scalar){var newX=v.x*scalar;var newY=v.y*scalar;return{x:newX,y:newY}}return SVGExporter}()},{"./SaveLoadUtility.js":200}],200:[function(require,module,exports){var SaveLoadUtils={exportGraph:function(pathwayDetails){var returnString=pathwayDetails.pathwayTitle+"\n\n";returnString+=pathwayDetails.pathwayDescription+"\n\n";var nodes=pathwayDetails.graphJSON.elements.nodes;var edges=pathwayDetails.graphJSON.elements.edges;returnString+="--NODE_NAME\tNODE_ID\tNODE_TYPE\tPARENT_ID\tPOSX\tPOSY--"+"\n";if(nodes){for(var i=0;i<nodes.length;i++){var nodeName=nodes[i].data.name;var parentID=nodes[i].data.parent;var nodeID=nodes[i].data.id;var pos=nodes[i].position;var nodeType=nodes[i].data.type;if(nodes[i].data.parent){parentID=nodes[i].data.parent}else{parentID=-1}returnString+=nodeName+"\t"+nodeID+"\t"+nodeType+"\t"+parentID+"\t"+parseInt(pos.x)+"\t"+parseInt(pos.y)+"\n"}}returnString+="\n";returnString+="--EDGE_ID\tSOURCE\tTARGET\tEDGE_TYPEINTERACTION_PUBMED_ID\n";if(edges){for(var i=0;i<edges.length;i++){var edgeID=edges[i].data.id;var edgeType=edges[i].data.type;var source=edges[i].data.source;var target=edges[i].data.target;var pubmedIDs=edges[i].data.pubmedIDs;var pubmedString="";if(pubmedIDs!=undefined){for(var j=0;j<pubmedIDs.length;j++){pubmedString+=pubmedIDs[j];if(j!=pubmedIDs.length-1)pubmedString+=";"}}returnString+=edgeID+"\t"+source+"\t"+target+"\t"+edgeType+"\t"+pubmedString+"\n"}}return returnString},exportAsSIFNX:function(pathwayDetails){var returnString="";var nodes=pathwayDetails.graphJSON.elements.nodes;var edges=pathwayDetails.graphJSON.elements.edges;var nodeMap={};returnString+="\n";returnString+="PARTICIPANT\tPARTICIPANT_TYPE\tPARENT_ID\tPOSX\tPOSY"+"\n";if(nodes){for(var i=0;i<nodes.length;i++){var nodeName=nodes[i].data.name;var nodeType=nodes[i].data.type;var parentID=nodes[i].data.parent;var pos=nodes[i].position;nodeMap[nodes[i].data.id]=nodes[i];if(nodes[i].data.parent){parentID=nodes[i].data.parent}else{parentID=-1}returnString+=nodeName+"\t"+nodeType+"\t"+parentID+"\t"+parseInt(pos.x)+"\t"+parseInt(pos.y)+"\t"+pathwayDetails.pathwayTitle+"\n"}}returnString+="\n";returnString+="PARTICIPANT_A\tPARTICIPANT_B\tTYPE\tPUBMED_IDS\n";if(edges){for(var i=0;i<edges.length;i++){var edgeType=edges[i].data.type;var source=edges[i].data.source;var target=edges[i].data.target;var pubmedIDs=edges[i].data.pubmedIDs;var pubmedString="";if(pubmedIDs!=undefined){for(var j=0;j<pubmedIDs.length;j++){pubmedString+=pubmedIDs[j];if(j!=pubmedIDs.length-1)pubmedString+=";"}}returnString+=nodeMap[source].data.name+"\t"+nodeMap[target].data.name+"\t"+edgeType+"\t"+pubmedString+"\n"}}return returnString},parseGraph:function(graphText){var allEles=[];var nodes=[];var edges=[];var seperator=/\r?\n|\r/;var lines=graphText.split(seperator);var edgesStartIndex=-1;var graphDataIndex=5;var title=lines[0];var description=lines[2];if(lines[0].includes("--NODE_NAME")){graphDataIndex=1;title="New Pathway";description=""}for(var i=graphDataIndex;i<lines.length;i++){if(lines[i].length==0||lines[i]===""){edgesStartIndex=i+2;break}var lineData=lines[i].split("\t");var nodeName=lineData[0];var nodeID=lineData[1];var nodeType=lineData[2];var parentID=lineData[3];var posX=lineData.length>4?lineData[4]:"0";var posY=lineData.length>5?lineData[5]:"0";var newNode={group:"nodes",data:{id:nodeID,name:nodeName,type:nodeType},position:{x:parseInt(posX),y:parseInt(posY)}};if(parentID!="-1"){newNode.data.parent=parentID}nodes.push(newNode)}for(var i=edgesStartIndex;i<lines.length;i++){if(lines[i].length==0){break}var lineData=lines[i].split("\t");var edgeID=lineData[0];var edgeSource=lineData[1];var edgeTarget=lineData[2];var edgeType=lineData[3];var pubmedIDs=lineData.length>4?lineData[4].split(";"):[];newEdge={group:"edges",data:{id:edgeID,type:edgeType,source:edgeSource,target:edgeTarget,pubmedIDs:pubmedIDs}};edges.push(newEdge)}return{title:title,description:description,nodes:nodes,edges:edges}}};module.exports=SaveLoadUtils},{}],201:[function(require,module,exports){module.exports=function($){"use strict";var movedNodes=[];function handleNodeAlignment(param){var tmpNodes=window.editorActionsManager.selecteNodeStack;var nodes=cy.collection();var nodeMap={};movedNodes=[];for(var key in tmpNodes){nodes=nodes.add(tmpNodes[key])}nodes.forEach(function(node,index){if(node.isParent()){nodeMap[node.id()]=node}});if(nodes.length>0){var firstSelected=nodes[0];var firstBbox=firstSelected.boundingBox();nodes.forEach(function(node,index){if(index==0){return}if(nodeMap[node.parent().id()]==null){var newPosition=calculateNewPosition(param,node,firstBbox);changePosition(node,0,0,newPosition)}});window.editorActionsManager.handleChangePositionByAlignment(movedNodes)}}function calculateNewPosition(param,node,referenceBbox){var currentPos=node.position();var currentBbox=node.boundingBox();var newPosition;if(param==="vLeft"){newPosition={x:referenceBbox.x1+currentBbox.w/2,y:currentPos.y}}else if(param==="vCen"){newPosition={x:referenceBbox.x1+referenceBbox.w/2,y:currentPos.y}}else if(param==="vRight"){newPosition={x:referenceBbox.x2-currentBbox.w/2,y:currentPos.y}}else if(param==="hTop"){newPosition={x:currentPos.x,y:referenceBbox.y1+currentBbox.h/2}}else if(param==="hMid"){newPosition={x:currentPos.x,y:referenceBbox.y1+referenceBbox.h/2}}else if(param==="hBot"){newPosition={x:currentPos.x,y:referenceBbox.y2-currentBbox.h/2}}else{console.log("Error: wrong alignment name "+param);return}return newPosition}function changePosition(node,dx,dy,newPos){if(node.isParent()){var childNodes=node.children();var parentBbox=node.boundingBox();childNodes.forEach(function(childNode,index){var childBbox=childNode.boundingBox();var _dx=-(parentBbox.x1-childBbox.x1)-parentBbox.w/2+childBbox.w/2;var _dy=-(parentBbox.y1-childBbox.y1)-parentBbox.h/2+childBbox.h/2;if(childNode.isParent()){changePosition(childNode,0,0,{x:newPos.x+_dx,y:newPos.y+_dy})}else{changePosition(childNode,_dx,_dy,newPos)}})}else{var position={x:newPos.x+dx,y:newPos.y+dy};movedNodes.push({node:node,nextPosition:position,oldPosition:null})}}$(".viewDropdown li a").click(function(event){event.preventDefault();var dropdownLinkRole=$(event.target).attr("role");if(dropdownLinkRole=="grid"){$("#gridOptionsDiv").modal("show")}else{handleNodeAlignment(dropdownLinkRole)}});$(".highlightDropDown li a").click(function(event){event.preventDefault();var dropdownLinkRole=$(event.target).attr("role");if(dropdownLinkRole=="highlightInvalidGenes"){window.editorActionsManager.validateGenes()}else{window.editorActionsManager.removeInvalidGeneHighlights()}})}(window.$)},{}],202:[function(require,module,exports){module.exports=function(){function CBioPortalAccessor(){this.GET_ALL_CANCER_STUDIES_URL="http://www.cbioportal.org/webservice.do?cmd=getCancerStudies";this.GET_GENETIC_PROFILES_URL="http://www.cbioportal.org/webservice.do?cmd=getGeneticProfiles&cancer_study_id=";this.GET_PROFILE_DATA_URL="http://www.cbioportal.org/webservice.do?cmd=getProfileData";this.MRNA_EXP_STUDY_NAME="_mrna_median_Zscores";this.CNA_EXP_STUDY_NAME="_gistic";this.VALIDATE_GENES_URL="http://www.cbioportal.org/beta/api/genes/fetch?geneIdType=HUGO_GENE_SYMBOL&projection=ID";this.MUTATION_EXP_STUDY_NAME="_mutations";this.CNA_DELETION=-2;this.CNA_GAIN=2;this.Z_SCORE_UPPER_THRESHOLD=2;this.Z_SCORE_LOWER_THRESHOLD=-2;this.MUTATION="Mutation";this.GENE_EXPRESSION="Gene Expression";this.CNA="Copy Number Alteration"}CBioPortalAccessor.prototype.fetchCancerStudies=function(callbackFunction){var cancerStudies={};var request=new XMLHttpRequest;request.onreadystatechange=function(){if(request.readyState===XMLHttpRequest.DONE&&request.status===200){var seperator=/\r?\n|\r/;var lines=request.responseText.split(seperator);for(var i=1;i<lines.length;i++){if(lines[i].length<=0)continue;var lineData=lines[i].split("\t");cancerStudies[lineData[0]]=lineData}callbackFunction(cancerStudies)}else if(request.readyState===XMLHttpRequest.DONE&&request.status!=200){window.notificationManager.createNotification("Error retrieving cancer studies","fail")}};request.open("GET",this.GET_ALL_CANCER_STUDIES_URL);request.send()};CBioPortalAccessor.prototype.getSupportedGeneticProfiles=function(cancerStudy,callbackFunction){var outData={};var request=new XMLHttpRequest;var self=this;request.onreadystatechange=function(){if(request.readyState===XMLHttpRequest.DONE&&request.status===200){var seperator=/\r?\n|\r/;var lines=request.responseText.split(seperator);for(var i=1;i<lines.length;i++){if(lines[i].length<=0)continue;var lineData=lines[i].split("\t");var cancerProfileName=lineData[0];if(self.isSupportedCancerProfile(cancerProfileName)){outData[cancerProfileName]=lineData}}callbackFunction(outData)}else if(request.readyState===XMLHttpRequest.DONE&&request.status!=200){window.notificationManager.createNotification("Error retrieving genetic profiles","fail")}};request.open("GET",this.GET_GENETIC_PROFILES_URL+cancerStudy);request.send()};CBioPortalAccessor.prototype.isSupportedCancerProfile=function(cancerProfileName){return cancerProfileName.endsWith(this.MRNA_EXP_STUDY_NAME)||cancerProfileName.endsWith(this.CNA_EXP_STUDY_NAME)||cancerProfileName.endsWith(this.MUTATION_EXP_STUDY_NAME)};CBioPortalAccessor.prototype.getDataType=function(cancerProfileName){if(cancerProfileName.endsWith(this.MRNA_EXP_STUDY_NAME)){return this.GENE_EXPRESSION}else if(cancerProfileName.endsWith(this.CNA_EXP_STUDY_NAME)){return this.CNA}else if(cancerProfileName.endsWith(this.MUTATION_EXP_STUDY_NAME)){return this.MUTATION}};CBioPortalAccessor.prototype.calcAlterationPercentages=function(paramLines,geneticProfileId,callbackFunction){var seperator=/\r?\n|\r/;var lines=paramLines.split(seperator);var startIndex=0;for(var i in lines){if(!lines[i].startsWith("#")){startIndex=parseInt(i);break}}var tumorSamples=lines[startIndex].split("\t");var numOfTumorSamples=tumorSamples.length-2;var outData={};outData[geneticProfileId]={};var geneticProfileType=this.getDataType(geneticProfileId);for(var i=startIndex+1;i<lines.length;i++){if(lines[i].length<=0)continue;var lineData=lines[i].split("\t");var profileDataAlteration=0;for(var j=2;j<lineData.length;j++){if(lineData[j]!=="NaN"){if(geneticProfileType==this.MUTATION)profileDataAlteration++;else if(geneticProfileType==this.CNA&&(lineData[j]==this.CNA_GAIN||lineData[j]==this.CNA_DELETION))profileDataAlteration++;else if(geneticProfileType==this.GENE_EXPRESSION&&(parseInt(lineData[j])>=this.Z_SCORE_UPPER_THRESHOLD||parseInt(lineData[j])<=this.Z_SCORE_LOWER_THRESHOLD))profileDataAlteration++}}outData[geneticProfileId][lineData[1]]=profileDataAlteration/numOfTumorSamples*100}callbackFunction(outData)};CBioPortalAccessor.prototype.getProfileData=function(params,callbackFunction){var outData={};var request=new XMLHttpRequest;var self=this;request.onreadystatechange=function(){if(request.readyState===XMLHttpRequest.DONE&&request.status===200){self.calcAlterationPercentages(request.responseText,params.geneticProfileId,callbackFunction);window.notificationManager.createNotification("Profile data "+params.geneticProfileId+" is succesfully loaded from cBioPortal ","success")}};var queryURL=this.GET_PROFILE_DATA_URL;queryURL+="&case_set_id="+params.caseSetId+"_sequenced";queryURL+="&genetic_profile_id="+params.geneticProfileId;queryURL+="&gene_list=";for(var i=0;i<params.genes.length;i++){queryURL+=params.genes[i];if(i!=params.genes.length-1)queryURL+="+"}request.open("GET",queryURL);request.send()};CBioPortalAccessor.prototype.validateGenes=function(nodeSymbols){var request=new XMLHttpRequest;var self=this;request.onreadystatechange=function(){if(request.readyState===XMLHttpRequest.DONE&&request.status===200){var validGeneSymbols=JSON.parse(request.responseText);var validGeneArray=_.map(validGeneSymbols,function(object){return object.hugoGeneSymbol});window.editorActionsManager.highlightInvalidGenes(validGeneArray)}};var queryURL=this.VALIDATE_GENES_URL;request.open("POST",queryURL);request.setRequestHeader("Content-type","application/json");request.send(JSON.stringify(nodeSymbols))};return CBioPortalAccessor}()},{}],203:[function(require,module,exports){var $=window.$=window.jQuery=require("jquery");var _=window._=require("underscore");var Backbone=window.Backbone=require("backbone");Backbone.$=$;require("bootstrap");require("./RealTimeUtils");var WelcomePageView=require("./BackboneViews/WelcomePageView.js");var AppManager=require("./AppManager");var RealTimeModule=require("./RealTimeManager");var SaveLoadUtilities=require("./SaveLoadUtility.js");$(window).load(function(){function getLocalPathway(pathwayName){var request=new XMLHttpRequest;request.onreadystatechange=function(){if(request.readyState===XMLHttpRequest.DONE&&request.status===200){var allEles=SaveLoadUtilities.parseGraph(request.responseText);window.editorActionsManager.loadFile(allEles.nodes,allEles.edges);window.appManager.pathwayDetailsView.updatePathwayProperties({fileName:allEles.title+".txt",pathwayTitle:allEles.title,pathwayDescription:allEles.description})}else{console.log(request.responseText)}};request.open("GET","/pathway?filename="+pathwayName);request.send()}var localUsageCallback=function(postSuccess){var appInstance=new AppManager(false);postSuccess();var uri=window.location.search;if(uri.length>0){var pathwayName=uri.substring(uri.indexOf("=")+1,uri.length);getLocalPathway(pathwayName)}};var collaborativeUsageCallback=function(postSuccess){var realTimeManager=new RealTimeModule(postSuccess);var realTimeAuthCallback=function(response){if(response.error){function popUpAuthHandler(response){if(response.error)console.log(response.error);var appInstance=new AppManager(true,realTimeManager);realTimeManager.initRealTimeAPI()}realTimeManager.authorize(popUpAuthHandler,true)}else{var appInstance=new AppManager(true,realTimeManager);realTimeManager.initRealTimeAPI()}};realTimeManager.authorize(realTimeAuthCallback,false)};var welPage=new WelcomePageView({el:$(".welcomePageContainer"),localUsageCallback:localUsageCallback,collaborativeUsageCallback:collaborativeUsageCallback}).render();var uri=window.location.search;if(uri.length>0){var uriTerm=uri.substring(1,uri.indexOf("="));if(uriTerm==="id"){$(".landingContent h3").hide();$(".welPageButtons").hide();$("#collaborativeUsage").click();$(".continueButton").click().hide()}else if(uriTerm==="filename"){$(".landingContent h3").hide();$(".welPageButtons").hide();$("#localUsage").click();$(".continueButton").click().hide()}}})},{"./AppManager":176,"./BackboneViews/WelcomePageView.js":183,"./RealTimeManager":197,"./RealTimeUtils":198,"./SaveLoadUtility.js":200,backbone:1,bootstrap:4,jquery:142,underscore:144}],204:[function(require,module,exports){},{}],205:[function(require,module,exports){exports.endianness=function(){return"LE"};exports.hostname=function(){if(typeof location!=="undefined"){return location.hostname}else return""};exports.loadavg=function(){return[]};exports.uptime=function(){return 0};exports.freemem=function(){return Number.MAX_VALUE};exports.totalmem=function(){return Number.MAX_VALUE};exports.cpus=function(){return[]};exports.type=function(){return"Browser"};exports.release=function(){if(typeof navigator!=="undefined"){return navigator.appVersion}return""};exports.networkInterfaces=exports.getNetworkInterfaces=function(){return{}};exports.arch=function(){return"javascript"};exports.platform=function(){return"browser"};exports.tmpdir=exports.tmpDir=function(){return"/tmp"};exports.EOL="\n";exports.homedir=function(){return"/"}},{}],206:[function(require,module,exports){(function(process){function normalizeArray(parts,allowAboveRoot){var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up--;up){parts.unshift("..")}}return parts}var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;var splitPath=function(filename){return splitPathRe.exec(filename).slice(1)};exports.resolve=function(){var resolvedPath="",resolvedAbsolute=false;for(var i=arguments.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if(typeof path!=="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!path){continue}resolvedPath=path+"/"+resolvedPath;resolvedAbsolute=path.charAt(0)==="/"}resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."};exports.normalize=function(path){var isAbsolute=exports.isAbsolute(path),trailingSlash=substr(path,-1)==="/";path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path};exports.isAbsolute=function(path){return path.charAt(0)==="/"};exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p,index){if(typeof p!=="string"){throw new TypeError("Arguments to path.join must be strings")}return p}).join("/"))};exports.relative=function(from,to){from=exports.resolve(from).substr(1);to=exports.resolve(to).substr(1);function trim(arr){var start=0;for(;start<arr.length;start++){if(arr[start]!=="")break}var end=arr.length-1;for(;end>=0;end--){if(arr[end]!=="")break}if(start>end)return[];return arr.slice(start,end-start+1)}var fromParts=trim(from.split("/"));var toParts=trim(to.split("/"));var length=Math.min(fromParts.length,toParts.length);var samePartsLength=length;for(var i=0;i<length;i++){if(fromParts[i]!==toParts[i]){samePartsLength=i;break}}var outputParts=[];for(var i=samePartsLength;i<fromParts.length;i++){outputParts.push("..")}outputParts=outputParts.concat(toParts.slice(samePartsLength));return outputParts.join("/")};exports.sep="/";exports.delimiter=":";exports.dirname=function(path){var result=splitPath(path),root=result[0],dir=result[1];if(!root&&!dir){return"."}if(dir){dir=dir.substr(0,dir.length-1)}return root+dir};exports.basename=function(path,ext){var f=splitPath(path)[2];if(ext&&f.substr(-1*ext.length)===ext){f=f.substr(0,f.length-ext.length)}return f};exports.extname=function(path){return splitPath(path)[3]};function filter(xs,f){if(xs.filter)return xs.filter(f);var res=[];for(var i=0;i<xs.length;i++){if(f(xs[i],i,xs))res.push(xs[i])}return res}var substr="ab".substr(-1)==="b"?function(str,start,len){return str.substr(start,len)}:function(str,start,len){if(start<0)start=str.length+start;return str.substr(start,len)}}).call(this,require("_process"))},{_process:207}],207:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.prependListener=noop;process.prependOnceListener=noop;process.listeners=function(name){return[]};process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],208:[function(require,module,exports){(function(setImmediate,clearImmediate){var nextTick=require("process/browser.js").nextTick;var apply=Function.prototype.apply;var slice=Array.prototype.slice;var immediateIds={};var nextImmediateId=0;exports.setTimeout=function(){return new Timeout(apply.call(setTimeout,window,arguments),clearTimeout)};exports.setInterval=function(){return new Timeout(apply.call(setInterval,window,arguments),clearInterval)};exports.clearTimeout=exports.clearInterval=function(timeout){timeout.close()};function Timeout(id,clearFn){this._id=id;this._clearFn=clearFn}Timeout.prototype.unref=Timeout.prototype.ref=function(){};Timeout.prototype.close=function(){this._clearFn.call(window,this._id)};exports.enroll=function(item,msecs){clearTimeout(item._idleTimeoutId);item._idleTimeout=msecs};exports.unenroll=function(item){clearTimeout(item._idleTimeoutId);item._idleTimeout=-1};exports._unrefActive=exports.active=function(item){clearTimeout(item._idleTimeoutId);var msecs=item._idleTimeout;if(msecs>=0){item._idleTimeoutId=setTimeout(function onTimeout(){if(item._onTimeout)item._onTimeout()},msecs)}};exports.setImmediate=typeof setImmediate==="function"?setImmediate:function(fn){var id=nextImmediateId++;var args=arguments.length<2?false:slice.call(arguments,1);immediateIds[id]=true;nextTick(function onNextTick(){if(immediateIds[id]){if(args){fn.apply(null,args)}else{fn.call(null)}exports.clearImmediate(id)}});return id};exports.clearImmediate=typeof clearImmediate==="function"?clearImmediate:function(id){delete immediateIds[id]}}).call(this,require("timers").setImmediate,require("timers").clearImmediate)},{"process/browser.js":207,timers:208}]},{},[203]);